"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[675],{2937(e,a,t){t.d(a,{a:()=>s});var r=t(467),n=t(8201),i=t(2303),o=t(6788);function s(e,a){return u.apply(this,arguments)}function u(){return(u=(0,r.a)(function*(e,a){var t=yield(0,n.a)(a),r={repeated:[[],[],[],[],[],[],[]],scheduled:[]};for(var s of t)if(!(e.indexOf(s.PathAttributeId)<0)){var u=(0,i.h)(s.StartTime,0),d=(0,i.h)(s.EndTime,0),f=60*u.hours+u.minutes,p=60*d.hours+d.minutes,h=parseInt(s.LongHeadway,10),l=parseInt(s.LowHeadway,10);if("0"===s.DateType){var c=parseInt(s.DateValue,10),v={type:"repeated",time:[f,p],interval:[h,l],count:[Math.floor((p-f)/l),Math.floor((p-f)/h)],day:c};r.repeated[c-1].push(v)}else if("1"===s.DateType){var m=s.DateValue,y={type:"scheduled",time:[f,p],interval:[h,l],count:[Math.floor((p-f)/l),Math.floor((p-f)/h)],date:[parseInt(m.slice(0,-4),10),parseInt(m.slice(-4,-2),10),parseInt(m.slice(-2),10)]};r.scheduled.push(y)}}for(var g=0;g<7;g++)r.repeated[g].sort(function(e,a){return e.time[0]-a.time[0]});return(0,o.b)(a),(0,o.a)(a),r})).apply(this,arguments)}},8621(e,a,t){t.d(a,{a:()=>h});var r=t(3453),n=t(467),i=t(5579),o=t(313),s=t(4293),u=t(8201),d=t(8671),f=t(2303),p=t(6788);function h(e,a,t){return l.apply(this,arguments)}function l(){return(l=(0,n.a)(function*(e,a,t){var n=function(e,a){var t={};for(var r of e)if(r.Id===a){t=r;break}return t}(yield(0,s.a)(t,!1),e),h=yield Promise.all([(0,u.a)(t),(0,d.a)(t),(0,o.a)(t)]),l=(0,r.a)(h,3),c=l[0],v=l[1],m=l[2],y=function(e){var a=(0,f.h)(e.goFirstBusTime,0),t=(0,f.h)(e.goLastBusTime,0),r=(0,f.h)(e.backFirstBusTime,0),n=(0,f.h)(e.backLastBusTime,0),i=(0,f.h)(e.holidayGoFirstBusTime,0),o=(0,f.h)(e.holidayGoLastBusTime,0),s=(0,f.h)(e.holidayBackFirstBusTime,0),u=(0,f.h)(e.holidayBackLastBusTime,0),d=(0,f.h)(e.peakHeadway,1),p=(0,f.h)(e.offPeakHeadway,1),h=(0,f.h)(e.holidayPeakHeadway,1),l=(0,f.h)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:a,last:t,rushHourWindow:d,offRushHourWindow:p},holiday:{first:i,last:o,rushHourWindow:h,offRushHourWindow:l}},back:{weekday:{first:r,last:n,rushHourWindow:d,offRushHourWindow:p},holiday:{first:s,last:u,rushHourWindow:h,offRushHourWindow:l}},realSequence:e.realSequence}}(n),g=function(e,a,t,r,n){var o={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,i.f)();for(var u of r)if(a.indexOf(u.PathAttributeId)>-1&&"0"===u.DateType)for(var d=(0,i.d)(u.DateValue),p=(0,i.h)(s,d.day,0,0),h=(0,f.h)(u.StartTime,0),l=(0,i.h)(p,0,h.hours,h.minutes),c=(0,f.h)(u.EndTime,0),v=(0,i.h)(p,0,c.hours,c.minutes),m=Math.abs(60*c.hours+c.minutes-(60*h.hours+h.minutes)),y=parseInt(u.LongHeadway),g=parseInt(u.LowHeadway),_=(g+y)/2,b=m/_,D=0;D<b;D++){var I=!1,S=(0,i.h)(p,0,h.hours,h.minutes+g*D);S.getTime()<l.getTime()&&(I=!0),S.getTime()>v.getTime()&&(I=!0),!1===I&&(o.calendarEventGroups[d.code].push({date:S,dateString:(0,i.c)(S,"hh:mm"),duration:g,deviation:Math.abs(_-g)}),o.calendarEventQuantity[d.code]+=1)}for(var T of n)if(a.indexOf(T.PathAttributeId)>-1&&"0"===T.DateType){var k=(0,i.d)(T.DateValue),w=(0,i.h)(s,k.day,0,0),B=(0,f.h)(T.DepartureTime,0),$=(0,i.h)(w,0,B.hours,B.minutes);o.calendarEventGroups[k.code].push({date:$,dateString:(0,i.c)($,"hh:mm"),duration:15,deviation:0}),o.calendarEventQuantity[k.code]+=1}for(var L in o.calendarEventGroups)o.calendarEventGroups[L].sort(function(e,a){return e.date.getTime()-a.date.getTime()});return o}(0,a,0,c,v),_=function(e,a){var t={};for(var r of e)r.id===a&&(t=r);return t}(m,n.providerId),b={timeTableRules:y,calendar:g,properties:[{key:"route_name",icon:"route",value:n.nameZh},{key:"pricing",icon:"attach_money",value:n.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:_.nameZn},{key:"provider_phone",icon:"call",value:_.phoneInfo},{key:"provider_email",icon:"alternate_email",value:_.email}]};return(0,p.a)(t),(0,p.b)(t),b})).apply(this,arguments)}},7123(e,a,t){t.d(a,{a:()=>_});var r=t(3453),n=t(467),i=t(7183),o=t(8024),s=t(6483),u=t(6802),d=t(7810),f=t(2063),p=t(8011),h=t(4293),l=t(1932),c=t(424),v=t(2303),m=t(6788),y=t(3459),g=t(1531);function _(e,a,t,r,n){return b.apply(this,arguments)}function b(){return(b=(0,n.a)(function*(e,a,t,n,_){(0,m.f)(_,"getRoute_0",0,!1),(0,m.f)(_,"getRoute_1",0,!1),(0,m.f)(_,"getStop_0",0,!1),(0,m.f)(_,"getStop_1",0,!1),(0,m.f)(_,"getLocation_0",0,!1),(0,m.f)(_,"getLocation_1",0,!1),(0,m.f)(_,"getSegmentBuffers_0",0,!1),(0,m.f)(_,"getSegmentBuffers_1",0,!1),(0,m.f)(_,"getEstimateTime_0",0,!1),(0,m.f)(_,"getEstimateTime_1",0,!1),(0,m.f)(_,"getBusEvent_0",0,!1),(0,m.f)(_,"getBusEvent_1",0,!1),(0,m.f)(_,"getBusData_0",0,!1),(0,m.f)(_,"getBusData_1",0,!1);var b=yield Promise.all([(0,h.a)(_,!0),(0,c.a)(_),(0,l.a)(_),(0,f.a)(_)]),D=(0,r.a)(b,4),I=D[0],S=D[1],T=D[2],k=D[3],w=yield Promise.all([(0,p.a)(_,0),(0,p.a)(_,1),(0,p.a)(_,2),(0,d.a)(_)]),B=(0,r.a)(w,4),$=B[0],L=B[1],E=B[2],P=B[3],R=yield Promise.all([(0,u.a)(_),(0,s.b)(t,n)]),H=(0,r.a)(R,2),M=H[0],x=H[1],O=(0,v.b)(P,M,I,e,a),C=!1,W={};(0,o.f)(T,`r_${e}`)&&(C=!0,W=T[`r_${e}`]);var G=(0,y.b)("time_formatting_mode"),q=[],A=[];for(var Q of k){var F={},N=Q.RouteID;if([e,10*e].includes(N)||a.includes(N)){F.status=(0,v.g)(null==Q?void 0:Q.EstimateTime,G);var V=`s_${Q.StopID}`,Z={};if(!(0,o.f)(S,V))continue;Z=S[V],F.id=Q.StopID,F.sequence=Z.seqNo,F.goBack=Z.goBack;var U=`l_${Z.stopLocationId}`,j={};if(!(0,o.f)($,U))continue;j=$[U],F.name=j.n;var z=j.r.length;F.overlappingRoutes=[];for(var J=0;J<z;J++){var K=j.r[J];if(K!==e){var X=`r_${K}`;if((0,o.f)(I,X)){var Y=I[X],ee={name:Y.n,RouteEndPoints:{RouteDeparture:Y.dep,RouteDestination:Y.des,text:`${Y.dep} ↔ ${Y.des}`,html:`<span>${Y.dep}</span><span>↔</span><span>${Y.des}</span>`},RouteID:Y.id,PathAttributeId:Y.pid};F.overlappingRoutes.push(ee)}}}F.position={longitude:j.lo,latitude:j.la},A.push({latitude:j.la,longitude:j.lo,id:Q.StopID});var ae=j.g,te=[];for(var re of((0,o.f)(E,ae)&&(te=E[ae]),F.nearbyLocations=[],te)){var ne=`ml_${re.hash}`;if((0,o.f)(L,ne)){var ie=L[ne],oe={name:ie.n,distance:0|(0,i.c)(ie.la[0],ie.lo[0],j.la,j.lo),hash:ie.hash};F.nearbyLocations.push(oe)}}for(var se of(F.nearbyLocations.sort(function(e,a){return e.distance-a.distance}),F.buses=[],j.s)){var ue=`s_${se}`;if((0,o.f)(O,ue))for(var de=O[ue].length-1;de>=0;de--)F.buses.push((0,v.c)(O[ue][de]))}F.buses.sort(function(e,a){return e.index-a.index});var fe=[];(0,o.f)(x,V)&&(fe=x[V]),F.busArrivalTimes=fe;var pe=!1,he=!1,le=!1,ce=!1;if(C){var ve=`g_${F.goBack}`,me=[];for(var ye of((0,o.f)(W,ve)?me=W[ve]:"1"===F.goBack&&(ce=!0,me=W.g_0),me))ye.OriginStopID!==Q.StopID&&ye.DestinationStopID!==Q.StopID||(pe=!0),ce?(ye.OriginStopID===Q.StopID&&(le=!0),ye.DestinationStopID===Q.StopID&&(he=!0)):(ye.OriginStopID===Q.StopID&&(he=!0),ye.DestinationStopID===Q.StopID&&(le=!0))}F.segmentBuffer={isSegmentBuffer:pe,isStartingPoint:he,isEndingPoint:le},q.push(F)}}q.sort(function(e,a){return e.sequence-a.sequence});for(var ge=(0,g.b)(A,450),_e=!1,be=!1,De={},Ie=0,Se={},Te=q.length,ke=0;ke<Te;ke++){var we=q[ke],Be=q[ke+1]||we,$e=0;if(we.buses.length>0&&we.buses[0].onThisRoute){var Le=[we.buses[0].position.longitude,we.buses[0].position.latitude],Ee=Le[0],Pe=Le[1],Re=[we.position.longitude,we.position.latitude],He=Re[0],Me=Re[1],xe=[Be.position.longitude,Be.position.latitude],Oe=xe[0],Ce=xe[1];if((Ee-He)*(Oe-Ee)+(Pe-Me)*(Ce-Pe)>=0){var We=Math.hypot(Ee-He,Pe-Me),Ge=Math.hypot(Ee-Oe,Pe-Ce);$e=Math.max(0,Math.min(We/(We+Ge),1))}}we.progress=$e,we.segmentBuffer.isStartingPoint&&(_e=!0),we.segmentBuffer.isEndingPoint&&_e&&(be=!0),_e&&!be&&(we.segmentBuffer.isSegmentBuffer=!0),_e&&be&&(_e=!1,be=!1);var qe=!1;null!==ge&&ge.id===we.id&&(qe=!0),we.nearest=qe;var Ae=`g_${we.goBack}`||"g_0";(0,o.f)(De,Ae)||(De[Ae]=[],Se[Ae]=0,Ie+=1),De[Ae].push(we),Se[Ae]+=1}var Qe=I[`r_${e}`],Fe=Qe.n,Ne=Qe.dep,Ve=Qe.des,Ze={groupNames:[`往${Ve}`,`往${Ne}`],groupedItems:De,groupQuantity:Ie,itemQuantity:Se,RouteName:Fe,RouteEndPoints:[Ne,Ve],dataUpdateTime:(0,m.e)(_),RouteID:e,PathAttributeId:a};return(0,m.a)(_),(0,m.b)(_),Ze})).apply(this,arguments)}},8134(e,a,t){t.d(a,{a:()=>b,b:()=>S,c:()=>p,d:()=>v,e:()=>l});var r=t(467),n=t(2129),i=t(8024),o=t(4781),s=t(9734),u=t(8011),d=t(4293),f=t(6788);function p(e){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return(c=(0,r.a)(function*(e){var a,t=(0,i.c)(),r=yield(0,d.a)(t,!0),n=`r_${e}`;return!!(0,i.f)(r,n)&&(a=r[n],(0,f.a)(t),(0,f.b)(t),a)})).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}var y={},g=[],_=!1;function b(){return D.apply(this,arguments)}function D(){return(D=(0,r.a)(function*(){if(!_){var e=(0,i.c)(),a=yield(0,d.a)(e,!0),t=yield(0,u.a)(e,1),r=yield(0,s.a)(e,!0);(0,f.a)(e),(0,f.b)(e);var n={},p=[],h=0;for(var l in a){var c=a[l],v={id:c.id,pid:c.pid,dep:c.dep,des:c.des,n:c.n,hash:"",lo:"",la:"",r:"",s:"",type:0};p.push(v);var m=(0,o.b)(`${v.n.toLowerCase()}${v.dep.toLowerCase()}${v.des.toLowerCase()}`,!0);for(var b of m){var D=`u_${b}`;(0,i.f)(n,D)||(n[D]=[]),n[D].push(h)}h+=1}for(var I in t){var S=t[I],T={id:S.id,n:S.n,lo:S.lo,la:S.la,r:S.r,s:S.s,hash:S.hash,dep:"",des:"",pid:[],type:1};p.push(T);var k=(0,o.b)(T.n.toLowerCase(),!0);for(var w of k){var B=`u_${w}`;(0,i.f)(n,B)||(n[B]=[]),n[B].push(h)}h+=1}for(var $ in r){var L=r[$],E={id:L.BusId,pid:[],dep:"",des:"",n:L.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};p.push(E);var P=(0,o.b)(E.n.toLowerCase(),!0);for(var R of P){var H=`u_${R}`;(0,i.f)(n,H)||(n[H]=[]),n[H].push(h)}h+=1}y=n,g=p,_=!0}})).apply(this,arguments)}function I(e,a){var t=0,r=0;for(var n of a){t+=e.indexOf(n,r)-r,r+=1}return e===a&&(t=10*Math.abs(t)),t}function S(e,a,t){if(!_)return[];var r=e.toLowerCase(),s=(0,o.b)(r,!0),u=(0,o.b)(r,!1),d=[];for(var f of s){var p=`u_${f}`;(0,i.f)(y,p)&&d.push(y[p])}d.sort(function(e,a){return e.length-a.length});var h=d.length-1,l=[];if(0===h&&(l=d[0]),h>0)for(var c=0;c<h;c++){var v=d[c],m=d[c+1];l=0===c?(0,n.b)(v,m):(0,n.b)(l,m)}var b=[],D=0,S=new Set;if(-1===a||2===a){var T=g.filter(function(e){return e.n===r&&2===e.type});for(var k of T)if(b.push({item:k,score:1/0}),S.add(k.id),(D+=1)>=t)break}if(D<t)for(var w of l){var B=g[w];if((-1===a||a===B.type)&&!S.has(B.id)){var $=I(u,(0,o.b)(B.n,!1));if(!(D<t))break;b.push({item:B,score:$}),D+=1}}return b.sort(function(e,a){return a.score-e.score}),b}}}]);
//# sourceMappingURL=18990a5336d7bc5b7809.js.map