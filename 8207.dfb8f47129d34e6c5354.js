"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[588,8207],{2757(t,e,r){r.d(e,{R:()=>O});var n=r(467),i=r(4256),a=r(574),o=r(2945),u=r(5428),f=r(6483),s=r(6802),l=r(7810),c=r(2063),p=r(8011),y=r(4293),d=r(424),v=r(2303),m=r(6788),h=r(3459),g=r(1238);function _(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return $(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function b(t,e){var r={},n=[];for(var i in t){var a=t[i],o=a.StopID,u=parseInt(a.EstimateTime);u>=0&&e.indexOf(o)>-1&&n.push([o,u])}var f=n.length;n.sort(function(t,e){return t[1]-e[1]});for(var s=1,l=0,c=n;l<c.length;l++){var p=s/f,y=(p-p%.25)/.25;r[`s_${c[l][0]}`]={number:s,text:s.toString(),code:y},s+=1}return r}function O(t,e,r,n){return S.apply(this,arguments)}function S(){return(S=(0,n.A)(function*(t,e,r,n){(0,m.Mf)(n,"getLocation_0",0,!1),(0,m.Mf)(n,"getLocation_1",0,!1),(0,m.Mf)(n,"getRoute_0",0,!1),(0,m.Mf)(n,"getRoute_1",0,!1),(0,m.Mf)(n,"getStop_0",0,!1),(0,m.Mf)(n,"getStop_1",0,!1),(0,m.Mf)(n,"getEstimateTime_0",0,!1),(0,m.Mf)(n,"getEstimateTime_1",0,!1),(0,m.Mf)(n,"getBusEvent_0",0,!1),(0,m.Mf)(n,"getBusEvent_1",0,!1);for(var $=yield(0,c.K)(n),O=yield(0,p.g)(n,1),S=yield(0,y.a)(n,!0),A=yield(0,d.T)(n),w=yield(0,l.J)(n),J=yield(0,s.d)(n),I=yield(0,f.Io)(e,r),x=(0,h.Js)("time_formatting_mode"),L=(0,h.Js)("location_labels"),C=(0,h.Js)("display_user_orientation"),N={},T={},M={},k=(0,g.Y)(),P=O[`ml_${t}`],D=P.n,E=P.id,Q=P.v,z=[],R=[],j=E.length,q=0;q<j;q++)z=z.concat(P.s[q]),R=R.concat(P.r[q]);var B,F=function(t,e){var r,n={},i=_(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.indexOf(a.StopID)>-1&&(n[`s_${a.StopID}`]=a)}}catch(t){i.e(t)}finally{i.f()}return n}($,z),U=(0,v.AS)(w,J,S,z),K=[],V=_(Q);try{for(V.s();!(B=V.n()).done;){var Z,H=B.value,W=0,X=0,Y=_(H);try{for(Y.s();!(Z=Y.n()).done;){var G=Z.value;W+=G[0],X+=G[1]}}catch(t){Y.e(t)}finally{Y.f()}var tt=(0,u.hF)([W,X]),et=(0,a.DK)(tt);K.push(et)}}catch(t){V.e(t)}finally{V.f()}var rt=[];switch(L){case"address":rt=(0,i._q)(P.a);break;case"letters":rt=(0,o.V)(j);break;case"directions":rt=(0,o.M)(K)}for(var nt=0;nt<j;nt++){var it=`g_${nt}`;N[it]=[],T[it]=0,M[it]={name:rt[nt],properties:[{key:"address",icon:"personal_places",value:(0,i.pD)(P.a[nt])},{key:"exact_position",icon:"location_on",value:`${P.la[nt].toFixed(5)}, ${P.lo[nt].toFixed(5)}`},{key:"cardinal_direction",icon:K[nt].icon,value:`${K[nt].name}${C&&-1!==k.cardinalDirection.id&&k.cardinalDirection.id===K[nt].id?"（目前指向）":""}`}]};for(var at=P.s[nt],ot=at.length,ut=b(F,at),ft=0;ft<ot;ft++){var st={},lt=P.s[nt][ft],ct=`s_${lt}`,pt={};if(A.hasOwnProperty(ct)){pt=A[ct],st.stopId=lt;var yt={number:0,text:"--",code:-1};ut.hasOwnProperty(ct)&&(yt=ut[ct]),st.ranking=yt;var dt=P.r[nt][ft],vt=`r_${dt}`,mt={};if(S.hasOwnProperty(vt)){mt=S[vt],st.route_name=mt.n,st.route_direction=`往${[mt.des,mt.dep,""][parseInt(pt.goBack)]}`,st.routeId=dt;var ht={};if(F.hasOwnProperty(ct)){ht=F[ct];var gt=(0,v.$Q)(ht.EstimateTime,x);st.status=gt;var _t=[];U.hasOwnProperty(ct)&&(_t=U[ct].map(function(t){return(0,v.s$)(t)})),st.buses=_t;var $t=[];I.hasOwnProperty(ct)&&($t=I[ct]),st.busArrivalTimes=$t,N[it].push(st),T[it]+=1}}}}}for(var bt in N)N[bt].sort(function(t,e){return t.routeId-e.routeId});var Ot={groupedItems:N,groups:M,groupQuantity:j,itemQuantity:T,LocationName:D,hash:t,dataUpdateTime:(0,m.Zt)(n)};return(0,m.LQ)(n),(0,m.gC)(n),Ot})).apply(this,arguments)}},9566(t,e,r){r.d(e,{$j:()=>M,DW:()=>V,Fq:()=>U,L2:()=>J,LH:()=>z,NC:()=>j,R_:()=>P,Rh:()=>$,Xi:()=>N,aq:()=>B,bq:()=>H,eD:()=>I,g$:()=>A,vV:()=>O,z$:()=>E});var n=r(2284),i=r(467),a=r(8024),o=r(6483),u=r(5767),f=r(2063),s=r(8011),l=r(9218),c=r(4293),p=r(424),y=r(2303),d=r(6788),v=r(3459),m=r(4311);function h(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return g(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var _={};function $(){return b.apply(this,arguments)}function b(){return(b=(0,i.A)(function*(){var t,e=h(yield(0,m.Su)(11));try{for(e.s();!(t=e.n()).done;){var r=t.value,n=yield(0,m.Ct)(11,r);if(n){var i=JSON.parse(n);_.hasOwnProperty(r)||(_[r]=i)}}}catch(t){e.e(t)}finally{e.f()}})).apply(this,arguments)}function O(t,e){return S.apply(this,arguments)}function S(){return(S=(0,i.A)(function*(t,e){var r=(0,a.zx)(),n=yield(0,l.l)(r);if((0,d.LQ)(r),!n.symbols.hasOwnProperty(e))return!1;var i=(0,a.zx)(),o=`f_${i}`;if(_.hasOwnProperty(o))return!1;if(yield(0,m.Ct)(11,o))return!1;var u={name:t,icon:e,id:i,timestamp:(new Date).getTime()};return _[o]=u,yield(0,m.mL)(11,o,JSON.stringify(u)),yield(0,m.mL)(12,o,JSON.stringify([])),i})).apply(this,arguments)}function A(t,e,r){return w.apply(this,arguments)}function w(){return(w=(0,i.A)(function*(t,e,r){var n=`f_${t}`,i=yield(0,m.Ct)(11,n);if(!i)return!1;var o=JSON.parse(i),u=(0,a.zx)(),f=yield(0,l.l)(u);if((0,d.LQ)(u),!f.symbols.hasOwnProperty(r))return!1;var s={name:e,icon:r,id:t,timestamp:o.timestamp};return _[n]=s,yield(0,m.mL)(11,n,JSON.stringify(s)),!0})).apply(this,arguments)}function J(t){var e=`f_${t}`;return!!_.hasOwnProperty(e)&&{name:_[e].name,icon:_[e].icon,id:_[e].id,timestamp:_[e].timestamp}}function I(t){return x.apply(this,arguments)}function x(){return(x=(0,i.A)(function*(t){var e=[],r=`f_${t}`,n=J(t);if("boolean"==typeof n&&!1===n)return e;var i=yield(0,m.Ct)(12,r);if(!i)return e;var a=JSON.parse(i);if(0===a.length){return e.push({type:"empty",id:0,index:0}),e}var o,u=h(a);try{for(u.s();!(o=u.n()).done;){var f=o.value,s=yield(0,m.Ct)(13,f);if(s){var l=JSON.parse(s);e.push(l)}}}catch(t){u.e(t)}finally{u.f()}return e})).apply(this,arguments)}function L(t){return C.apply(this,arguments)}function C(){return(C=(0,i.A)(function*(t){var e=`f_${t}`,r=yield(0,m.Ct)(12,e);return r?JSON.parse(r).length:0})).apply(this,arguments)}function N(){return T.apply(this,arguments)}function T(){return(T=(0,i.A)(function*(){var t,e=yield function(){var t=[];for(var e in _){var r={name:_[e].name,icon:_[e].icon,id:_[e].id,timestamp:_[e].timestamp};t.push(r)}return t.sort(function(t,e){return t.timestamp-e.timestamp}),t}(),r=[],n=h(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=yield I(i.id),o=yield L(i.id);r.push({name:i.name,icon:i.icon,id:i.id,timestamp:i.timestamp,content:a,contentLength:o})}}catch(t){n.e(t)}finally{n.f()}return r})).apply(this,arguments)}function M(t){return k.apply(this,arguments)}function k(){return(k=(0,i.A)(function*(t){var e=!0;"object"===(0,n.A)(t)&&Array.isArray(t)||(e=!1);var r,i=[],a=h(yield(0,m.Su)(13));try{for(a.s();!(r=a.n()).done;){var o=r.value,u=yield(0,m.Ct)(13,o);if(u){var f=JSON.parse(u);e?t.indexOf(f.type)>-1&&i.push(f):i.push(f)}}}catch(t){a.e(t)}finally{a.f()}return i})).apply(this,arguments)}function P(t){return D.apply(this,arguments)}function D(){return(D=(0,i.A)(function*(t){(0,d.Mf)(t,"getEstimateTime_0",0,!1),(0,d.Mf)(t,"getEstimateTime_1",0,!1),(0,d.Mf)(t,"getRoute_0",0,!1),(0,d.Mf)(t,"getRoute_1",0,!1);var e,r=yield(0,f.K)(t),n=yield(0,c.a)(t,!0),i=yield N(),a=(0,v.Js)("time_formatting_mode"),s=(0,v.Js)("power_saving"),l=(0,v.Js)("refresh_interval"),p=[],m=h(i);try{for(m.s();!(e=m.n()).done;){var g=e.value;p=p.concat(g.content.filter(function(t){return"stop"===t.type}).map(function(t){return t.id}))}}catch(t){m.e(t)}finally{m.f()}var _,$={},b=h(r);try{for(b.s();!(_=b.n()).done;){var O=_.value;if(p.indexOf(O.StopID)>-1)$[`s_${O.StopID}`]=O}}catch(t){b.e(t)}finally{b.f()}var S,A=[],w=h(i);try{for(w.s();!(S=w.n()).done;){var J,I=S.value,x={name:I.name,icon:I.icon,id:I.id,timestamp:I.timestamp,content:[],contentLength:I.contentLength},L=h(I.content);try{for(L.s();!(J=L.n()).done;){var C=J.value;switch(C.type){case"stop":var T=`s_${C.id}`,M={};if(!$.hasOwnProperty(T))break;M=$[T],C.status=(0,y.$Q)(M.EstimateTime,a);var k=n[`r_${C.route.id}`];C.route.pathAttributeId=k.pid;break;case"route":var P=n[`r_${C.id}`];C.pathAttributeId=P.pid}x.content.push(C)}}catch(t){L.e(t)}finally{L.f()}A.push(x)}}catch(t){w.e(t)}finally{w.f()}var D={folders:A,dataUpdateTime:(0,d.Zt)(t)};return(0,d.LQ)(t),(0,d.gC)(t),s||(l.dynamic&&(yield(0,u.Eu)(r)),yield(0,o.VZ)(r)),D})).apply(this,arguments)}function E(t,e){return Q.apply(this,arguments)}function Q(){return(Q=(0,i.A)(function*(t,e){var r=`f_${t}`,n=`${e.type}_${e.id}`,i=J(t);if("boolean"==typeof i&&!1===i)return!1;var a=yield(0,m.Ct)(12,r);if(!a)return!1;var o=JSON.parse(a);return(0===o.length||o.indexOf(n)<0)&&(yield(0,m.mL)(12,r,JSON.stringify(o.concat(n))),yield(0,m.mL)(13,n,JSON.stringify(e)),!0)})).apply(this,arguments)}function z(t,e){return R.apply(this,arguments)}function R(){return(R=(0,i.A)(function*(t,e){var r,n=`${t}_${e}`,i=h(yield(0,m.Su)(12));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=yield(0,m.Ct)(12,a);if(o)if(JSON.parse(o).indexOf(n)>-1)return!0}}catch(t){i.e(t)}finally{i.f()}return!1})).apply(this,arguments)}function j(t,e,r){return q.apply(this,arguments)}function q(){return(q=(0,i.A)(function*(t,e,r){var n=`f_${t}`,i=`${e}_${r}`,a=J(t);if("boolean"==typeof a&&!1===a)return!1;var o=yield(0,m.Ct)(12,n);if(!o)return!1;var u=JSON.parse(o),f=u.indexOf(i);return f>-1&&u.length>0&&(u.splice(f,1),yield(0,m.mL)(12,n,JSON.stringify(u))),!1===(yield z(e,r))&&(yield(0,m.iQ)(13,i)),!0})).apply(this,arguments)}function B(t,e,r){return F.apply(this,arguments)}function F(){return(F=(0,i.A)(function*(t,e,r){var n=(0,a.zx)(),i=yield(0,p.T)(n),o=yield(0,s.g)(n,0),u=yield(0,c.a)(n,!0),f=i[`s_${e}`],l=parseInt(f.goBack),y=o[`l_${f.stopLocationId}`].n,d=u[`r_${r}`],v=d.n,m=d.dep,h=d.des,g={type:"stop",id:e,timestamp:(new Date).getTime(),name:y,direction:l,route:{name:v,endPoints:{departure:m,destination:h},id:r}};return yield E(t,g)})).apply(this,arguments)}function U(t,e){return K.apply(this,arguments)}function K(){return(K=(0,i.A)(function*(t,e){var r=(0,a.zx)(),n=yield(0,c.a)(r,!0);(0,d.LQ)(r),(0,d.gC)(r);var i=`r_${e}`,o={};if(!n.hasOwnProperty(i))return!1;o=n[i];var u={type:"route",id:e,timestamp:(new Date).getTime(),name:o.n,endPoints:{departure:o.dep,destination:o.des}};return yield E(t,u)})).apply(this,arguments)}function V(t,e){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.A)(function*(t,e){var r=(0,a.zx)(),n=yield(0,s.g)(r,1);(0,d.LQ)(r),(0,d.gC)(r);var i=`ml_${e}`,o={};if(!n.hasOwnProperty(i))return!1;o=n[i];var u={type:"location",id:e,timestamp:(new Date).getTime(),name:o.n};return yield E(t,u)})).apply(this,arguments)}function H(t,e,r,n){return W.apply(this,arguments)}function W(){return(W=(0,i.A)(function*(t,e,r,n){var i=`f_${t}`,a=`${e}_${r}`,o=J(t);if("boolean"==typeof o&&!1===o)return!1;var u=yield(0,m.Ct)(12,i);if(!u)return!1;var f=JSON.parse(u),s=f.indexOf(a);if(s>-1&&f.length>1){var l=0;switch(n){case"up":l=-1;break;case"down":l=1;break;default:l=0}return f.splice(s,1),f.splice(s+l,0,a),yield(0,m.mL)(12,i,JSON.stringify(f)),!0}return!1})).apply(this,arguments)}}}]);
//# sourceMappingURL=8207.dfb8f47129d34e6c5354.js.map