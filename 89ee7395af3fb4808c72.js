"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[323],{7123(e,t,n){n.d(t,{R:()=>_});var a=n(467),r=n(7183),o=n(6483),i=n(6802),u=n(7810),s=n(2063),d=n(8011),l=n(4293),f=n(1932),c=n(424),y=n(2303),p=n(6788),h=n(3459),m=n(1531);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function _(e,t,n,a,r){return S.apply(this,arguments)}function S(){return(S=(0,a.A)(function*(e,t,n,a,g){(0,p.Mf)(g,"getRoute_0",0,!1),(0,p.Mf)(g,"getRoute_1",0,!1),(0,p.Mf)(g,"getStop_0",0,!1),(0,p.Mf)(g,"getStop_1",0,!1),(0,p.Mf)(g,"getLocation_0",0,!1),(0,p.Mf)(g,"getLocation_1",0,!1),(0,p.Mf)(g,"getSegmentBuffers_0",0,!1),(0,p.Mf)(g,"getSegmentBuffers_1",0,!1),(0,p.Mf)(g,"getEstimateTime_0",0,!1),(0,p.Mf)(g,"getEstimateTime_1",0,!1),(0,p.Mf)(g,"getBusEvent_0",0,!1),(0,p.Mf)(g,"getBusEvent_1",0,!1),(0,p.Mf)(g,"getBusData_0",0,!1),(0,p.Mf)(g,"getBusData_1",0,!1);var _=yield(0,l.a)(g,!0),S=yield(0,c.T)(g),b=yield(0,d.g)(g,0),w=yield(0,d.g)(g,1),I=yield(0,d.g)(g,2),D=yield(0,f.L)(g),T=yield(0,s.K)(g),k=yield(0,u.J)(g),B=yield(0,i.d)(g),P=yield(0,o.Io)(n,a),M=(0,y.w_)(k,B,_,e,t),$=!1,E={};D.hasOwnProperty(`r_${e}`)&&($=!0,E=D[`r_${e}`]);var R,A=(0,h.Js)("time_formatting_mode"),O=[],U=[],H=v(T);try{for(H.s();!(R=H.n()).done;){var L=R.value,Q={},x=L.RouteID;if([e,10*e].includes(x)||t.includes(x)){Q.status=(0,y.$Q)(null==L?void 0:L.EstimateTime,A);var W=`s_${L.StopID}`,G={};if(!S.hasOwnProperty(W))continue;G=S[W],Q.id=L.StopID,Q.sequence=G.seqNo,Q.goBack=G.goBack;var q=`l_${G.stopLocationId}`,C={};if(!b.hasOwnProperty(q))continue;C=b[q],Q.name=C.n,Q.overlappingRoutes=C.r.filter(function(t){return t!==e}).map(function(e){var t=`r_${e}`;if(_.hasOwnProperty(t)){var n=_[t];return{name:n.n,RouteEndPoints:{RouteDeparture:n.dep,RouteDestination:n.des,text:`${n.dep} ↔ ${n.des}`,html:`<span>${n.dep}</span><span>↔</span><span>${n.des}</span>`},RouteID:n.id,PathAttributeId:n.pid}}return null}).filter(function(e){return null!==e}),Q.position={longitude:C.lo,latitude:C.la},U.push({latitude:C.la,longitude:C.lo,id:L.StopID});var j=C.g,F=[];I.hasOwnProperty(j)&&(F=I[j]);var Z,V=[],J=v(F);try{for(J.s();!(Z=J.n()).done;){var N=`ml_${Z.value.hash}`;if(w.hasOwnProperty(N)){var K=w[N],Y={name:K.n,distance:0|(0,r.aV)(K.la[0],K.lo[0],C.la,C.lo),hash:K.hash};V.push(Y)}}}catch(e){J.e(e)}finally{J.f()}V.sort(function(e,t){return e.distance-t.distance}),Q.nearbyLocations=V;var z,X=[],ee=v(C.s);try{for(ee.s();!(z=ee.n()).done;){var te=`s_${z.value}`;M.hasOwnProperty(te)&&X.push(M[te].map(function(e){return(0,y.s$)(e)}))}}catch(e){ee.e(e)}finally{ee.f()}Q.buses=X.flat().sort(function(e,t){return e.index-t.index});var ne=[];P.hasOwnProperty(W)&&(ne=P[W]),Q.busArrivalTimes=ne;var ae=!1,re=!1,oe=!1,ie=!1;if($){var ue=`g_${Q.goBack}`,se=[];E.hasOwnProperty(ue)?se=E[ue]:"1"===Q.goBack&&(ie=!0,se=E.g_0);var de,le=v(se);try{for(le.s();!(de=le.n()).done;){var fe=de.value;fe.OriginStopID!==L.StopID&&fe.DestinationStopID!==L.StopID||(ae=!0),ie?(fe.OriginStopID===L.StopID&&(oe=!0),fe.DestinationStopID===L.StopID&&(re=!0)):(fe.OriginStopID===L.StopID&&(re=!0),fe.DestinationStopID===L.StopID&&(oe=!0))}}catch(e){le.e(e)}finally{le.f()}}Q.segmentBuffer={isSegmentBuffer:ae,isStartingPoint:re,isEndingPoint:oe},O.push(Q)}}}catch(e){H.e(e)}finally{H.f()}O.sort(function(e,t){return e.sequence-t.sequence});for(var ce=(0,m.uQ)(U,450),ye=!1,pe=!1,he={},me=0,ve={},ge=O.length,_e=0;_e<ge;_e++){var Se=O[_e],be=O[_e+1]||Se,we=0;if(Se.buses.length>0&&Se.buses[0].onThisRoute){var Ie=[Se.buses[0].position.longitude,Se.buses[0].position.latitude],De=Ie[0],Te=Ie[1],ke=[Se.position.longitude,Se.position.latitude],Be=ke[0],Pe=ke[1],Me=[be.position.longitude,be.position.latitude],$e=Me[0],Ee=Me[1];if((De-Be)*($e-De)+(Te-Pe)*(Ee-Te)>=0){var Re=Math.hypot(De-Be,Te-Pe),Ae=Math.hypot(De-$e,Te-Ee);we=Math.max(0,Math.min(Re/(Re+Ae),1))}}Se.progress=we,Se.segmentBuffer.isStartingPoint&&(ye=!0),Se.segmentBuffer.isEndingPoint&&ye&&(pe=!0),ye&&!pe&&(Se.segmentBuffer.isSegmentBuffer=!0),ye&&pe&&(ye=!1,pe=!1);var Oe=!1;null!==ce&&ce.id===Se.id&&(Oe=!0),Se.nearest=Oe;var Ue=`g_${Se.goBack}`||"g_0";he.hasOwnProperty(Ue)||(he[Ue]=[],ve[Ue]=0,me+=1),he[Ue].push(Se),ve[Ue]+=1}var He=_[`r_${e}`],Le={groupedItems:he,groupQuantity:me,itemQuantity:ve,RouteName:He.n,RouteEndPoints:{RouteDeparture:He.dep,RouteDestination:He.des},dataUpdateTime:(0,p.Zt)(g),RouteID:e,PathAttributeId:t};return(0,p.LQ)(g),(0,p.gC)(g),Le})).apply(this,arguments)}},8621(e,t,n){n.d(t,{p:()=>y});var a=n(467),r=n(5579),o=n(313),i=n(4293),u=n(8201),s=n(8671),d=n(2303),l=n(6788);function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function y(e,t,n){return p.apply(this,arguments)}function p(){return(p=(0,a.A)(function*(e,t,n){var a=function(e,t){var n,a={},r=f(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.Id===t){a=o;break}}}catch(e){r.e(e)}finally{r.f()}return a}(yield(0,i.a)(n,!1),e),c=yield(0,u.Y)(n),y=yield(0,s.s)(n),p=yield(0,o.s)(n),h=function(e){var t=(0,d.aU)(e.goFirstBusTime,0),n=(0,d.aU)(e.goLastBusTime,0),a=(0,d.aU)(e.backFirstBusTime,0),r=(0,d.aU)(e.backLastBusTime,0),o=(0,d.aU)(e.holidayGoFirstBusTime,0),i=(0,d.aU)(e.holidayGoLastBusTime,0),u=(0,d.aU)(e.holidayBackFirstBusTime,0),s=(0,d.aU)(e.holidayBackLastBusTime,0),l=(0,d.aU)(e.peakHeadway,1),f=(0,d.aU)(e.offPeakHeadway,1),c=(0,d.aU)(e.holidayPeakHeadway,1),y=(0,d.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:l,offRushHourWindow:f},holiday:{first:o,last:i,rushHourWindow:c,offRushHourWindow:y}},back:{weekday:{first:a,last:r,rushHourWindow:l,offRushHourWindow:f},holiday:{first:u,last:s,rushHourWindow:c,offRushHourWindow:y}},realSequence:e.realSequence}}(a),m=function(e,t,n,a,o){var i,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,r.P$)(),l=f(a);try{for(l.s();!(i=l.n()).done;){var c=i.value;if(t.indexOf(c.PathAttributeId)>-1&&"0"===c.DateType)for(var y=(0,r.mr)(c.DateValue),p=(0,r.S1)(s,y.day,0,0),h=(0,d.aU)(c.StartTime,0),m=(0,r.S1)(p,0,h.hours,h.minutes),v=(0,d.aU)(c.EndTime,0),g=(0,r.S1)(p,0,v.hours,v.minutes),_=Math.abs(60*v.hours+v.minutes-(60*h.hours+h.minutes)),S=parseInt(c.LongHeadway),b=parseInt(c.LowHeadway),w=(b+S)/2,I=_/w,D=0;D<I;D++){var T=!1,k=(0,r.S1)(p,0,h.hours,h.minutes+b*D);k.getTime()<m.getTime()&&(T=!0),k.getTime()>g.getTime()&&(T=!0),!1===T&&(u.calendarEventGroups[y.code].push({date:k,dateString:(0,r.$T)(k,"hh:mm"),duration:b,deviation:Math.abs(w-b)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){l.e(e)}finally{l.f()}var B,P=f(o);try{for(P.s();!(B=P.n()).done;){var M=B.value;if(t.indexOf(M.PathAttributeId)>-1&&"0"===M.DateType){var $=(0,r.mr)(M.DateValue),E=(0,r.S1)(s,$.day,0,0),R=(0,d.aU)(M.DepartureTime,0),A=(0,r.S1)(E,0,R.hours,R.minutes);u.calendarEventGroups[$.code].push({date:A,dateString:(0,r.$T)(A,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[$.code]+=1}}}catch(e){P.e(e)}finally{P.f()}for(var O in u.calendarEventGroups)u.calendarEventGroups[O].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return u}(0,t,0,c,y),v=function(e,t){var n,a={},r=f(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.id===t&&(a=o)}}catch(e){r.e(e)}finally{r.f()}return a}(p,a.providerId),g={timeTableRules:h,calendar:m,properties:[{key:"route_name",icon:"route",value:a.nameZh},{key:"pricing",icon:"attach_money",value:a.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:v.nameZn},{key:"provider_phone",icon:"call",value:v.phoneInfo},{key:"provider_email",icon:"alternate_email",value:v.email}]};return(0,l.LQ)(n),(0,l.gC)(n),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=89ee7395af3fb4808c72.js.map