"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[675],{7123(e,a,t){t.d(a,{a:()=>_});var r=t(3453),n=t(467),i=t(7183),o=t(8024),s=t(6483),u=t(6802),d=t(7810),f=t(2063),p=t(8011),h=t(4293),l=t(1932),c=t(424),v=t(2303),m=t(6788),y=t(3459),g=t(1531);function _(e,a,t,r,n){return b.apply(this,arguments)}function b(){return(b=(0,n.a)(function*(e,a,t,n,_){(0,m.f)(_,"getRoute_0",0,!1),(0,m.f)(_,"getRoute_1",0,!1),(0,m.f)(_,"getStop_0",0,!1),(0,m.f)(_,"getStop_1",0,!1),(0,m.f)(_,"getLocation_0",0,!1),(0,m.f)(_,"getLocation_1",0,!1),(0,m.f)(_,"getSegmentBuffers_0",0,!1),(0,m.f)(_,"getSegmentBuffers_1",0,!1),(0,m.f)(_,"getEstimateTime_0",0,!1),(0,m.f)(_,"getEstimateTime_1",0,!1),(0,m.f)(_,"getBusEvent_0",0,!1),(0,m.f)(_,"getBusEvent_1",0,!1),(0,m.f)(_,"getBusData_0",0,!1),(0,m.f)(_,"getBusData_1",0,!1);var b=yield Promise.all([(0,h.a)(_,!0),(0,c.a)(_),(0,l.a)(_)]),D=(0,r.a)(b,3),S=D[0],I=D[1],k=D[2],B=yield Promise.all([(0,p.a)(_,0),(0,p.a)(_,1),(0,p.a)(_,2)]),w=(0,r.a)(B,3),T=w[0],$=w[1],E=w[2],L=yield Promise.all([(0,f.a)(_),(0,d.a)(_),(0,u.a)(_),(0,s.b)(t,n)]),R=(0,r.a)(L,4),P=R[0],H=R[1],x=R[2],C=R[3],O=(0,v.b)(H,x,S,e,a),W=!1,G={};(0,o.e)(k,`r_${e}`)&&(W=!0,G=k[`r_${e}`]);var M=(0,y.b)("time_formatting_mode"),q=[],Q=[];for(var A of P){var F={},N=A.RouteID;if([e,10*e].includes(N)||a.includes(N)){F.status=(0,v.g)(null==A?void 0:A.EstimateTime,M);var Z=`s_${A.StopID}`,V={};if(!(0,o.e)(I,Z))continue;V=I[Z],F.id=A.StopID,F.sequence=V.seqNo,F.goBack=V.goBack;var U=`l_${V.stopLocationId}`,j={};if(!(0,o.e)(T,U))continue;j=T[U],F.name=j.n;var z=j.r.length;F.overlappingRoutes=[];for(var J=0;J<z;J++){var K=j.r[J];if(K!==e){var X=`r_${K}`;if((0,o.e)(S,X)){var Y=S[X],ee={name:Y.n,RouteEndPoints:{RouteDeparture:Y.dep,RouteDestination:Y.des,text:`${Y.dep} ↔ ${Y.des}`,html:`<span>${Y.dep}</span><span>↔</span><span>${Y.des}</span>`},RouteID:Y.id,PathAttributeId:Y.pid};F.overlappingRoutes.push(ee)}}}F.position={longitude:j.lo,latitude:j.la},Q.push({latitude:j.la,longitude:j.lo,id:A.StopID});var ae=j.g,te=[];for(var re of((0,o.e)(E,ae)&&(te=E[ae]),F.nearbyLocations=[],te)){var ne=`ml_${re.hash}`;if((0,o.e)($,ne)){var ie=$[ne],oe={name:ie.n,distance:0|(0,i.c)(ie.la[0],ie.lo[0],j.la,j.lo),hash:ie.hash};F.nearbyLocations.push(oe)}}for(var se of(F.nearbyLocations.sort(function(e,a){return e.distance-a.distance}),F.buses=[],j.s)){var ue=`s_${se}`;if((0,o.e)(O,ue))for(var de=O[ue].length-1;de>=0;de--)F.buses.push((0,v.c)(O[ue][de]))}F.buses.sort(function(e,a){return e.index-a.index});var fe=[];(0,o.e)(C,Z)&&(fe=C[Z]),F.busArrivalTimes=fe;var pe=!1,he=!1,le=!1,ce=!1;if(W){var ve=`g_${F.goBack}`,me=[];for(var ye of((0,o.e)(G,ve)?me=G[ve]:"1"===F.goBack&&(ce=!0,me=G.g_0),me))ye.OriginStopID!==A.StopID&&ye.DestinationStopID!==A.StopID||(pe=!0),ce?(ye.OriginStopID===A.StopID&&(le=!0),ye.DestinationStopID===A.StopID&&(he=!0)):(ye.OriginStopID===A.StopID&&(he=!0),ye.DestinationStopID===A.StopID&&(le=!0))}F.segmentBuffer={isSegmentBuffer:pe,isStartingPoint:he,isEndingPoint:le},q.push(F)}}q.sort(function(e,a){return e.sequence-a.sequence});for(var ge=(0,g.b)(Q,450),_e=!1,be=!1,De={},Se=0,Ie={},ke=q.length,Be=0;Be<ke;Be++){var we=q[Be],Te=q[Be+1]||we,$e=0;if(we.buses.length>0&&we.buses[0].onThisRoute){var Ee=[we.buses[0].position.longitude,we.buses[0].position.latitude],Le=Ee[0],Re=Ee[1],Pe=[we.position.longitude,we.position.latitude],He=Pe[0],xe=Pe[1],Ce=[Te.position.longitude,Te.position.latitude],Oe=Ce[0],We=Ce[1];if((Le-He)*(Oe-Le)+(Re-xe)*(We-Re)>=0){var Ge=Math.hypot(Le-He,Re-xe),Me=Math.hypot(Le-Oe,Re-We);$e=Math.max(0,Math.min(Ge/(Ge+Me),1))}}we.progress=$e,we.segmentBuffer.isStartingPoint&&(_e=!0),we.segmentBuffer.isEndingPoint&&_e&&(be=!0),_e&&!be&&(we.segmentBuffer.isSegmentBuffer=!0),_e&&be&&(_e=!1,be=!1);var qe=!1;null!==ge&&ge.id===we.id&&(qe=!0),we.nearest=qe;var Qe=`g_${we.goBack}`||"g_0";(0,o.e)(De,Qe)||(De[Qe]=[],Ie[Qe]=0,Se+=1),De[Qe].push(we),Ie[Qe]+=1}var Ae=S[`r_${e}`],Fe=Ae.n,Ne=Ae.dep,Ze=Ae.des,Ve={groupNames:[`往${Ze}`,`往${Ne}`],groupedItems:De,groupQuantity:Se,itemQuantity:Ie,RouteName:Fe,RouteEndPoints:[Ne,Ze],dataUpdateTime:(0,m.e)(_),RouteID:e,PathAttributeId:a};return(0,m.a)(_),(0,m.b)(_),Ve})).apply(this,arguments)}},8134(e,a,t){t.d(a,{a:()=>b,b:()=>I,c:()=>p,d:()=>v,e:()=>l});var r=t(467),n=t(2129),i=t(8024),o=t(4781),s=t(9734),u=t(8011),d=t(4293),f=t(6788);function p(e){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return(c=(0,r.a)(function*(e){var a,t=(0,i.c)(),r=yield(0,d.a)(t,!0),n=`r_${e}`;return!!(0,i.e)(r,n)&&(a=r[n],(0,f.a)(t),(0,f.b)(t),a)})).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}var y={},g=[],_=!1;function b(){return D.apply(this,arguments)}function D(){return(D=(0,r.a)(function*(){if(!_){var e=(0,i.c)(),a=yield(0,d.a)(e,!0),t=yield(0,u.a)(e,1),r=yield(0,s.a)(e,!0);(0,f.a)(e),(0,f.b)(e);var n={},p=[],h=0;for(var l in a){var c=a[l],v={id:c.id,pid:c.pid,dep:c.dep,des:c.des,n:c.n,hash:"",lo:"",la:"",r:"",s:"",type:0};p.push(v);var m=(0,o.b)(`${v.n.toLowerCase()}${v.dep.toLowerCase()}${v.des.toLowerCase()}`,!0);for(var b of m){var D=`u_${b}`;(0,i.e)(n,D)||(n[D]=[]),n[D].push(h)}h+=1}for(var S in t){var I=t[S],k={id:I.id,n:I.n,lo:I.lo,la:I.la,r:I.r,s:I.s,hash:I.hash,dep:"",des:"",pid:[],type:1};p.push(k);var B=(0,o.b)(k.n.toLowerCase(),!0);for(var w of B){var T=`u_${w}`;(0,i.e)(n,T)||(n[T]=[]),n[T].push(h)}h+=1}for(var $ in r){var E=r[$],L={id:E.BusId,pid:[],dep:"",des:"",n:E.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};p.push(L);var R=(0,o.b)(L.n.toLowerCase(),!0);for(var P of R){var H=`u_${P}`;(0,i.e)(n,H)||(n[H]=[]),n[H].push(h)}h+=1}y=n,g=p,_=!0}})).apply(this,arguments)}function S(e,a){var t=0,r=0;for(var n of a){t+=e.indexOf(n,r)-r,r+=1}return e===a&&(t=10*Math.abs(t)),t}function I(e,a,t){if(!_)return[];var r=e.toLowerCase(),s=(0,o.b)(r,!0),u=(0,o.b)(r,!1),d=[];for(var f of s){var p=`u_${f}`;(0,i.e)(y,p)&&d.push(y[p])}d.sort(function(e,a){return e.length-a.length});var h=d.length-1,l=[];if(0===h&&(l=d[0]),h>0)for(var c=0;c<h;c++){var v=d[c],m=d[c+1];l=0===c?(0,n.b)(v,m):(0,n.b)(l,m)}var b=[],D=0,I=new Set;if(-1===a||2===a){var k=g.filter(function(e){return e.n===r&&2===e.type});for(var B of k)if(b.push({item:B,score:1/0}),I.add(B.id),(D+=1)>=t)break}if(D<t)for(var w of l){var T=g[w];if((-1===a||a===T.type)&&!I.has(T.id)){var $=S(u,(0,o.b)(T.n,!1));if(!(D<t))break;b.push({item:T,score:$}),D+=1}}return b.sort(function(e,a){return a.score-e.score}),b}},8621(e,a,t){t.d(a,{a:()=>p});var r=t(467),n=t(5579),i=t(313),o=t(4293),s=t(8201),u=t(8671),d=t(2303),f=t(6788);function p(e,a,t){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e,a,t){var r=function(e,a){var t={};for(var r of e)if(r.Id===a){t=r;break}return t}(yield(0,o.a)(t,!1),e),p=yield(0,s.a)(t),h=yield(0,u.a)(t),l=yield(0,i.a)(t),c=function(e){var a=(0,d.h)(e.goFirstBusTime,0),t=(0,d.h)(e.goLastBusTime,0),r=(0,d.h)(e.backFirstBusTime,0),n=(0,d.h)(e.backLastBusTime,0),i=(0,d.h)(e.holidayGoFirstBusTime,0),o=(0,d.h)(e.holidayGoLastBusTime,0),s=(0,d.h)(e.holidayBackFirstBusTime,0),u=(0,d.h)(e.holidayBackLastBusTime,0),f=(0,d.h)(e.peakHeadway,1),p=(0,d.h)(e.offPeakHeadway,1),h=(0,d.h)(e.holidayPeakHeadway,1),l=(0,d.h)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:a,last:t,rushHourWindow:f,offRushHourWindow:p},holiday:{first:i,last:o,rushHourWindow:h,offRushHourWindow:l}},back:{weekday:{first:r,last:n,rushHourWindow:f,offRushHourWindow:p},holiday:{first:s,last:u,rushHourWindow:h,offRushHourWindow:l}},realSequence:e.realSequence}}(r),v=function(e,a,t,r,i){var o={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,n.f)();for(var u of r)if(a.indexOf(u.PathAttributeId)>-1&&"0"===u.DateType)for(var f=(0,n.d)(u.DateValue),p=(0,n.h)(s,f.day,0,0),h=(0,d.h)(u.StartTime,0),l=(0,n.h)(p,0,h.hours,h.minutes),c=(0,d.h)(u.EndTime,0),v=(0,n.h)(p,0,c.hours,c.minutes),m=Math.abs(60*c.hours+c.minutes-(60*h.hours+h.minutes)),y=parseInt(u.LongHeadway),g=parseInt(u.LowHeadway),_=(g+y)/2,b=m/_,D=0;D<b;D++){var S=!1,I=(0,n.h)(p,0,h.hours,h.minutes+g*D);I.getTime()<l.getTime()&&(S=!0),I.getTime()>v.getTime()&&(S=!0),!1===S&&(o.calendarEventGroups[f.code].push({date:I,dateString:(0,n.c)(I,"hh:mm"),duration:g,deviation:Math.abs(_-g)}),o.calendarEventQuantity[f.code]+=1)}for(var k of i)if(a.indexOf(k.PathAttributeId)>-1&&"0"===k.DateType){var B=(0,n.d)(k.DateValue),w=(0,n.h)(s,B.day,0,0),T=(0,d.h)(k.DepartureTime,0),$=(0,n.h)(w,0,T.hours,T.minutes);o.calendarEventGroups[B.code].push({date:$,dateString:(0,n.c)($,"hh:mm"),duration:15,deviation:0}),o.calendarEventQuantity[B.code]+=1}for(var E in o.calendarEventGroups)o.calendarEventGroups[E].sort(function(e,a){return e.date.getTime()-a.date.getTime()});return o}(0,a,0,p,h),m=function(e,a){var t={};for(var r of e)r.id===a&&(t=r);return t}(l,r.providerId),y={timeTableRules:c,calendar:v,properties:[{key:"route_name",icon:"route",value:r.nameZh},{key:"pricing",icon:"attach_money",value:r.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,f.a)(t),(0,f.b)(t),y})).apply(this,arguments)}}}]);
//# sourceMappingURL=35f82d9f8e7f8f226122.js.map