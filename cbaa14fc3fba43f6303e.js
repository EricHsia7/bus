"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[806],{904:(e,t,n)=>{n.d(t,{AE:()=>S,BM:()=>I,WR:()=>m,Z_:()=>b,gO:()=>_,kr:()=>g,l$:()=>w});var a=n(8024),r=n(3648),i=n(4927),o=n(6052),s=n(9333),c=n(8379),d=n(5693),u=n(7891),l=n(7908),f=n(5009),v=n(6104),p=100,h=(new Date).getTime(),y=["Home"];function m(e){var t=y.length;y[t-1]!==e&&y.push(e)}function g(e){if(y.indexOf(e)>-1){var t=y.length;y[t-1]===e&&y.pop()}}function b(){var e=y.length;if(e>1)switch(y[e-2]){case"Home":case"FolderIconSelector":case"Location":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":case"QRCode":default:break;case"FolderCreator":(0,o.z1)();break;case"FolderEditor":(0,s.I6)();break;case"FolderManager":(0,c.m)();break;case"Search":(0,f.Bb)();break;case"Settings":(0,v.os)();break;case"PersonalScheduleManager":(0,u.Z)();break;case"PersonalScheduleEditor":(0,d.Xy)();break;case"Bus":(0,i.F)();break;case"RegisterNotification":(0,l.hy)()}}function w(){var e=y.length;if(e>1){var t=y[e-2];switch(y.pop(),t){case"Home":case"FolderIconSelector":case"Location":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":case"QRCode":default:break;case"FolderCreator":(0,o.pd)();break;case"FolderEditor":(0,s.uy)();break;case"FolderManager":(0,c.g)();break;case"Search":(0,f.rf)();break;case"Settings":(0,v.Ow)();break;case"PersonalScheduleManager":(0,u.z)();break;case"PersonalScheduleEditor":(0,d.bF)();break;case"Bus":(0,i.$)();break;case"RegisterNotification":(0,l.XG)()}}}function I(){var e=0;(0,a.t9)()&&(e=-1*(window.outerHeight-window.innerHeight)/2),(0,r.bv)(".f svg.g").style.setProperty("--h",`${e}px`)}function S(e){function t(){var t=(0,r.bv)(".f");t.classList.add("i"),t.addEventListener("animationend",(function(){t.setAttribute("displayed","false"),t.classList.remove("i"),"function"==typeof e&&e()}),{once:!0})}var n=(new Date).getTime();n-h<p?setTimeout(t,Math.max(1,n-h)):t()}function _(e){var t=0,n=0,a=window.innerWidth,r=window.innerHeight;switch(e){case"window":t=a,n=r;break;case"head":t=a,n=55;break;case"head-one-button":t=a-55,n=55;break;case"head-two-button":t=a-110,n=55;break;case"route-details-canvas":t=a-20-20,n=1440;break;case"route-bus-arrival-time-chart":t=a-45-15-20,n=75;break;case"location-bus-arrival-time-chart":t=a-30-20,n=75;break;default:t=0,n=0}return{width:t,height:n}}},3030:(e,t,n)=>{n.d(t,{az:()=>ce,dM:()=>de,eS:()=>se,s_:()=>J,so:()=>oe});var a=n(5767),r=n(9566),i=n(2757),o=n(4636),s=n(5314),c=n(3459),d=n(7968),u=n(8024),l=n(3648),f=n(5579),v=n(4537),p=n(904),h=n(9119);function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var b=(0,l.bv)(".j"),w=(0,l.aI)(b,".k"),I=(0,l.aI)(w,".l"),S=(0,l.aI)(b,".m"),_=(0,l.aI)(w,".n"),A=(0,l.aI)(_,".o"),$=(0,l.aI)(w,".p"),k=(0,l.aI)($,".q"),L=(0,l.aI)(w,".r .s"),T={},E=!0,x=!1,M=0,P=0,R=0,D={},F=0,O=!1,C=1e4,B=15e3,H=5e3,Z=15e3,j=!0,U=0,N=0,z="",q=!1,Q=!1,W=!1,G="",Y=20;function J(){S.addEventListener("touchstart",(function(){M=Math.round(S.scrollLeft/F)}),{passive:!0}),S.addEventListener("scroll",(function(e){O=!0;var t=e.target.scrollLeft/F;P=t>M?M+1:M-1;var n=D[`g_${M}`]||{width:0,offset:0},a=D[`g_${P}`]||{width:0,offset:0},r=n.width+(a.width-n.width)*Math.abs(t-M),i=-1*(n.offset+(a.offset-n.offset)*Math.abs(t-M))+.5*F-.5*r;X(R,i,r-Y,t),t===P&&(M=Math.round(S.scrollLeft/F),O=!1)}),{passive:!0})}function X(e,t,n,a){S.style.setProperty("--t",e.toString()),k.style.setProperty("--u",(n/10).toString()),A.style.setProperty("--v",`${t.toFixed(5)}px`),A.style.setProperty("--w",a.toFixed(5))}function V(e){var t=e;if(q){var n=t.detail.progress-1;L.style.setProperty("--z",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,V)}function K(){var e=(0,u.zx)(),t=document.createElement("div");return t.classList.add("_"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0"),t.innerHTML=`<div class="aa"><div class="ba"><div class="ca" code="-1" displayed="false"></div><div class="da" code="-1" displayed="true"></div></div><div class="ea"></div><div class="fa"></div><div class="ga"><div class="ha"><div class="ia" code="0" displayed="false"></div><div class="ja" code="0" displayed="true"></div></div><div class="ka" onclick="bus.location.stretchLocationItem('${e}')">${(0,v.Z)("keyboard_arrow_down")}</div><div class="la"></div></div></div><div class="ma" displayed="false"><div class="na"><div class="oa" highlighted="true" type="tab" onclick="bus.location.switchLocationBodyTab('${e}', 0)" code="0"><div class="pa">${(0,v.Z)("directions_bus")}</div>公車</div><div class="oa" highlighted="false" type="tab" onclick="bus.location.switchLocationBodyTab('${e}', 1)" code="1"><div class="pa">${(0,v.Z)("departure_board")}</div>抵達時間</div><div class="oa" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-location', ['${e}', null, null])"><div class="pa">${(0,v.Z)("folder")}</div>儲存</div><div class="oa" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-location', ['${e}', null, null, null])" enabled="true"><div class="pa">${(0,v.Z)("notifications")}</div>到站通知</div></div><div class="qa" displayed="true"></div><div class="ra" displayed="false"></div></div>`,{element:t,id:e}}function ee(){var e=document.createElement("div");return e.classList.add("wa"),{element:e,id:""}}function te(){var e=document.createElement("div");return e.classList.add("xa"),e.innerHTML='<div class="ya"></div><div class="za"></div>',{element:e,id:""}}function ne(e,t,n){function a(e,a,i){function s(e,t,n){var a=e.getBoundingClientRect(),r=a.top,i=a.left,o=a.bottom,s=a.right,c=window.innerWidth,d=window.innerHeight,u=(0,l.aI)(e,".ha"),f=(0,l.aI)(u,".ia"),v=(0,l.aI)(u,".ja");f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,n&&o>0&&r<d&&s>0&&i<c?(v.addEventListener("animationend",(function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("_a"),f.setAttribute("displayed","false")}),{once:!0}),f.setAttribute("displayed","true"),v.classList.add("_a")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}function c(e,t,n){var a=e.getBoundingClientRect(),r=a.top,i=a.left,o=a.bottom,s=a.right,c=window.innerWidth,d=window.innerHeight,u=(0,l.aI)(e,".ba"),f=(0,l.aI)(u,".ca"),v=(0,l.aI)(u,".da");f.setAttribute("code",t.ranking.code.toString()),f.innerText=t.ranking.text,n&&o>0&&r<d&&s>0&&i<c?(v.addEventListener("animationend",(function(){v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text,v.classList.remove("ab"),f.setAttribute("displayed","false")}),{once:!0}),f.setAttribute("displayed","true"),v.classList.add("ab")):(v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text)}function d(e,t){(0,l.aI)(e,".ea").innerText=t.route_direction}function p(e,t){(0,l.aI)(e,".fa").innerText=t.route_name}function h(e,t){(0,l.aI)(e,".qa").innerHTML=0===t.buses.length?'<div class="bb">目前沒有公車可顯示</div>':t.buses.map((function(e){return`<div class="cb" on-this-route="${e.onThisRoute}"><div class="db"><div class="eb">${(0,v.Z)("directions_bus")}</div><div class="fb">${e.carNumber}</div></div><div class="gb"><div class="hb">路線：${e.RouteName}</div><div class="ib">狀態：${e.status.text}</div><div class="jb">類型：${e.type}</div></div></div>`})).join("")}function y(e,t){(0,l.aI)(e,".ra").innerHTML=0===t.busArrivalTimes.length?'<div class="kb">目前沒有抵達時間可顯示</div>':t.busArrivalTimes.map((function(e){return`<div class="lb"><div class="mb"><div class="nb">${(0,v.Z)("calendar_view_day")}</div><div class="ob">${e.personalSchedule.name}</div><div class="pb">週${(0,f.kd)(e.day).name} ${(0,f.pn)(e.personalSchedule.period.start)} - ${(0,f.pn)(e.personalSchedule.period.end)}</div></div><div class="qb">${e.chart}</div></div>`})).join("")}function m(e,t){t&&e.setAttribute("stretched","false")}function g(e,t){e.setAttribute("animation",(0,u.xZ)(t))}function b(e,t){e.setAttribute("skeleton-screen",(0,u.xZ)(t))}function w(e,t){var n=(0,l.aI)(e,".ma"),a=(0,l.aI)(n,".na"),i=(0,l.aI)(a,'.oa[type="save-to-folder"]');i.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-location', ['${e.id}', ${t.stopId}, ${t.routeId}])`),(0,r.LH)("stop",t.stopId).then((function(e){i.setAttribute("highlighted",(0,u.xZ)(e))}))}function I(e,t){var n=(0,l.aI)(e,".ma"),a=(0,l.aI)(n,".na"),r=(0,l.aI)(a,'.oa[type="schedule-notification"]');r.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-location', ['${e.id}', ${t.stopId}, ${t.routeId}, ${t.status.time}])`);var i=(0,o.Zc)(t.stopId);r.setAttribute("highlighted",(0,u.xZ)(i))}null===i?(s(e,a,n),c(e,a,n),d(e,a),p(e,a),h(e,a),y(e,a),m(e,t),g(e,n),b(e,t),w(e,a),I(e,a)):(a.status.time!==i.status.time&&(s(e,a,n),I(e,a)),i.ranking.number===a.ranking.number&&i.ranking.code===a.ranking.code||c(e,a,n),i.stopId!==a.stopId&&(d(e,a),p(e,a),w(e,a)),(0,u.hw)(i.buses,a.buses)||h(e,a),(0,u.hw)(i.busArrivalTimes,a.busArrivalTimes)||y(e,a),n!==E&&g(e,n),t!==x&&(m(e,t),b(e,t)))}function i(e,a,r){function i(e,t){(0,l.aI)(e,".ya").innerHTML=(0,v.Z)(t.icon)}function o(e,t){(0,l.aI)(e,".za").innerHTML=t.value}function s(e,t){e.setAttribute("animation",(0,u.xZ)(t))}function c(e,t){e.setAttribute("skeleton-screen",(0,u.xZ)(t))}null===r?(i(e,a),o(e,a),s(e,n),c(e,t)):((0,u.hw)(r.icon,a.icon)||i(e,a),(0,u.hw)(r.value,a.value)||o(e,a),n!==E&&s(e,n),t!==x&&c(e,t))}var s=(0,p.gO)("window"),c=s.width,h=s.height,y=e.groupQuantity,m=e.itemQuantity,g=e.groupedItems,b=e.groups;R=y,F=c;for(var w=0,k=0;k<y;k++){var L=(0,d.q_)(b[`g_${k}`].name,500,"17px",'"Noto Sans TC", sans-serif')+Y;D[`g_${k}`]={width:L,offset:w},w+=L}var P=-1*D[`g_${M}`].offset+.5*F-.5*D[`g_${M}`].width;O||X(R,P,D[`g_${M}`].width-Y,M),I.innerHTML=`<span>${e.LocationName}</span>`,I.setAttribute("animation",(0,u.xZ)(n)),I.setAttribute("skeleton-screen",(0,u.xZ)(t)),_.setAttribute("animation",(0,u.xZ)(n)),_.setAttribute("skeleton-screen",(0,u.xZ)(t)),$.setAttribute("skeleton-screen",(0,u.xZ)(t));var C,B=(0,l.jg)(S,".sa").length;if(y!==B){var H=B-y;if(H<0)for(var Z=0;Z<Math.abs(H);Z++){var j=(C=void 0,(C=document.createElement("div")).classList.add("sa"),C.innerHTML='<div class="ta"><div class="ua"></div></div><div class="va"></div>',{element:C,id:""});S.appendChild(j.element);var U=ee();A.appendChild(U.element)}else for(var N=(0,l.jg)(S,".sa"),z=(0,l.jg)(A,".wa"),q=0;q<Math.abs(H);q++){var Q=B-1-q;N[Q].remove(),z[Q].remove()}}for(var W=(0,l.jg)(S,".sa"),G=0;G<y;G++){var J=`g_${G}`,V=W[G],ne=(0,l.jg)(V,".va ._").length;if(m[J]!==ne){var ae=ne-m[J];if(ae<0)for(var re=(0,l.aI)(V,".va"),ie=0;ie<Math.abs(ae);ie++){var oe=K();re.appendChild(oe.element)}else for(var se=(0,l.jg)(V,".va ._"),ce=0;ce<Math.abs(ae);ce++){se[ne-1-ce].remove()}}var de=(0,l.jg)((0,l.jg)(S,".sa")[G],".ta .ua .xa").length,ue=b[J].properties.length;if(ue!==de){var le=de-ue;if(le<0)for(var fe=(0,l.aI)(V,".ta"),ve=(0,l.aI)(fe,".ua"),pe=0;pe<Math.abs(le);pe++){var he=te();ve.appendChild(he.element)}else for(var ye=(0,l.aI)(V,".ta"),me=(0,l.aI)(ye,".ua"),ge=(0,l.jg)(me,".xa"),be=0;be<Math.abs(le);be++){ge[de-1-be].remove()}}}for(var we=0;we<y;we++){var Ie=`g_${we}`,Se=(0,l.jg)(A,".wa")[we];Se.innerHTML=`<span>${b[Ie].name}</span>`,Se.style.setProperty("--rb",`${D[Ie].width}px`),Se.style.setProperty("--sb",we.toString());for(var _e=(0,l.jg)(S,".sa")[we],Ae=b[Ie].properties.length,$e=0;$e<Ae;$e++){var ke=b[Ie].properties[$e],Le=(0,l.jg)(_e,".ta .ua .xa")[$e];if(T.hasOwnProperty("groups"))if(T.groups.hasOwnProperty(Ie))if(T.groups[Ie].properties[$e])i(Le,ke,T.groups[Ie].properties[$e]);else i(Le,ke,null);else i(Le,ke,null);else i(Le,ke,null)}for(var Te=0;Te<m[Ie];Te++){var Ee=(0,l.jg)(_e,".va ._")[Te],xe=g[Ie][Te];if(T.hasOwnProperty("groupedItems"))if(T.groupedItems.hasOwnProperty(Ie))if(T.groupedItems[Ie][Te])a(Ee,xe,T.groupedItems[Ie][Te]);else a(Ee,xe,null);else a(Ee,xe,null);else a(Ee,xe,null)}}T=e,E=n,x=t}function ae(){return re.apply(this,arguments)}function re(){var e;return e=function*(){var e=(0,c.Js)("playing_animation"),t=(0,c.Js)("refresh_interval"),n=(0,p.gO)("location-bus-arrival-time-chart");j=t.dynamic,B=t.baseInterval,q=!0,z=(0,u.zx)(),L.setAttribute("refreshing","true"),L.classList.remove("y"),document.addEventListener(z,V);var r=yield(0,i.R)(G,n.width,n.height,z);ne(r,!1,e);var o=0;j&&(o=yield(0,a.wz)()),U=(new Date).getTime(),N=j?Math.max(U+H,r.dataUpdateTime+B/o):U+B,Z=Math.max(H,N-U),q=!1,L.setAttribute("refreshing","false"),L.style.setProperty("--x",`${Z}ms`),L.classList.add("y")},re=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){g(i,a,r,o,s,"next",e)}function s(e){g(i,a,r,o,s,"throw",e)}o(void 0)}))},re.apply(this,arguments)}function ie(){ae().then((function(){Q?setTimeout((function(){ie()}),Math.max(H,N-(new Date).getTime())):W=!1})).catch((function(e){Q?((0,h.a)(`地點網路連線中斷，將在${C/1e3}秒後重試。`,"error"),setTimeout((function(){ie()}),C)):W=!1}))}function oe(e){(0,p.WR)("Location"),(0,s.XK)("location",e),G=e,M=0,b.setAttribute("displayed","true"),S.scrollLeft=0,function(){for(var e=(0,c.Js)("playing_animation"),t=(0,p.gO)("window"),n=(t.width,t.height),a={g_0:Math.floor(n/50)+5,g_1:Math.floor(n/50)+5},r={},i=0;i<2;i++){var o=`g_${i}`;r[o]=[];for(var s=0;s<a[o];s++)r[o].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}ne({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:a,LocationName:"載入中",dataUpdateTime:0},!0,e)}(),Q||(Q=!0,W?ae():(W=!0,ie())),(0,p.Z_)()}function se(){b.setAttribute("displayed","false"),Q=!1,(0,p.l$)()}function ce(e){var t=(0,l.aI)(S,`.sa .va ._#${e}`),n=(0,l.aI)(t,".ma"),a=t.parentElement,r=(0,l.ji)(t,"_"),i=r.length,o=a.getBoundingClientRect(),s=t.getBoundingClientRect().top-o.top,c="true"===t.getAttribute("stretched"),d="true"===t.getAttribute("animation");if(d){var u=c?"2":"1";t.setAttribute("stretching","true"),t.style.setProperty("--ub",`${s}px`);for(var f=0;f<i;f++){var v=r[f];v.setAttribute("push-direction",u),v.setAttribute("push-state","1")}t.addEventListener("transitionend",(function(){for(var e=0;e<i;e++){var n=r[e];n.setAttribute("push-direction","0"),n.setAttribute("push-state","0")}t.setAttribute("stretching","false")}),{once:!0}),t.addEventListener("transitionstart",(function(){for(var e=0;e<i;e++){r[e].setAttribute("push-state","2")}}),{once:!0})}c?(d?n.addEventListener("transitionend",(function(){n.setAttribute("displayed","false")}),{once:!0}):n.setAttribute("displayed","false"),t.setAttribute("stretched","false")):(n.setAttribute("displayed","true"),t.setAttribute("stretched","true"))}function de(e,t){var n,a=(0,l.aI)(S,`.sa .va ._#${e}`),r=(0,l.aI)(a,".ma"),i=(0,l.aI)(r,".na"),o=y((0,l.jg)(i,'.oa[highlighted="true"][type="tab"]'));try{for(o.s();!(n=o.n()).done;){n.value.setAttribute("highlighted","false")}}catch(e){o.e(e)}finally{o.f()}switch((0,l.aI)(i,`.oa[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,l.aI)(a,".qa").setAttribute("displayed","true"),(0,l.aI)(a,".ra").setAttribute("displayed","false");break;case 1:(0,l.aI)(a,".qa").setAttribute("displayed","false"),(0,l.aI)(a,".ra").setAttribute("displayed","true")}}},4927:(e,t,n)=>{n.d(t,{F:()=>w,$:()=>b});var a=n(6160),r=n(5314),i=n(3459),o=n(8024),s=n(3648),c=n(904),d=n(4537),u=[],l=!1,f=!0;function v(e,t,n,a){function r(e,t,r){function i(e,t){(0,s.aI)(e,".wb").innerHTML=(0,d.Z)(t.icon)}function c(e,t){(0,s.aI)(e,".xb").innerText=t.value}function u(e,t){e.setAttribute("animation",t)}function v(e,t){e.setAttribute("skeleton-screen",t)}null===r?(i(e,t),c(e,t),v(e,n),u(e,a)):((0,o.hw)(r,t)||i(e,t),(0,o.hw)(r,t)||c(e,t),n!==l&&v(e,n),a!==f&&u(e,a))}var i,c=t.length,v=(0,s.jg)(e,".yb .vb").length;if(c!==v){var p=v-c;if(p<0)for(var h=0;h<Math.abs(p);h++){var y=(i=void 0,(i=document.createElement("div")).classList.add("vb"),i.innerHTML='<div class="wb"></div><div class="xb"></div>',{element:i,id:""});(0,s.aI)(e,".yb").appendChild(y.element)}else for(var m=0;m<Math.abs(p);m++){var g=v-1-m;(0,s.jg)(e,".yb .vb")[g].remove()}}for(var b=(0,s.jg)(e,".yb .vb"),w=0;w<c;w++){var I=b[w],S=t[w];0===u.length?r(I,S,null):r(I,S,u[w])}u=t,f=a,l=n}function p(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var h=(0,s.bv)(".zb"),y=((0,s.aI)(h,"._b"),(0,s.aI)(h,".ac")),m=(0,s.aI)(y,".bc"),g=(0,s.aI)(m,'.cc[group="properties"]');(0,s.aI)(m,'.cc[group="location"]');function b(e){(0,c.WR)("Bus"),(0,r.XK)("bus",e),h.setAttribute("displayed","true"),function(e){I.apply(this,arguments)}(e),(0,c.Z_)()}function w(){h.setAttribute("displayed","false"),(0,c.l$)()}function I(){var e;return e=function*(e){!function(e){for(var t=(0,i.Js)("playing_animation"),n=[],a=0;a<5;a++)n.push({key:a,icon:"none",value:""});v(e,n,!0,t)}(g);var t=(0,i.Js)("playing_animation"),n=(0,o.zx)(),r=yield(0,a.i)(e,n);v(g,r.properties,!1,t)},I=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){p(i,a,r,o,s,"next",e)}function s(e){p(i,a,r,o,s,"throw",e)}o(void 0)}))},I.apply(this,arguments)}},6052:(e,t,n)=>{n.d(t,{c6:()=>f,pd:()=>v,z1:()=>p});var a=n(9566),r=n(3648),i=n(904),o=n(9119),s=(0,r.bv)(".dc"),c=(0,r.aI)(s,".ec"),d=(0,r.aI)(c,".fc"),u=(0,r.aI)(d,'.gc[group="folder-name"] .hc input'),l=(0,r.aI)(d,'.gc[group="folder-icon"] .hc .ic input');function f(){var e=u.value,t=l.value;(0,a.vV)(e,t).then((function(e){e?(p(),(0,o.a)("已建立資料夾","folder")):(0,o.a)("無法建立資料夾","error")}))}function v(){(0,i.WR)("FolderCreator"),s.setAttribute("displayed","true"),(0,i.Z_)()}function p(){s.setAttribute("displayed","false"),(0,i.l$)()}},7084:(e,t,n)=>{n.d(t,{default:()=>me});var a=n(6483),r=n(8925),i=n(5767),o=n(9566),s=n(4636),c=n(5314),d=n(3459),u=n(3251),l=n(1238),f=n(1531),v=n(4927),p=n(7183),h=n(3648),y=n(5579),m=n(904);function g(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var b=(0,h.bv)(".jc"),w=(0,h.aI)(b,".kc"),I=(0,h.aI)(w,".lc"),S=(0,h.aI)(w,".mc"),_=(0,h.aI)(S,'.nc[name="total-data-usage"] .oc'),A=(0,h.aI)(S,'.nc[name="start-time"] .oc'),$=(0,h.aI)(S,'.nc[name="end-time"] .oc');function k(){var e;return e=function*(){var e=(0,m.gO)("window"),t=e.width,n=Math.min(5/18*t,.33*e.height),a=yield(0,r.LN)(t,n,20);_.innerText=(0,p.tH)(a.stats.sum),A.innerText=(0,y.$T)(a.period.start,"YYYY-MM-DD"),$.innerText=(0,y.$T)(a.period.end,"YYYY-MM-DD"),I.innerHTML=a.chart},k=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){g(i,a,r,o,s,"next",e)}function s(e){g(i,a,r,o,s,"throw",e)}o(void 0)}))},k.apply(this,arguments)}var L=n(6052),T=n(9333),E=n(9930),x=n(6788),M=n(972),P=n(8024),R=n(4781),D=n(6082),F=n(4537),O=n(9119);function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function H(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var Z="",j=(0,h.bv)(".pc"),U=(0,h.bv)(".dc"),N=(0,h.bv)(".qc");function z(e){var t=document.createElement("div");return t.classList.add("rc"),t.setAttribute("onclick",`bus.folder.selectFolderIcon('${e}', '${Z}')`),t.innerHTML=(0,F.Z)(e),{element:t,id:""}}function q(){var e;return e=function*(){var e=(0,h.aI)(N,".sc .tc");e.innerHTML="";var t=(0,P.zx)(),n=yield(0,E.z)(t);(0,x.LQ)(t);var a,r=new DocumentFragment,i=C(n);try{for(i.s();!(a=i.n()).done;){var o=z(a.value);r.appendChild(o.element)}}catch(e){i.e(e)}finally{i.f()}e.append(r)},q=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){H(i,a,r,o,s,"next",e)}function s(e){H(i,a,r,o,s,"throw",e)}o(void 0)}))},q.apply(this,arguments)}function Q(e){var t=(0,h.aI)(N,".sc .uc"),n=(0,h.aI)(N,".sc .tc");if(!(0,R.iO)(e)){var a,r=(0,M.U)(e,100),i=new DocumentFragment,o=C(r);try{for(o.s();!(a=o.n()).done;){var s=z(a.value.item);i.appendChild(s.element)}}catch(e){o.e(e)}finally{o.f()}t.innerHTML="",t.append(i),t.setAttribute("displayed",r.length>0?"true":"false"),n.setAttribute("displayed",r.length>0?"false":"true")}}function W(){(0,m.kr)("FolderIconSelector"),N.setAttribute("displayed","false")}var G=n(8379),Y=n(540),J=n(6091),X=n(3030),V=n(2174),K=n(8380),ee=n(5693),te=n(7891),ne=n(8279),ae=n(7908),re=n(8332),ie=n(9009),oe=n(4474),se=n(4690),ce=n(3041),de=n(752),ue=n(5009),le=n(6104),fe=n(6166),ve=n(2994),pe=n(9469),he=!1,ye=!1;window.bus={initialize:function(){!1===he&&(he=!0,(0,m.BM)(),(0,d.Yq)().then((function(){(0,J.Q)(),(0,Y.F)(),(0,u.A)().then((function(e){if("ok"===e){(0,se.S5)(),(0,X.s_)(),(0,ue.ld)(),window.addEventListener("resize",(function(){(0,ue.ld)()})),screen&&screen.orientation&&screen.orientation.addEventListener("change",(function(){(0,ue.ld)()})),(0,J.u)(),(0,o.Rh)().then((function(){(0,Y.a)()}));var t=window.matchMedia("(prefers-color-scheme: dark)"),n=(0,h.bv)(".bd .cd .dd #search_input");t.addEventListener("change",(function(){(0,ue.gn)(n.selectionStart,n.selectionEnd)})),n.addEventListener("paste",(function(){(0,ue.RC)(),(0,ue.gn)(n.selectionStart,n.selectionEnd)})),n.addEventListener("cut",(function(){(0,ue.RC)(),(0,ue.gn)(n.selectionStart,n.selectionEnd)})),n.addEventListener("selectionchange",(function(){(0,ue.RC)(),(0,ue.gn)(n.selectionStart,n.selectionEnd)})),document.addEventListener("selectionchange",(function(){(0,ue.RC)(),(0,ue.gn)(n.selectionStart,n.selectionEnd)})),n.addEventListener("keyup",(function(){(0,ue.RC)(),(0,ue.gn)(n.selectionStart,n.selectionEnd)}));var a=(0,h.bv)(".qc .ed .fd #search_material_symbols_input");a.addEventListener("paste",(function(){Q(a.value)})),a.addEventListener("cut",(function(){Q(a.value)})),a.addEventListener("selectionchange",(function(){Q(a.value)})),document.addEventListener("selectionchange",(function(){Q(a.value)})),a.addEventListener("keyup",(function(){Q(a.value)})),(0,pe._)(),(0,m.AE)((function(){(0,s.Db)(),(0,s.cS)().then((function(){(0,s.z9)()})),document.addEventListener("click",(function(){(0,f.to)(),(0,l.q)()}),{once:!0})}))}"fetchError"!==e&&"unknownError"!==e||((0,m.AE)(),alert(e))})).catch((function(e){(0,m.AE)(),alert(e)}))})))},secondlyInitialize:function(){ye||(ye=!0,(0,D.X)(),(0,i.fV)(),(0,r.Ir)(),(0,a.$t)(),(0,c.FU)(),(0,i.fV)().then((function(){(0,i.MN)().then((function(){(0,i.cy)()}))})))},route:{stretchRouteItem:se.aU,openRoute:se.SR,closeRoute:se.U7,switchRoute:se.Ch,switchRouteBodyTab:se.py,openRouteDetails:oe.GS,closeRouteDetails:oe.GZ,shareRoutePermalink:re.w,showRoutePermalinkQRCode:re.e,switchCalendarDay:ie.f4},location:{openLocation:X.so,closeLocation:X.eS,stretchLocationItem:X.az,switchLocationBodyTab:X.dM},folder:{openSaveToFolder:ce.BI,closeSaveToFolder:ce.nS,openFolderManager:G.g,closeFolderManager:G.m,openFolderEditor:T.uy,closeFolderEditor:T.I6,openFolderIconSelector:function(e){var t;switch((0,m.WR)("FolderIconSelector"),e){case"editor":Z="editor",t=(0,h.aI)(j,'.vc .wc .xc[group="folder-icon"] .yc .zc ._c');break;case"creator":Z="creator",t=(0,h.aI)(U,'.ec .fc .gc[group="folder-icon"] .hc .ic .ad')}"false"===t.getAttribute("disabled")&&(D.m?(N.setAttribute("displayed","true"),function(){q.apply(this,arguments)}(Z),(0,M.L)()):(0,O.a)("資料還在下載中","download_for_offline"))},closeFolderIconSelector:W,openFolderCreator:L.pd,closeFolderCreator:L.z1,createFormulatedFolder:L.c6,saveEditedFolder:T.Bo,selectFolderIcon:function(e){var t;switch(Z){case"editor":t=(0,h.aI)(j,'.vc .wc .xc[group="folder-icon"] .yc .zc input');break;case"creator":t=(0,h.aI)(U,'.ec .fc .gc[group="folder-icon"] .hc .ic input')}t.value=e,W()},saveStopItemOnRoute:ce.JL,saveStopItemOnLocation:ce.Lb,saveRouteOnDetailsPage:ce.Dh,saveRouteOnRoute:ce.jD,removeItemOnFolderEditor:T.cG,moveItemOnFolderEditor:T.Lq},search:{openSearch:ue.rf,closeSearch:ue.Bb,typeTextIntoInput:ue._O,deleteCharFromInout:ue.d$,emptyInput:ue.Wb,openSystemKeyboard:ue.vp,switchSearchTypeFilter:ue.H2},storage:{openStorage:ve.G,closeStorage:ve.Q},dataUsage:{openDataUsage:function(){(0,m.WR)("DataUsage"),b.setAttribute("displayed","true"),function(){k.apply(this,arguments)}(),(0,m.Z_)()},closeDataUsage:function(){b.setAttribute("displayed","false"),(0,m.l$)()}},personalSchedule:{openPersonalScheduleManager:te.z,closePersonalScheduleManager:te.Z,openPersonalScheduleCreator:K.I1,closePersonalScheduleCreator:K.GJ,createFormulatedPersonalSchedule:K.Ps,switchPersonalScheduleCreatorDay:K.om,openPersonalScheduleEditor:ee.bF,closePersonalScheduleEditor:ee.Xy,switchPersonalScheduleEditorDay:ee.Dn,saveEditedPersonalSchedule:ee.gv},settings:{openSettings:le.Ow,closeSettings:le.os,openSettingsOptions:fe.yH,closeSettingsOptions:fe.wx,settingsOptionsHandler:fe.Yi,downloadExportFile:le.vv,openFileToImportData:le.rY,viewCommitOfCurrentVersion:le.hP,showPromptToAskForPersistentStorage:le.jk},bus:{openBus:v.$,closeBus:v.F},notification:{openNotificationScheduleManager:V.Sv,closeNotificationScheduleManager:V.m_,openRegisterNotification:ae.XG,closeRegisterNotification:ae.hy,saveFormulatedRegisterNotification:ae.NW,openScheduleNotification:de.Ho,closeScheduleNotification:de.b$,scheduleNotificationForStopItemOnRoute:de.H9,scheduleNotificationForStopItemOnLocation:de.b6,cancelNotificationOnNotificationScheduleManager:V.Gv},qrcode:{openQRCode:ne.X8,closeQRCode:ne.Vc}};const me=window.bus},7123:(e,t,n)=>{n.d(t,{R:()=>b});var a=n(7183),r=n(6483),i=n(6802),o=n(7810),s=n(2063),c=n(8011),d=n(4293),u=n(1932),l=n(424),f=n(2303),v=n(6788),p=n(3459),h=n(1531);function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function b(e,t,n,a,r){return w.apply(this,arguments)}function w(){var e;return e=function*(e,t,n,m,g){(0,v.Mf)(g,"getRoute_0",0,!1),(0,v.Mf)(g,"getRoute_1",0,!1),(0,v.Mf)(g,"getStop_0",0,!1),(0,v.Mf)(g,"getStop_1",0,!1),(0,v.Mf)(g,"getLocation_0",0,!1),(0,v.Mf)(g,"getLocation_1",0,!1),(0,v.Mf)(g,"getSegmentBuffers_0",0,!1),(0,v.Mf)(g,"getSegmentBuffers_1",0,!1),(0,v.Mf)(g,"getEstimateTime_0",0,!1),(0,v.Mf)(g,"getEstimateTime_1",0,!1),(0,v.Mf)(g,"getBusEvent_0",0,!1),(0,v.Mf)(g,"getBusEvent_1",0,!1),(0,v.Mf)(g,"getBusData_0",0,!1),(0,v.Mf)(g,"getBusData_1",0,!1);var b=yield(0,d.a)(g,!0),w=yield(0,l.T)(g),I=yield(0,c.g)(g,0),S=yield(0,c.g)(g,1),_=yield(0,c.g)(g,2),A=yield(0,u.L)(g),$=yield(0,s.K)(g),k=yield(0,o.J)(g),L=yield(0,i.d)(g),T=yield(0,r.Io)(n,m),E=(0,f.w_)(k,L,b,e,t),x=!1,M={};A.hasOwnProperty(`r_${e}`)&&(x=!0,M=A[`r_${e}`]);var P,R=(0,p.Js)("time_formatting_mode"),D=[],F=[],O=y($);try{for(O.s();!(P=O.n()).done;){var C=P.value,B={},H=C.RouteID;if([e,10*e].includes(H)||t.includes(H)){B.status=(0,f.$Q)(null==C?void 0:C.EstimateTime,R);var Z=`s_${C.StopID}`,j={};if(!w.hasOwnProperty(Z))continue;j=w[Z],B.id=C.StopID,B.sequence=j.seqNo,B.goBack=j.goBack;var U=`l_${j.stopLocationId}`,N={};if(!I.hasOwnProperty(U))continue;N=I[U],B.name=N.n,B.overlappingRoutes=N.r.filter((function(t){return t!==e})).map((function(e){var t=`r_${e}`;if(b.hasOwnProperty(t)){var n=b[t];return{name:n.n,RouteEndPoints:{RouteDeparture:n.dep,RouteDestination:n.des,text:`${n.dep} ↔ ${n.des}`,html:`<span>${n.dep}</span><span>↔</span><span>${n.des}</span>`},RouteID:n.id,PathAttributeId:n.pid}}return null})).filter((function(e){return null!==e})),B.position={longitude:N.lo,latitude:N.la},F.push({latitude:N.la,longitude:N.lo,id:C.StopID});var z=N.g,q=[];_.hasOwnProperty(z)&&(q=_[z]);var Q,W=[],G=y(q);try{for(G.s();!(Q=G.n()).done;){var Y=`ml_${Q.value.hash}`;if(S.hasOwnProperty(Y)){var J=S[Y],X={name:J.n,distance:0|(0,a.aV)(J.la[0],J.lo[0],N.la,N.lo),hash:J.hash};W.push(X)}}}catch(e){G.e(e)}finally{G.f()}W.sort((function(e,t){return e.distance-t.distance})),B.nearbyLocations=W;var V,K=[],ee=y(N.s);try{for(ee.s();!(V=ee.n()).done;){var te=`s_${V.value}`;E.hasOwnProperty(te)&&K.push(E[te].map((function(e){return(0,f.s$)(e)})))}}catch(e){ee.e(e)}finally{ee.f()}B.buses=K.flat().sort((function(e,t){return e.index-t.index}));var ne=[];T.hasOwnProperty(Z)&&(ne=T[Z]),B.busArrivalTimes=ne;var ae=!1,re=!1,ie=!1,oe=!1;if(x){var se=`g_${B.goBack}`,ce=[];M.hasOwnProperty(se)?ce=M[se]:"1"===B.goBack&&(oe=!0,ce=M.g_0);var de,ue=y(ce);try{for(ue.s();!(de=ue.n()).done;){var le=de.value;le.OriginStopID!==C.StopID&&le.DestinationStopID!==C.StopID||(ae=!0),oe?(le.OriginStopID===C.StopID&&(ie=!0),le.DestinationStopID===C.StopID&&(re=!0)):(le.OriginStopID===C.StopID&&(re=!0),le.DestinationStopID===C.StopID&&(ie=!0))}}catch(e){ue.e(e)}finally{ue.f()}}B.segmentBuffer={isSegmentBuffer:ae,isStartingPoint:re,isEndingPoint:ie},D.push(B)}}}catch(e){O.e(e)}finally{O.f()}D.sort((function(e,t){return e.sequence-t.sequence}));for(var fe=(0,h.uQ)(F,450),ve=!1,pe=!1,he={},ye=0,me={},ge=D.length,be=0;be<ge;be++){var we=D[be],Ie=D[be+1]||we,Se=0;if(we.buses.length>0&&we.buses[0].onThisRoute){var _e=[we.buses[0].position.longitude,we.buses[0].position.latitude],Ae=_e[0],$e=_e[1],ke=[we.position.longitude,we.position.latitude],Le=ke[0],Te=ke[1],Ee=[Ie.position.longitude,Ie.position.latitude],xe=Ee[0],Me=Ee[1];if((Ae-Le)*(xe-Ae)+($e-Te)*(Me-$e)>=0){var Pe=Math.hypot(Ae-Le,$e-Te),Re=Math.hypot(Ae-xe,$e-Me);Se=Math.max(0,Math.min(Pe/(Pe+Re),1))}}we.progress=Se,we.segmentBuffer.isStartingPoint&&(ve=!0),we.segmentBuffer.isEndingPoint&&ve&&(pe=!0),ve&&!pe&&(we.segmentBuffer.isSegmentBuffer=!0),ve&&pe&&(ve=!1,pe=!1);var De=!1;null!==fe&&fe.id===we.id&&(De=!0),we.nearest=De;var Fe=`g_${we.goBack}`||"g_0";he.hasOwnProperty(Fe)||(he[Fe]=[],me[Fe]=0,ye+=1),he[Fe].push(we),me[Fe]+=1}var Oe=b[`r_${e}`],Ce={groupedItems:he,groupQuantity:ye,itemQuantity:me,RouteName:Oe.n,RouteEndPoints:{RouteDeparture:Oe.dep,RouteDestination:Oe.des},dataUpdateTime:(0,v.Zt)(g),RouteID:e,PathAttributeId:t};return(0,v.LQ)(g),(0,v.gC)(g),Ce},w=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){g(i,a,r,o,s,"next",e)}function s(e){g(i,a,r,o,s,"throw",e)}o(void 0)}))},w.apply(this,arguments)}},8379:(e,t,n)=>{n.d(t,{g:()=>h,m:()=>y});var a=n(9566),r=n(3648),i=n(4537),o=n(904);function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function d(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var u=(0,r.bv)(".gd"),l=(0,r.aI)(u,".hd"),f=(0,r.aI)(l,".id");function v(e){var t=document.createElement("div");return t.classList.add("jd"),t.setAttribute("onclick",`bus.folder.openFolderEditor('${e.id}')`),t.innerHTML=`<div class="kd">${(0,i.Z)(e.icon)}</div><div class="ld">${e.name}</div><div class="md">${e.contentLength}</div><div class="nd">${(0,i.Z)("arrow_forward_ios")}</div>`,{element:t,id:""}}function p(){var e;return e=function*(){var e=yield(0,a.Xi)();f.innerHTML="";var t,n=new DocumentFragment,r=s(e);try{for(r.s();!(t=r.n()).done;){var i=v(t.value);n.appendChild(i.element)}}catch(e){r.e(e)}finally{r.f()}f.append(n)},p=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){d(i,a,r,o,s,"next",e)}function s(e){d(i,a,r,o,s,"throw",e)}o(void 0)}))},p.apply(this,arguments)}function h(){(0,o.WR)("FolderManager"),u.setAttribute("displayed","true"),function(){p.apply(this,arguments)}()}function y(){(0,o.kr)("FolderManager"),u.setAttribute("displayed","false")}},8621:(e,t,n)=>{n.d(t,{p:()=>v});var a=n(5579),r=n(313),i=n(4293),o=n(8201),s=n(8671),c=n(2303),d=n(6788);function u(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function v(e,t,n){return p.apply(this,arguments)}function p(){var e;return e=function*(e,t,n){var u=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.Id===t){a=i;break}}}catch(e){r.e(e)}finally{r.f()}return a}(yield(0,i.a)(n,!1),e),f=yield(0,o.Y)(n),v=yield(0,s.s)(n),p=yield(0,r.s)(n),h=function(e){var t=(0,c.aU)(e.goFirstBusTime,0),n=(0,c.aU)(e.goLastBusTime,0),a=(0,c.aU)(e.backFirstBusTime,0),r=(0,c.aU)(e.backLastBusTime,0),i=(0,c.aU)(e.holidayGoFirstBusTime,0),o=(0,c.aU)(e.holidayGoLastBusTime,0),s=(0,c.aU)(e.holidayBackFirstBusTime,0),d=(0,c.aU)(e.holidayBackLastBusTime,0),u=(0,c.aU)(e.peakHeadway,1),l=(0,c.aU)(e.offPeakHeadway,1),f=(0,c.aU)(e.holidayPeakHeadway,1),v=(0,c.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:u,offRushHourWindow:l},holiday:{first:i,last:o,rushHourWindow:f,offRushHourWindow:v}},back:{weekday:{first:a,last:r,rushHourWindow:u,offRushHourWindow:l},holiday:{first:s,last:d,rushHourWindow:f,offRushHourWindow:v}},realSequence:e.realSequence}}(u),y=function(e,t,n,r,i){var o,s={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},d=(0,a.P$)(),u=l(r);try{for(u.s();!(o=u.n()).done;){var f=o.value;if(t.indexOf(f.PathAttributeId)>-1&&"0"===f.DateType)for(var v=(0,a.mr)(f.DateValue),p=(0,a.S1)(d,v.day,0,0),h=(0,c.aU)(f.StartTime,0),y=(0,a.S1)(p,0,h.hours,h.minutes),m=(0,c.aU)(f.EndTime,0),g=(0,a.S1)(p,0,m.hours,m.minutes),b=Math.abs(60*m.hours+m.minutes-(60*h.hours+h.minutes)),w=parseInt(f.LongHeadway),I=parseInt(f.LowHeadway),S=(I+w)/2,_=b/S,A=0;A<_;A++){var $=!1,k=(0,a.S1)(p,0,h.hours,h.minutes+I*A);k.getTime()<y.getTime()&&($=!0),k.getTime()>g.getTime()&&($=!0),!1===$&&(s.calendarEventGroups[v.code].push({date:k,dateString:(0,a.$T)(k,"hh:mm"),duration:I,deviation:Math.abs(S-I)}),s.calendarEventQuantity[v.code]+=1)}}}catch(e){u.e(e)}finally{u.f()}var L,T=l(i);try{for(T.s();!(L=T.n()).done;){var E=L.value;if(t.indexOf(E.PathAttributeId)>-1&&"0"===E.DateType){var x=(0,a.mr)(E.DateValue),M=(0,a.S1)(d,x.day,0,0),P=(0,c.aU)(E.DepartureTime,0),R=(0,a.S1)(M,0,P.hours,P.minutes);s.calendarEventGroups[x.code].push({date:R,dateString:(0,a.$T)(R,"hh:mm"),duration:15,deviation:0}),s.calendarEventQuantity[x.code]+=1}}}catch(e){T.e(e)}finally{T.f()}for(var D in s.calendarEventGroups)s.calendarEventGroups[D].sort((function(e,t){return e.date.getTime()-t.date.getTime()}));return s}(0,t,0,f,v),m=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.id===t&&(a=i)}}catch(e){r.e(e)}finally{r.f()}return a}(p,u.providerId),g={timeTableRules:h,calendar:y,properties:[{key:"route_name",icon:"route",value:u.nameZh},{key:"pricing",icon:"attach_money",value:u.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,d.LQ)(n),(0,d.gC)(n),g},p=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){u(i,a,r,o,s,"next",e)}function s(e){u(i,a,r,o,s,"throw",e)}o(void 0)}))},p.apply(this,arguments)}},9333:(e,t,n)=>{n.d(t,{Bo:()=>L,I6:()=>A,Lq:()=>k,cG:()=>$,uy:()=>_});var a=n(9566),r=n(8024),i=n(3648),o=n(4537),s=n(904),c=n(9119);function d(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}var f=(0,i.bv)(".pc"),v=(0,i.aI)(f,".od"),p=(0,i.aI)(v,".pd"),h=(0,i.aI)(f,".vc"),y=(0,i.aI)(h,".wc"),m=(0,i.aI)(y,'.xc[group="folder-name"] .yc input'),g=(0,i.aI)(y,'.xc[group="folder-icon"] .yc .zc input'),b=(0,i.aI)(y,'.xc[group="folder-icon"] .yc .zc ._c'),w=(0,i.aI)(y,'.xc[group="folder-content"] .yc');function I(e,t){var n=(0,r.zx)(),a=document.createElement("div");a.id=n,a.classList.add("qd"),a.setAttribute("type",t.type);var i="",s="",c="";switch(t.type){case"stop":c="location_on",i=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`,s=t.name;break;case"route":c="route",i=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`,s=t.name;break;case"bus":i="",s=t.name;break;case"empty":c="lightbulb",i="提示",s="沒有內容";break;default:c="",i="null",s="null"}return a.innerHTML=`<div class="rd">${(0,o.Z)(c)}</div><div class="sd">${i}</div><div class="td">${s}</div><div class="ud"><div class="vd" onclick="bus.folder.moveItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id}, 'up')">${(0,o.Z)("keyboard_arrow_down")}</div><div class="wd" onclick="bus.folder.moveItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id}, 'down')">${(0,o.Z)("keyboard_arrow_down")}</div><div class="xd" onclick="bus.folder.removeItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id})">${(0,o.Z)("delete")}</div><div class="yd"></div><div class="yd"></div></div>`,{element:a,id:n}}function S(){var e;return e=function*(e){!function(e,t){m.value=e.name,g.value=e.icon,e.default?(m.setAttribute("readonly","readonly"),g.setAttribute("readonly","readonly"),b.setAttribute("disabled","true")):(m.removeAttribute("readonly"),g.removeAttribute("readonly"),b.setAttribute("disabled","false")),p.setAttribute("onclick",`bus.folder.saveEditedFolder('${e.id}')`),w.innerHTML="";var n,a=new DocumentFragment,r=u(t);try{for(r.s();!(n=r.n()).done;){var i=I(e,n.value);a.appendChild(i.element)}}catch(e){r.e(e)}finally{r.f()}w.append(a)}(yield(0,a.L2)(e),yield(0,a.eD)(e))},S=function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){d(i,a,r,o,s,"next",e)}function s(e){d(i,a,r,o,s,"throw",e)}o(void 0)}))},S.apply(this,arguments)}function _(e){(0,s.WR)("FolderEditor"),f.setAttribute("displayed","true"),function(e){S.apply(this,arguments)}(e),(0,s.Z_)()}function A(){f.setAttribute("displayed","false"),(0,s.l$)()}function $(e,t,n,r){var o=(0,i.aI)(f,`.vc .wc .xc[group="folder-content"] .yc .qd#${e}`);(0,a.NC)(t,n,r).then((function(e){if(e)switch(o.remove(),n){case"stop":(0,c.a)("已移除站牌","delete");break;case"route":(0,c.a)("已移除路線","delete")}else(0,c.a)("無法移除","error")}))}function k(e,t,n,r,o){var s=(0,i.aI)(f,`.vc .wc .xc[group="folder-content"] .yc .qd#${e}`);(0,a.bq)(t,n,r,o).then((function(e){if(e)switch(o){case"up":var t=s.previousElementSibling;t&&s.parentNode.insertBefore(s,t),(0,c.a)("已往上移","arrow_circle_up");break;case"down":var n=s.nextElementSibling;n&&s.parentNode.insertBefore(n,s),(0,c.a)("已往下移","arrow_circle_down")}else(0,c.a)("無法移動","error")}))}function L(e){var t=m.value,n=g.value;(0,a.g$)(e,t,n),A()}}}]);
//# sourceMappingURL=cbaa14fc3fba43f6303e.js.map