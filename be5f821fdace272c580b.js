"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,n)=>{n.d(e,{Ch:()=>mt,S5:()=>et,SR:()=>vt,U7:()=>ft,aB:()=>nt,py:()=>pt,q0:()=>ht});var i=n(7123),a=n(4537),s=n(6788),o=n(3459),r=n(8024),c=n(7968),d=n(3648),u=n(5767),l=n(9566),v=n(904),f=n(9119),m=n(5579),h=n(5314),p=n(4636);function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw s}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function y(t,e,n,i,a,s,o){try{var r=t[s](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,a)}var A=(0,d.bv)(".gk"),I=(0,d.aI)(A,".xl"),w=(0,d.aI)(I,"._l"),k=(0,d.aI)(I,".zl"),x=(0,d.aI)(I,".gm .hm"),R=(0,d.aI)(I,".am"),_=(0,d.aI)(R,".bm"),T=(0,d.aI)(I,".em"),P=(0,d.aI)(T,".fm"),S=(0,d.aI)(A,".hk"),L={},Z=!0,j=!1,M=0,E=0,D=0,B={},C=0,F=!1,z=1e4,H=15e3,q=5e3,N=15e3,O=!0,Q=!1,U=0,J=0,W=!1,$="",K=-1,X=-1,G=!1,V=0,Y=[],tt=20;function et(){S.addEventListener("touchstart",(function(){M=Math.round(S.scrollLeft/C)}),{passive:!0}),S.addEventListener("scroll",(function(t){F=!0;var e=t.target.scrollLeft/C;E=e>M?M+1:M-1;var n=B["g_".concat(M)]||{width:0,offset:0},i=B["g_".concat(E)]||{width:0,offset:0},a=n.width+(i.width-n.width)*Math.abs(e-M),s=-1*(n.offset+(i.offset-n.offset)*Math.abs(e-M))+.5*C-.5*a;it(D,s,a-tt,e),e===E&&(M=Math.round(S.scrollLeft/C),F=!1)}),{passive:!0})}function nt(){var t=(0,v.gO)("window"),e=t.width,n=t.height;A.style.setProperty("--dk","".concat(e,"px")),A.style.setProperty("--ek","".concat(n,"px"))}function it(t,e,n,i){S.style.setProperty("--fk",t.toString()),P.style.setProperty("--vl",(n/10).toString()),_.style.setProperty("--cm","".concat(e.toFixed(5),"px")),_.style.setProperty("--tl",i.toFixed(5))}function at(){var t=(new Date).getTime();W?(X=-1+(0,s._M)($),K+=.1*(X-K)):(X=-1*Math.min(1,Math.max(0,Math.abs(t-U)/N)),K=X),x.style.setProperty("--z",K.toString()),window.requestAnimationFrame((function(){Q&&at()}))}function st(){var t=(0,r.zx)("i"),e=document.createElement("div");return e.classList.add("im"),e.id=t,e.setAttribute("stretched","false"),e.innerHTML='<div class="nm"></div><div class="qm"><div class="ia" code="0"></div><div class="ja" code="0"></div></div>',{element:e,id:t}}function ot(t){var e=(0,r.zx)("i"),n=document.createElement("div");return n.classList.add("tm"),n.id=e,n.setAttribute("stretched","false"),n.innerHTML='<div class="um"><div class="vm"></div><div class="wm"><div class="xm"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="ym" onclick="bus.route.stretchRouteItemBody(\''.concat(e,"', '").concat(t,"')\">").concat((0,a.Z)("keyboard_arrow_down"),'</div><div class="zm"></div></div></div><div class="_m" displayed="false"><div class="an"><div class="bn" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 0)" code="0"><div class="cn">').concat((0,a.Z)("directions_bus"),'</div>公車</div><div class="bn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 1)" code="1"><div class="cn">').concat((0,a.Z)("departure_board"),'</div>抵達時間</div><div class="bn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 2)" code="2"><div class="cn">').concat((0,a.Z)("route"),'</div>路線</div><div class="bn" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder(\'stop-on-route\', [\'').concat(e,'\', null, null])"><div class="cn">').concat((0,a.Z)("folder"),'</div>儲存至資料夾</div><div class="bn" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification(\'stop-on-route\', [\'').concat(e,'\', null, null, null])" enabled="true"><div class="cn">').concat((0,a.Z)("notifications"),'</div>設定到站通知</div></div><div class="dn" displayed="true"></div><div class="en" displayed="false"></div><div class="fn" displayed="false"></div></div>'),{element:n,id:e}}function rt(){var t=document.createElement("div");t.classList.add("ik");var e=document.createElement("div");e.classList.add("jk");var n=document.createElement("div");n.classList.add("kk");var i=document.createElement("div");return i.classList.add("lk"),e.appendChild(n),e.appendChild(i),t.appendChild(e),{element:t,id:""}}function ct(t,e,n){function i(e,n,i,s,o,c){function u(t,e,n,i,a){var s=(0,d.aI)(e,".qm"),o=(0,d.aI)(s,".ja"),r=(0,d.aI)(s,".ia"),c=(0,d.aI)(t,".xm"),u=(0,d.aI)(c,".ja"),l=(0,d.aI)(c,".ia");if(r.setAttribute("code",n.status.code.toString()),l.setAttribute("code",n.status.code.toString()),l.innerText=n.status.text,!i&&a){var v=t.getBoundingClientRect(),f=v.top,m=v.left,h=v.bottom,p=v.right,b=window.innerWidth,g=window.innerHeight;if(h>0&&f<g&&p>0&&m<b)return o.addEventListener("animationend",(function(){o.setAttribute("code",n.status.code.toString()),o.classList.remove("_a")}),{once:!0}),u.addEventListener("animationend",(function(){u.setAttribute("code",n.status.code.toString()),u.innerText=n.status.text,u.classList.remove("_a")}),{once:!0}),o.classList.add("_a"),void u.classList.add("_a")}o.setAttribute("code",n.status.code.toString()),u.setAttribute("code",n.status.code.toString()),u.innerText=n.status.text}function v(t,e,n){t.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer))}function f(t,e){(0,d.aI)(t,".vm").innerText=e.name}function h(t,e){(0,d.aI)(t,".dn").innerHTML=0===e.buses.length?'<div class="gn">目前沒有公車可顯示</div>':e.buses.map((function(t){return'<div class="hn" on-this-route="'.concat(t.onThisRoute,'"><div class="in"><div class="jn">').concat((0,a.Z)("directions_bus"),'</div><div class="kn">').concat(t.carNumber,'</div></div><div class="ln"><div class="mn">路線：').concat(t.RouteName,'</div><div class="nn">狀態：').concat(t.status.text,'</div><div class="on">類型：').concat(t.type,"</div></div></div>")})).join("")}function b(t,e){(0,d.aI)(t,".en").innerHTML=0===e.overlappingRoutes.length?'<div class="pn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return'<div class="qn"><div class="rn"><div class="sn">'.concat((0,a.Z)("route"),'</div><div class="tn">').concat(t.name,'</div></div><div class="un">').concat(t.RouteEndPoints.html,'</div><div class="vn"><div class="wn" onclick="bus.route.switchRoute(').concat(t.RouteID,", [").concat(t.PathAttributeId.join(","),'])">查看路線</div><div class="wn" onclick="bus.folder.openSaveToFolder(\'route-on-route\', [').concat(t.RouteID,'])">收藏路線</div></div></div>')})).join("")}function g(t,e){(0,d.aI)(t,".fn").innerHTML=0===e.busArrivalTimes.length?'<div class="xn">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return'<div class="yn"><div class="zn"><div class="_n">'.concat((0,a.Z)("calendar_view_day"),'</div><div class="ao">').concat(t.personalSchedule.name,'</div><div class="bo">週').concat((0,m.kd)(t.day).name," ").concat((0,m.pn)(t.personalSchedule.period.start)," - ").concat((0,m.pn)(t.personalSchedule.period.end),'</div></div><div class="co">').concat(t.chart,"</div></div>")})).join("")}function y(t,e,n){t.setAttribute("nearest",(0,r.xZ)(n.nearest)),e.setAttribute("nearest",(0,r.xZ)(n.nearest))}function A(t,e,n,i,a){var s=(null==n?void 0:n.progress)||0,o=(null==e?void 0:e.progress)||0,r=(0,d.aI)(t,".nm");if(!i&&a&&0!==s&&0===o&&Math.abs(o-s)>0)return r.style.setProperty("--lm","100%"),r.style.setProperty("--mm","100%"),void r.addEventListener("transitionend",(function(){r.style.setProperty("--lm","0%"),r.style.setProperty("--mm","0%")}),{once:!0});r.style.setProperty("--lm","0%"),r.style.setProperty("--mm","".concat(100*o,"%"))}function I(t,e,n){n&&((0,d.aI)(t,"._m").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function w(t,e,n){t.setAttribute("animation",(0,r.xZ)(n)),e.setAttribute("animation",(0,r.xZ)(n))}function k(t,e,n){t.setAttribute("skeleton-screen",(0,r.xZ)(n)),e.setAttribute("skeleton-screen",(0,r.xZ)(n))}function x(e,n){var i=(0,d.aI)(e,'._m .an .bn[type="save-to-folder"]');i.setAttribute("onclick","bus.folder.openSaveToFolder('stop-on-route', ['".concat(e.id,"', ").concat(n.id,", ").concat(t.RouteID,"])")),(0,l.LH)("stop",n.id).then((function(t){i.setAttribute("highlighted",(0,r.xZ)(t))}))}function R(e,n){var i=(0,d.aI)(e,'._m .an .bn[type="schedule-notification"]');i.setAttribute("onclick","bus.notification.openScheduleNotification('stop-on-route', ['".concat(e.id,"', ").concat(n.id,", ").concat(t.RouteID,", ").concat(n.status.time,"])"));var a=(0,p.Zc)(n.id);i.setAttribute("highlighted",(0,r.xZ)(a))}null===s?(u(e,n,i,o,c),f(e,i),h(e,i),b(e,i),g(e,i),v(e,n,i),y(e,n,i),A(n,i,s,o,c),I(e,n,o),w(e,n,c),k(e,n,o),x(e,i),R(e,i)):(i.status.time!==s.status.time&&(u(e,n,i,o,c),R(e,i)),(0,r.hw)(s.buses,i.buses)||h(e,i),(0,r.hw)(s.busArrivalTimes,i.busArrivalTimes)||g(e,i),(0,r.hw)(s.segmentBuffer,i.segmentBuffer)||v(e,n,i),s.nearest!==i.nearest&&y(e,n,i),s.progress!==i.progress&&A(n,i,s,o,c),s.id!==i.id&&(f(e,i),b(e,i),x(e,i),R(e,i)),c!==Z&&w(e,n,c),o!==j&&(I(e,n,o),k(e,n,o)))}var s=(0,v.gO)("window"),o=s.width,u=s.height,f=t.groupQuantity,h=t.itemQuantity,b=t.groupedItems;D=f,C=o;for(var g=0,y=0;y<f;y++){var A=(0,c.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return"往".concat(t)}))[y],500,"17px",'"Noto Sans TC", sans-serif')+tt;B["g_".concat(y)]={width:A,offset:g},g+=A}var I=-1*B["g_".concat(M)].offset+.5*C-.5*B["g_".concat(M)].width;F||it(D,I,B["g_".concat(M)].width-tt,M),w.innerHTML="<span>".concat(t.RouteName,"</span>"),w.setAttribute("animation",(0,r.xZ)(n)),w.setAttribute("skeleton-screen",(0,r.xZ)(e)),R.setAttribute("animation",(0,r.xZ)(n)),R.setAttribute("skeleton-screen",(0,r.xZ)(e)),T.setAttribute("animation",(0,r.xZ)(n)),T.setAttribute("skeleton-screen",(0,r.xZ)(e)),k.setAttribute("onclick","bus.route.openRouteDetails(".concat(t.RouteID,", [").concat(t.PathAttributeId.join(","),"])"));var x,P,E=(0,d.jg)(S,".ik").length;if(f!==E){var z=E-f;if(z<0){for(var H=new DocumentFragment,q=new DocumentFragment,N=0;N<Math.abs(z);N++){var O=rt();H.appendChild(O.element);var Q=(x=void 0,P=void 0,x=(0,r.zx)("t"),(P=document.createElement("div")).classList.add("dm"),P.id=x,{element:P,id:x});q.appendChild(Q.element)}S.append(H),_.append(q)}else for(var U=(0,d.jg)(S,".ik"),J=(0,d.jg)(_,".dm"),W=0;W<Math.abs(z);W++){var $=E-1-W;U[$].remove(),J[$].remove()}}for(var K=(0,d.jg)(S,".ik"),X=0;X<f;X++){var G="g_".concat(X),V=K[X],Y=(0,d.aI)(V,".lk"),et=(0,d.aI)(V,".kk"),nt=(0,d.jg)(Y,".tm").length;if(h[G]!==nt){var at=nt-h[G];if(at<0){for(var ct=new DocumentFragment,dt=new DocumentFragment,ut=0;ut<Math.abs(at);ut++){var lt=st(),vt=ot(lt.id);ct.appendChild(vt.element),dt.appendChild(lt.element)}Y.append(ct),et.append(dt)}else for(var ft=(0,d.jg)(Y,".tm"),mt=(0,d.jg)(et,".im"),ht=0;ht<Math.abs(at);ht++){var pt=nt-1-ht;ft[pt].remove(),mt[pt].remove()}}}for(var bt=(0,d.jg)(_,".dm"),gt=0;gt<f;gt++){var yt="g_".concat(gt),At=bt[gt];At.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return"<span>往".concat(t,"</span>")}))[gt],At.style.setProperty("--wl","".concat(B[yt].width,"px")),At.style.setProperty("--ul",gt.toString());for(var It=K[gt],wt=(0,d.aI)(It,".lk"),kt=(0,d.aI)(It,".kk"),xt=(0,d.jg)(wt,".tm"),Rt=(0,d.jg)(kt,".im"),_t=0;_t<h[yt];_t++){var Tt=xt[_t],Pt=Rt[_t],St=b[yt][_t];if(L.hasOwnProperty("groupedItems"))if(L.groupedItems.hasOwnProperty(yt))if(L.groupedItems[yt][_t])i(Tt,Pt,St,L.groupedItems[yt][_t],e,n);else i(Tt,Pt,St,null,e,n);else i(Tt,Pt,St,null,e,n);else i(Tt,Pt,St,null,e,n)}}L=t,Z=n,j=e}function dt(){return ut.apply(this,arguments)}function ut(){var t;return t=function*(){var t=(0,o.Js)("playing_animation"),e=(0,o.Js)("refresh_interval"),n=(0,v.gO)("route-bus-arrival-time-chart");O=e.dynamic,H=e.baseInterval,W=!0,$=(0,r.zx)("r"),x.setAttribute("refreshing","true");var a=yield(0,i.R)(V,Y,n.width,n.height,$);ct(a,!1,t);var s=0;O&&(s=yield(0,u.wz)()),U=(new Date).getTime(),J=O?Math.max(U+q,a.dataUpdateTime+H/s):U+H,N=Math.max(q,J-U),W=!1,x.setAttribute("refreshing","false")},ut=function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function o(t){y(s,i,a,o,r,"next",t)}function r(t){y(s,i,a,o,r,"throw",t)}o(void 0)}))},ut.apply(this,arguments)}function lt(){dt().then((function(){Q?setTimeout((function(){lt()}),Math.max(q,J-(new Date).getTime())):G=!1})).catch((function(t){console.error(t),Q?((0,f.a)("（路線）發生網路錯誤，將在".concat(z/1e3,"秒後重試。"),"error"),setTimeout((function(){lt()}),z)):G=!1}))}function vt(t,e){(0,v.WR)("Route"),(0,h.XK)("route",t),V=t,Y=e,M=0,A.setAttribute("displayed","true"),(0,d.aI)(A,".hk").scrollLeft=0,function(){for(var t=(0,o.Js)("playing_animation"),e=(0,v.gO)("window"),n=(e.width,e.height),i=Math.floor(n/50)+5,a={},s=0;s<2;s++){var r="g_".concat(s);a[r]=[];for(var c=0;c<i;c++)a[r].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],sequence:c,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}ct({groupedItems:a,groupQuantity:2,itemQuantity:{g_0:i,g_1:i},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),Q||(Q=!0,G?dt():(G=!0,lt()),K=-1,X=-1,at()),(0,v.Z_)()}function ft(){A.setAttribute("displayed","false"),Q=!1,K=-1,X=-1,(0,v.l$)()}function mt(t,e){Q=!1,K=-1,X=-1,vt(t,e)}function ht(t,e){var n=(0,d.bv)(".gk .hk .ik .jk .lk .tm#".concat(t)),i=(0,d.aI)(n,"._m"),a=(0,d.bv)(".gk .hk .ik .jk .kk .im#".concat(e));"true"===n.getAttribute("stretched")?("true"===n.getAttribute("animation")?i.addEventListener("transitionend",(function(){i.setAttribute("displayed","false")}),{once:!0}):i.setAttribute("displayed","false"),n.setAttribute("stretched","false"),a.setAttribute("stretched","false")):(i.setAttribute("displayed","true"),n.setAttribute("stretched","true"),a.setAttribute("stretched","true"))}function pt(t,e){var n,i=(0,d.aI)(S,".tm#".concat(t)),a=(0,d.aI)(i,".an"),s=b((0,d.jg)(a,'.bn[highlighted="true"][type="tab"]'));try{for(s.s();!(n=s.n()).done;){n.value.setAttribute("highlighted","false")}}catch(t){s.e(t)}finally{s.f()}switch((0,d.aI)(a,'.bn[code="'.concat(e,'"]')).setAttribute("highlighted","true"),e){case 0:(0,d.aI)(i,".dn").setAttribute("displayed","true"),(0,d.aI)(i,".en").setAttribute("displayed","false"),(0,d.aI)(i,".fn").setAttribute("displayed","false");break;case 1:(0,d.aI)(i,".dn").setAttribute("displayed","false"),(0,d.aI)(i,".en").setAttribute("displayed","false"),(0,d.aI)(i,".fn").setAttribute("displayed","true");break;case 2:(0,d.aI)(i,".dn").setAttribute("displayed","false"),(0,d.aI)(i,".en").setAttribute("displayed","true"),(0,d.aI)(i,".fn").setAttribute("displayed","false")}}}}]);
//# sourceMappingURL=be5f821fdace272c580b.js.map