"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[796,6675],{7123(t,n,e){e.d(n,{R:()=>w});var r=e(7183),o=e(6483),a=e(6802),i=e(7810),u=e(2063),s=e(8011),f=e(4293),l=e(1932),p=e(424),c=e(2303),d=e(6788),v=e(3459),h=e(1531);function y(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return g(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?g(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function g(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function m(t,n,e,r,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void e(t)}u.done?n(s):Promise.resolve(s).then(r,o)}function w(t,n,e,r,o){return _.apply(this,arguments)}function _(){var t;return t=function*(t,n,e,g,m){(0,d.Mf)(m,"getRoute_0",0,!1),(0,d.Mf)(m,"getRoute_1",0,!1),(0,d.Mf)(m,"getStop_0",0,!1),(0,d.Mf)(m,"getStop_1",0,!1),(0,d.Mf)(m,"getLocation_0",0,!1),(0,d.Mf)(m,"getLocation_1",0,!1),(0,d.Mf)(m,"getSegmentBuffers_0",0,!1),(0,d.Mf)(m,"getSegmentBuffers_1",0,!1),(0,d.Mf)(m,"getEstimateTime_0",0,!1),(0,d.Mf)(m,"getEstimateTime_1",0,!1),(0,d.Mf)(m,"getBusEvent_0",0,!1),(0,d.Mf)(m,"getBusEvent_1",0,!1),(0,d.Mf)(m,"getBusData_0",0,!1),(0,d.Mf)(m,"getBusData_1",0,!1);var w=yield(0,f.a)(m,!0),_=yield(0,p.T)(m),S=yield(0,s.g)(m,0),b=yield(0,s.g)(m,1),I=yield(0,s.g)(m,2),D=yield(0,l.L)(m),P=yield(0,u.K)(m),$=yield(0,i.J)(m),B=yield(0,a.d)(m),O=yield(0,o.Io)(e,g),M=(0,c.w_)($,B,w,t,n),R=!1,A={};D.hasOwnProperty(`r_${t}`)&&(R=!0,A=D[`r_${t}`]);var C,L=(0,v.Js)("time_formatting_mode"),x=[],k=[],E=y(P);try{for(E.s();!(C=E.n()).done;){var T=C.value,Q={},j=T.RouteID;if([t,10*t].includes(j)||n.includes(j)){Q.status=(0,c.$Q)(null==T?void 0:T.EstimateTime,L);var N=`s_${T.StopID}`,q={};if(!_.hasOwnProperty(N))continue;q=_[N],Q.id=T.StopID,Q.sequence=q.seqNo,Q.goBack=q.goBack;var U=`l_${q.stopLocationId}`,z={};if(!S.hasOwnProperty(U))continue;z=S[U],Q.name=z.n,Q.overlappingRoutes=z.r.filter(function(n){return n!==t}).map(function(t){var n=`r_${t}`;if(w.hasOwnProperty(n)){var e=w[n];return{name:e.n,RouteEndPoints:{RouteDeparture:e.dep,RouteDestination:e.des,text:`${e.dep} ↔ ${e.des}`,html:`<span>${e.dep}</span><span>↔</span><span>${e.des}</span>`},RouteID:e.id,PathAttributeId:e.pid}}return null}).filter(function(t){return null!==t}),Q.position={longitude:z.lo,latitude:z.la},k.push({latitude:z.la,longitude:z.lo,id:T.StopID});var J=z.g,F=[];I.hasOwnProperty(J)&&(F=I[J]);var G,K=[],V=y(F);try{for(V.s();!(G=V.n()).done;){var Z=`ml_${G.value.hash}`;if(b.hasOwnProperty(Z)){var H=b[Z],W={name:H.n,distance:0|(0,r.aV)(H.la[0],H.lo[0],z.la,z.lo),hash:H.hash};K.push(W)}}}catch(t){V.e(t)}finally{V.f()}K.sort(function(t,n){return t.distance-n.distance}),Q.nearbyLocations=K;var X,Y=[],tt=y(z.s);try{for(tt.s();!(X=tt.n()).done;){var nt=`s_${X.value}`;M.hasOwnProperty(nt)&&Y.push(M[nt].map(function(t){return(0,c.s$)(t)}))}}catch(t){tt.e(t)}finally{tt.f()}Q.buses=Y.flat().sort(function(t,n){return t.index-n.index});var et=[];O.hasOwnProperty(N)&&(et=O[N]),Q.busArrivalTimes=et;var rt=!1,ot=!1,at=!1,it=!1;if(R){var ut=`g_${Q.goBack}`,st=[];A.hasOwnProperty(ut)?st=A[ut]:"1"===Q.goBack&&(it=!0,st=A.g_0);var ft,lt=y(st);try{for(lt.s();!(ft=lt.n()).done;){var pt=ft.value;pt.OriginStopID!==T.StopID&&pt.DestinationStopID!==T.StopID||(rt=!0),it?(pt.OriginStopID===T.StopID&&(at=!0),pt.DestinationStopID===T.StopID&&(ot=!0)):(pt.OriginStopID===T.StopID&&(ot=!0),pt.DestinationStopID===T.StopID&&(at=!0))}}catch(t){lt.e(t)}finally{lt.f()}}Q.segmentBuffer={isSegmentBuffer:rt,isStartingPoint:ot,isEndingPoint:at},x.push(Q)}}}catch(t){E.e(t)}finally{E.f()}x.sort(function(t,n){return t.sequence-n.sequence});for(var ct=(0,h.uQ)(k,450),dt=!1,vt=!1,ht={},yt=0,gt={},mt=x.length,wt=0;wt<mt;wt++){var _t=x[wt],St=x[wt+1]||_t,bt=0;if(_t.buses.length>0&&_t.buses[0].onThisRoute){var It=[_t.buses[0].position.longitude,_t.buses[0].position.latitude],Dt=It[0],Pt=It[1],$t=[_t.position.longitude,_t.position.latitude],Bt=$t[0],Ot=$t[1],Mt=[St.position.longitude,St.position.latitude],Rt=Mt[0],At=Mt[1];if((Dt-Bt)*(Rt-Dt)+(Pt-Ot)*(At-Pt)>=0){var Ct=Math.hypot(Dt-Bt,Pt-Ot),Lt=Math.hypot(Dt-Rt,Pt-At);bt=Math.max(0,Math.min(Ct/(Ct+Lt),1))}}_t.progress=bt,_t.segmentBuffer.isStartingPoint&&(dt=!0),_t.segmentBuffer.isEndingPoint&&dt&&(vt=!0),dt&&!vt&&(_t.segmentBuffer.isSegmentBuffer=!0),dt&&vt&&(dt=!1,vt=!1);var xt=!1;null!==ct&&ct.id===_t.id&&(xt=!0),_t.nearest=xt;var kt=`g_${_t.goBack}`||"g_0";ht.hasOwnProperty(kt)||(ht[kt]=[],gt[kt]=0,yt+=1),ht[kt].push(_t),gt[kt]+=1}var Et=w[`r_${t}`],Tt={groupedItems:ht,groupQuantity:yt,itemQuantity:gt,RouteName:Et.n,RouteEndPoints:{RouteDeparture:Et.dep,RouteDestination:Et.des},dataUpdateTime:(0,d.Zt)(m),RouteID:t,PathAttributeId:n};return(0,d.LQ)(m),(0,d.gC)(m),Tt},_=function(){var n=this,e=arguments;return new Promise(function(r,o){var a=t.apply(n,e);function i(t){m(a,r,o,i,u,"next",t)}function u(t){m(a,r,o,i,u,"throw",t)}i(void 0)})},_.apply(this,arguments)}},8134(t,n,e){e.d(n,{F6:()=>y,GU:()=>D,Rk:()=>v,dD:()=>S});var r=e(2129),o=e(8024),a=e(4781),i=e(9734),u=e(8011),s=e(4293),f=e(6788);function l(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return p(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?p(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function c(t,n,e,r,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void e(t)}u.done?n(s):Promise.resolve(s).then(r,o)}function d(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var a=t.apply(n,e);function i(t){c(a,r,o,i,u,"next",t)}function u(t){c(a,r,o,i,u,"throw",t)}i(void 0)})}}function v(t){return h.apply(this,arguments)}function h(){return(h=d(function*(t){var n,e=(0,o.zx)(),r=yield(0,s.a)(e,!0),a=`r_${t}`;return!!r.hasOwnProperty(a)&&(n=r[a],(0,f.LQ)(e),(0,f.gC)(e),n)})).apply(this,arguments)}function y(t){return g.apply(this,arguments)}function g(){return(g=d(function*(t){var n=(0,o.zx)(),e=yield(0,s.a)(n,!0),r=[];for(var a in e){var i=e[a];String(i.pid).indexOf(t)>-1&&r.push(i)}return(0,f.LQ)(n),(0,f.gC)(n),r})).apply(this,arguments)}var m={},w=[],_=!1;function S(){return b.apply(this,arguments)}function b(){return(b=d(function*(){if(!_){var t=(0,o.zx)(),n=yield(0,s.a)(t,!0),e=yield(0,u.g)(t,1),r=yield(0,i.j)(t,!0);(0,f.LQ)(t),(0,f.gC)(t);var p={},c=[],d=0;for(var v in n){var h=n[v],y={id:h.id,pid:h.pid,dep:h.dep,des:h.des,n:h.n,hash:"",lo:"",la:"",r:"",s:"",type:0};c.push(y);var g,S=l((0,a.B5)(`${y.n.toLowerCase()}${y.dep.toLowerCase()}${y.des.toLowerCase()}`,!0));try{for(S.s();!(g=S.n()).done;){var b=`u_${g.value}`;p.hasOwnProperty(b)||(p[b]=[]),p[b].push(d)}}catch(t){S.e(t)}finally{S.f()}d+=1}for(var I in e){var D=e[I],P={id:D.id,n:D.n,lo:D.lo,la:D.la,r:D.r,s:D.s,hash:D.hash,dep:"",des:"",pid:[],type:1};c.push(P);var $,B=l((0,a.B5)(P.n.toLowerCase(),!0));try{for(B.s();!($=B.n()).done;){var O=`u_${$.value}`;p.hasOwnProperty(O)||(p[O]=[]),p[O].push(d)}}catch(t){B.e(t)}finally{B.f()}d+=1}for(var M in r){var R=r[M],A={id:R.BusId,pid:[],dep:"",des:"",n:R.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};c.push(A);var C,L=l((0,a.B5)(A.n.toLowerCase(),!0));try{for(L.s();!(C=L.n()).done;){var x=`u_${C.value}`;p.hasOwnProperty(x)||(p[x]=[]),p[x].push(d)}}catch(t){L.e(t)}finally{L.f()}d+=1}m=p,w=c,_=!0}})).apply(this,arguments)}function I(t,n){var e,r=0,o=0,a=l(n);try{for(a.s();!(e=a.n()).done;){var i=e.value;r+=t.indexOf(i,o)-o,o+=1}}catch(t){a.e(t)}finally{a.f()}return t===n&&(r=10*Math.abs(r)),r}function D(t,n,e){if(!_)return[];var o,i=t.toLowerCase(),u=(0,a.B5)(i,!0),s=(0,a.B5)(i,!1),f=[],p=l(u);try{for(p.s();!(o=p.n()).done;){var c=`u_${o.value}`;m.hasOwnProperty(c)&&f.push(m[c])}}catch(t){p.e(t)}finally{p.f()}f.sort(function(t,n){return t.length-n.length});var d=f.length-1,v=[];if(0===d&&(v=f[0]),d>0)for(var h=0;h<d;h++){var y=f[h],g=f[h+1];v=0===h?(0,r._N)(y,g):(0,r._N)(v,g)}var S=[],b=0,D=new Set;if(-1===n||2===n){var P,$=w.filter(function(t){return t.n===i&&2===t.type}),B=l($);try{for(B.s();!(P=B.n()).done;){var O=P.value;if(S.push({item:O,score:1/0}),D.add(O.id),(b+=1)>=e)break}}catch(t){B.e(t)}finally{B.f()}}if(b<e){var M,R=l(v);try{for(R.s();!(M=R.n()).done;){var A=M.value,C=w[A];if((-1===n||n===C.type)&&!D.has(C.id)){var L=I(s,(0,a.B5)(C.n,!1));if(!(b<e))break;S.push({item:C,score:L}),b+=1}}}catch(t){R.e(t)}finally{R.f()}}return S.sort(function(t,n){return n.score-t.score}),S}}}]);
//# sourceMappingURL=a4a1679e47e14df0d790.js.map