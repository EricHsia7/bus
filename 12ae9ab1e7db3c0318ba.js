"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{7123(e,a,t){t.d(a,{a:()=>_});var r=t(3453),n=t(467),i=t(7183),o=t(8024),s=t(6483),u=t(6802),d=t(7810),f=t(2063),p=t(8011),h=t(4293),l=t(1932),c=t(424),v=t(2303),m=t(6788),g=t(3459),y=t(1531);function _(e,a,t,r,n){return b.apply(this,arguments)}function b(){return(b=(0,n.a)(function*(e,a,t,n,_){(0,m.f)(_,"getRoute_0",0,!1),(0,m.f)(_,"getRoute_1",0,!1),(0,m.f)(_,"getStop_0",0,!1),(0,m.f)(_,"getStop_1",0,!1),(0,m.f)(_,"getLocation_0",0,!1),(0,m.f)(_,"getLocation_1",0,!1),(0,m.f)(_,"getSegmentBuffers_0",0,!1),(0,m.f)(_,"getSegmentBuffers_1",0,!1),(0,m.f)(_,"getEstimateTime_0",0,!1),(0,m.f)(_,"getEstimateTime_1",0,!1),(0,m.f)(_,"getBusEvent_0",0,!1),(0,m.f)(_,"getBusEvent_1",0,!1),(0,m.f)(_,"getBusData_0",0,!1),(0,m.f)(_,"getBusData_1",0,!1);var b=yield Promise.all([(0,h.a)(_,!0),(0,c.a)(_),(0,l.a)(_),(0,f.a)(_)]),D=(0,r.a)(b,4),S=D[0],I=D[1],k=D[2],B=D[3],w=yield Promise.all([(0,p.a)(_,0),(0,p.a)(_,1),(0,p.a)(_,2),(0,d.a)(_)]),T=(0,r.a)(w,4),$=T[0],E=T[1],L=T[2],P=T[3],R=yield Promise.all([(0,u.a)(_),(0,s.b)(t,n)]),H=(0,r.a)(R,2),x=H[0],C=H[1],O=(0,v.b)(P,x,S,e,a),W=!1,G={};(0,o.f)(k,`r_${e}`)&&(W=!0,G=k[`r_${e}`]);var M=(0,g.b)("time_formatting_mode"),q=[],Q=[];for(var A of B){var F={},N=A.RouteID;if([e,10*e].includes(N)||a.includes(N)){F.status=(0,v.g)(null==A?void 0:A.EstimateTime,M);var Z=`s_${A.StopID}`,V={};if(!(0,o.f)(I,Z))continue;V=I[Z],F.id=A.StopID,F.sequence=V.seqNo,F.goBack=V.goBack;var U=`l_${V.stopLocationId}`,j={};if(!(0,o.f)($,U))continue;j=$[U],F.name=j.n;var z=j.r.length;F.overlappingRoutes=[];for(var J=0;J<z;J++){var K=j.r[J];if(K!==e){var X=`r_${K}`;if((0,o.f)(S,X)){var Y=S[X],ee={name:Y.n,RouteEndPoints:{RouteDeparture:Y.dep,RouteDestination:Y.des,text:`${Y.dep} ↔ ${Y.des}`,html:`<span>${Y.dep}</span><span>↔</span><span>${Y.des}</span>`},RouteID:Y.id,PathAttributeId:Y.pid};F.overlappingRoutes.push(ee)}}}F.position={longitude:j.lo,latitude:j.la},Q.push({latitude:j.la,longitude:j.lo,id:A.StopID});var ae=j.g,te=[];for(var re of((0,o.f)(L,ae)&&(te=L[ae]),F.nearbyLocations=[],te)){var ne=`ml_${re.hash}`;if((0,o.f)(E,ne)){var ie=E[ne],oe={name:ie.n,distance:0|(0,i.c)(ie.la[0],ie.lo[0],j.la,j.lo),hash:ie.hash};F.nearbyLocations.push(oe)}}for(var se of(F.nearbyLocations.sort(function(e,a){return e.distance-a.distance}),F.buses=[],j.s)){var ue=`s_${se}`;if((0,o.f)(O,ue))for(var de=O[ue].length-1;de>=0;de--)F.buses.push((0,v.c)(O[ue][de]))}F.buses.sort(function(e,a){return e.index-a.index});var fe=[];(0,o.f)(C,Z)&&(fe=C[Z]),F.busArrivalTimes=fe;var pe=!1,he=!1,le=!1,ce=!1;if(W){var ve=`g_${F.goBack}`,me=[];for(var ge of((0,o.f)(G,ve)?me=G[ve]:"1"===F.goBack&&(ce=!0,me=G.g_0),me))ge.OriginStopID!==A.StopID&&ge.DestinationStopID!==A.StopID||(pe=!0),ce?(ge.OriginStopID===A.StopID&&(le=!0),ge.DestinationStopID===A.StopID&&(he=!0)):(ge.OriginStopID===A.StopID&&(he=!0),ge.DestinationStopID===A.StopID&&(le=!0))}F.segmentBuffer={isSegmentBuffer:pe,isStartingPoint:he,isEndingPoint:le},q.push(F)}}q.sort(function(e,a){return e.sequence-a.sequence});for(var ye=(0,y.b)(Q,450),_e=!1,be=!1,De={},Se=0,Ie={},ke=q.length,Be=0;Be<ke;Be++){var we=q[Be],Te=q[Be+1]||we,$e=0;if(we.buses.length>0&&we.buses[0].onThisRoute){var Ee=[we.buses[0].position.longitude,we.buses[0].position.latitude],Le=Ee[0],Pe=Ee[1],Re=[we.position.longitude,we.position.latitude],He=Re[0],xe=Re[1],Ce=[Te.position.longitude,Te.position.latitude],Oe=Ce[0],We=Ce[1];if((Le-He)*(Oe-Le)+(Pe-xe)*(We-Pe)>=0){var Ge=Math.hypot(Le-He,Pe-xe),Me=Math.hypot(Le-Oe,Pe-We);$e=Math.max(0,Math.min(Ge/(Ge+Me),1))}}we.progress=$e,we.segmentBuffer.isStartingPoint&&(_e=!0),we.segmentBuffer.isEndingPoint&&_e&&(be=!0),_e&&!be&&(we.segmentBuffer.isSegmentBuffer=!0),_e&&be&&(_e=!1,be=!1);var qe=!1;null!==ye&&ye.id===we.id&&(qe=!0),we.nearest=qe;var Qe=`g_${we.goBack}`||"g_0";(0,o.f)(De,Qe)||(De[Qe]=[],Ie[Qe]=0,Se+=1),De[Qe].push(we),Ie[Qe]+=1}var Ae=S[`r_${e}`],Fe=Ae.n,Ne=Ae.dep,Ze=Ae.des,Ve={groupNames:[`往${Ze}`,`往${Ne}`],groupedItems:De,groupQuantity:Se,itemQuantity:Ie,RouteName:Fe,RouteEndPoints:[Ne,Ze],dataUpdateTime:(0,m.e)(_),RouteID:e,PathAttributeId:a};return(0,m.a)(_),(0,m.b)(_),Ve})).apply(this,arguments)}},8134(e,a,t){t.d(a,{a:()=>b,b:()=>I,c:()=>p,d:()=>v,e:()=>l});var r=t(467),n=t(2129),i=t(8024),o=t(4781),s=t(9734),u=t(8011),d=t(4293),f=t(6788);function p(e){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return(c=(0,r.a)(function*(e){var a,t=(0,i.c)(),r=yield(0,d.a)(t,!0),n=`r_${e}`;return!!(0,i.f)(r,n)&&(a=r[n],(0,f.a)(t),(0,f.b)(t),a)})).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}var g={},y=[],_=!1;function b(){return D.apply(this,arguments)}function D(){return(D=(0,r.a)(function*(){if(!_){var e=(0,i.c)(),a=yield(0,d.a)(e,!0),t=yield(0,u.a)(e,1),r=yield(0,s.a)(e,!0);(0,f.a)(e),(0,f.b)(e);var n={},p=[],h=0;for(var l in a){var c=a[l],v={id:c.id,pid:c.pid,dep:c.dep,des:c.des,n:c.n,hash:"",lo:"",la:"",r:"",s:"",type:0};p.push(v);var m=(0,o.b)(`${v.n.toLowerCase()}${v.dep.toLowerCase()}${v.des.toLowerCase()}`,!0);for(var b of m){var D=`u_${b}`;(0,i.f)(n,D)||(n[D]=[]),n[D].push(h)}h+=1}for(var S in t){var I=t[S],k={id:I.id,n:I.n,lo:I.lo,la:I.la,r:I.r,s:I.s,hash:I.hash,dep:"",des:"",pid:[],type:1};p.push(k);var B=(0,o.b)(k.n.toLowerCase(),!0);for(var w of B){var T=`u_${w}`;(0,i.f)(n,T)||(n[T]=[]),n[T].push(h)}h+=1}for(var $ in r){var E=r[$],L={id:E.BusId,pid:[],dep:"",des:"",n:E.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};p.push(L);var P=(0,o.b)(L.n.toLowerCase(),!0);for(var R of P){var H=`u_${R}`;(0,i.f)(n,H)||(n[H]=[]),n[H].push(h)}h+=1}g=n,y=p,_=!0}})).apply(this,arguments)}function S(e,a){var t=0,r=0;for(var n of a){t+=e.indexOf(n,r)-r,r+=1}return e===a&&(t=10*Math.abs(t)),t}function I(e,a,t){if(!_)return[];var r=e.toLowerCase(),s=(0,o.b)(r,!0),u=(0,o.b)(r,!1),d=[];for(var f of s){var p=`u_${f}`;(0,i.f)(g,p)&&d.push(g[p])}d.sort(function(e,a){return e.length-a.length});var h=d.length-1,l=[];if(0===h&&(l=d[0]),h>0)for(var c=0;c<h;c++){var v=d[c],m=d[c+1];l=0===c?(0,n.b)(v,m):(0,n.b)(l,m)}var b=[],D=0,I=new Set;if(-1===a||2===a){var k=y.filter(function(e){return e.n===r&&2===e.type});for(var B of k)if(b.push({item:B,score:1/0}),I.add(B.id),(D+=1)>=t)break}if(D<t)for(var w of l){var T=y[w];if((-1===a||a===T.type)&&!I.has(T.id)){var $=S(u,(0,o.b)(T.n,!1));if(!(D<t))break;b.push({item:T,score:$}),D+=1}}return b.sort(function(e,a){return a.score-e.score}),b}},8621(e,a,t){t.d(a,{a:()=>h});var r=t(3453),n=t(467),i=t(5579),o=t(313),s=t(4293),u=t(8201),d=t(8671),f=t(2303),p=t(6788);function h(e,a,t){return l.apply(this,arguments)}function l(){return(l=(0,n.a)(function*(e,a,t){var n=function(e,a){var t={};for(var r of e)if(r.Id===a){t=r;break}return t}(yield(0,s.a)(t,!1),e),h=yield Promise.all([(0,u.a)(t),(0,d.a)(t),(0,o.a)(t)]),l=(0,r.a)(h,3),c=l[0],v=l[1],m=l[2],g=function(e){var a=(0,f.h)(e.goFirstBusTime,0),t=(0,f.h)(e.goLastBusTime,0),r=(0,f.h)(e.backFirstBusTime,0),n=(0,f.h)(e.backLastBusTime,0),i=(0,f.h)(e.holidayGoFirstBusTime,0),o=(0,f.h)(e.holidayGoLastBusTime,0),s=(0,f.h)(e.holidayBackFirstBusTime,0),u=(0,f.h)(e.holidayBackLastBusTime,0),d=(0,f.h)(e.peakHeadway,1),p=(0,f.h)(e.offPeakHeadway,1),h=(0,f.h)(e.holidayPeakHeadway,1),l=(0,f.h)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:a,last:t,rushHourWindow:d,offRushHourWindow:p},holiday:{first:i,last:o,rushHourWindow:h,offRushHourWindow:l}},back:{weekday:{first:r,last:n,rushHourWindow:d,offRushHourWindow:p},holiday:{first:s,last:u,rushHourWindow:h,offRushHourWindow:l}},realSequence:e.realSequence}}(n),y=function(e,a,t,r,n){var o={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,i.f)();for(var u of r)if(a.indexOf(u.PathAttributeId)>-1&&"0"===u.DateType)for(var d=(0,i.d)(u.DateValue),p=(0,i.h)(s,d.day,0,0),h=(0,f.h)(u.StartTime,0),l=(0,i.h)(p,0,h.hours,h.minutes),c=(0,f.h)(u.EndTime,0),v=(0,i.h)(p,0,c.hours,c.minutes),m=Math.abs(60*c.hours+c.minutes-(60*h.hours+h.minutes)),g=parseInt(u.LongHeadway),y=parseInt(u.LowHeadway),_=(y+g)/2,b=m/_,D=0;D<b;D++){var S=!1,I=(0,i.h)(p,0,h.hours,h.minutes+y*D);I.getTime()<l.getTime()&&(S=!0),I.getTime()>v.getTime()&&(S=!0),!1===S&&(o.calendarEventGroups[d.code].push({date:I,dateString:(0,i.c)(I,"hh:mm"),duration:y,deviation:Math.abs(_-y)}),o.calendarEventQuantity[d.code]+=1)}for(var k of n)if(a.indexOf(k.PathAttributeId)>-1&&"0"===k.DateType){var B=(0,i.d)(k.DateValue),w=(0,i.h)(s,B.day,0,0),T=(0,f.h)(k.DepartureTime,0),$=(0,i.h)(w,0,T.hours,T.minutes);o.calendarEventGroups[B.code].push({date:$,dateString:(0,i.c)($,"hh:mm"),duration:15,deviation:0}),o.calendarEventQuantity[B.code]+=1}for(var E in o.calendarEventGroups)o.calendarEventGroups[E].sort(function(e,a){return e.date.getTime()-a.date.getTime()});return o}(0,a,0,c,v),_=function(e,a){var t={};for(var r of e)r.id===a&&(t=r);return t}(m,n.providerId),b={timeTableRules:g,calendar:y,properties:[{key:"route_name",icon:"route",value:n.nameZh},{key:"pricing",icon:"attach_money",value:n.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:_.nameZn},{key:"provider_phone",icon:"call",value:_.phoneInfo},{key:"provider_email",icon:"alternate_email",value:_.email}]};return(0,p.a)(t),(0,p.b)(t),b})).apply(this,arguments)}}}]);
//# sourceMappingURL=12ae9ab1e7db3c0318ba.js.map