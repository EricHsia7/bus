"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,i)=>{i.d(e,{Ch:()=>lt,S5:()=>V,SR:()=>dt,U7:()=>ut,aU:()=>ct,py:()=>vt});var n=i(7123),s=i(4537),a=i(3459),r=i(8024),o=i(7968),d=i(3648),u=i(5767),l=i(9566),c=i(904),v=i(9119),f=i(5579),p=i(5314),h=i(4636);function m(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return b(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function g(t,e,i,n,s,a,r){try{var o=t[a](r),d=o.value}catch(t){return void i(t)}o.done?e(d):Promise.resolve(d).then(n,s)}var y=(0,d.bv)(".ik"),A=(0,d.aI)(y,"._l"),I=(0,d.aI)(A,".cm"),$=(0,d.aI)(A,".bm"),k=(0,d.aI)(A,".jm .km"),w=(0,d.aI)(A,".dm"),x=(0,d.aI)(w,".em"),L=(0,d.aI)(A,".hm"),R=(0,d.aI)(L,".im"),j=(0,d.aI)(y,".jk"),T={},P=!0,S=!1,_=0,E=0,Z=0,M={},C=0,D=!1,B=1e4,H=15e3,q=5e3,F=15e3,z=!0,N=0,O=0,U="",Q=!1,J=!1,W=!1,K=0,X=[],G=20;function V(){j.addEventListener("touchstart",(function(){_=Math.round(j.scrollLeft/C)}),{passive:!0}),j.addEventListener("scroll",(function(t){D=!0;var e=t.target.scrollLeft/C;E=e>_?_+1:_-1;var i=M[`g_${_}`]||{width:0,offset:0},n=M[`g_${E}`]||{width:0,offset:0},s=i.width+(n.width-i.width)*Math.abs(e-_),a=-1*(i.offset+(n.offset-i.offset)*Math.abs(e-_))+.5*C-.5*s;Y(Z,a,s-G,e),e===E&&(_=Math.round(j.scrollLeft/C),D=!1)}),{passive:!0})}function Y(t,e,i,n){j.style.setProperty("--hk",t.toString()),R.style.setProperty("--xl",i.toString()),x.style.setProperty("--fm",`${e.toFixed(5)}px`),x.style.setProperty("--vl",n.toFixed(5))}function tt(t){var e=t;if(Q){var i=e.detail.progress-1;k.style.setProperty("--zl",i.toString())}"end"===e.detail.stage&&document.removeEventListener(e.detail.target,tt)}function et(){var t=(0,r.zx)("i"),e=document.createElement("div");return e.classList.add("qm"),e.id=t,e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0"),e.innerHTML='<div class="vm"></div><div class="ym"><div class="ia" code="0"></div><div class="ja" code="0"></div></div>',{element:e,id:t}}function it(t){var e=(0,r.zx)("i"),i=document.createElement("div");return i.classList.add("an"),i.id=e,i.setAttribute("stretched","false"),i.setAttribute("stretching","false"),i.setAttribute("push-direction","0"),i.setAttribute("push-state","0"),i.innerHTML=`<div class="bn"><div class="cn"></div><div class="dn"><div class="en"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="fn" onclick="bus.route.stretchRouteItem('${e}', '${t}')">${(0,s.Z)("keyboard_arrow_down")}</div><div class="gn"></div></div></div><div class="hn" displayed="false"><div class="in"><div class="jn" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 0)" code="0"><div class="kn">${(0,s.Z)("directions_bus")}</div>公車</div><div class="jn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 1)" code="1"><div class="kn">${(0,s.Z)("departure_board")}</div>抵達時間</div><div class="jn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 2)" code="2"><div class="kn">${(0,s.Z)("route")}</div>路線</div><div class="jn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 3)" code="3"><div class="kn">${(0,s.Z)("location_on")}</div>地點</div><div class="jn" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-route', ['${e}', null, null])"><div class="kn">${(0,s.Z)("folder")}</div>儲存至資料夾</div><div class="jn" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-route', ['${e}', null, null, null])" enabled="true"><div class="kn">${(0,s.Z)("notifications")}</div>設定到站通知</div></div><div class="ln" displayed="true"></div><div class="mn" displayed="false"></div><div class="nn" displayed="false"></div><div class="on" displayed="false"></div></div>`,{element:i,id:e}}function nt(){var t=document.createElement("div");t.classList.add("kk");var e=document.createElement("div");e.classList.add("lk");var i=document.createElement("div");i.classList.add("mk");var n=document.createElement("div");n.classList.add("pm");var s=document.createElement("div");s.classList.add("nk");var a=document.createElement("div");return a.classList.add("pn"),s.appendChild(a),i.appendChild(n),e.appendChild(i),e.appendChild(s),t.appendChild(e),{element:t,id:""}}function st(t,e,i){function n(e,i,n,a,o,u){function c(t,e,i,n,s){var a=(0,d.aI)(e,".ym"),r=(0,d.aI)(a,".ja"),o=(0,d.aI)(a,".ia"),u=(0,d.aI)(t,".en"),l=(0,d.aI)(u,".ja"),c=(0,d.aI)(u,".ia");if(o.setAttribute("code",i.status.code.toString()),c.setAttribute("code",i.status.code.toString()),c.innerText=i.status.text,!n&&s){var v=t.getBoundingClientRect(),f=v.top,p=v.left,h=v.bottom,m=v.right,b=window.innerWidth,g=window.innerHeight;if(h>0&&f<g&&m>0&&p<b)return r.addEventListener("animationend",(function(){r.setAttribute("code",i.status.code.toString()),r.classList.remove("_a")}),{once:!0}),l.addEventListener("animationend",(function(){l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text,l.classList.remove("_a")}),{once:!0}),r.classList.add("_a"),void l.classList.add("_a")}r.setAttribute("code",i.status.code.toString()),l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text}function v(t,e,i){t.setAttribute("segment-buffer",(0,r.xZ)(i.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,r.xZ)(i.segmentBuffer.isSegmentBuffer))}function p(t,e){(0,d.aI)(t,".cn").innerText=e.name}function m(t,e){(0,d.aI)(t,".ln").innerHTML=0===e.buses.length?'<div class="qn">目前沒有公車可顯示</div>':e.buses.map((function(t){return`<div class="rn" on-this-route="${t.onThisRoute}"><div class="sn"><div class="tn">${(0,s.Z)("directions_bus")}</div><div class="un">${t.carNumber}</div></div><div class="vn"><div class="wn">路線：${t.RouteName}</div><div class="xn">狀態：${t.status.text}</div><div class="yn">類型：${t.type}</div></div></div>`})).join("")}function b(t,e){(0,d.aI)(t,".mn").innerHTML=0===e.overlappingRoutes.length?'<div class="zn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return`<div class="_n"><div class="ao"><div class="bo">${(0,s.Z)("route")}</div><div class="co">${t.name}</div></div><div class="do">${t.RouteEndPoints.html}</div><div class="eo"><div class="fo" onclick="bus.route.switchRoute(${t.RouteID}, [${t.PathAttributeId.join(",")}])">查看路線</div><div class="fo" onclick="bus.folder.openSaveToFolder('route-on-route', [${t.RouteID}])">收藏路線</div></div></div>`})).join("")}function g(t,e){(0,d.aI)(t,".nn").innerHTML=0===e.busArrivalTimes.length?'<div class="go">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return`<div class="ho"><div class="io"><div class="jo">${(0,s.Z)("calendar_view_day")}</div><div class="ko">${t.personalSchedule.name}</div><div class="lo">週${(0,f.kd)(t.day).name} ${(0,f.pn)(t.personalSchedule.period.start)} - ${(0,f.pn)(t.personalSchedule.period.end)}</div></div><div class="mo">${t.chart}</div></div>`})).join("")}function y(t,e){(0,d.aI)(t,".on").innerHTML=0===e.nearbyLocations.length?'<div class="no">目前沒有地點可顯示</div>':e.nearbyLocations.map((function(t){return`<div class="oo"><div class="po"><div class="qo">${(0,s.Z)("location_on")}</div><div class="ro">${t.name}</div></div><div class="so">${t.distance}公尺</div><div class="to"><div class="uo" onclick="bus.location.openLocation('${t.hash}')">查看地點</div><div class="uo">收藏地點</div></div></div>`})).join("")}function A(t,e,i){t.setAttribute("nearest",(0,r.xZ)(i.nearest)),e.setAttribute("nearest",(0,r.xZ)(i.nearest))}function I(t,e,i,n,s){var a=(null==i?void 0:i.progress)||0,r=(null==e?void 0:e.progress)||0,o=(0,d.aI)(t,".vm");if(!n&&s&&0!==a&&0===r&&Math.abs(r-a)>0)return o.style.setProperty("--tm","100%"),o.style.setProperty("--um","100%"),void o.addEventListener("transitionend",(function(){o.style.setProperty("--tm","0%"),o.style.setProperty("--um","0%")}),{once:!0});o.style.setProperty("--tm","0%"),o.style.setProperty("--um",100*r+"%")}function $(t,e,i){i&&((0,d.aI)(t,".hn").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function k(t,e,i){t.setAttribute("animation",(0,r.xZ)(i)),e.setAttribute("animation",(0,r.xZ)(i))}function w(t,e,i){t.setAttribute("skeleton-screen",(0,r.xZ)(i)),e.setAttribute("skeleton-screen",(0,r.xZ)(i))}function x(e,i){var n=(0,d.aI)(e,'.hn .in .jn[type="save-to-folder"]');n.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}])`),(0,l.LH)("stop",i.id).then((function(t){n.setAttribute("highlighted",(0,r.xZ)(t))}))}function L(e,i){var n=(0,d.aI)(e,'.hn .in .jn[type="schedule-notification"]');n.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}, ${i.status.time}])`);var s=(0,h.Zc)(i.id);n.setAttribute("highlighted",(0,r.xZ)(s))}null===a?(c(e,i,n,o,u),p(e,n),m(e,n),b(e,n),g(e,n),y(e,n),v(e,i,n),A(e,i,n),I(i,n,a,o,u),$(e,i,o),k(e,i,u),w(e,i,o),x(e,n),L(e,n)):(n.status.time!==a.status.time&&(c(e,i,n,o,u),L(e,n)),(0,r.hw)(a.buses,n.buses)||m(e,n),(0,r.hw)(a.busArrivalTimes,n.busArrivalTimes)||g(e,n),(0,r.hw)(a.segmentBuffer,n.segmentBuffer)||v(e,i,n),a.nearest!==n.nearest&&A(e,i,n),a.progress!==n.progress&&I(i,n,a,o,u),a.id!==n.id&&(p(e,n),b(e,n),y(e,n),x(e,n),L(e,n)),u!==P&&k(e,i,u),o!==S&&($(e,i,o),w(e,i,o)))}var a=(0,c.gO)("window"),u=a.width,v=a.height,p=t.groupQuantity,m=t.itemQuantity,b=t.groupedItems;Z=p,C=u;for(var g=0,y=0;y<p;y++){var A=(0,o.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`往${t}`}))[y],500,"17px",'"Noto Sans TC", sans-serif')+G;M[`g_${y}`]={width:A,offset:g},g+=A}var k=-1*M[`g_${_}`].offset+.5*C-.5*M[`g_${_}`].width;D||Y(Z,k,M[`g_${_}`].width-G,_),I.innerHTML=`<span>${t.RouteName}</span>`,I.setAttribute("animation",(0,r.xZ)(i)),I.setAttribute("skeleton-screen",(0,r.xZ)(e)),w.setAttribute("animation",(0,r.xZ)(i)),w.setAttribute("skeleton-screen",(0,r.xZ)(e)),L.setAttribute("animation",(0,r.xZ)(i)),L.setAttribute("skeleton-screen",(0,r.xZ)(e)),$.setAttribute("onclick",`bus.route.openRouteDetails(${t.RouteID}, [${t.PathAttributeId.join(",")}])`);var R,E,B=(0,d.jg)(j,".kk").length;if(p!==B){var H=B-p;if(H<0){for(var q=new DocumentFragment,F=new DocumentFragment,z=0;z<Math.abs(H);z++){var N=nt();q.appendChild(N.element);var O=(R=void 0,E=void 0,R=(0,r.zx)("t"),(E=document.createElement("div")).classList.add("gm"),E.id=R,{element:E,id:R});F.appendChild(O.element)}j.append(q),x.append(F)}else for(var U=(0,d.jg)(j,".kk"),Q=(0,d.jg)(x,".gm"),J=0;J<Math.abs(H);J++){var W=B-1-J;U[W].remove(),Q[W].remove()}}for(var K=(0,d.jg)(j,".kk"),X=0;X<p;X++){var V=`g_${X}`,tt=K[X],st=(0,d.aI)(tt,".nk"),at=(0,d.aI)(tt,".mk"),rt=(0,d.jg)(st,".an").length;if(m[V]!==rt){var ot=rt-m[V];if(ot<0){for(var dt=new DocumentFragment,ut=new DocumentFragment,lt=0;lt<Math.abs(ot);lt++){var ct=et(),vt=it(ct.id);dt.appendChild(vt.element),ut.appendChild(ct.element)}st.append(dt),at.append(ut)}else for(var ft=(0,d.jg)(st,".an"),pt=(0,d.jg)(at,".qm"),ht=0;ht<Math.abs(ot);ht++){var mt=rt-1-ht;ft[mt].remove(),pt[mt].remove()}}}for(var bt=(0,d.jg)(x,".gm"),gt=0;gt<p;gt++){var yt=`g_${gt}`,At=bt[gt];At.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`<span>往${t}</span>`}))[gt],At.style.setProperty("--yl",`${M[yt].width}px`),At.style.setProperty("--wl",gt.toString());for(var It=K[gt],$t=(0,d.aI)(It,".nk"),kt=(0,d.aI)(It,".mk"),wt=(0,d.jg)($t,".an"),xt=(0,d.jg)(kt,".qm"),Lt=0;Lt<m[yt];Lt++){var Rt=wt[Lt],jt=xt[Lt],Tt=b[yt][Lt];if(T.hasOwnProperty("groupedItems"))if(T.groupedItems.hasOwnProperty(yt))if(T.groupedItems[yt][Lt])n(Rt,jt,Tt,T.groupedItems[yt][Lt],e,i);else n(Rt,jt,Tt,null,e,i);else n(Rt,jt,Tt,null,e,i);else n(Rt,jt,Tt,null,e,i)}}T=t,P=i,S=e}function at(){return rt.apply(this,arguments)}function rt(){var t;return t=function*(){var t=(0,a.Js)("playing_animation"),e=(0,a.Js)("refresh_interval"),i=(0,c.gO)("route-bus-arrival-time-chart");z=e.dynamic,H=e.baseInterval,Q=!0,U=(0,r.zx)("r"),k.setAttribute("refreshing","true"),k.classList.remove("lm"),document.addEventListener(U,tt);var s=yield(0,n.R)(K,X,i.width,i.height,U);st(s,!1,t);var o=0;z&&(o=yield(0,u.wz)()),N=(new Date).getTime(),O=z?Math.max(N+q,s.dataUpdateTime+H/o):N+H,F=Math.max(q,O-N),Q=!1,k.setAttribute("refreshing","false"),k.style.setProperty("--x",`${F}ms`),k.addEventListener("animationend",(function(){k.classList.remove("lm")}),{once:!0}),k.classList.add("lm")},rt=function(){var e=this,i=arguments;return new Promise((function(n,s){var a=t.apply(e,i);function r(t){g(a,n,s,r,o,"next",t)}function o(t){g(a,n,s,r,o,"throw",t)}r(void 0)}))},rt.apply(this,arguments)}function ot(){at().then((function(){J?setTimeout((function(){ot()}),Math.max(q,O-(new Date).getTime())):W=!1})).catch((function(t){console.error(t),J?((0,v.a)(`路線網路連線中斷，將在${B/1e3}秒後重試。`,"error"),setTimeout((function(){ot()}),B)):W=!1}))}function dt(t,e){(0,c.WR)("Route"),(0,p.XK)("route",t),K=t,X=e,_=0,y.setAttribute("displayed","true"),j.scrollLeft=0,function(){for(var t=(0,a.Js)("playing_animation"),e=(0,c.gO)("window"),i=(e.width,e.height),n=Math.floor(i/50)+5,s={},r=0;r<2;r++){var o=`g_${r}`;s[o]=[];for(var d=0;d<n;d++)s[o].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],nearbyLocations:[],sequence:d,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}st({groupedItems:s,groupQuantity:2,itemQuantity:{g_0:n,g_1:n},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),J||(J=!0,W?at():(W=!0,ot())),(0,c.Z_)()}function ut(){y.setAttribute("displayed","false"),J=!1,(0,c.l$)()}function lt(t,e){J=!1,dt(t,e)}function ct(t,e){var i=(0,d.aI)(j,`.kk .lk .nk .an#${t}`),n=(0,d.aI)(i,".hn"),s=(0,d.aI)(j,`.kk .lk .mk .qm#${e}`),a=i.parentElement,r=s.parentElement,o=(0,d.ji)(s,"qm"),u=(0,d.ji)(i,"an"),l=u.length,c=a.getBoundingClientRect(),v=i.getBoundingClientRect(),f=r.getBoundingClientRect(),p=s.getBoundingClientRect().top-f.top,h=v.top-c.top,m="true"===i.getAttribute("stretched"),b="true"===i.getAttribute("animation");if(b){var g=m?"2":"1";s.setAttribute("stretching","true"),s.style.setProperty("--nm",`${p}px`),i.setAttribute("stretching","true"),i.style.setProperty("--wo",`${h}px`);for(var y=0;y<l;y++){var A=u[y],I=o[y];I.style.setProperty("--om",(-1*y-1).toString()),I.setAttribute("push-direction",g),I.setAttribute("push-state","1"),A.setAttribute("push-direction",g),A.setAttribute("push-state","1")}i.addEventListener("transitionend",(function(){for(var t=0;t<l;t++){var e=u[t],n=o[t];n.setAttribute("push-direction","0"),n.setAttribute("push-state","0"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0")}s.setAttribute("stretching","false"),i.setAttribute("stretching","false")}),{once:!0}),i.addEventListener("transitionstart",(function(){for(var t=0;t<l;t++){var e=u[t];o[t].setAttribute("push-state","2"),e.setAttribute("push-state","2")}}),{once:!0})}m?(b?n.addEventListener("transitionend",(function(){n.setAttribute("displayed","false")}),{once:!0}):n.setAttribute("displayed","false"),i.setAttribute("stretched","false"),s.setAttribute("stretched","false")):(n.setAttribute("displayed","true"),i.setAttribute("stretched","true"),s.setAttribute("stretched","true"))}function vt(t,e){var i,n=(0,d.aI)(j,`.an#${t}`),s=(0,d.aI)(n,".in"),a=m((0,d.jg)(s,'.jn[highlighted="true"][type="tab"]'));try{for(a.s();!(i=a.n()).done;){i.value.setAttribute("highlighted","false")}}catch(t){a.e(t)}finally{a.f()}switch((0,d.aI)(s,`.jn[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,d.aI)(n,".ln").setAttribute("displayed","true"),(0,d.aI)(n,".nn").setAttribute("displayed","false"),(0,d.aI)(n,".mn").setAttribute("displayed","false"),(0,d.aI)(n,".on").setAttribute("displayed","false");break;case 1:(0,d.aI)(n,".ln").setAttribute("displayed","false"),(0,d.aI)(n,".nn").setAttribute("displayed","true"),(0,d.aI)(n,".mn").setAttribute("displayed","false"),(0,d.aI)(n,".on").setAttribute("displayed","false");break;case 2:(0,d.aI)(n,".ln").setAttribute("displayed","false"),(0,d.aI)(n,".nn").setAttribute("displayed","false"),(0,d.aI)(n,".mn").setAttribute("displayed","true"),(0,d.aI)(n,".on").setAttribute("displayed","false");break;case 3:(0,d.aI)(n,".ln").setAttribute("displayed","false"),(0,d.aI)(n,".nn").setAttribute("displayed","false"),(0,d.aI)(n,".mn").setAttribute("displayed","false"),(0,d.aI)(n,".on").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=73cdff3ea90c0723add4.js.map