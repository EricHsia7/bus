"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[496],{365(e,t,r){r.d(t,{G:()=>o});var i=r(467),n=r(3422),a=r(4778),u=r(2571),s=r(1172);function o(e){return d.apply(this,arguments)}function d(){return(d=(0,i.A)(function*(e){if(""===n.M3||""===n.se||void 0===e)return!1;var t=(0,a.F)("cancel",[e]),r=(0,u.b)("cancel",[e]),i=yield(0,s.R)("cancel",t,r);return!1!==i&&(200===i.code&&"cancel"===i.method&&(yield(0,n.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>n});var i=r(467);function n(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,i.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},n=yield fetch(t,i);if(!n.ok){yield n.text();return!1}try{var a=yield n.text(),u=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return u;default:return!1}}catch(e){throw new Error("E23")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{b:()=>u});var i=r(8024),n=r(3422);function a(e,t,r){var n=(new Date).getTime(),a=(n-n%5e3)/5e3;return(0,i.Zf)((0,i.Zf)(`${e}\n${t}\n${a}\n${(0,i.Zf)(`${e}\n${t}\n${(0,i.Zf)(JSON.stringify(r))}`)}`))}function u(e,t){switch(e){case"cancel":return""!==n.M3&&""!==n.se&&1===t.length&&{client_id:n.M3,token:a(n.M3,n.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,i.Zf)(`${(0,i.Zf)(t[0])}${r.getTime()}`)};case"schedule":return""!==n.M3&&""!==n.se&&9===t.length&&{client_id:n.M3,token:a(n.M3,n.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==n.M3&&""!==n.se&&0===t.length&&{client_id:n.M3,token:a(n.M3,n.se,{})};case"reschedule":return""!==n.M3&&""!==n.se&&3===t.length&&{client_id:n.M3,token:a(n.M3,n.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3422(e,t,r){r.d(t,{M3:()=>_,ph:()=>v,se:()=>g,z9:()=>R,hc:()=>D,D7:()=>J,cS:()=>M,e3:()=>z,Db:()=>Q,VJ:()=>I,ms:()=>w,G7:()=>C,mD:()=>j,FX:()=>E,gc:()=>T,Je:()=>O,uQ:()=>k,Zc:()=>F});var i=r(467),n=r(8024),a=r(8011),u=r(4293),s=r(424),o=r(6788),d=r(3459),c=r(4311),l=r(2284),f=r(4778),p=r(2571),m=r(1172);function h(){return(h=(0,i.A)(function*(){if(""===_||""===g)return!1;var e=(0,f.F)("rotate"),t=(0,p.b)("rotate",[]),r=yield(0,m.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&(k(r.secret),yield w(),!0))})).apply(this,arguments)}function y(){return y=(0,i.A)(function*(e,t,r,i,n,a,u,s,o){if(""===_||""===g||void 0===e||void 0===t||void 0===r||void 0===i||void 0===n||void 0===a||"number"!=typeof u||void 0===o)return!1;var d=new Date;switch((0,l.A)(o)){case"string":case"number":d=new Date(o);break;default:if(!(o instanceof Date))return!1;d=o}var c=(0,f.F)("schedule"),y=(0,p.b)("schedule",[e,t,r,i,n,a,u,s,d.toISOString()]),v=yield(0,m.R)("schedule",c,y);return!1!==v&&(200===v.code&&"schedule"===v.method&&(Math.random()>.8&&(yield function(){return h.apply(this,arguments)}()),yield C(v.schedule_id,e,t,r,i,n,a,u,s,d.getTime()),v.schedule_id))}),y.apply(this,arguments)}var v="",_="",g="",S=[],b={},$={};function w(){return N.apply(this,arguments)}function N(){return(N=(0,i.A)(function*(){var e={provider:v,client_id:_,secret:g};yield(0,c.mL)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function Q(){return A.apply(this,arguments)}function A(){return(A=(0,i.A)(function*(){var e=yield(0,c.Ct)(9,"n_client");if(e){var t=JSON.parse(e);v=t.provider,_=t.client_id,g=t.secret}})).apply(this,arguments)}function D(){return""!==_&&""!==g}function O(e){if(!(0,n.Gz)(e))throw new Error("E24");var t=new URL(e);v=`${t.protocol}//${t.hostname}`}function J(){return String(v)}function T(e){void 0!==e&&(_=String(e))}function k(e){void 0!==e&&(g=String(e))}function M(){return x.apply(this,arguments)}function x(){return(x=(0,i.A)(function*(){(new Date).getTime();var e=yield(0,c.Su)(10),t=0;for(var r of e){var i=yield(0,c.Ct)(10,r),a=JSON.parse(i),u=a.schedule_id,s=`s_${a.stop_id}`;S.push(a),b[u]=t,(0,n.mQ)($,s)||($[s]=[]),$[s].push(t),t+=1}})).apply(this,arguments)}function C(e,t,r,i,n,a,u,s,o,d){return L.apply(this,arguments)}function L(){return(L=(0,i.A)(function*(e,t,r,i,a,u,s,o,d,l){var f={schedule_id:e,stop_id:t,location_name:r,route_id:i,route_name:a,direction:u,estimate_time:s,time_formatting_mode:o,time_offset:d,scheduled_time:l},p=`s_${t}`,m=S.length;S.push(f),b[e]=m,(0,n.mQ)($,p)||($[p]=[]),$[p].push(m),yield(0,c.mL)(10,e,JSON.stringify(f))})).apply(this,arguments)}function I(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.A)(function*(e){if((0,n.mQ)(b,e)){var t=b[e],r=`s_${S[t].stop_id}`;S.splice(t,1,null),$[r].splice($[r].indexOf(t),1),delete b[e],yield(0,c.iQ)(10,e)}})).apply(this,arguments)}function F(e){var t=(new Date).getTime(),r=`s_${e}`;if((0,n.mQ)($,r)){var i=$[r];for(var a of i){var u=S[a];if(null!==u)if(u.scheduled_time>t)return!0}}return!1}function R(){return H.apply(this,arguments)}function H(){return(H=(0,i.A)(function*(){var e=(new Date).getTime();for(var t in b){var r=b[t],i=S[r];if(i.scheduled_time<=e){var n=`s_${i.stop_id}`;S.splice(r,1,null),$[n].splice($[n].indexOf(r),1),delete b[t],yield(0,c.iQ)(10,t)}}})).apply(this,arguments)}function z(e){return U.apply(this,arguments)}function U(){return(U=(0,i.A)(function*(e){var t=yield(0,u.a)(e,!0),r=function(){var e=(new Date).getTime(),t=[];for(var r of S)null!==r&&r.scheduled_time>e&&t.push(r);return t}(),i=(new Date).getTime(),a=[];for(var s of r){var d={},c=s.location_name;d.name=c;var l=s.stop_id;d.stop_id=l;var f=s.estimate_time;d.estimate_time=f;var p=s.schedule_id;d.schedule_id=p;var m=s.scheduled_time;d.scheduled_time=m;var h=new Date(m),y=h.getDate(),v=h.getHours(),_=h.getMinutes();d.date=String(y).padStart(2,"0"),d.hours=String(v).padStart(2,"0"),d.minutes=String(_).padStart(2,"0"),d.route={};var g=s.route_name;d.route.name=g;var b=s.route_id;d.route.id=b;var $=s.direction;d.route.direction=$;var w=`r_${s.route_id}`;if((0,n.mQ)(t,w)){var N=t[w].pid;d.route.pathAttributeId=N,a.push(d)}}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});var Q=[],A=0,D={};for(var O of a){var J=`g_${O.date}_${O.hours}`;(0,n.mQ)(D,J)?O.is_first=!1:(D[J]=!0,O.is_first=!0),Q.push(O),A+=1}var T={items:Q,itemQuantity:A,dataUpdateTime:Math.max((0,o.Zt)(e),i)};return(0,o.gC)(e),(0,o.LQ)(e),T})).apply(this,arguments)}var E=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function j(e,t,r,i){return G.apply(this,arguments)}function G(){return G=(0,i.A)(function*(e,t,r,i){if(D()){var c=(0,d.Js)("time_formatting_mode"),l=(0,n.zx)(),f=yield(0,s.T)(l),p=yield(0,a.g)(l,0),m=yield(0,u.a)(l,!0);(0,o.LQ)(l),(0,o.gC)(l);var h=`s_${e}`,v={};if(!(0,n.mQ)(f,h))return 0;var _=(v=f[h]).stopLocationId,g=v.goBack,S=`l_${_}`;if(!(0,n.mQ)(p,S))return 0;var b=p[S].n,$=`r_${t}`,w={};if(!(0,n.mQ)(m,$))return 0;var N=(w=m[$]).n,Q=w.dep,A=[w.des,Q,""][g?parseInt(g):0],O=E[i].time_offset,J=(new Date).getTime()+1e3*r+60*O*1e3,T=yield function(e,t,r,i,n,a,u,s,o){return y.apply(this,arguments)}(e,b,t,N,A,r,c,O,J);return!1===T?0:1}return 2}),G.apply(this,arguments)}},3937(e,t,r){r.d(t,{e:()=>o});var i=r(467),n=r(3422),a=r(4778),u=r(2571),s=r(1172);function o(e){return d.apply(this,arguments)}function d(){return(d=(0,i.A)(function*(e){if(!e)return!1;var t=(0,a.F)("register"),r=(0,u.b)("register",[e]),i=yield(0,s.R)("register",t,r);return!1!==i&&(200===i.code&&"register"===i.method&&((0,n.gc)(i.client_id),(0,n.uQ)(i.secret),yield(0,n.ms)(),!0))})).apply(this,arguments)}},4778(e,t,r){r.d(t,{F:()=>n});var i=r(3422);function n(e){if(""===i.ph)return!1;var t=new URL(i.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5314(e,t,r){r.d(t,{$i:()=>g,DF:()=>v,FU:()=>p,Qj:()=>l,XK:()=>h});var i=r(467),n=r(8024),a=r(5579),u=r(9734),s=r(8011),o=r(4293),d=r(6788),c=r(4311);function l(){return f.apply(this,arguments)}function f(){return(f=(0,i.A)(function*(){var e=[],t=(new Date).getTime(),r=yield(0,c.Su)(8);for(var i of r){var n=yield(0,c.Ct)(8,i),a=JSON.parse(n);t-new Date(a.time).getTime()<=12096e5&&e.push(a)}return 0===e.length&&e.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),e})).apply(this,arguments)}function p(){return m.apply(this,arguments)}function m(){return(m=(0,i.A)(function*(){var e=(new Date).getTime(),t=yield(0,c.Su)(8);for(var r of t){var i=yield(0,c.Ct)(8,r),n=JSON.parse(i);e-new Date(n.time).getTime()>12096e5&&(yield(0,c.iQ)(8,r))}})).apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return(y=(0,i.A)(function*(e,t){var r=(0,n.zx)(),i=`${e}_${t}`,a=(new Date).toISOString(),d=yield(0,c.Ct)(8,i);if(d){var l=JSON.parse(d);l.time=a,yield(0,c.mL)(8,i,JSON.stringify(l))}else switch(e){case"route":var f=yield(0,o.a)(r,!0),p=`r_${t}`;if((0,n.mQ)(f,p)){var m={type:"route",time:a,name:f[p].n,id:t};yield(0,c.mL)(8,i,JSON.stringify(m))}break;case"location":var h=yield(0,s.g)(r,1),y=`ml_${t}`;if((0,n.mQ)(h,y)){var v={type:"location",time:a,name:h[y].n,hash:t};yield(0,c.mL)(8,i,JSON.stringify(v))}break;case"bus":var _=yield(0,u.j)(r,!0),g=`c_${t}`;if((0,n.mQ)(_,g)){var S={type:"bus",time:a,name:_[g].CarNum,id:t};yield(0,c.mL)(8,i,JSON.stringify(S))}}})).apply(this,arguments)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,i.A)(function*(e,t){var r=`${e}_${t}`,i=yield(0,c.Ct)(8,r);return!!i&&JSON.parse(i)})).apply(this,arguments)}function g(e){return S.apply(this,arguments)}function S(){return(S=(0,i.A)(function*(e){var t=yield l(),r=yield(0,o.a)(e,!0),i=[],n=0;for(var u of t){var s=u.type,c=new Date(u.time);switch(s){case"route":var f={type:"route"},p=u.name;f.name=p;var m=u.id;f.id=m;var h=r[`r_${m}`].pid;f.pid=h,f.time={absolute:c.getTime(),relative:(0,a.HN)(c)},i.push(f),n+=1;break;case"location":var y={type:"location"},v=u.hash;y.hash=v;var _=u.name;y.name=_,y.time={absolute:c.getTime(),relative:(0,a.HN)(c)},i.push(y),n+=1;break;case"bus":var g={type:"bus"},S=u.id;g.id=S;var b=u.name;g.name=b,g.time={absolute:c.getTime(),relative:(0,a.HN)(c)},i.push(g),n+=1;break;case"empty":var $={type:"empty"},w=u.id;$.id=w;var N=u.name;$.name=N,$.time={absolute:c.getTime(),relative:(0,a.HN)(c)},i.push($),n=1}}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var Q={items:i,itemQuantity:n,dataUpdateTime:(new Date).getTime()};return(0,d.LQ)(e),(0,d.gC)(e),Q})).apply(this,arguments)}},5352(e,t,r){r.d(t,{Qh:()=>u,nL:()=>c,qZ:()=>o,ty:()=>f,vQ:()=>h});var i=r(467),n=r(8024),a=r(4311);function u(e,t,r,i,n,a){return s.apply(this,arguments)}function s(){return(s=(0,i.A)(function*(e,t,r,i,u,s){var o=(0,n.zx)();if(t<0||t>23||r<0||r>59||i<0||i>23||u<0||u>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(i)&&Number.isInteger(u)))return!1;if(s.length>7)return!1;for(var d of s)if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1;var c={name:e,period:{start:{hours:t,minutes:r},end:{hours:i,minutes:u}},days:s,id:o};return yield(0,a.mL)(7,o,JSON.stringify(c)),!0})).apply(this,arguments)}function o(e){return d.apply(this,arguments)}function d(){return(d=(0,i.A)(function*(e){var t=yield(0,a.Ct)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return(l=(0,i.A)(function*(e){(yield o(e.id))&&(yield(0,a.mL)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function f(){return p.apply(this,arguments)}function p(){return(p=(0,i.A)(function*(){var e=[],t=yield(0,a.Su)(7);for(var r of t){var i=yield(0,a.Ct)(7,r);if(i){var n=JSON.parse(i);e.push(n)}}return e.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),e.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),e})).apply(this,arguments)}function m(){return(m=(0,i.A)(function*(){var e=yield f(),t={};for(var r of e)for(var i of r.days){var a=`d_${i}`;(0,n.mQ)(t,a)||(t[a]=[]);var u={start:r.period.start,end:r.period.end};t[a].push(u)}for(var s in t){for(var o=t[s],d=o.length,c=[],l=0;l<d;l++){var p=o[l-1]||o[l],m=o[l];0===c.length?c.push(m):60*m.start.hours+m.start.minutes>=60*p.start.hours+p.start.minutes&&60*m.start.hours+m.start.minutes<=60*p.end.hours+p.end.minutes?(c[c.length-1].end.hours=m.end.hours,c[c.length-1].end.minutes=m.end.minutes):c.push(m)}t[s]=c}return t})).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=(0,i.A)(function*(e){var t=yield function(){return m.apply(this,arguments)}(),r=`d_${e.getDay()}`,i=e.getHours(),a=e.getMinutes();if((0,n.mQ)(t,r)){var u=t[r];for(var s of u)if(60*i+a>=60*s.start.hours+s.start.minutes&&60*i+a<=60*s.end.hours+s.end.minutes)return!0}return!1}),y.apply(this,arguments)}}}]);
//# sourceMappingURL=835b67cf72872784d678.js.map