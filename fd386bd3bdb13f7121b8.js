"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[8052,9933],{77(t,e,r){r.d(e,{D7:()=>I,FX:()=>T,G7:()=>A,M3:()=>m,VJ:()=>P,Zc:()=>D,e3:()=>N,hc:()=>O,mD:()=>M,ms:()=>w,ph:()=>v,se:()=>h,uQ:()=>$});var n=r(8024),i=r(8011),o=r(4293),a=r(424),u=r(6788),s=r(3459),f=r(4311),c=r(3447);function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return d(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function p(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){y(o,n,i,a,u,"next",t)}function u(t){y(o,n,i,a,u,"throw",t)}a(void 0)})}}var v="",m="",h="",_=[],g={},b={};function w(){return S.apply(this,arguments)}function S(){return(S=p(function*(){var t={provider:v,client_id:m,secret:h};yield(0,f.mL)(9,"n_client",JSON.stringify(t))})).apply(this,arguments)}function O(){return""!==m&&""!==h}function I(){return String(v)}function $(t){void 0!==t&&(h=String(t))}function A(t,e,r,n,i,o,a,u,s,f){return x.apply(this,arguments)}function x(){return(x=p(function*(t,e,r,n,i,o,a,u,s,c){var l={schedule_id:t,stop_id:e,location_name:r,route_id:n,route_name:i,direction:o,estimate_time:a,time_formatting_mode:u,time_offset:s,scheduled_time:c},d=`s_${e}`,y=_.length;_.push(l),g[t]=y,b.hasOwnProperty(d)||(b[d]=[]),b[d].push(y),yield(0,f.mL)(10,t,JSON.stringify(l))})).apply(this,arguments)}function P(t){return k.apply(this,arguments)}function k(){return(k=p(function*(t){if(g.hasOwnProperty(t)){var e=g[t],r=`s_${_[e].stop_id}`;_.splice(e,1,null),b[r].splice(b[r].indexOf(e),1),delete g[t],yield(0,f.iQ)(10,t)}})).apply(this,arguments)}function D(t){var e=(new Date).getTime(),r=`s_${t}`;if(b.hasOwnProperty(r)){var n,i=l(b[r]);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=_[o];if(null!==a)if(a.scheduled_time>e)return!0}}catch(t){i.e(t)}finally{i.f()}}return!1}function N(t){return J.apply(this,arguments)}function J(){return(J=p(function*(t){var e,r=yield(0,o.a)(t,!0),n=function(){var t,e=(new Date).getTime(),r=[],n=l(_);try{for(n.s();!(t=n.n()).done;){var i=t.value;null!==i&&i.scheduled_time>e&&r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}(),i=(new Date).getTime(),a=[],s=l(n);try{for(s.s();!(e=s.n()).done;){var f=e.value,c={},d=f.location_name;c.name=d;var y=f.stop_id;c.stop_id=y;var p=f.estimate_time;c.estimate_time=p;var v=f.schedule_id;c.schedule_id=v;var m=f.scheduled_time;c.scheduled_time=m;var h=new Date(m),g=h.getDate(),b=h.getHours(),w=h.getMinutes();c.date=String(g).padStart(2,"0"),c.hours=String(b).padStart(2,"0"),c.minutes=String(w).padStart(2,"0"),c.route={};var S=f.route_name;c.route.name=S;var O=f.route_id;c.route.id=O;var I=f.direction;c.route.direction=I;var $=`r_${f.route_id}`;if(r.hasOwnProperty($)){var A=r[$].pid;c.route.pathAttributeId=A,a.push(c)}}}catch(t){s.e(t)}finally{s.f()}a.sort(function(t,e){return t.scheduled_time-e.scheduled_time});for(var x=[],P=0,k={},D=0,N=a;D<N.length;D++){var J=N[D],T=`g_${J.date}_${J.hours}`;k.hasOwnProperty(T)?J.is_first=!1:(k[T]=!0,J.is_first=!0),x.push(J),P+=1}var M={items:x,itemQuantity:P,dataUpdateTime:Math.max((0,u.Zt)(t),i)};return(0,u.gC)(t),(0,u.LQ)(t),M})).apply(this,arguments)}var T=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function M(t,e,r,n){return L.apply(this,arguments)}function L(){return(L=p(function*(t,e,r,f){if(O()){var l=(0,s.Js)("time_formatting_mode"),d=(0,n.zx)(),y=yield(0,a.T)(d),p=yield(0,i.g)(d,0),v=yield(0,o.a)(d,!0);(0,u.LQ)(d),(0,u.gC)(d);var m=`s_${t}`,h={};if(!y.hasOwnProperty(m))return 0;var _=(h=y[m]).stopLocationId,g=h.goBack,b=`l_${_}`;if(!p.hasOwnProperty(b))return 0;var w=p[b].n,S=`r_${e}`,I={};if(!v.hasOwnProperty(S))return 0;var $=(I=v[S]).n,A=I.dep,x=[I.des,A,""][g?parseInt(g):0],P=T[f].time_offset,k=(new Date).getTime()+1e3*r+60*P*1e3;return!1===(yield(0,c.Z)(t,w,e,$,x,r,l,P,k))?0:1}return 2})).apply(this,arguments)}},2757(t,e,r){r.d(e,{R:()=>S});var n=r(4256),i=r(574),o=r(2945),a=r(5428),u=r(6483),s=r(6802),f=r(7810),c=r(2063),l=r(8011),d=r(4293),y=r(424),p=r(2303),v=r(6788),m=r(3459),h=r(1238);function _(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function g(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return b(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){var r={},n=[];for(var i in t){var o=t[i],a=o.StopID,u=parseInt(o.EstimateTime);u>=0&&e.indexOf(a)>-1&&n.push([a,u])}var s=n.length;n.sort(function(t,e){return t[1]-e[1]});for(var f=1,c=0,l=n;c<l.length;c++){var d=f/s,y=(d-d%.25)/.25;r[`s_${l[c][0]}`]={number:f,text:f.toString(),code:y},f+=1}return r}function S(t,e,r,n){return O.apply(this,arguments)}function O(){var t;return t=function*(t,e,r,_){(0,v.Mf)(_,"getLocation_0",0,!1),(0,v.Mf)(_,"getLocation_1",0,!1),(0,v.Mf)(_,"getRoute_0",0,!1),(0,v.Mf)(_,"getRoute_1",0,!1),(0,v.Mf)(_,"getStop_0",0,!1),(0,v.Mf)(_,"getStop_1",0,!1),(0,v.Mf)(_,"getEstimateTime_0",0,!1),(0,v.Mf)(_,"getEstimateTime_1",0,!1),(0,v.Mf)(_,"getBusEvent_0",0,!1),(0,v.Mf)(_,"getBusEvent_1",0,!1);for(var b=yield(0,c.K)(_),S=yield(0,l.g)(_,1),O=yield(0,d.a)(_,!0),I=yield(0,y.T)(_),$=yield(0,f.J)(_),A=yield(0,s.d)(_),x=yield(0,u.Io)(e,r),P=(0,m.Js)("time_formatting_mode"),k=(0,m.Js)("location_labels"),D=(0,m.Js)("display_user_orientation"),N={},J={},T={},M=(0,h.Y)(),L=S[`ml_${t}`],C=L.n,Q=L.id,j=L.v,E=[],U=[],F=Q.length,Z=0;Z<F;Z++)E=E.concat(L.s[Z]),U=U.concat(L.r[Z]);var B,z=function(t,e){var r,n={},i=g(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;e.indexOf(o.StopID)>-1&&(n[`s_${o.StopID}`]=o)}}catch(t){i.e(t)}finally{i.f()}return n}(b,E),K=(0,p.AS)($,A,O,E),R=[],q=g(j);try{for(q.s();!(B=q.n()).done;){var V,X=B.value,G=0,H=0,Y=g(X);try{for(Y.s();!(V=Y.n()).done;){var W=V.value;G+=W[0],H+=W[1]}}catch(t){Y.e(t)}finally{Y.f()}var tt=(0,a.hF)([G,H]),et=(0,i.DK)(tt);R.push(et)}}catch(t){q.e(t)}finally{q.f()}var rt=[];switch(k){case"address":rt=(0,n._q)(L.a);break;case"letters":rt=(0,o.V)(F);break;case"directions":rt=(0,o.M)(R)}for(var nt=0;nt<F;nt++){var it=`g_${nt}`;N[it]=[],J[it]=0,T[it]={name:rt[nt],properties:[{key:"address",icon:"personal_places",value:(0,n.pD)(L.a[nt])},{key:"exact_position",icon:"location_on",value:`${L.la[nt].toFixed(5)}, ${L.lo[nt].toFixed(5)}`},{key:"cardinal_direction",icon:R[nt].icon,value:`${R[nt].name}${D&&-1!==M.cardinalDirection.id&&M.cardinalDirection.id===R[nt].id?"（目前指向）":""}`}]};for(var ot=L.s[nt],at=ot.length,ut=w(z,ot),st=0;st<at;st++){var ft={},ct=L.s[nt][st],lt=`s_${ct}`,dt={};if(I.hasOwnProperty(lt)){dt=I[lt],ft.stopId=ct;var yt={number:0,text:"--",code:-1};ut.hasOwnProperty(lt)&&(yt=ut[lt]),ft.ranking=yt;var pt=L.r[nt][st],vt=`r_${pt}`,mt={};if(O.hasOwnProperty(vt)){mt=O[vt],ft.route_name=mt.n,ft.route_direction=`往${[mt.des,mt.dep,""][parseInt(dt.goBack)]}`,ft.routeId=pt;var ht={};if(z.hasOwnProperty(lt)){ht=z[lt];var _t=(0,p.$Q)(ht.EstimateTime,P);ft.status=_t;var gt=[];K.hasOwnProperty(lt)&&(gt=K[lt].map(function(t){return(0,p.s$)(t)})),ft.buses=gt;var bt=[];x.hasOwnProperty(lt)&&(bt=x[lt]),ft.busArrivalTimes=bt,N[it].push(ft),J[it]+=1}}}}}for(var wt in N)N[wt].sort(function(t,e){return t.routeId-e.routeId});var St={groupedItems:N,groups:T,groupQuantity:F,itemQuantity:J,LocationName:C,hash:t,dataUpdateTime:(0,v.Zt)(_)};return(0,v.LQ)(_),(0,v.gC)(_),St},O=function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){_(o,n,i,a,u,"next",t)}function u(t){_(o,n,i,a,u,"throw",t)}a(void 0)})},O.apply(this,arguments)}},3937(t,e,r){r(77),r(4778),r(2571)},5314(t,e,r){r.d(e,{DF:()=>m,Qj:()=>d,XK:()=>p});var n=r(8024),i=r(9734),o=r(8011),a=r(4293),u=(r(6788),r(4311));function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return f(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function l(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){c(o,n,i,a,u,"next",t)}function u(t){c(o,n,i,a,u,"throw",t)}a(void 0)})}}function d(){return y.apply(this,arguments)}function y(){return(y=l(function*(){var t,e=[],r=(new Date).getTime(),n=s(yield(0,u.Su)(8));try{for(n.s();!(t=n.n()).done;){var i=t.value,o=yield(0,u.Ct)(8,i),a=JSON.parse(o);r-new Date(a.time).getTime()<=12096e5&&e.push(a)}}catch(t){n.e(t)}finally{n.f()}return 0===e.length&&e.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),e})).apply(this,arguments)}function p(t,e){return v.apply(this,arguments)}function v(){return(v=l(function*(t,e){var r=(0,n.zx)(),s=`${t}_${e}`,f=(new Date).toISOString(),c=yield(0,u.Ct)(8,s);if(c){var l=JSON.parse(c);l.time=f,yield(0,u.mL)(8,s,JSON.stringify(l))}else switch(t){case"route":var d=yield(0,a.a)(r,!0),y=`r_${e}`;if(d.hasOwnProperty(y)){var p={type:"route",time:f,name:d[y].n,id:e};yield(0,u.mL)(8,s,JSON.stringify(p))}break;case"location":var v=yield(0,o.g)(r,1),m=`ml_${e}`;if(v.hasOwnProperty(m)){var h={type:"location",time:f,name:v[m].n,hash:e};yield(0,u.mL)(8,s,JSON.stringify(h))}break;case"bus":var _=yield(0,i.j)(r,!0),g=`c_${e}`;if(_.hasOwnProperty(g)){var b={type:"bus",time:f,name:_[g].CarNum,id:e};yield(0,u.mL)(8,s,JSON.stringify(b))}}})).apply(this,arguments)}function m(t,e){return h.apply(this,arguments)}function h(){return(h=l(function*(t,e){var r=`${t}_${e}`,n=yield(0,u.Ct)(8,r);return!!n&&JSON.parse(n)})).apply(this,arguments)}},5352(t,e,r){r.d(e,{Qh:()=>f,nL:()=>y,qZ:()=>l,ty:()=>v});var n=r(8024),i=r(4311);function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){s=!0,o=t},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){u(o,n,i,a,s,"next",t)}function s(t){u(o,n,i,a,s,"throw",t)}a(void 0)})}}function f(t,e,r,n,i,o){return c.apply(this,arguments)}function c(){return(c=s(function*(t,e,r,a,u,s){var f=(0,n.zx)();if(e<0||e>23||r<0||r>59||a<0||a>23||u<0||u>59)return!1;if(!(Number.isInteger(e)&&Number.isInteger(r)&&Number.isInteger(a)&&Number.isInteger(u)))return!1;if(s.length>7)return!1;var c,l=o(s);try{for(l.s();!(c=l.n()).done;){var d=c.value;if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1}}catch(t){l.e(t)}finally{l.f()}var y={name:t,period:{start:{hours:e,minutes:r},end:{hours:a,minutes:u}},days:s,id:f};return yield(0,i.mL)(7,f,JSON.stringify(y)),!0})).apply(this,arguments)}function l(t){return d.apply(this,arguments)}function d(){return(d=s(function*(t){var e=yield(0,i.Ct)(7,t);if(e)return JSON.parse(e)})).apply(this,arguments)}function y(t){return p.apply(this,arguments)}function p(){return(p=s(function*(t){(yield l(t.id))&&(yield(0,i.mL)(7,t.id,JSON.stringify(t)))})).apply(this,arguments)}function v(){return m.apply(this,arguments)}function m(){return(m=s(function*(){var t,e=[],r=o(yield(0,i.Su)(7));try{for(r.s();!(t=r.n()).done;){var n=t.value,a=yield(0,i.Ct)(7,n);if(a){var u=JSON.parse(a);e.push(u)}}}catch(t){r.e(t)}finally{r.f()}return e.sort(function(t,e){return 60*t.period.end.hours+t.period.end.minutes-(60*e.period.end.hours+e.period.end.minutes)}),e.sort(function(t,e){return 60*t.period.start.hours+t.period.start.minutes-(60*e.period.start.hours+e.period.start.minutes)}),e})).apply(this,arguments)}}}]);
//# sourceMappingURL=fd386bd3bdb13f7121b8.js.map