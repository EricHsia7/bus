"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[18],{3030(e,t,i){i.d(t,{a:()=>pe,b:()=>X,c:()=>ue});var a=i(467),s=i(5767),r=i(9566),n=i(2757),d=i(3422),o=i(5314),l=i(3459),u=i(8179),p=i(7968),c=i(8024),h=i(5579),f=i(4537),v=i(904),g=i(9119),b=i(3041),m=i(752),A=i(1351),y=(0,u.c)(".dg"),L=(0,u.e)(y,".mg"),C=(0,u.e)(L,".qg"),w=(0,u.e)(C,"span"),k=(0,u.e)(L,".pg"),x=(0,u.e)(y,".ah"),T=(0,u.e)(L,".sg"),_=(0,u.e)(T,".tg"),$=(0,u.e)(L,".wg"),I=(0,u.e)($,".xg"),S=(0,u.e)(L,".yg .zg"),M={},E=!1,N=!1,P=0,D=0,j=0,F={},R=0,q=!1,B=15e3,H=5e3,Q=15e3,z=!0,U=0,W=0,G="",J=!1,K=!1,O=!1,V="";function X(){x.addEventListener("touchstart",function(){P=Math.round(x.scrollLeft/R)},{passive:!0}),x.addEventListener("scroll",function(e){q=!0;var t=e.target.scrollLeft/R;D=t>P?P+1:P-1;var i=t-P,a=Math.abs(i);a>1&&(i>0?(P=Math.floor(t),D=P+1):(P=Math.ceil(t),D=P-1),a=Math.abs(t-P));var s=F[`g_${P}`]||{width:0,offset:0},r=F[`g_${D}`]||{width:0,offset:0},n=s.width+(r.width-s.width)*a,d=-1*(s.offset+(r.offset-s.offset)*a)+.5*R-.5*n;Y(j,d,n-20,t)},{passive:!0}),x.addEventListener("scrollend",function(e){var t=e.target.scrollLeft/R;P=Math.round(t),q=!1},{passive:!0})}function Y(e,t,i,a){x.style.setProperty("--cg",e.toString()),I.style.setProperty("--gg",i.toString()),_.style.setProperty("--hg",`${t.toString()}px`),_.style.setProperty("--jg",a.toString())}function Z(e){var t=e;if(J){var i=t.detail.progress-1;S.style.setProperty("--kg",i.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Z)}function ee(){var e=(0,u.a)();e.classList.add("lh"),e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0");var t=(0,u.a)();t.classList.add("mh");var i=(0,u.a)();i.classList.add("nh");var a=(0,u.a)();a.classList.add("ph"),a.setAttribute("code","-1"),a.setAttribute("displayed","false");var s=(0,u.a)();s.classList.add("qh"),s.setAttribute("code","-1"),s.setAttribute("displayed","true"),i.appendChild(a),i.appendChild(s);var r=(0,u.a)();r.classList.add("_h");var n=(0,u.a)();n.classList.add("ai");var d=(0,u.a)();d.classList.add("bi");var o=(0,u.a)();o.classList.add("ei");var l=(0,u.a)();l.classList.add("tf"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var p=(0,u.a)();p.classList.add("uf"),p.setAttribute("code","0"),p.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(p);var c=(0,u.a)();c.classList.add("di"),c.appendChild((0,f.b)("keyboard_arrow_down")),c.onclick=function(){!function(e){var t=(0,u.e)(e,".fi"),i=e.parentElement,a=(0,u.f)(e,"lh"),s=a.length,r=i.getBoundingClientRect(),n=e.getBoundingClientRect().top-r.top,d="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=d?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--jh",`${n}px`);for(var p=0;p<s;p++){var c=a[p];c.setAttribute("push-direction",l),c.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<s;t++){var i=a[t];i.setAttribute("push-direction","0"),i.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<s;e++){a[e].setAttribute("push-state","2")}},{once:!0})}d?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(e)};var h=(0,u.a)();h.classList.add("ci"),d.appendChild(o),d.appendChild(c),d.appendChild(h),t.appendChild(i),t.appendChild(r),t.appendChild(n),t.appendChild(d);var v=(0,u.a)();v.classList.add("fi"),v.setAttribute("displayed","false");var g=(0,u.a)();g.classList.add("gi");var b=(0,u.a)();b.classList.add("hi"),b.setAttribute("highlighted","true"),b.setAttribute("type","tab"),b.setAttribute("code","0");var m=(0,u.a)();m.classList.add("ki"),m.appendChild((0,f.b)("directions_bus")),b.appendChild(m),b.appendChild(document.createTextNode("公車")),b.onclick=function(){ce(e,0)};var A=(0,u.a)();A.classList.add("hi"),A.setAttribute("highlighted","false"),A.setAttribute("type","tab"),A.setAttribute("code","1");var y=(0,u.a)();y.classList.add("ki"),y.appendChild((0,f.b)("departure_board")),A.appendChild(y),A.appendChild(document.createTextNode("抵達時間")),A.onclick=function(){ce(e,1)};var L=(0,u.a)();L.classList.add("hi"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var C=(0,u.a)();C.classList.add("ki"),C.appendChild((0,f.b)("folder")),L.appendChild(C),L.appendChild(document.createTextNode("儲存"));var w=(0,u.a)();w.classList.add("hi"),w.setAttribute("highlighted","false"),w.setAttribute("type","schedule-notification"),w.setAttribute("enabled","true");var k=(0,u.a)();k.classList.add("ki"),k.appendChild((0,f.b)("notifications")),w.appendChild(k),w.appendChild(document.createTextNode("通知")),g.appendChild(b),g.appendChild(A),g.appendChild(L),g.appendChild(w);var x=(0,u.a)();x.classList.add("li"),x.setAttribute("displayed","true");var T=(0,u.a)();return T.classList.add("mi"),T.setAttribute("displayed","false"),v.appendChild(g),v.appendChild(x),v.appendChild(T),e.appendChild(t),e.appendChild(v),e}function te(){var e=(0,u.a)();e.classList.add("bh");var t=(0,u.a)();t.classList.add("ch");var i=(0,u.a)();i.classList.add("dh"),t.appendChild(i);var a=(0,u.a)();return a.classList.add("kh"),e.appendChild(t),e.appendChild(a),e}function ie(){var e=(0,u.a)();e.classList.add("ug");var t=document.createElement("span");return e.appendChild(t),e}function ae(){var e=(0,u.a)();e.classList.add("fh");var t=(0,u.a)();t.classList.add("gh"),t.appendChild((0,f.a)());var i=(0,u.a)();return i.classList.add("hh"),e.appendChild(t),e.appendChild(i),e}function se(){var e=(0,u.a)();e.classList.add("ni"),e.setAttribute("on-this-route","false");var t=(0,u.a)();t.classList.add("pi");var i=(0,u.a)();i.classList.add("ri"),i.appendChild((0,f.b)("directions_bus"));var a=(0,u.a)();a.classList.add("ti");var s=(0,u.a)();s.classList.add("wi");var r=(0,u.a)();r.classList.add("_i");var n=(0,u.a)();n.classList.add("aj");var d=(0,u.a)();return d.classList.add("bj"),t.appendChild(i),t.appendChild(a),e.appendChild(t),s.appendChild(r),s.appendChild(n),s.appendChild(d),e.appendChild(s),e}function re(){var e=(0,u.a)();e.classList.add("oi");var t=(0,u.a)();t.classList.add("qi");var i=(0,u.a)();i.classList.add("si"),i.appendChild((0,f.b)("calendar_view_day"));var a=(0,u.a)();a.classList.add("ui");var s=(0,u.a)();s.classList.add("vi");var r=(0,u.a)();return r.classList.add("xi"),t.appendChild(i),t.appendChild(a),t.appendChild(s),e.appendChild(t),e.appendChild(r),e}function ne(e,t,i){var a,s;function n(e,a,s){function n(e,i,a){var s=(0,u.e)(e,".mh"),r=(0,u.e)(s,".ei"),n=(0,u.e)(r,".tf"),d=(0,u.e)(r,".uf");if(n.setAttribute("code",i.status.code.toString()),n.innerText=i.status.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,p=o.left,c=o.bottom,h=o.right,f=window.innerWidth,v=window.innerHeight;if(c>0&&l<v&&h>0&&p<f)return d.addEventListener("animationend",function(){d.setAttribute("code",i.status.code.toString()),d.innerText=i.status.text,d.classList.remove("wf"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("wf")}d.setAttribute("code",i.status.code.toString()),d.innerText=i.status.text}function o(e,i,a){var s=(0,u.e)(e,".mh"),r=(0,u.e)(s,".nh"),n=(0,u.e)(r,".ph"),d=(0,u.e)(r,".qh");if(n.setAttribute("code",i.ranking.code.toString()),n.innerText=i.ranking.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,p=o.left,c=o.bottom,h=o.right,f=window.innerWidth,v=window.innerHeight;if(c>0&&l<v&&h>0&&p<f)return d.addEventListener("animationend",function(){d.setAttribute("code",i.ranking.code.toString()),d.innerText=i.ranking.text,d.classList.remove("zh"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("zh")}d.setAttribute("code",i.ranking.code.toString()),d.innerText=i.ranking.text}function l(e,t){var i=(0,u.e)(e,".mh");(0,u.e)(i,"._h").innerText=t.route_direction}function p(e,t){var i=(0,u.e)(e,".mh");(0,u.e)(i,".ai").innerText=t.route_name}function f(e,t){var i=(0,u.e)(e,".fi"),a=(0,u.e)(i,".li"),s=Array.from((0,u.d)(a,".ni")),r=s.length,n=t.buses.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var p=se();o.appendChild(p),s.push(p)}a.append(o)}else if(d>0)for(var h=r-1,f=r-d-1;h>f;h--)s[h].remove(),s.splice(h,1);for(var v=0;v<n;v++){var g=t.buses[v],b=s[v],m=(0,u.e)(b,".pi"),A=(0,u.e)(m,".ti"),y=(0,u.e)(b,".wi"),L=(0,u.e)(y,"._i"),C=(0,u.e)(y,".aj"),w=(0,u.e)(y,".bj");b.setAttribute("on-this-route",(0,c.a)(g.onThisRoute)),A.innerText=g.carNumber,L.innerText=`路線：${g.RouteName}`,C.innerText=`狀態：${g.status.text}`,w.innerText=`類型：${g.type}`}a.setAttribute("empty",(0,c.a)(0===n))}function v(e,t){var i=(0,u.e)(e,".fi"),a=(0,u.e)(i,".mi"),s=Array.from((0,u.d)(a,".oi")),r=s.length,n=t.busArrivalTimes.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var p=re();o.appendChild(p),s.push(p)}a.append(o)}else if(d>0)for(var f=r-1,v=r-d-1;f>v;f--)s[f].remove(),s.splice(f,1);for(var g=0;g<n;g++){var b=t.busArrivalTimes[g],m=s[g],A=(0,u.e)(m,".qi"),y=(0,u.e)(A,".ui"),L=(0,u.e)(A,".vi"),C=(0,u.e)(m,".xi");y.innerText=b.personalSchedule.name,L.innerText=`週${(0,h.g)(b.day).name} ${(0,h.i)(b.personalSchedule.period.start)} - ${(0,h.i)(b.personalSchedule.period.end)}`,C.innerHTML=b.chart}a.setAttribute("empty",(0,c.a)(0===n))}function g(e,t){t&&e.setAttribute("stretched","false")}function A(e,t){e.setAttribute("animation",(0,c.a)(t))}function y(e,t){e.setAttribute("skeleton-screen",(0,c.a)(t))}function L(e,t){var i=(0,u.e)(e,".fi"),a=(0,u.e)(i,".gi"),s=(0,u.e)(a,'.hi[type="save-to-folder"]');s.onclick=function(){(0,b.b)("stop",[t.stopId,t.routeId],s)},(0,r.e)("stop",t.stopId).then(function(e){s.setAttribute("highlighted",(0,c.a)(e))})}function C(e,t){var i=(0,u.e)(e,".fi"),a=(0,u.e)(i,".gi"),s=(0,u.e)(a,'.hi[type="schedule-notification"]');s.onclick=function(){(0,m.b)(s,t.stopId,t.routeId,t.status.time)};var r=(0,d.r)(t.stopId);s.setAttribute("highlighted",(0,c.a)(r))}null==s?(n(e,a,i),o(e,a,i),l(e,a),p(e,a),f(e,a),v(e,a),g(e,t),A(e,i),y(e,t),L(e,a),C(e,a)):(a.status.time!==s.status.time&&(n(e,a,i),C(e,a)),s.ranking.number===a.ranking.number&&s.ranking.code===a.ranking.code||o(e,a,i),s.stopId!==a.stopId&&(l(e,a),p(e,a),L(e,a)),(0,c.b)(s.buses,a.buses)||f(e,a),(0,c.b)(s.busArrivalTimes,a.busArrivalTimes)||v(e,a),i!==E&&A(e,i),t!==N&&(g(e,t),y(e,t)))}function o(e,a,s){function r(e,t){var i=(0,u.e)(e,".gh");(0,f.c)(i,t.icon)}function n(e,t){(0,u.e)(e,".hh").innerHTML=t.value}function d(e,t){e.setAttribute("animation",(0,c.a)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,c.a)(t))}null==s?(r(e,a),n(e,a),d(e,i),o(e,t)):((0,c.b)(s.icon,a.icon)||r(e,a),(0,c.b)(s.value,a.value)||n(e,a),i!==E&&d(e,i),t!==N&&o(e,t))}var l=(0,v.e)("window"),g=l.width,y=l.height,L=e.groupQuantity,I=e.itemQuantity,S=e.groupedItems,D=e.groups;j=L,R=g;for(var B=0,H=0;H<L;H++){var Q=`g_${H}`,z=(0,p.d)(D[Q].name,500,"17px",'"Noto Sans TC", sans-serif')+20;F[Q]={width:z,offset:B},B+=z}if(F[`g_${L}`]={width:0,offset:B},!q){var U=F[`g_${P}`],W=-1*U.offset+.5*R-.5*U.width,G=U.width-20;Y(j,W,G,P)}(null===(a=M)||void 0===a?void 0:a.hash)!==e.hash&&(k.onclick=function(){(0,A.b)(e.hash)}),(null===(s=M)||void 0===s?void 0:s.LocationName)!==e.LocationName&&(w.innerText=e.LocationName),E!==i&&(C.setAttribute("animation",(0,c.a)(i)),T.setAttribute("animation",(0,c.a)(i))),N!==t&&(C.setAttribute("skeleton-screen",(0,c.a)(t)),T.setAttribute("skeleton-screen",(0,c.a)(t)),$.setAttribute("skeleton-screen",(0,c.a)(t)));var J=Array.from((0,u.d)(x,".bh")),K=Array.from((0,u.d)(_,".ug")),O=J.length;if(L!==O){var V=O-L;if(V<0){for(var X=new DocumentFragment,Z=new DocumentFragment,ne=0;ne>V;ne--){var de=te();X.appendChild(de),J.push(de);var oe=ie();Z.appendChild(oe),K.push(oe)}x.append(X),_.append(Z)}else if(V>0)for(var le=O-1,ue=O-V-1;le>ue;le--)J[le].remove(),J.splice(le,1),K[le].remove(),K.splice(le,1)}for(var pe=(0,u.d)(x,".bh"),ce=0;ce<L;ce++){var he=`g_${ce}`,fe=pe[ce],ve=(0,u.e)(fe,".ch"),ge=(0,u.e)(ve,".dh"),be=Array.from((0,u.d)(ge,".fh")),me=be.length,Ae=D[he].properties.length;if(Ae!==me){var ye=me-Ae;if(ye<0){for(var Le=new DocumentFragment,Ce=0;Ce>ye;Ce--){var we=ae();Le.appendChild(we),be.push(we)}ge.append(Le)}else if(ye>0)for(var ke=me-1,xe=me-ye-1;ke>xe;ke--)be[ke].remove(),be.splice(ke,1)}var Te=(0,u.e)(fe,".kh"),_e=Array.from((0,u.d)(Te,".lh")),$e=_e.length;if(I[he]!==$e){var Ie=$e-I[he];if(Ie<0){for(var Se=new DocumentFragment,Me=0;Me>Ie;Me--){var Ee=ee();Se.appendChild(Ee),_e.push(Ee)}Te.append(Se)}else if(Ie>0)for(var Ne=$e-1,Pe=$e-Ie-1;Ne>Pe;Ne--)_e[Ne].remove(),_e.splice(Ne,1)}var De=K[ce];(0,u.e)(De,"span").innerText=D[he].name,De.style.setProperty("--eg",`${F[he].offset}px`),De.style.setProperty("--fg",`${F[he].width}px`),De.style.setProperty("--vg",ce.toString());for(var je=0;je<Ae;je++){var Fe=D[he].properties[je],Re=be[je];if((0,c.e)(M,"groups"))if((0,c.e)(M.groups,he))if(M.groups[he].properties[je])o(Re,Fe,M.groups[he].properties[je]);else o(Re,Fe,null);else o(Re,Fe,null);else o(Re,Fe,null)}for(var qe=0;qe<I[he];qe++){var Be=_e[qe],He=S[he][qe];if((0,c.e)(M,"groupedItems"))if((0,c.e)(M.groupedItems,he))if(M.groupedItems[he][qe])n(Be,He,M.groupedItems[he][qe]);else n(Be,He,null);else n(Be,He,null);else n(Be,He,null)}}_.style.setProperty("--ig",`${B}px`),M=e,E=i,N=t}function de(){return oe.apply(this,arguments)}function oe(){return(oe=(0,a.a)(function*(){var e=(0,l.b)("playing_animation"),t=(0,l.b)("refresh_interval"),i=(0,v.e)("location-bus-arrival-time-chart");z=t.dynamic,B=t.baseInterval,J=!0,G=(0,c.c)(),S.setAttribute("refreshing","true"),S.classList.remove("_g"),document.addEventListener(G,Z);var a=yield(0,n.a)(V,i.width,i.height,G);ne(a,!1,e);var r=0;z&&(r=yield(0,s.c)()),U=(new Date).getTime(),W=z?Math.max(U+H,a.dataUpdateTime+B/r):U+B,Q=Math.max(H,W-U),J=!1,S.setAttribute("refreshing","false"),S.style.setProperty("--lg",`${Q}ms`),S.classList.add("_g")})).apply(this,arguments)}function le(){de().then(function(){K?setTimeout(function(){le()},Math.max(H,W-(new Date).getTime())):O=!1}).catch(function(e){K?((0,g.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){le()},1e4)):O=!1})}function ue(e){(0,v.d)("Location"),(0,o.e)("location",e),V=e,P=0,F={},y.setAttribute("displayed","true"),x.scrollLeft=0,x.focus(),function(e){for(var t=(0,l.b)("playing_animation"),i=(0,v.e)("window"),a=(i.width,i.height),s={g_0:Math.floor(a/50)+5,g_1:Math.floor(a/50)+5},r={},n=0;n<2;n++){var d=`g_${n}`;r[d]=[];for(var o=0;o<s[d];o++)r[d].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}ne({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:s,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,O?de():(O=!0,le())),(0,v.a)()}function pe(){y.setAttribute("displayed","false"),K=!1,(0,v.c)()}function ce(e,t){var i=(0,u.e)(e,".fi"),a=(0,u.e)(i,".gi"),s=(0,u.d)(a,'.hi[highlighted="true"][type="tab"]');for(var r of s)r.setAttribute("highlighted","false");switch((0,u.e)(a,`.hi[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,u.e)(e,".li").setAttribute("displayed","true"),(0,u.e)(e,".mi").setAttribute("displayed","false");break;case 1:(0,u.e)(e,".li").setAttribute("displayed","false"),(0,u.e)(e,".mi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=f35526d3f2f8f2f85e5c.js.map