"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{2937(e,t,a){a.d(t,{a:()=>f});var r=a(3453),n=a(467),i=a(8201),o=a(8671),s=a(2303),u=a(6788);function f(e,t){return p.apply(this,arguments)}function p(){return(p=(0,n.a)(function*(e,t){var a=yield Promise.all([(0,i.a)(t),(0,o.a)(t)]),n=(0,r.a)(a,2),f=n[0],p=n[1],d={repeated:[[],[],[],[],[],[],[]],scheduled:[],timeZoneOffset:-480};for(var l of f)if(!(e.indexOf(l.PathAttributeId)<0)){var c=(0,s.h)(l.StartTime,0),v=(0,s.h)(l.EndTime,0),h=60*c.hours+c.minutes,g=60*v.hours+v.minutes,y=parseInt(l.LongHeadway,10),m=parseInt(l.LowHeadway,10);if("0"===l.DateType){var b=parseInt(l.DateValue,10)-1,_={type:"repeated",time:[h,g],interval:[y,m],count:[Math.ceil((g-h)/m),Math.floor((g-h)/y)],day:b};d.repeated[b].push(_)}else if("1"===l.DateType){var I=l.DateValue,D={type:"scheduled",time:[h,g],interval:[y,m],count:[Math.ceil((g-h)/m),Math.floor((g-h)/y)],date:[parseInt(I.slice(0,-4),10),parseInt(I.slice(-4,-2),10),parseInt(I.slice(-2),10)]};d.scheduled.push(D)}}for(var S of p)if(!(e.indexOf(S.PathAttributeId)<0)){var $=(0,s.h)(S.DepartureTime,0),B=60*$.hours+$.minutes,k=B+30;if("0"===S.DateType){var R=parseInt(S.DateValue,10)-1,L={type:"repeated",time:[B,k],interval:[30,30],count:[1,1],day:R};d.repeated[R].push(L)}else if("1"===S.DateType){var P=S.DateValue,T={type:"scheduled",time:[B,k],interval:[30,30],count:[1,1],date:[parseInt(P.slice(0,-4),10),parseInt(P.slice(-4,-2),10),parseInt(P.slice(-2),10)]};d.scheduled.push(T)}}for(var w=0;w<7;w++)d.repeated[w].sort(function(e,t){return e.time[0]-t.time[0]});return(0,u.b)(t),(0,u.a)(t),d})).apply(this,arguments)}},8621(e,t,a){a.d(t,{a:()=>p});var r=a(467),n=a(4131),i=a(4373),o=a(3041),s=a(8024),u=a(4293),f=a(6788);function p(e,t,a){return d.apply(this,arguments)}function d(){return(d=(0,r.a)(function*(e,t,a){var r=yield(0,u.a)(a,!0);(0,f.a)(a),(0,f.b)(a);var p=`r_${e}`;if(!(0,s.f)(r,p))return{actions:[],actionsQuantity:0,RouteID:e};var d=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,o.c)("route",[e],null)}},{icon:"calendar_today",name:"時刻表",key:"calendar",action:function(){(0,n.c)(t)}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,i.d)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,i.f)(e)}}];return{actions:d,actionsQuantity:d.length,RouteID:e}})).apply(this,arguments)}},7123(e,t,a){a.d(t,{a:()=>_});var r=a(3453),n=a(467),i=a(7183),o=a(8024),s=a(5428),u=a(6483),f=a(6802),p=a(7810),d=a(2063),l=a(8011),c=a(4293),v=a(1932),h=a(424),g=a(2303),y=a(6788),m=a(3459),b=a(1531);function _(e,t,a,r,n){return I.apply(this,arguments)}function I(){return(I=(0,n.a)(function*(e,t,a,n,_){(0,y.f)(_,"getRoute_0",0,!1),(0,y.f)(_,"getRoute_1",0,!1),(0,y.f)(_,"getStop_0",0,!1),(0,y.f)(_,"getStop_1",0,!1),(0,y.f)(_,"getLocation_0",0,!1),(0,y.f)(_,"getLocation_1",0,!1),(0,y.f)(_,"getSegmentBuffers_0",0,!1),(0,y.f)(_,"getSegmentBuffers_1",0,!1),(0,y.f)(_,"getEstimateTime_0",0,!1),(0,y.f)(_,"getEstimateTime_1",0,!1),(0,y.f)(_,"getBusEvent_0",0,!1),(0,y.f)(_,"getBusEvent_1",0,!1),(0,y.f)(_,"getBusData_0",0,!1),(0,y.f)(_,"getBusData_1",0,!1);var I=yield Promise.all([(0,c.a)(_,!0),(0,h.a)(_),(0,v.a)(_),(0,d.a)(_)]),D=(0,r.a)(I,4),S=D[0],$=D[1],B=D[2],k=D[3],R=yield Promise.all([(0,l.a)(_,0),(0,l.a)(_,1),(0,l.a)(_,2),(0,p.a)(_)]),L=(0,r.a)(R,4),P=L[0],T=L[1],w=L[2],E=L[3],C=yield Promise.all([(0,f.a)(_),(0,u.b)(a,n)]),O=(0,r.a)(C,2),x=O[0],M=O[1],q=(0,g.b)(E,x,S,e,t),A=!1,N={};(0,o.f)(B,`r_${e}`)&&(A=!0,N=B[`r_${e}`]);var Q=(0,m.b)("time_formatting_mode"),V=[],H=[];for(var U of k){var Z={},j=U.RouteID;if([e,10*e].includes(j)||t.includes(j)){Z.status=(0,g.g)(null==U?void 0:U.EstimateTime,Q);var z=`s_${U.StopID}`,F={};if(!(0,o.f)($,z))continue;F=$[z],Z.id=U.StopID,Z.sequence=F.seqNo,Z.goBack=F.goBack;var G=`l_${F.stopLocationId}`,J={};if(!(0,o.f)(P,G))continue;J=P[G],Z.name=J.n;var K=J.r.length;Z.overlappingRoutes=[];for(var W=0;W<K;W++){var X=J.r[W];if(X!==e){var Y=`r_${X}`;if((0,o.f)(S,Y)){var ee=S[Y],te={name:ee.n,RouteEndPoints:{RouteDeparture:ee.dep,RouteDestination:ee.des,text:`${ee.dep} ↔ ${ee.des}`,html:`<span>${ee.dep}</span><span>↔</span><span>${ee.des}</span>`},RouteID:ee.id,PathAttributeId:ee.pid};Z.overlappingRoutes.push(te)}}}Z.position={longitude:J.lo,latitude:J.la},H.push({latitude:J.la,longitude:J.lo,id:U.StopID});var ae=J.g,re=[];for(var ne of((0,o.f)(w,ae)&&(re=w[ae]),Z.nearbyLocations=[],re)){var ie=`ml_${ne.hash}`;if((0,o.f)(T,ie)){var oe=T[ie],se={name:oe.n,distance:0|(0,i.c)(oe.la[0],oe.lo[0],J.la,J.lo),hash:oe.hash};Z.nearbyLocations.push(se)}}for(var ue of(Z.nearbyLocations.sort(function(e,t){return e.distance-t.distance}),Z.buses=[],J.s)){var fe=`s_${ue}`;if((0,o.f)(q,fe))for(var pe=q[fe].length-1;pe>=0;pe--)Z.buses.push((0,g.c)(q[fe][pe]))}Z.buses.sort(function(e,t){return e.index-t.index});var de=[];(0,o.f)(M,z)&&(de=M[z]),Z.busArrivalTimes=de;var le=!1,ce=!1,ve=!1,he=!1;if(A){var ge=`g_${Z.goBack}`,ye=[];for(var me of((0,o.f)(N,ge)?ye=N[ge]:"1"===Z.goBack&&(he=!0,ye=N.g_0),ye))me.OriginStopID!==U.StopID&&me.DestinationStopID!==U.StopID||(le=!0),he?(me.OriginStopID===U.StopID&&(ve=!0),me.DestinationStopID===U.StopID&&(ce=!0)):(me.OriginStopID===U.StopID&&(ce=!0),me.DestinationStopID===U.StopID&&(ve=!0))}Z.segmentBuffer={isSegmentBuffer:le,isStartingPoint:ce,isEndingPoint:ve},V.push(Z)}}V.sort(function(e,t){return e.sequence-t.sequence});for(var be=(0,b.b)(H,450),_e=!1,Ie=!1,De={},Se=0,$e={},Be=V.length,ke=0;ke<Be;ke++){var Re=V[ke],Le=V[ke+1]||Re,Pe=0;if(Re.buses.length>0&&Re.buses[0].onThisRoute){var Te=[Re.buses[0].position.longitude,Re.buses[0].position.latitude],we=Te[0],Ee=Te[1],Ce=[Re.position.longitude,Re.position.latitude],Oe=Ce[0],xe=Ce[1],Me=[Le.position.longitude,Le.position.latitude],qe=Me[0],Ae=Me[1];if((we-Oe)*(qe-we)+(Ee-xe)*(Ae-Ee)>=0){var Ne=Math.hypot(we-Oe,Ee-xe),Qe=Math.hypot(we-qe,Ee-Ae);Pe=(0,s.a)(Ne/(Ne+Qe),0,1)}}Re.progress=Pe,Re.segmentBuffer.isStartingPoint&&(_e=!0),Re.segmentBuffer.isEndingPoint&&_e&&(Ie=!0),_e&&!Ie&&(Re.segmentBuffer.isSegmentBuffer=!0),_e&&Ie&&(_e=!1,Ie=!1);var Ve=!1;null!==be&&be.id===Re.id&&(Ve=!0),Re.nearest=Ve;var He=`g_${Re.goBack}`||"g_0";(0,o.f)(De,He)||(De[He]=[],$e[He]=0,Se+=1),De[He].push(Re),$e[He]+=1}var Ue=S[`r_${e}`],Ze=Ue.n,je=Ue.dep,ze=Ue.des,Fe={groupNames:[`往${ze}`,`往${je}`],groupedItems:De,groupQuantity:Se,itemQuantity:$e,RouteName:Ze,RouteEndPoints:[je,ze],dataUpdateTime:(0,y.e)(_),RouteID:e,PathAttributeId:t};return(0,y.a)(_),(0,y.b)(_),Fe})).apply(this,arguments)}},8134(e,t,a){a.d(t,{a:()=>_,b:()=>S,c:()=>d,d:()=>h,e:()=>c});var r=a(467),n=a(2129),i=a(8024),o=a(4781),s=a(9734),u=a(8011),f=a(4293),p=a(6788);function d(e){return l.apply(this,arguments)}function l(){return(l=(0,r.a)(function*(e){var t=(0,i.c)(),a=yield(0,f.a)(t,!0),r=[];for(var n in a){var o=a[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,p.a)(t),(0,p.b)(t),r})).apply(this,arguments)}function c(e){return v.apply(this,arguments)}function v(){return(v=(0,r.a)(function*(e){var t,a=(0,i.c)(),r=yield(0,f.a)(a,!0),n=`r_${e}`;return!!(0,i.f)(r,n)&&(t=r[n],(0,p.a)(a),(0,p.b)(a),t)})).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=(0,r.a)(function*(e){var t=(0,i.c)(),a=yield(0,f.a)(t,!0),r=[];for(var n in a){var o=a[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,p.a)(t),(0,p.b)(t),r})).apply(this,arguments)}var y={},m=[],b=!1;function _(){return I.apply(this,arguments)}function I(){return(I=(0,r.a)(function*(){if(!b){var e=(0,i.c)(),t=yield(0,f.a)(e,!0),a=yield(0,u.a)(e,1),r=yield(0,s.a)(e,!0);(0,p.a)(e),(0,p.b)(e);var n={},d=[],l=0;for(var c in t){var v=t[c],h={id:v.id,pid:v.pid,dep:v.dep,des:v.des,n:v.n,hash:"",lo:"",la:"",r:"",s:"",type:0};d.push(h);var g=(0,o.b)(`${h.n.toLowerCase()}${h.dep.toLowerCase()}${h.des.toLowerCase()}`,!0);for(var _ of g){var I=`u_${_}`;(0,i.f)(n,I)||(n[I]=[]),n[I].push(l)}l+=1}for(var D in a){var S=a[D],$={id:S.id,n:S.n,lo:S.lo,la:S.la,r:S.r,s:S.s,hash:S.hash,dep:"",des:"",pid:[],type:1};d.push($);var B=(0,o.b)($.n.toLowerCase(),!0);for(var k of B){var R=`u_${k}`;(0,i.f)(n,R)||(n[R]=[]),n[R].push(l)}l+=1}for(var L in r){var P=r[L],T={id:P.BusId,pid:[],dep:"",des:"",n:P.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};d.push(T);var w=(0,o.b)(T.n.toLowerCase(),!0);for(var E of w){var C=`u_${E}`;(0,i.f)(n,C)||(n[C]=[]),n[C].push(l)}l+=1}y=n,m=d,b=!0}})).apply(this,arguments)}function D(e,t){var a=0,r=0;for(var n of t){a+=e.indexOf(n,r)-r,r+=1}return e===t&&(a=10*Math.abs(a)),a}function S(e,t,a){if(!b)return[];var r=e.toLowerCase(),s=(0,o.b)(r,!0),u=(0,o.b)(r,!1),f=[];for(var p of s){var d=`u_${p}`;(0,i.f)(y,d)&&f.push(y[d])}f.sort(function(e,t){return e.length-t.length});var l=f.length-1,c=[];if(0===l&&(c=f[0]),l>0)for(var v=0;v<l;v++){var h=f[v],g=f[v+1];c=0===v?(0,n.b)(h,g):(0,n.b)(c,g)}var _=[],I=0,S=new Set;if(-1===t||2===t){var $=m.filter(function(e){return e.n===r&&2===e.type});for(var B of $)if(_.push({item:B,score:1/0}),S.add(B.id),(I+=1)>=a)break}if(I<a)for(var k of c){var R=m[k];if((-1===t||t===R.type)&&!S.has(R.id)){var L=D(u,(0,o.b)(R.n,!1));if(!(I<a))break;_.push({item:R,score:L}),I+=1}}return _.sort(function(e,t){return t.score-e.score}),_}}}]);
//# sourceMappingURL=31728717e393100f04ae.js.map