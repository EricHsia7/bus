{"version":3,"file":"88c711818e4756107db6.js","mappings":"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","sources":["webpack://bus/./src/data/apis/getSemiTimeTable/index.ts","webpack://bus/./src/data/apis/getStop/index.ts","webpack://bus/./src/data/apis/index.ts","webpack://bus/./src/data/apis/loader.ts","webpack://bus/./src/data/bus/index.ts"],"sourcesContent":["import { lfGetItem, lfSetItem } from '../../storage/index';\nimport { getAPIURL } from '../getAPIURL/index';\nimport { fetchData, setDataReceivingProgress, setDataUpdateTime } from '../loader';\n\nlet SemiTimetableAPIVariableCache_available: boolean = false;\nlet SemiTimetableAPIVariableCache_data: object = {};\n\nexport interface SemiTimetableItem {\n  Id: number;\n  PathAttributeId: number;\n  StartTime: string; // hhmm\n  EndTime: string; // hhmm\n  LongHeadway: string; // minutes\n  LowHeadway: string; // minutes\n  DateType: '0' | '1';\n  DateValue: string; // DateType: 0 -> [1: Mon, 2: Tue, 3: Wed, 4: Thu, 5: Fri, 6: Sun, 7: Sat]; DateType: 1 -> yyyymmdd (UTC+8)\n}\n\nexport type SemiTimeTable = Array<SemiTimetableItem>;\n\nexport async function getSemiTimeTable(requestID: string): Promise<SemiTimeTable> {\n  async function getData() {\n    const apis = [\n      [0, 12],\n      [1, 12]\n    ];\n    const result = [];\n    for (const api of apis) {\n      const url = getAPIURL(api[0], api[1]);\n      const data = await fetchData(url, requestID, `getSemiTimeTable_${api[0]}`, 'json');\n      for (let i = 0, l = data.BusInfo.length; i < l; i++) {\n        result.push(data.BusInfo[i]);\n      }\n      setDataUpdateTime(requestID, data.EssentialInfo.UpdateTime, -480); // UTC+8\n    }\n    return result;\n  }\n\n  const cacheTimeToLive = 60 * 60 * 24 * 14 * 1000;\n  const cacheKey = 'bus_semi_timetable_cache';\n  const cacheTimestamp = await lfGetItem(0, `${cacheKey}_timestamp`);\n  if (cacheTimestamp === null) {\n    const result = await getData();\n    await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n    await lfSetItem(0, cacheKey, JSON.stringify(result));\n    if (!SemiTimetableAPIVariableCache_available) {\n      SemiTimetableAPIVariableCache_available = true;\n      SemiTimetableAPIVariableCache_data = result;\n    }\n    return result;\n  } else {\n    if (new Date().getTime() - parseInt(cacheTimestamp) > cacheTimeToLive) {\n      const result = await getData();\n      await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n      await lfSetItem(0, cacheKey, JSON.stringify(result));\n      return result;\n    } else {\n      if (!SemiTimetableAPIVariableCache_available) {\n        const cache = await lfGetItem(0, cacheKey);\n        SemiTimetableAPIVariableCache_available = true;\n        SemiTimetableAPIVariableCache_data = JSON.parse(cache);\n      }\n      setDataReceivingProgress(requestID, 'getSemiTimeTable_0', 0, true);\n      setDataReceivingProgress(requestID, 'getSemiTimeTable_1', 0, true);\n      setDataUpdateTime(requestID, -1);\n      return SemiTimetableAPIVariableCache_data;\n    }\n  }\n}\n","import { lfGetItem, lfSetItem } from '../../storage/index';\nimport { getAPIURL } from '../getAPIURL/index';\nimport { fetchData, setDataReceivingProgress, setDataUpdateTime } from '../loader';\n\nexport interface StopItem {\n  Id: number; // StopID\n  routeId: number; // RouteID\n  nameZh: string; // name in Chinese\n  nameEn: string; // name in English\n  seqNo: number; // sequence on the route\n  pgp: string; // pgp (-1: get off, 0: get on and off, 1: get on)\n  goBack: '0' | '1' | '2'; // GoBack (0: go, 1: back, 2: unknown)\n  longitude: string; // number in string\n  latitude: string; // number in string\n  address: string;\n  stopLocationId: number; // LocationID\n  showLon: string; // number in string\n  showLat: string; // number in string\n  vector: string;\n}\n\nexport type Stop = Array<StopItem>;\n\nexport interface SimplifiedStopItem {\n  seqNo: number;\n  goBack: '0' | '1' | '2'; // GoBack (0: go, 1: back, 2: unknown)\n  stopLocationId: number;\n}\n\nexport type SimplifiedStop = { [key: string]: SimplifiedStopItem };\n\nlet StopAPIVariableCache_available: boolean = false;\nlet StopAPIVariableCache_data: SimplifiedStop = {};\n\nasync function simplifyStop(array: Stop): Promise<SimplifiedStop> {\n  const worker = new Worker(new URL('./simplifyStop-worker.ts', import.meta.url));\n\n  // Wrap worker communication in a promise\n  const result = await new Promise((resolve, reject) => {\n    worker.onmessage = function (e) {\n      resolve(e.data); // Resolve the promise with the worker's result\n      worker.terminate(); // Terminate the worker when done\n    };\n\n    worker.onerror = function (e) {\n      reject(e.message); // Reject the promise on error\n      worker.terminate(); // Terminate the worker if an error occurs\n    };\n\n    worker.postMessage(array); // Send data to the worker\n  });\n\n  return result;\n}\n\nexport async function getStop(requestID: string): Promise<SimplifiedStop> {\n  async function getData() {\n    const apis = [\n      [0, 11],\n      [1, 11]\n    ];\n    const result = [];\n    for (const api of apis) {\n      const url = getAPIURL(api[0], api[1]);\n      const data = await fetchData(url, requestID, `getStop_${api[0]}`, 'json');\n      for (let i = 0, l = data.BusInfo.length; i < l; i += 64) {\n        Array.prototype.push.apply(result, data.BusInfo.slice(i, i + 64));\n      }\n      setDataUpdateTime(requestID, data.EssentialInfo.UpdateTime, -480); // UTC+8\n    }\n    return result;\n  }\n\n  const cacheTimeToLive = 60 * 60 * 24 * 45 * 1000;\n  const cacheKey = 'bus_stop_cache';\n  const cacheTimestamp = await lfGetItem(0, `${cacheKey}_timestamp`);\n  if (cacheTimestamp === null) {\n    const result = await getData();\n    const simplified_result = await simplifyStop(result);\n    await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n    await lfSetItem(0, cacheKey, JSON.stringify(simplified_result));\n    if (!StopAPIVariableCache_available) {\n      StopAPIVariableCache_available = true;\n      StopAPIVariableCache_data = simplified_result;\n    }\n    return simplified_result;\n  } else {\n    if (new Date().getTime() - parseInt(cacheTimestamp) > cacheTimeToLive) {\n      const result = await getData();\n      const simplified_result = await simplifyStop(result);\n      await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n      await lfSetItem(0, cacheKey, JSON.stringify(simplified_result));\n      return simplified_result;\n    } else {\n      if (!StopAPIVariableCache_available) {\n        const cache = await lfGetItem(0, cacheKey);\n        StopAPIVariableCache_available = true;\n        StopAPIVariableCache_data = JSON.parse(cache);\n      }\n      setDataReceivingProgress(requestID, 'getStop_0', 0, true);\n      setDataReceivingProgress(requestID, 'getStop_1', 0, true);\n      setDataUpdateTime(requestID, -1);\n      return StopAPIVariableCache_data;\n    }\n  }\n}\n","import { hasOwnProperty } from '../../tools/index';\nimport { formatTime } from '../../tools/time';\nimport { BusData, BusDataItem } from './getBusData/index';\nimport { BusEvent, BusEventItem } from './getBusEvent/index';\nimport { SimplifiedRoute } from './getRoute/index';\n\nexport interface EstimateTimeStatus {\n  code: 0 | 0.5 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8; // 8: loading\n  text: string;\n  time: number;\n}\n\nexport function parseEstimateTime(EstimateTime: string, mode: number): EstimateTimeStatus {\n  if (typeof EstimateTime === 'string') {\n    const time = parseInt(EstimateTime);\n    if (time === -3) {\n      return { code: 6, text: '末班駛離', time };\n    }\n    if (time === -4) {\n      return { code: 5, text: '今日停駛', time };\n    }\n    if (time === -2) {\n      return { code: 4, text: '交通管制', time };\n    }\n    if (time === -1) {\n      return { code: 3, text: '未發車', time };\n    }\n    if (0 <= time && time <= 10) {\n      return { code: 2, text: '進站中', time };\n    }\n    if (10 < time && time <= 180) {\n      return { code: 1, text: formatTime(time, mode), time };\n    }\n    if (180 < time && time <= 250) {\n      return { code: 0.5, text: formatTime(time, mode), time };\n    }\n    if (250 < time) {\n      return { code: 0, text: formatTime(time, mode), time };\n    }\n  }\n  return { code: 7, text: '發生錯誤', time: -5 };\n}\n\nexport interface TimeMoment {\n  type: 'moment';\n  hours: number;\n  minutes: number;\n}\n\nexport interface TimeRange {\n  type: 'range';\n  min: number;\n  max: number;\n}\n\n/**\n * parseTimeCode\n * @param code 0: hhmm/mm, 1: mmMM/mm\n * @param mode 0: moment, 1: range\n * @returns 0: TimeMoment, 1: TimeRange\n */\n\nexport function parseTimeCode(code: string, mode: 0 | 1): TimeMoment | TimeRange {\n  const codeLength = code.length;\n  if (mode === 0) {\n    let hours = 0;\n    let minutes = 0;\n    if (codeLength === 4) {\n      hours = parseInt(code.substring(0, 2));\n      minutes = parseInt(code.substring(2, 4));\n    }\n    if (codeLength === 2) {\n      minutes = parseInt(code);\n    }\n    return {\n      type: 'moment',\n      hours: hours,\n      minutes: minutes\n    };\n  }\n  if (mode === 1) {\n    let min = 0;\n    let max = 0;\n    if (codeLength === 4) {\n      const number1 = parseInt(code.substring(0, 2));\n      const number2 = parseInt(code.substring(2, 4));\n      min = Math.min(number1, number2);\n      max = Math.max(number1, number2);\n    }\n    if (codeLength === 2) {\n      const number = parseInt(code);\n      min = number;\n      max = number;\n    }\n    return {\n      type: 'range',\n      min: min,\n      max: max\n    };\n  }\n}\n\nexport interface BatchFoundBusPosition {\n  longitude: number;\n  latitude: number;\n}\n\nexport interface BatchFoundBus {\n  CarType: BusEventItem['CarType'];\n  BusStatus: BusEventItem['BusStatus'];\n  BusID: string;\n  CarOnStop: BusEventItem['CarOnStop'];\n  onThisRoute: boolean;\n  position: BatchFoundBusPosition;\n  RouteName: string;\n  RouteID: number;\n  index: number;\n}\n\nexport type BatchFoundBuses = { [key: string]: Array<BatchFoundBus> };\n\nexport function batchFindBusesForRoute(BusEvent: BusEvent, BusData: BusData, Route: SimplifiedRoute, RouteID: number, PathAttributeId: Array<number>): BatchFoundBuses {\n  const result = {} as BatchFoundBuses;\n  const BusDataObj: {\n    [key: string]: BusDataItem;\n  } = {};\n  for (const BusDataItem of BusData) {\n    const thisBusID = BusDataItem.BusID;\n    BusDataObj[thisBusID] = BusDataItem;\n  }\n\n  for (const BusEventItem of BusEvent) {\n    const processedItem = {} as BatchFoundBus;\n\n    // collect data from 'BusEvent'\n    processedItem.CarType = BusEventItem.CarType;\n    processedItem.BusStatus = BusEventItem.BusStatus;\n    processedItem.BusID = BusEventItem.BusID;\n    processedItem.CarOnStop = BusEventItem.CarOnStop;\n\n    // check whether this bus is on the route\n    const thisRouteID = parseInt(BusEventItem.RouteID);\n    const thisBusID = String(BusEventItem.BusID);\n    let isOnThisRoute: boolean = false;\n    let index: number = 0;\n    if (thisRouteID === RouteID || PathAttributeId.indexOf(thisRouteID) > -1 || thisRouteID === RouteID * 10) {\n      isOnThisRoute = true;\n      index = thisBusID.charCodeAt(0) * Math.pow(10, -5);\n    } else {\n      isOnThisRoute = false;\n      index = thisBusID.charCodeAt(0);\n    }\n    processedItem.onThisRoute = isOnThisRoute;\n    processedItem.index = index;\n\n    // collect data from 'BusData'\n    let thisBusData = {} as BusDataItem;\n    if (hasOwnProperty(BusDataObj, thisBusID)) {\n      thisBusData = BusDataObj[thisBusID];\n    } else {\n      continue;\n    }\n    processedItem.position = {\n      latitude: parseFloat(thisBusData.Latitude),\n      longitude: parseFloat(thisBusData.Longitude)\n    };\n\n    // search data from 'Route'\n    let searchedRoute = {};\n    let isRouteSearched = false;\n    for (const key in Route) {\n      const thisRouteItem = Route[key];\n      const pid = thisRouteItem.pid;\n      if (pid.indexOf(thisRouteID) > -1) {\n        searchedRoute = thisRouteItem;\n        isRouteSearched = true;\n        break;\n      }\n    }\n    processedItem.RouteName = isRouteSearched ? searchedRoute.n : '未知路線';\n    processedItem.RouteID = isRouteSearched ? searchedRoute.id : null;\n\n    const StopKey = `s_${BusEventItem.StopID}`;\n    if (!hasOwnProperty(result, StopKey)) {\n      result[StopKey] = [];\n    }\n    result[StopKey].push(processedItem);\n    // Handle multiple buses (of the same route) on a stop\n  }\n  return result;\n}\n\nexport function batchFindBusesForLocation(BusEvent: BusEvent, BusData: BusData, Route: SimplifiedRoute, StopIDList: Array<number>): BatchFoundBuses {\n  const result = {} as BatchFoundBuses;\n  const BusDataObj: {\n    [BusID: string]: BusDataItem;\n  } = {};\n  for (const BusDataItem of BusData) {\n    const thisBusID = BusDataItem.BusID;\n    BusDataObj[thisBusID] = BusDataItem;\n  }\n\n  for (const BusEventItem of BusEvent) {\n    const processedItem = {} as BatchFoundBus;\n\n    const thisStopID = parseInt(BusEventItem.StopID);\n    const thisRouteID = parseInt(BusEventItem.RouteID);\n    const thisBusID = String(BusEventItem.BusID);\n\n    // Check whether this bus is on one of the specified stops\n    if (StopIDList.indexOf(thisStopID) < 0) {\n      continue;\n    }\n\n    processedItem.index = thisBusID.charCodeAt(0);\n    processedItem.onThisRoute = true; // Every entry in Location is stop-route pair\n\n    // Collect data from 'BusEvent'\n    processedItem.CarType = BusEventItem.CarType;\n    processedItem.BusStatus = BusEventItem.BusStatus;\n    processedItem.BusID = BusEventItem.BusID;\n    processedItem.CarOnStop = BusEventItem.CarOnStop;\n\n    // Collect data from 'BusData'\n    let thisBusData = {} as BusDataItem;\n    if (hasOwnProperty(BusDataObj, thisBusID)) {\n      thisBusData = BusDataObj[thisBusID];\n    } else {\n      continue;\n    }\n    processedItem.position = {\n      latitude: parseFloat(thisBusData.Latitude),\n      longitude: parseFloat(thisBusData.Longitude)\n    };\n\n    // Search data from 'Route'\n    let searchedRoute = {};\n    let isRouteSearched = false;\n    for (const key in Route) {\n      const thisRouteItem = Route[key];\n      const pid = thisRouteItem.pid;\n      if (pid.indexOf(thisRouteID) > -1) {\n        searchedRoute = thisRouteItem;\n        isRouteSearched = true;\n        break;\n      }\n    }\n    processedItem.RouteName = isRouteSearched ? searchedRoute.n : '未知路線';\n    processedItem.RouteID = isRouteSearched ? searchedRoute.id : null;\n\n    const StopKey = `s_${thisStopID}`;\n    if (!hasOwnProperty(result, StopKey)) {\n      result[StopKey] = [];\n    }\n    result[StopKey].push(processedItem);\n  }\n  return result;\n}\n\ninterface FormattedBusStatus {\n  onStop: boolean;\n  situation: string;\n  text: string;\n}\n\ninterface FormattedBusPosition {\n  longitude: number;\n  latitude: number;\n}\n\nexport function parseCarType(CarType: '0' | '1' | '2' | '3'): '一般' | '低底盤' | '大復康巴士' | '狗狗友善專車' | '未知類型' {\n  let type = '';\n  switch (CarType) {\n    case '0':\n      type = '一般';\n      break;\n    case '1':\n      type = '低底盤';\n      break;\n    case '2':\n      type = '大復康巴士';\n      break;\n    case '3':\n      type = '狗狗友善專車';\n      break;\n    default:\n      type = '未知類型';\n  }\n  return type;\n}\n\nexport function parseCarOnStop(CarOnStop: '0' | '1'): string {\n  let onStop = '';\n  switch (CarOnStop) {\n    case '0':\n      onStop = '離站';\n      break;\n    case '1':\n      onStop = '進站';\n      break;\n    default:\n      onStop = '未知狀態'; // Handle unexpected values if necessary\n  }\n  return onStop;\n}\n\nexport function parseBusStatus(BusStatus: '0' | '1' | '2' | '3' | '4' | '5' | '99'): string {\n  let situation = '';\n  switch (BusStatus) {\n    case '0':\n      situation = '正常';\n      break;\n    case '1':\n      situation = '車禍';\n      break;\n    case '2':\n      situation = '故障';\n      break;\n    case '3':\n      situation = '塞車';\n      break;\n    case '4':\n      situation = '緊急求援';\n      break;\n    case '5':\n      situation = '加油';\n      break;\n    case '99':\n      situation = '非營運狀態';\n      break;\n    default:\n      situation = '未知狀態'; // Handle unexpected values if necessary\n  }\n  return situation;\n}\n\nexport interface FormattedBus {\n  type: '一般' | '低底盤' | '大復康巴士' | '狗狗友善專車' | '未知類型';\n  carNumber: string;\n  status: FormattedBusStatus;\n  RouteName: string;\n  onThisRoute: boolean;\n  index: number;\n  position: FormattedBusPosition;\n}\n\nexport function formatBus(batchFoundBus: BatchFoundBus): FormattedBus {\n  const result = {} as FormattedBus;\n\n  const CarType = batchFoundBus.CarType;\n  const type = parseCarType(CarType);\n  result.type = type;\n\n  const CarOnStop = batchFoundBus.CarOnStop;\n  const onStop = parseCarOnStop(CarOnStop);\n\n  const BusStatus = batchFoundBus.BusStatus;\n  const situation = parseBusStatus(BusStatus);\n\n  result.carNumber = batchFoundBus.BusID;\n  result.status = {\n    onStop: onStop,\n    situation: situation,\n    text: `${onStop} | ${situation}`\n  };\n  result.RouteName = batchFoundBus.RouteName;\n  result.onThisRoute = batchFoundBus.onThisRoute;\n  result.index = batchFoundBus.index;\n  result.position = batchFoundBus.position;\n  return result;\n}\n","import { hasOwnProperty } from '../../tools/index';\nimport { pakoInflate } from '../../tools/pako-inflate/index';\nimport { timeStampToNumber } from '../../tools/time';\nimport { recordDataUsage } from '../analytics/data-usage/index';\n\ntype FetchTaskRequest = [resolve: Function, reject: Function, requestID: string, tag: string];\n\ninterface FetchTask {\n  processing: boolean;\n  requests: Array<FetchTaskRequest>;\n  failed: boolean;\n  timestamp: number;\n  result: any;\n}\n\ntype FetchTasks = { [url: string]: FetchTask };\n\nconst tasks: FetchTasks = {};\n\nconst TTL = 30000;\nconst FetchError = new Error('FetchError');\n\nexport async function fetchData(url: string, requestID: string, tag: string, fileType: 'json' | 'xml'): Promise<object> {\n  // Check concurrency\n  if (hasOwnProperty(tasks, url)) {\n    if (tasks[url].processing) {\n      return await new Promise((resolve, reject) => {\n        tasks[url].requests.push([resolve, reject, requestID, tag]);\n      });\n    } else if (tasks[url].result !== null && new Date().getTime() <= tasks[url].timestamp) {\n      setDataReceivingProgress(requestID, tag, 0, true);\n      return tasks[url].result;\n    }\n  } else {\n    tasks[url] = {\n      processing: true,\n      requests: [],\n      failed: false,\n      timestamp: -1,\n      result: null\n    };\n  }\n\n  // Fetch data\n  const response = await fetch(url);\n  if (!response.ok) {\n    setDataReceivingProgress(requestID, tag, 0, true);\n    throw new Error(`HTTP error! status: ${response.status}`);\n  }\n\n  // Read chunks\n  const contentLength = parseInt(String(response.headers.get('content-length')));\n  const reader = response.body.getReader();\n  const chunks = [];\n  let receivedLength = 0;\n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) {\n      break;\n    }\n    chunks.push(value);\n    receivedLength += value.length;\n    const progress = receivedLength / contentLength;\n    setDataReceivingProgress(requestID, tag, progress, false);\n    if (hasOwnProperty(tasks, url)) {\n      for (const request of tasks[url].requests) {\n        setDataReceivingProgress(request[2], request[3], progress, false);\n      }\n    }\n  }\n\n  // Concatenate all the chunks into a single Uint8Array\n  const uint8Array = new Uint8Array(receivedLength);\n  let position = 0;\n  for (const chunk of chunks) {\n    uint8Array.set(chunk, position);\n    position += chunk.length;\n  }\n\n  // Create a blob from the concatenated Uint8Array\n  const blob = new Blob([uint8Array], { type: 'application/gzip' });\n  const arrayBuffer = await blob.arrayBuffer();\n  const inflatedData = await pakoInflate(arrayBuffer);\n\n  let result;\n  switch (fileType) {\n    case 'json':\n      if (/^<!doctype html>/.test(inflatedData)) {\n        result = await fetchData(url.replace('https://tcgbusfs.blob.core.windows.net/', 'https://erichsia7.github.io/bus-alternative-static-apis/'), requestID, tag, fileType);\n      } else {\n        result = JSON.parse(inflatedData);\n      }\n      break;\n    case 'xml':\n      result = inflatedData;\n      break;\n    default:\n      break;\n  }\n\n  // Record data usage\n  const now = new Date();\n  await recordDataUsage(contentLength, now);\n\n  if (result) {\n    // Resolve promises\n    if (hasOwnProperty(tasks, url)) {\n      const progress = receivedLength / contentLength;\n      let request = tasks[url].requests.shift();\n      while (request) {\n        request[0](result);\n        setDataReceivingProgress(request[2], request[3], progress, false);\n        request = tasks[url].requests.shift();\n      }\n      tasks[url].result = result;\n      tasks[url].timestamp = now.getTime() + TTL;\n      tasks[url].processing = false;\n    }\n    discardExpiredFetchTasks();\n    return result;\n  } else {\n    // Reject promises\n    if (hasOwnProperty(tasks, url)) {\n      let request = tasks[url].requests.shift();\n      while (request) {\n        request[1](FetchError);\n        setDataReceivingProgress(request[2], request[3], 0, true);\n        request = tasks[url].requests.shift();\n      }\n      tasks[url].failed = true;\n    }\n    discardExpiredFetchTasks();\n    throw FetchError;\n  }\n}\n\nfunction discardExpiredFetchTasks(): void {\n  const now = new Date().getTime();\n  for (const url in tasks) {\n    if (hasOwnProperty(tasks, url)) {\n      if (!tasks[url].processing) {\n        if (now > tasks[url].timestamp) {\n          delete tasks[url];\n          continue;\n        }\n      }\n      if (tasks[url].failed) {\n        delete tasks[url];\n        continue;\n      }\n    }\n  }\n}\n\nexport type DataReceivingProgress = {\n  [requestID: string]: {\n    [tag: string]: {\n      expel: boolean;\n      progress: number;\n      total: number;\n    };\n  };\n};\n\nconst dataReceivingProgress: DataReceivingProgress = {};\n\nexport function setDataReceivingProgress(requestID: string, tag: string, progress: number, expel: boolean): void {\n  if (!hasOwnProperty(dataReceivingProgress, requestID)) {\n    dataReceivingProgress[requestID] = {};\n  }\n  if (hasOwnProperty(dataReceivingProgress[requestID], tag)) {\n    if (expel) {\n      dataReceivingProgress[requestID][tag].expel = true;\n    } else {\n      dataReceivingProgress[requestID][tag].expel = false;\n      dataReceivingProgress[requestID][tag].progress = progress;\n    }\n    broadcastDataReceivingProgress(requestID, 'run');\n  } else {\n    dataReceivingProgress[requestID][tag] = { expel: false, progress: progress, total: 1 };\n    broadcastDataReceivingProgress(requestID, 'start');\n  }\n}\n\nexport function getDataReceivingProgress(requestID: string): number {\n  if (hasOwnProperty(dataReceivingProgress, requestID)) {\n    if (typeof dataReceivingProgress[requestID] === 'object') {\n      let total: number = 0;\n      let received: number = 0;\n      for (const key in dataReceivingProgress[requestID]) {\n        if (!dataReceivingProgress[requestID][key].expel) {\n          total += dataReceivingProgress[requestID][key].total;\n          received += dataReceivingProgress[requestID][key].progress;\n        }\n      }\n      const progress = Math.min(Math.max(received / total, 0), 1);\n      return progress === Infinity || isNaN(progress) ? 1 : progress;\n    }\n  }\n  return 1;\n}\n\nexport function deleteDataReceivingProgress(requestID: string): void {\n  if (hasOwnProperty(dataReceivingProgress, requestID)) {\n    delete dataReceivingProgress[requestID];\n    broadcastDataReceivingProgress(requestID, 'end');\n  }\n}\n\nexport interface DataReceivingProgressEventDict {\n  target: string;\n  stage: 'start' | 'run' | 'end';\n  progress: number;\n}\n\nexport type DataReceivingProgressEvent = CustomEvent<DataReceivingProgressEventDict>;\n\nexport function broadcastDataReceivingProgress(requestID: string, stage: DataReceivingProgressEventDict['stage']): void {\n  const eventDict: DataReceivingProgressEventDict = {\n    target: requestID,\n    stage: stage,\n    progress: getDataReceivingProgress(requestID)\n  };\n  const event = new CustomEvent(requestID, { detail: eventDict });\n  document.dispatchEvent(event);\n}\n\nexport type DataUpdateTime = { [key: string]: number };\n\nexport const dataUpdateTime: DataUpdateTime = {};\n\nexport function setDataUpdateTime(requestID: string, timestamp: string | number, timeZoneOffset: number): void {\n  if (!hasOwnProperty(dataUpdateTime, requestID)) {\n    dataUpdateTime[requestID] = 0;\n  }\n  let timeNumber = 0;\n  if (typeof timestamp === 'string') {\n    timeNumber = timeStampToNumber(timestamp, timeZoneOffset);\n  }\n  if (timeNumber > dataUpdateTime[requestID]) {\n    dataUpdateTime[requestID] = timeNumber;\n  }\n}\n\nexport function getDataUpdateTime(requestID: string): number {\n  if (hasOwnProperty(dataUpdateTime, requestID)) {\n    return dataUpdateTime[requestID] * 1;\n  } else {\n    return 0;\n  }\n}\n\nexport function deleteDataUpdateTime(requestID: string): void {\n  if (hasOwnProperty(dataUpdateTime, requestID)) {\n    delete dataUpdateTime[requestID];\n  }\n}\n","import { MaterialSymbols } from '../../interface/icons/material-symbols-type';\nimport { hasOwnProperty } from '../../tools/index';\nimport { getBusData } from '../apis/getBusData/index';\nimport { getBusEvent } from '../apis/getBusEvent/index';\nimport { CarInfoItem, getCarInfo } from '../apis/getCarInfo/index';\nimport { getLocation, SimplifiedLocation } from '../apis/getLocation/index';\nimport { getStop } from '../apis/getStop/index';\nimport { parseBusStatus, parseCarOnStop, parseCarType } from '../apis/index';\nimport { deleteDataReceivingProgress, deleteDataUpdateTime } from '../apis/loader';\nimport { searchRouteByPathAttributeId } from '../search/index';\n\nexport interface integratedBus {\n  properties: Array<{\n    key: string;\n    icon: MaterialSymbols;\n    value: string;\n  }>;\n  RouteID: number;\n  FullPathAttributeId: Array<number>;\n}\n\nexport async function integrateBus(id: CarInfoItem['BusId'], requestID: string): Promise<integratedBus> {\n  const carKey = `c_${id}`;\n  const CarInfo = await getCarInfo(requestID, true);\n  const BusData = await getBusData(requestID);\n  const BusEvent = await getBusEvent(requestID);\n  const Stop = await getStop(requestID);\n  const Location = (await getLocation(requestID, 0)) as SimplifiedLocation;\n\n  let result: integratedBus = {\n    properties: [],\n    LocationName: ''\n  };\n\n  // Collect data from CarInfo\n  let thisCar = {};\n  if (hasOwnProperty(CarInfo, carKey)) {\n    thisCar = CarInfo[carKey];\n  } else {\n    return result;\n  }\n\n  const thisCarNumber = thisCar.CarNum;\n  result.properties.push({\n    key: 'car_number',\n    icon: 'tag',\n    value: thisCarNumber\n  });\n\n  const thisCarType = thisCar.CarType;\n  const type = parseCarType(thisCarType);\n  result.properties.push({\n    key: 'car_type',\n    icon: 'directions_bus',\n    value: type\n  });\n\n  // Collect data from BusData\n  let thisBusDataItem = {};\n  for (const BusDataItem of BusData) {\n    const thisBusDataItemBusID = BusDataItem.BusID;\n    if (thisBusDataItemBusID === thisCarNumber) {\n      thisBusDataItem = BusDataItem;\n      break;\n    }\n  }\n  const thisBusDataItemPathAttributeId = parseInt(thisBusDataItem.RouteID);\n  // result.PathAttributeId = thisBusDataItemPathAttributeId;\n  const thisBusDataItemBusStatus = thisBusDataItem.BusStatus;\n  const situation = parseBusStatus(thisBusDataItemBusStatus);\n  const thisBusDataItemGoBack = parseInt(thisBusDataItem.GoBack);\n\n  // Collect data from BusEvent\n  let thisBusEventItem = {};\n  for (const BusEventItem of BusEvent) {\n    const thisBusEventItemBusID = BusEventItem.BusID;\n    if (thisBusEventItemBusID === thisCarNumber) {\n      thisBusEventItem = BusEventItem;\n      break;\n    }\n  }\n\n  const thisBusEventItemCarOnStop = thisBusEventItem.CarOnStop;\n  const onStop = parseCarOnStop(thisBusEventItemCarOnStop);\n  result.properties.push({\n    key: 'status',\n    icon: 'vital_signs',\n    value: `${onStop} | ${situation}`\n  });\n  const thisBusEventItemStopID = thisBusEventItem.StopID;\n\n  // Search routes\n  const searchedRoutes = await searchRouteByPathAttributeId(thisBusDataItemPathAttributeId);\n  let searchedRoute = {};\n  if (searchedRoutes.length > 0) {\n    searchedRoute = searchedRoutes[0];\n  } else {\n    return result;\n  }\n  const thisRouteID = searchedRoute.id;\n  const thisRouteFullPathAttributeId = searchedRoute.pid;\n  const thisRouteName = searchedRoute.n;\n  const thisRouteDeparture = searchedRoute.dep;\n  const thisRouteDestination = searchedRoute.des;\n  const thisRouteDirection = [thisRouteDestination, thisRouteDeparture, ''][thisBusDataItemGoBack ? thisBusDataItemGoBack : 0];\n  result.properties.push({\n    key: 'route',\n    icon: 'route',\n    value: `${thisRouteName} - 往${thisRouteDirection}`\n  });\n\n  result.RouteID = thisRouteID;\n  result.FullPathAttributeId = thisRouteFullPathAttributeId;\n\n  // Collect data from Stop\n  const StopKey = `s_${thisBusEventItemStopID}`;\n  let thisStopItem = {};\n  if (hasOwnProperty(Stop, StopKey)) {\n    thisStopItem = Stop[StopKey];\n  } else {\n    return result;\n  }\n  const thisStopItemStopLocationId = thisStopItem.stopLocationId;\n\n  // Collect data drom Location\n  const LocationKey = `l_${thisStopItemStopLocationId}`;\n  const thisLocationItem = Location[LocationKey];\n  const thisLocationItemName = thisLocationItem.n;\n  result.properties.push({\n    key: 'location_name',\n    icon: 'location_on',\n    value: thisLocationItemName\n  });\n\n  deleteDataReceivingProgress(requestID);\n  deleteDataUpdateTime(requestID);\n  return result;\n}\n"],"names":["SemiTimetableAPIVariableCache_available","SemiTimetableAPIVariableCache_data","getSemiTimeTable","_x","_getSemiTimeTable","apply","arguments","_asyncToGenerator","requestID","getData","_getData","result","api","url","getAPIURL","data","fetchData","i","l","BusInfo","length","push","setDataUpdateTime","EssentialInfo","UpdateTime","cacheKey","cacheTimestamp","lfGetItem","lfSetItem","Date","getTime","JSON","stringify","parseInt","cache","parse","setDataReceivingProgress","StopAPIVariableCache_available","StopAPIVariableCache_data","simplifyStop","_simplifyStop","array","worker","Worker","URL","Promise","resolve","reject","onmessage","e","terminate","onerror","message","postMessage","getStop","_x2","_getStop","Array","prototype","slice","simplified_result","parseEstimateTime","EstimateTime","mode","time","code","text","formatTime","parseTimeCode","codeLength","hours","minutes","substring","type","min","max","number1","number2","Math","number","batchFindBusesForRoute","BusEvent","BusData","Route","RouteID","PathAttributeId","BusDataObj","BusDataItem","BusID","BusEventItem","processedItem","CarType","BusStatus","CarOnStop","thisRouteID","thisBusID","String","isOnThisRoute","index","indexOf","charCodeAt","pow","onThisRoute","thisBusData","hasOwnProperty","position","latitude","parseFloat","Latitude","longitude","Longitude","searchedRoute","isRouteSearched","key","thisRouteItem","pid","RouteName","n","id","StopKey","StopID","batchFindBusesForLocation","StopIDList","thisStopID","parseCarType","parseCarOnStop","onStop","parseBusStatus","situation","formatBus","batchFoundBus","carNumber","status","tasks","FetchError","Error","_x3","_x4","_fetchData","tag","fileType","processing","requests","timestamp","failed","response","fetch","ok","contentLength","headers","get","reader","body","getReader","chunks","receivedLength","_yield$reader$read","read","done","value","progress","request","uint8Array","Uint8Array","chunk","set","blob","Blob","arrayBuffer","inflatedData","pakoInflate","test","replace","now","recordDataUsage","shift","discardExpiredFetchTasks","dataReceivingProgress","expel","broadcastDataReceivingProgress","total","getDataReceivingProgress","_typeof","received","Infinity","isNaN","deleteDataReceivingProgress","stage","eventDict","target","event","CustomEvent","detail","document","dispatchEvent","dataUpdateTime","timeZoneOffset","timeNumber","timeStampToNumber","getDataUpdateTime","deleteDataUpdateTime","integrateBus","_integrateBus","carKey","CarInfo","getCarInfo","getBusData","getBusEvent","Stop","Location","getLocation","properties","LocationName","thisCar","thisCarNumber","CarNum","icon","thisCarType","thisBusDataItem","thisBusDataItemPathAttributeId","thisBusDataItemBusStatus","thisBusDataItemGoBack","GoBack","thisBusEventItem","thisBusEventItemCarOnStop","thisBusEventItemStopID","searchedRoutes","searchRouteByPathAttributeId","thisRouteFullPathAttributeId","thisRouteName","thisRouteDeparture","dep","thisRouteDirection","des","FullPathAttributeId","thisLocationItemName","stopLocationId"],"sourceRoot":""}