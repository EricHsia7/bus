"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[496],{365(e,t,r){r.d(t,{G:()=>s});var n=r(467),i=r(3422),a=r(4778),u=r(2571),o=r(1172);function s(e){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e){if(""===i.M3||""===i.se||void 0===e)return!1;var t=(0,a.F)("cancel",[e]),r=(0,u.b)("cancel",[e]),n=yield(0,o.R)("cancel",t,r);return!1!==n&&(200===n.code&&"cancel"===n.method&&(yield(0,i.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>i});var n=r(467);function i(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,n.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},i=yield fetch(t,n);if(!i.ok){yield i.text();return!1}try{var a=yield i.text(),u=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return u;default:return!1}}catch(e){throw new Error("E23")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{b:()=>u});var n=r(8024),i=r(3422);function a(e,t,r){var i=(new Date).getTime(),a=(i-i%5e3)/5e3;return(0,n.Zf)((0,n.Zf)(`${e}\n${t}\n${a}\n${(0,n.Zf)(`${e}\n${t}\n${(0,n.Zf)(JSON.stringify(r))}`)}`))}function u(e,t){switch(e){case"cancel":return""!==i.M3&&""!==i.se&&1===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,n.Zf)(`${(0,n.Zf)(t[0])}${r.getTime()}`)};case"schedule":return""!==i.M3&&""!==i.se&&9===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==i.M3&&""!==i.se&&0===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{})};case"reschedule":return""!==i.M3&&""!==i.se&&3===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3422(e,t,r){r.d(t,{M3:()=>S,ph:()=>g,se:()=>b,z9:()=>R,hc:()=>T,D7:()=>k,cS:()=>C,e3:()=>H,Db:()=>Q,VJ:()=>Z,ms:()=>N,G7:()=>I,mD:()=>P,FX:()=>G,gc:()=>M,Je:()=>J,uQ:()=>x,Zc:()=>U});var n=r(467),i=r(8024),a=r(8011),u=r(4293),o=r(424),s=r(6788),c=r(3459),l=r(4311),f=r(2284),d=r(4778),p=r(2571),m=r(1172);function h(){return(h=(0,n.A)(function*(){if(""===S||""===b)return!1;var e=(0,d.F)("rotate"),t=(0,p.b)("rotate",[]),r=yield(0,m.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&(x(r.secret),yield N(),!0))})).apply(this,arguments)}function y(){return y=(0,n.A)(function*(e,t,r,n,i,a,u,o,s){if(""===S||""===b||void 0===e||void 0===t||void 0===r||void 0===n||void 0===i||void 0===a||"number"!=typeof u||void 0===s)return!1;var c=new Date;switch((0,f.A)(s)){case"string":case"number":c=new Date(s);break;default:if(!(s instanceof Date))return!1;c=s}var l=(0,d.F)("schedule"),y=(0,p.b)("schedule",[e,t,r,n,i,a,u,o,c.toISOString()]),v=yield(0,m.R)("schedule",l,y);return!1!==v&&(200===v.code&&"schedule"===v.method&&(Math.random()>.8&&(yield function(){return h.apply(this,arguments)}()),yield I(v.schedule_id,e,t,r,n,i,a,u,o,c.getTime()),v.schedule_id))}),y.apply(this,arguments)}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return _(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("E0")}var a,u=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(o)throw a}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var g="",S="",b="",w=[],A={},$={};function N(){return O.apply(this,arguments)}function O(){return(O=(0,n.A)(function*(){var e={provider:g,client_id:S,secret:b};yield(0,l.mL)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function Q(){return D.apply(this,arguments)}function D(){return(D=(0,n.A)(function*(){var e=yield(0,l.Ct)(9,"n_client");if(e){var t=JSON.parse(e);g=t.provider,S=t.client_id,b=t.secret}})).apply(this,arguments)}function T(){return""!==S&&""!==b}function J(e){if(!(0,i.Gz)(e))throw new Error("E24");var t=new URL(e);g=`${t.protocol}//${t.hostname}`}function k(){return String(g)}function M(e){void 0!==e&&(S=String(e))}function x(e){void 0!==e&&(b=String(e))}function C(){return L.apply(this,arguments)}function L(){return(L=(0,n.A)(function*(){(new Date).getTime();var e,t=0,r=v(yield(0,l.Su)(10));try{for(r.s();!(e=r.n()).done;){var n=e.value,a=yield(0,l.Ct)(10,n),u=JSON.parse(a),o=u.schedule_id,s=`s_${u.stop_id}`;w.push(u),A[o]=t,(0,i.mQ)($,s)||($[s]=[]),$[s].push(t),t+=1}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function I(e,t,r,n,i,a,u,o,s,c){return E.apply(this,arguments)}function E(){return(E=(0,n.A)(function*(e,t,r,n,a,u,o,s,c,f){var d={schedule_id:e,stop_id:t,location_name:r,route_id:n,route_name:a,direction:u,estimate_time:o,time_formatting_mode:s,time_offset:c,scheduled_time:f},p=`s_${t}`,m=w.length;w.push(d),A[e]=m,(0,i.mQ)($,p)||($[p]=[]),$[p].push(m),yield(0,l.mL)(10,e,JSON.stringify(d))})).apply(this,arguments)}function Z(e){return F.apply(this,arguments)}function F(){return(F=(0,n.A)(function*(e){if((0,i.mQ)(A,e)){var t=A[e],r=`s_${w[t].stop_id}`;w.splice(t,1,null),$[r].splice($[r].indexOf(t),1),delete A[e],yield(0,l.iQ)(10,e)}})).apply(this,arguments)}function U(e){var t=(new Date).getTime(),r=`s_${e}`;if((0,i.mQ)($,r)){var n,a=v($[r]);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=w[u];if(null!==o)if(o.scheduled_time>t)return!0}}catch(e){a.e(e)}finally{a.f()}}return!1}function R(){return j.apply(this,arguments)}function j(){return(j=(0,n.A)(function*(){var e=(new Date).getTime();for(var t in A){var r=A[t],n=w[r];if(n.scheduled_time<=e){var i=`s_${n.stop_id}`;w.splice(r,1,null),$[i].splice($[i].indexOf(r),1),delete A[t],yield(0,l.iQ)(10,t)}}})).apply(this,arguments)}function H(e){return z.apply(this,arguments)}function z(){return(z=(0,n.A)(function*(e){var t,r=yield(0,u.a)(e,!0),n=function(){var e,t=(new Date).getTime(),r=[],n=v(w);try{for(n.s();!(e=n.n()).done;){var i=e.value;null!==i&&i.scheduled_time>t&&r.push(i)}}catch(e){n.e(e)}finally{n.f()}return r}(),a=(new Date).getTime(),o=[],c=v(n);try{for(c.s();!(t=c.n()).done;){var l=t.value,f={},d=l.location_name;f.name=d;var p=l.stop_id;f.stop_id=p;var m=l.estimate_time;f.estimate_time=m;var h=l.schedule_id;f.schedule_id=h;var y=l.scheduled_time;f.scheduled_time=y;var _=new Date(y),g=_.getDate(),S=_.getHours(),b=_.getMinutes();f.date=String(g).padStart(2,"0"),f.hours=String(S).padStart(2,"0"),f.minutes=String(b).padStart(2,"0"),f.route={};var A=l.route_name;f.route.name=A;var $=l.route_id;f.route.id=$;var N=l.direction;f.route.direction=N;var O=`r_${l.route_id}`;if((0,i.mQ)(r,O)){var Q=r[O].pid;f.route.pathAttributeId=Q,o.push(f)}}}catch(e){c.e(e)}finally{c.f()}o.sort(function(e,t){return e.scheduled_time-t.scheduled_time});for(var D=[],T=0,J={},k=0,M=o;k<M.length;k++){var x=M[k],C=`g_${x.date}_${x.hours}`;(0,i.mQ)(J,C)?x.is_first=!1:(J[C]=!0,x.is_first=!0),D.push(x),T+=1}var L={items:D,itemQuantity:T,dataUpdateTime:Math.max((0,s.Zt)(e),a)};return(0,s.gC)(e),(0,s.LQ)(e),L})).apply(this,arguments)}var G=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function P(e,t,r,n){return V.apply(this,arguments)}function V(){return V=(0,n.A)(function*(e,t,r,n){if(T()){var l=(0,c.Js)("time_formatting_mode"),f=(0,i.zx)(),d=yield(0,o.T)(f),p=yield(0,a.g)(f,0),m=yield(0,u.a)(f,!0);(0,s.LQ)(f),(0,s.gC)(f);var h=`s_${e}`,v={};if(!(0,i.mQ)(d,h))return 0;var _=(v=d[h]).stopLocationId,g=v.goBack,S=`l_${_}`;if(!(0,i.mQ)(p,S))return 0;var b=p[S].n,w=`r_${t}`,A={};if(!(0,i.mQ)(m,w))return 0;var $=(A=m[w]).n,N=A.dep,O=[A.des,N,""][g?parseInt(g):0],Q=G[n].time_offset,D=(new Date).getTime()+1e3*r+60*Q*1e3,J=yield function(e,t,r,n,i,a,u,o,s){return y.apply(this,arguments)}(e,b,t,$,O,r,l,Q,D);return!1===J?0:1}return 2}),V.apply(this,arguments)}},3937(e,t,r){r.d(t,{e:()=>s});var n=r(467),i=r(3422),a=r(4778),u=r(2571),o=r(1172);function s(e){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e){if(!e)return!1;var t=(0,a.F)("register"),r=(0,u.b)("register",[e]),n=yield(0,o.R)("register",t,r);return!1!==n&&(200===n.code&&"register"===n.method&&((0,i.gc)(n.client_id),(0,i.uQ)(n.secret),yield(0,i.ms)(),!0))})).apply(this,arguments)}},4778(e,t,r){r.d(t,{F:()=>i});var n=r(3422);function i(e){if(""===n.ph)return!1;var t=new URL(n.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5314(e,t,r){r.d(t,{$i:()=>b,DF:()=>g,FU:()=>h,Qj:()=>p,XK:()=>v});var n=r(467),i=r(8024),a=r(5579),u=r(9734),o=r(8011),s=r(4293),c=r(6788),l=r(4311);function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("E0")}var a,u=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(o)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t=[],r=(new Date).getTime(),n=f(yield(0,l.Su)(8));try{for(n.s();!(e=n.n()).done;){var i=e.value,a=yield(0,l.Ct)(8,i),u=JSON.parse(a);r-new Date(u.time).getTime()<=12096e5&&t.push(u)}}catch(e){n.e(e)}finally{n.f()}return 0===t.length&&t.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),t})).apply(this,arguments)}function h(){return y.apply(this,arguments)}function y(){return(y=(0,n.A)(function*(){var e,t=(new Date).getTime(),r=f(yield(0,l.Su)(8));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,l.Ct)(8,n),a=JSON.parse(i);t-new Date(a.time).getTime()>12096e5&&(yield(0,l.iQ)(8,n))}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,n.A)(function*(e,t){var r=(0,i.zx)(),n=`${e}_${t}`,a=(new Date).toISOString(),c=yield(0,l.Ct)(8,n);if(c){var f=JSON.parse(c);f.time=a,yield(0,l.mL)(8,n,JSON.stringify(f))}else switch(e){case"route":var d=yield(0,s.a)(r,!0),p=`r_${t}`;if((0,i.mQ)(d,p)){var m={type:"route",time:a,name:d[p].n,id:t};yield(0,l.mL)(8,n,JSON.stringify(m))}break;case"location":var h=yield(0,o.g)(r,1),y=`ml_${t}`;if((0,i.mQ)(h,y)){var v={type:"location",time:a,name:h[y].n,hash:t};yield(0,l.mL)(8,n,JSON.stringify(v))}break;case"bus":var _=yield(0,u.j)(r,!0),g=`c_${t}`;if((0,i.mQ)(_,g)){var S={type:"bus",time:a,name:_[g].CarNum,id:t};yield(0,l.mL)(8,n,JSON.stringify(S))}}})).apply(this,arguments)}function g(e,t){return S.apply(this,arguments)}function S(){return(S=(0,n.A)(function*(e,t){var r=`${e}_${t}`,n=yield(0,l.Ct)(8,r);return!!n&&JSON.parse(n)})).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=(0,n.A)(function*(e){var t,r=yield p(),n=yield(0,s.a)(e,!0),i=[],u=0,o=f(r);try{for(o.s();!(t=o.n()).done;){var l=t.value,d=l.type,m=new Date(l.time);switch(d){case"route":var h={type:"route"},y=l.name;h.name=y;var v=l.id;h.id=v;var _=n[`r_${v}`].pid;h.pid=_,h.time={absolute:m.getTime(),relative:(0,a.HN)(m)},i.push(h),u+=1;break;case"location":var g={type:"location"},S=l.hash;g.hash=S;var b=l.name;g.name=b,g.time={absolute:m.getTime(),relative:(0,a.HN)(m)},i.push(g),u+=1;break;case"bus":var w={type:"bus"},A=l.id;w.id=A;var $=l.name;w.name=$,w.time={absolute:m.getTime(),relative:(0,a.HN)(m)},i.push(w),u+=1;break;case"empty":var N={type:"empty"},O=l.id;N.id=O;var Q=l.name;N.name=Q,N.time={absolute:m.getTime(),relative:(0,a.HN)(m)},i.push(N),u=1}}}catch(e){o.e(e)}finally{o.f()}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var D={items:i,itemQuantity:u,dataUpdateTime:(new Date).getTime()};return(0,c.LQ)(e),(0,c.gC)(e),D})).apply(this,arguments)}},5352(e,t,r){r.d(t,{Qh:()=>s,nL:()=>d,qZ:()=>l,ty:()=>m,vQ:()=>v});var n=r(467),i=r(8024),a=r(4311);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("E0")}var a,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,a){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e,t,r,n,o,s){var c=(0,i.zx)();if(t<0||t>23||r<0||r>59||n<0||n>23||o<0||o>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(n)&&Number.isInteger(o)))return!1;if(s.length>7)return!1;var l,f=u(s);try{for(f.s();!(l=f.n()).done;){var d=l.value;if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1}}catch(e){f.e(e)}finally{f.f()}var p={name:e,period:{start:{hours:t,minutes:r},end:{hours:n,minutes:o}},days:s,id:c};return yield(0,a.mL)(7,c,JSON.stringify(p)),!0})).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=(0,n.A)(function*(e){var t=yield(0,a.Ct)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=(0,n.A)(function*(e){(yield l(e.id))&&(yield(0,a.mL)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function m(){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(){var e,t=[],r=u(yield(0,a.Su)(7));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,a.Ct)(7,n);if(i){var o=JSON.parse(i);t.push(o)}}}catch(e){r.e(e)}finally{r.f()}return t.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),t.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),t})).apply(this,arguments)}function y(){return(y=(0,n.A)(function*(){var e,t={},r=u(yield m());try{for(r.s();!(e=r.n()).done;){var n,a=e.value,o=u(a.days);try{for(o.s();!(n=o.n()).done;){var s=`d_${n.value}`;(0,i.mQ)(t,s)||(t[s]=[]);var c={start:a.period.start,end:a.period.end};t[s].push(c)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){r.e(e)}finally{r.f()}for(var l in t){for(var f=t[l],d=f.length,p=[],h=0;h<d;h++){var y=f[h-1]||f[h],v=f[h];0===p.length?p.push(v):60*v.start.hours+v.start.minutes>=60*y.start.hours+y.start.minutes&&60*v.start.hours+v.start.minutes<=60*y.end.hours+y.end.minutes?(p[p.length-1].end.hours=v.end.hours,p[p.length-1].end.minutes=v.end.minutes):p.push(v)}t[l]=p}return t})).apply(this,arguments)}function v(e){return _.apply(this,arguments)}function _(){return _=(0,n.A)(function*(e){var t=yield function(){return y.apply(this,arguments)}(),r=`d_${e.getDay()}`,n=e.getHours(),a=e.getMinutes();if((0,i.mQ)(t,r)){var o,s=u(t[r]);try{for(s.s();!(o=s.n()).done;){var c=o.value;if(60*n+a>=60*c.start.hours+c.start.minutes&&60*n+a<=60*c.end.hours+c.end.minutes)return!0}}catch(e){s.e(e)}finally{s.f()}}return!1}),_.apply(this,arguments)}}}]);
//# sourceMappingURL=47d81005057b0baca63c.js.map