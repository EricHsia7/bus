"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,i)=>{i.d(e,{Ch:()=>ft,S5:()=>et,SR:()=>ct,U7:()=>vt,aU:()=>pt,py:()=>ht});var s=i(5767),n=i(9566),a=i(4636),r=i(5314),o=i(7123),d=i(3459),u=i(7968),l=i(8024),c=i(3648),v=i(5579),f=i(4537),p=i(904),h=i(9119),b=i(3041),m=i(752),g=i(4474);function y(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return A(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?A(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=Array(e);i<e;i++)s[i]=t[i];return s}function I(t,e,i,s,n,a,r){try{var o=t[a](r),d=o.value}catch(t){return void i(t)}o.done?e(d):Promise.resolve(d).then(s,n)}var $=(0,c.bv)(".tk"),w=(0,c.aI)($,".lm"),k=(0,c.aI)(w,".om"),x=(0,c.aI)(w,".nm"),L=(0,c.aI)(w,".vm .wm"),R=(0,c.aI)(w,".pm"),T=(0,c.aI)(R,".qm"),_=(0,c.aI)(w,".tm"),S=(0,c.aI)(_,".um"),E=(0,c.aI)($,".uk"),P={},Z=!0,j=!1,M=0,B=0,C=0,D={},z=0,H=!1,F=1e4,q=15e3,N=5e3,O=15e3,U=!0,Q=0,J=0,W="",G=!1,K=!1,X=!1,V=0,Y=[],tt=20;function et(){E.addEventListener("touchstart",(function(){M=Math.round(E.scrollLeft/z)}),{passive:!0}),E.addEventListener("scroll",(function(t){H=!0;var e=t.target.scrollLeft/z;B=e>M?M+1:M-1;var i=D[`g_${M}`]||{width:0,offset:0},s=D[`g_${B}`]||{width:0,offset:0},n=i.width+(s.width-i.width)*Math.abs(e-M),a=-1*(i.offset+(s.offset-i.offset)*Math.abs(e-M))+.5*z-.5*n;it(C,a,n-tt,e),e===B&&(M=Math.round(E.scrollLeft/z),H=!1)}),{passive:!0})}function it(t,e,i,s){E.style.setProperty("--sk",t.toString()),S.style.setProperty("--hm",i.toString()),T.style.setProperty("--rm",`${e.toFixed(5)}px`),T.style.setProperty("--fm",s.toFixed(5))}function st(t){var e=t;if(G){var i=e.detail.progress-1;L.style.setProperty("--jm",i.toString())}"end"===e.detail.stage&&document.removeEventListener(e.detail.target,st)}function nt(){var t=(0,l.zx)(),e=document.createElement("div");return e.classList.add("bn"),e.id=t,e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0"),e.innerHTML='<div class="fn"><div class="in" displayed="false"></div></div><div class="jn"><div class="ja" code="0" displayed="false"></div><div class="ka" code="0" displayed="true"></div></div>',{element:e,id:t}}function at(t){var e=(0,l.zx)(),i=document.createElement("div");return i.classList.add("mn"),i.id=e,i.setAttribute("stretched","false"),i.setAttribute("stretching","false"),i.setAttribute("push-direction","0"),i.setAttribute("push-state","0"),i.innerHTML=`<div class="nn"><div class="on"></div><div class="pn"><div class="qn"><div class="ja" code="0" displayed="false"></div><div class="ka" code="0" displayed="true"></div></div><div class="rn" onclick="bus.route.stretchRouteItem('${e}', '${t}')">${(0,f.Z)("keyboard_arrow_down")}</div><div class="sn"></div></div></div><div class="tn" displayed="false"><div class="un"><div class="vn" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 0)" code="0"><div class="wn">${(0,f.Z)("directions_bus")}</div>公車</div><div class="vn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 1)" code="1"><div class="wn">${(0,f.Z)("departure_board")}</div>抵達時間</div><div class="vn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 2)" code="2"><div class="wn">${(0,f.Z)("route")}</div>路線</div><div class="vn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 3)" code="3"><div class="wn">${(0,f.Z)("location_on")}</div>地點</div><div class="vn" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-route', ['${e}', null, null])"><div class="wn">${(0,f.Z)("folder")}</div>儲存</div><div class="vn" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-route', ['${e}', null, null, null])" enabled="true"><div class="wn">${(0,f.Z)("notifications")}</div>到站通知</div></div><div class="xn" displayed="true"></div><div class="yn" displayed="false"></div><div class="zn" displayed="false"></div><div class="_n" displayed="false"></div></div>`,{element:i,id:e}}function rt(){var t=document.createElement("div");t.classList.add("vk");var e=document.createElement("div");e.classList.add("wk");var i=document.createElement("div");i.classList.add("xk");var s=document.createElement("div");s.classList.add("an");var n=document.createElement("div");n.classList.add("yk");var a=document.createElement("div");return a.classList.add("ao"),n.appendChild(a),i.appendChild(s),e.appendChild(i),e.appendChild(n),t.appendChild(e),{element:t,id:""}}function ot(t,e,i){function s(e,i,s,r,o,d){function u(t,e,i,s,n){var a=(0,c.aI)(e,".jn"),r=(0,c.aI)(a,".ka"),o=(0,c.aI)(a,".ja"),d=(0,c.aI)(t,".qn"),u=(0,c.aI)(d,".ka"),l=(0,c.aI)(d,".ja");if(o.setAttribute("code",i.status.code.toString()),l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text,!s&&n){var v=t.getBoundingClientRect(),f=v.top,p=v.left,h=v.bottom,b=v.right,m=window.innerWidth,g=window.innerHeight;if(h>0&&f<g&&b>0&&p<m)return r.addEventListener("animationend",(function(){r.setAttribute("code",i.status.code.toString()),r.classList.remove("ab"),o.setAttribute("displayed","false")}),{once:!0}),u.addEventListener("animationend",(function(){u.setAttribute("code",i.status.code.toString()),u.innerText=i.status.text,u.classList.remove("ab"),l.setAttribute("displayed","false")}),{once:!0}),l.setAttribute("displayed","true"),o.setAttribute("displayed","true"),r.classList.add("ab"),void u.classList.add("ab")}r.setAttribute("code",i.status.code.toString()),u.setAttribute("code",i.status.code.toString()),u.innerText=i.status.text}function p(t,e,i){t.setAttribute("segment-buffer",(0,l.xZ)(i.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,l.xZ)(i.segmentBuffer.isSegmentBuffer))}function h(t,e){(0,c.aI)(t,".on").innerText=e.name}function g(t,e){(0,c.aI)(t,".xn").innerHTML=0===e.buses.length?'<div class="bo">目前沒有公車可顯示</div>':e.buses.map((function(t){return`<div class="co" on-this-route="${t.onThisRoute}"><div class="do"><div class="eo">${(0,f.Z)("directions_bus")}</div><div class="fo">${t.carNumber}</div></div><div class="go"><div class="ho">路線：${t.RouteName}</div><div class="io">狀態：${t.status.text}</div><div class="jo">類型：${t.type}</div></div></div>`})).join("")}function y(t,e){(0,c.aI)(t,".yn").innerHTML=0===e.overlappingRoutes.length?'<div class="ko">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return`<div class="lo"><div class="mo"><div class="no">${(0,f.Z)("route")}</div><div class="oo">${t.name}</div></div><div class="po">${t.RouteEndPoints.html}</div><div class="qo"><div class="ro" onclick="bus.route.switchRoute(${t.RouteID}, [${t.PathAttributeId.join(",")}])">查看路線</div><div class="ro" onclick="bus.folder.openSaveToFolder('route-on-route', [${t.RouteID}])">收藏路線</div></div></div>`})).join("")}function A(t,e){(0,c.aI)(t,".zn").innerHTML=0===e.busArrivalTimes.length?'<div class="so">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return`<div class="to"><div class="uo"><div class="vo">${(0,f.Z)("calendar_view_day")}</div><div class="wo">${t.personalSchedule.name}</div><div class="xo">週${(0,v.kd)(t.day).name} ${(0,v.pn)(t.personalSchedule.period.start)} - ${(0,v.pn)(t.personalSchedule.period.end)}</div></div><div class="yo">${t.chart}</div></div>`})).join("")}function I(t,e){(0,c.aI)(t,"._n").innerHTML=0===e.nearbyLocations.length?'<div class="zo">目前沒有地點可顯示</div>':e.nearbyLocations.map((function(t){return`<div class="_o"><div class="ap"><div class="bp">${(0,f.Z)("location_on")}</div><div class="cp">${t.name}</div></div><div class="dp">${t.distance}公尺</div><div class="ep"><div class="fp" onclick="bus.location.openLocation('${t.hash}')">查看地點</div><div class="fp">收藏地點</div></div></div>`})).join("")}function $(t,e,i){t.setAttribute("nearest",(0,l.xZ)(i.nearest)),e.setAttribute("nearest",(0,l.xZ)(i.nearest))}function w(t,e,i,s,n){var a=(null==i?void 0:i.progress)||0,r=(null==e?void 0:e.progress)||0,o=(0,c.aI)(t,".fn .in");if(!s&&n&&0!==a&&0===r&&Math.abs(r-a)>0)return o.style.setProperty("--en","100%"),void o.addEventListener("transitionend",(function(){o.setAttribute("displayed","false"),o.style.setProperty("--en","-100%")}),{once:!0});r>0?(o.setAttribute("displayed","true"),o.style.setProperty("--en",100*(r-1)+"%")):o.setAttribute("displayed","false")}function k(t,e,i){i&&((0,c.aI)(t,".tn").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function x(t,e,i){t.setAttribute("animation",(0,l.xZ)(i)),e.setAttribute("animation",(0,l.xZ)(i))}function L(t,e,i){t.setAttribute("skeleton-screen",(0,l.xZ)(i)),e.setAttribute("skeleton-screen",(0,l.xZ)(i))}function R(e,i){var s=(0,c.aI)(e,'.tn .un .vn[type="save-to-folder"]');s.onclick=function(){(0,b.BI)("stop-on-route",[e.id,i.id,t.RouteID])},(0,n.LH)("stop",i.id).then((function(t){s.setAttribute("highlighted",(0,l.xZ)(t))}))}function T(e,i){var s=(0,c.aI)(e,'.tn .un .vn[type="schedule-notification"]');s.onclick=function(){(0,m.Ho)("stop-on-route",[e.id,i.id,t.RouteID,i.status.time])};var n=(0,a.Zc)(i.id);s.setAttribute("highlighted",(0,l.xZ)(n))}null===r?(u(e,i,s,o,d),h(e,s),g(e,s),y(e,s),A(e,s),I(e,s),p(e,i,s),$(e,i,s),w(i,s,r,o,d),k(e,i,o),x(e,i,d),L(e,i,o),R(e,s),T(e,s)):(s.status.time!==r.status.time&&(u(e,i,s,o,d),T(e,s)),(0,l.hw)(r.buses,s.buses)||g(e,s),(0,l.hw)(r.busArrivalTimes,s.busArrivalTimes)||A(e,s),(0,l.hw)(r.segmentBuffer,s.segmentBuffer)||p(e,i,s),r.nearest!==s.nearest&&$(e,i,s),r.progress!==s.progress&&w(i,s,r,o,d),r.id!==s.id&&(h(e,s),y(e,s),I(e,s),R(e,s),T(e,s)),Z!==d&&x(e,i,d),j!==o&&(k(e,i,o),L(e,i,o)))}var r=(0,p.gO)("window"),o=r.width,d=r.height,h=t.groupQuantity,y=t.itemQuantity,A=t.groupedItems;C=h,z=o;for(var I=0,$=0;$<h;$++){var w=(0,u.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`往${t}`}))[$],500,"17px",'"Noto Sans TC", sans-serif')+tt;D[`g_${$}`]={width:w,offset:I},I+=w}var L=-1*D[`g_${M}`].offset+.5*z-.5*D[`g_${M}`].width;H||it(C,L,D[`g_${M}`].width-tt,M),k.innerHTML=`<span>${t.RouteName}</span>`,k.setAttribute("animation",(0,l.xZ)(i)),k.setAttribute("skeleton-screen",(0,l.xZ)(e)),R.setAttribute("animation",(0,l.xZ)(i)),R.setAttribute("skeleton-screen",(0,l.xZ)(e)),_.setAttribute("animation",(0,l.xZ)(i)),_.setAttribute("skeleton-screen",(0,l.xZ)(e)),x.onclick=function(){(0,g.GS)(t.RouteID,t.PathAttributeId)};var S,B=(0,c.jg)(E,".vk").length;if(h!==B){var F=B-h;if(F<0){for(var q=new DocumentFragment,N=new DocumentFragment,O=0;O<Math.abs(F);O++){var U=rt();q.appendChild(U.element);var Q=(S=void 0,(S=document.createElement("div")).classList.add("sm"),{element:S,id:""});N.appendChild(Q.element)}E.append(q),T.append(N)}else for(var J=(0,c.jg)(E,".vk"),W=(0,c.jg)(T,".sm"),G=0;G<Math.abs(F);G++){var K=B-1-G;J[K].remove(),W[K].remove()}}for(var X=(0,c.jg)(E,".vk"),V=0;V<h;V++){var Y=`g_${V}`,et=X[V],st=(0,c.aI)(et,".yk"),ot=(0,c.aI)(et,".xk"),dt=(0,c.jg)(st,".mn").length;if(y[Y]!==dt){var ut=dt-y[Y];if(ut<0){for(var lt=new DocumentFragment,ct=new DocumentFragment,vt=0;vt<Math.abs(ut);vt++){var ft=nt(),pt=at(ft.id);lt.appendChild(pt.element),ct.appendChild(ft.element)}st.append(lt),ot.append(ct)}else for(var ht=(0,c.jg)(st,".mn"),bt=(0,c.jg)(ot,".bn"),mt=0;mt<Math.abs(ut);mt++){var gt=dt-1-mt;ht[gt].remove(),bt[gt].remove()}}}for(var yt=(0,c.jg)(T,".sm"),At=0;At<h;At++){var It=`g_${At}`,$t=yt[At];$t.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`<span>往${t}</span>`}))[At],$t.style.setProperty("--im",`${D[It].width}px`),$t.style.setProperty("--gm",At.toString());var wt=X[At];e&&(wt.scrollTop=0);for(var kt=(0,c.aI)(wt,".yk"),xt=(0,c.aI)(wt,".xk"),Lt=(0,c.jg)(kt,".mn"),Rt=(0,c.jg)(xt,".bn"),Tt=0;Tt<y[It];Tt++){var _t=Lt[Tt],St=Rt[Tt],Et=A[It][Tt];if(P.hasOwnProperty("groupedItems"))if(P.groupedItems.hasOwnProperty(It))if(P.groupedItems[It][Tt])s(_t,St,Et,P.groupedItems[It][Tt],e,i);else s(_t,St,Et,null,e,i);else s(_t,St,Et,null,e,i);else s(_t,St,Et,null,e,i)}}P=t,Z=i,j=e}function dt(){return ut.apply(this,arguments)}function ut(){var t;return t=function*(){var t=(0,d.Js)("playing_animation"),e=(0,d.Js)("refresh_interval"),i=(0,p.gO)("route-bus-arrival-time-chart");U=e.dynamic,q=e.baseInterval,G=!0,W=(0,l.zx)(),L.setAttribute("refreshing","true"),L.classList.remove("xm"),document.addEventListener(W,st);var n=yield(0,o.R)(V,Y,i.width,i.height,W);ot(n,!1,t);var a=0;U&&(a=yield(0,s.wz)()),Q=(new Date).getTime(),J=U?Math.max(Q+N,n.dataUpdateTime+q/a):Q+q,O=Math.max(N,J-Q),G=!1,L.setAttribute("refreshing","false"),L.style.setProperty("--km",`${O}ms`),L.classList.add("xm")},ut=function(){var e=this,i=arguments;return new Promise((function(s,n){var a=t.apply(e,i);function r(t){I(a,s,n,r,o,"next",t)}function o(t){I(a,s,n,r,o,"throw",t)}r(void 0)}))},ut.apply(this,arguments)}function lt(){dt().then((function(){K?setTimeout((function(){lt()}),Math.max(N,J-(new Date).getTime())):X=!1})).catch((function(t){K?((0,h.a)(`路線網路連線中斷，將在${F/1e3}秒後重試。`,"error"),setTimeout((function(){lt()}),F)):X=!1}))}function ct(t,e){(0,p.WR)("Route"),(0,r.XK)("route",t),V=t,Y=e,M=0,$.setAttribute("displayed","true"),E.scrollLeft=0,function(){for(var t=(0,d.Js)("playing_animation"),e=(0,p.gO)("window"),i=(e.width,e.height),s=Math.floor(i/50)+5,n={},a=0;a<2;a++){var r=`g_${a}`;n[r]=[];for(var o=0;o<s;o++)n[r].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],nearbyLocations:[],sequence:o,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}ot({groupedItems:n,groupQuantity:2,itemQuantity:{g_0:s,g_1:s},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),K||(K=!0,X?dt():(X=!0,lt())),(0,p.Z_)()}function vt(){$.setAttribute("displayed","false"),K=!1,(0,p.l$)()}function ft(t,e){K=!1,ct(t,e)}function pt(t,e){var i=(0,c.aI)(E,`.vk .wk .yk .mn#${t}`),s=(0,c.aI)(i,".tn"),n=(0,c.aI)(E,`.vk .wk .xk .bn#${e}`),a=i.parentElement,r=n.parentElement,o=(0,c.ji)(n,"bn"),d=(0,c.ji)(i,"mn"),u=d.length,l=a.getBoundingClientRect(),v=i.getBoundingClientRect(),f=r.getBoundingClientRect(),p=n.getBoundingClientRect().top-f.top,h=v.top-l.top,b="true"===i.getAttribute("stretched"),m="true"===i.getAttribute("animation");if(m){var g=b?"2":"1";n.setAttribute("stretching","true"),n.style.setProperty("--zm",`${p}px`),i.setAttribute("stretching","true"),i.style.setProperty("--hp",`${h}px`);for(var y=0;y<u;y++){var A=d[y],I=o[y];I.style.setProperty("--_m",(-1*y-1).toString()),I.setAttribute("push-direction",g),I.setAttribute("push-state","1"),A.setAttribute("push-direction",g),A.setAttribute("push-state","1")}i.addEventListener("transitionend",(function(){for(var t=0;t<u;t++){var e=d[t],s=o[t];s.setAttribute("push-direction","0"),s.setAttribute("push-state","0"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0")}n.setAttribute("stretching","false"),i.setAttribute("stretching","false")}),{once:!0}),i.addEventListener("transitionstart",(function(){for(var t=0;t<u;t++){var e=d[t];o[t].setAttribute("push-state","2"),e.setAttribute("push-state","2")}}),{once:!0})}b?(m?s.addEventListener("transitionend",(function(){s.setAttribute("displayed","false")}),{once:!0}):s.setAttribute("displayed","false"),i.setAttribute("stretched","false"),n.setAttribute("stretched","false")):(s.setAttribute("displayed","true"),i.setAttribute("stretched","true"),n.setAttribute("stretched","true"))}function ht(t,e){var i,s=(0,c.aI)(E,`.mn#${t}`),n=(0,c.aI)(s,".un"),a=y((0,c.jg)(n,'.vn[highlighted="true"][type="tab"]'));try{for(a.s();!(i=a.n()).done;){i.value.setAttribute("highlighted","false")}}catch(t){a.e(t)}finally{a.f()}switch((0,c.aI)(n,`.vn[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,c.aI)(s,".xn").setAttribute("displayed","true"),(0,c.aI)(s,".zn").setAttribute("displayed","false"),(0,c.aI)(s,".yn").setAttribute("displayed","false"),(0,c.aI)(s,"._n").setAttribute("displayed","false");break;case 1:(0,c.aI)(s,".xn").setAttribute("displayed","false"),(0,c.aI)(s,".zn").setAttribute("displayed","true"),(0,c.aI)(s,".yn").setAttribute("displayed","false"),(0,c.aI)(s,"._n").setAttribute("displayed","false");break;case 2:(0,c.aI)(s,".xn").setAttribute("displayed","false"),(0,c.aI)(s,".zn").setAttribute("displayed","false"),(0,c.aI)(s,".yn").setAttribute("displayed","true"),(0,c.aI)(s,"._n").setAttribute("displayed","false");break;case 3:(0,c.aI)(s,".xn").setAttribute("displayed","false"),(0,c.aI)(s,".zn").setAttribute("displayed","false"),(0,c.aI)(s,".yn").setAttribute("displayed","false"),(0,c.aI)(s,"._n").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=fa65f974b04f167aab53.js.map