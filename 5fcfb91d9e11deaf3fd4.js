"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,i)=>{i.d(e,{Ch:()=>lt,S5:()=>V,SR:()=>dt,U7:()=>ut,aU:()=>ct,py:()=>vt});var s=i(5767),r=i(9566),n=i(4636),a=i(5314),o=i(7123),d=i(3459),u=i(7968),l=i(8024),c=i(3648),v=i(5579),f=i(4537),p=i(904),h=i(9119);function b(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return m(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,n=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw n}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=Array(e);i<e;i++)s[i]=t[i];return s}function g(t,e,i,s,r,n,a){try{var o=t[n](a),d=o.value}catch(t){return void i(t)}o.done?e(d):Promise.resolve(d).then(s,r)}var y=(0,c.bv)(".mm"),A=(0,c.aI)(y,".dq"),I=(0,c.aI)(A,".gq"),$=(0,c.aI)(A,".fq"),w=(0,c.aI)(A,".nq .oq"),q=(0,c.aI)(A,".hq"),x=(0,c.aI)(q,".iq"),k=(0,c.aI)(A,".lq"),L=(0,c.aI)(k,".mq"),R=(0,c.aI)(y,".nm"),T={},j=!0,P=!1,S=0,E=0,Z=0,_={},M=0,C=!1,D=1e4,B=15e3,z=5e3,H=15e3,F=!0,N=0,O=0,U="",Q=!1,J=!1,W=!1,K=0,X=[],G=20;function V(){R.addEventListener("touchstart",(function(){S=Math.round(R.scrollLeft/M)}),{passive:!0}),R.addEventListener("scroll",(function(t){C=!0;var e=t.target.scrollLeft/M;E=e>S?S+1:S-1;var i=_[`g_${S}`]||{width:0,offset:0},s=_[`g_${E}`]||{width:0,offset:0},r=i.width+(s.width-i.width)*Math.abs(e-S),n=-1*(i.offset+(s.offset-i.offset)*Math.abs(e-S))+.5*M-.5*r;Y(Z,n,r-G,e),e===E&&(S=Math.round(R.scrollLeft/M),C=!1)}),{passive:!0})}function Y(t,e,i,s){R.style.setProperty("--lm",t.toString()),L.style.setProperty("--_p",i.toString()),x.style.setProperty("--jq",`${e.toFixed(5)}px`),x.style.setProperty("--yp",s.toFixed(5))}function tt(t){var e=t;if(Q){var i=e.detail.progress-1;w.style.setProperty("--bq",i.toString())}"end"===e.detail.stage&&document.removeEventListener(e.detail.target,tt)}function et(){var t=(0,l.zx)("i"),e=document.createElement("div");return e.classList.add("uq"),e.id=t,e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0"),e.innerHTML='<div class="xq"></div><div class="yq"><div class="jd" code="0"></div><div class="kd" code="0"></div></div>',{element:e,id:t}}function it(t){var e=(0,l.zx)("i"),i=document.createElement("div");return i.classList.add("zq"),i.id=e,i.setAttribute("stretched","false"),i.setAttribute("stretching","false"),i.setAttribute("push-direction","0"),i.setAttribute("push-state","0"),i.innerHTML=`<div class="_q"><div class="ar"></div><div class="br"><div class="cr"><div class="jd" code="0"></div><div class="kd" code="0"></div></div><div class="dr" onclick="bus.route.stretchRouteItem('${e}', '${t}')">${(0,f.Z)("keyboard_arrow_down")}</div><div class="er"></div></div></div><div class="fr" displayed="false"><div class="gr"><div class="hr" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 0)" code="0"><div class="ir">${(0,f.Z)("directions_bus")}</div>公車</div><div class="hr" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 1)" code="1"><div class="ir">${(0,f.Z)("departure_board")}</div>抵達時間</div><div class="hr" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 2)" code="2"><div class="ir">${(0,f.Z)("route")}</div>路線</div><div class="hr" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 3)" code="3"><div class="ir">${(0,f.Z)("location_on")}</div>地點</div><div class="hr" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-route', ['${e}', null, null])"><div class="ir">${(0,f.Z)("folder")}</div>儲存至資料夾</div><div class="hr" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-route', ['${e}', null, null, null])" enabled="true"><div class="ir">${(0,f.Z)("notifications")}</div>設定到站通知</div></div><div class="jr" displayed="true"></div><div class="kr" displayed="false"></div><div class="lr" displayed="false"></div><div class="mr" displayed="false"></div></div>`,{element:i,id:e}}function st(){var t=document.createElement("div");t.classList.add("om");var e=document.createElement("div");e.classList.add("pm");var i=document.createElement("div");i.classList.add("qm");var s=document.createElement("div");s.classList.add("tq");var r=document.createElement("div");r.classList.add("rm");var n=document.createElement("div");return n.classList.add("nr"),r.appendChild(n),i.appendChild(s),e.appendChild(i),e.appendChild(r),t.appendChild(e),{element:t,id:""}}function rt(t,e,i){function s(e,i,s,a,o,d){function u(t,e,i,s,r){var n=(0,c.aI)(e,".yq"),a=(0,c.aI)(n,".kd"),o=(0,c.aI)(n,".jd"),d=(0,c.aI)(t,".cr"),u=(0,c.aI)(d,".kd"),l=(0,c.aI)(d,".jd");if(o.setAttribute("code",i.status.code.toString()),l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text,!s&&r){var v=t.getBoundingClientRect(),f=v.top,p=v.left,h=v.bottom,b=v.right,m=window.innerWidth,g=window.innerHeight;if(h>0&&f<g&&b>0&&p<m)return a.addEventListener("animationend",(function(){a.setAttribute("code",i.status.code.toString()),a.classList.remove("od")}),{once:!0}),u.addEventListener("animationend",(function(){u.setAttribute("code",i.status.code.toString()),u.innerText=i.status.text,u.classList.remove("od")}),{once:!0}),a.classList.add("od"),void u.classList.add("od")}a.setAttribute("code",i.status.code.toString()),u.setAttribute("code",i.status.code.toString()),u.innerText=i.status.text}function p(t,e,i){t.setAttribute("segment-buffer",(0,l.xZ)(i.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,l.xZ)(i.segmentBuffer.isSegmentBuffer))}function h(t,e){(0,c.aI)(t,".ar").innerText=e.name}function b(t,e){(0,c.aI)(t,".jr").innerHTML=0===e.buses.length?'<div class="or">目前沒有公車可顯示</div>':e.buses.map((function(t){return`<div class="pr" on-this-route="${t.onThisRoute}"><div class="qr"><div class="rr">${(0,f.Z)("directions_bus")}</div><div class="sr">${t.carNumber}</div></div><div class="tr"><div class="ur">路線：${t.RouteName}</div><div class="vr">狀態：${t.status.text}</div><div class="wr">類型：${t.type}</div></div></div>`})).join("")}function m(t,e){(0,c.aI)(t,".kr").innerHTML=0===e.overlappingRoutes.length?'<div class="xr">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return`<div class="yr"><div class="zr"><div class="_r">${(0,f.Z)("route")}</div><div class="as">${t.name}</div></div><div class="bs">${t.RouteEndPoints.html}</div><div class="cs"><div class="ds" onclick="bus.route.switchRoute(${t.RouteID}, [${t.PathAttributeId.join(",")}])">查看路線</div><div class="ds" onclick="bus.folder.openSaveToFolder('route-on-route', [${t.RouteID}])">收藏路線</div></div></div>`})).join("")}function g(t,e){(0,c.aI)(t,".lr").innerHTML=0===e.busArrivalTimes.length?'<div class="es">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return`<div class="fs"><div class="gs"><div class="hs">${(0,f.Z)("calendar_view_day")}</div><div class="is">${t.personalSchedule.name}</div><div class="js">週${(0,v.kd)(t.day).name} ${(0,v.pn)(t.personalSchedule.period.start)} - ${(0,v.pn)(t.personalSchedule.period.end)}</div></div><div class="ks">${t.chart}</div></div>`})).join("")}function y(t,e){(0,c.aI)(t,".mr").innerHTML=0===e.nearbyLocations.length?'<div class="ls">目前沒有地點可顯示</div>':e.nearbyLocations.map((function(t){return`<div class="ms"><div class="ns"><div class="os">${(0,f.Z)("location_on")}</div><div class="ps">${t.name}</div></div><div class="qs">${t.distance}公尺</div><div class="rs"><div class="ss" onclick="bus.location.openLocation('${t.hash}')">查看地點</div><div class="ss">收藏地點</div></div></div>`})).join("")}function A(t,e,i){t.setAttribute("nearest",(0,l.xZ)(i.nearest)),e.setAttribute("nearest",(0,l.xZ)(i.nearest))}function I(t,e,i,s,r){var n=(null==i?void 0:i.progress)||0,a=(null==e?void 0:e.progress)||0,o=(0,c.aI)(t,".xq");if(!s&&r&&0!==n&&0===a&&Math.abs(a-n)>0)return o.style.setProperty("--vq","100%"),o.style.setProperty("--wq","100%"),void o.addEventListener("transitionend",(function(){o.style.setProperty("--vq","0%"),o.style.setProperty("--wq","0%")}),{once:!0});o.style.setProperty("--vq","0%"),o.style.setProperty("--wq",100*a+"%")}function $(t,e,i){i&&((0,c.aI)(t,".fr").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function w(t,e,i){t.setAttribute("animation",(0,l.xZ)(i)),e.setAttribute("animation",(0,l.xZ)(i))}function q(t,e,i){t.setAttribute("skeleton-screen",(0,l.xZ)(i)),e.setAttribute("skeleton-screen",(0,l.xZ)(i))}function x(e,i){var s=(0,c.aI)(e,'.fr .gr .hr[type="save-to-folder"]');s.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}])`),(0,r.LH)("stop",i.id).then((function(t){s.setAttribute("highlighted",(0,l.xZ)(t))}))}function k(e,i){var s=(0,c.aI)(e,'.fr .gr .hr[type="schedule-notification"]');s.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}, ${i.status.time}])`);var r=(0,n.Zc)(i.id);s.setAttribute("highlighted",(0,l.xZ)(r))}null===a?(u(e,i,s,o,d),h(e,s),b(e,s),m(e,s),g(e,s),y(e,s),p(e,i,s),A(e,i,s),I(i,s,a,o,d),$(e,i,o),w(e,i,d),q(e,i,o),x(e,s),k(e,s)):(s.status.time!==a.status.time&&(u(e,i,s,o,d),k(e,s)),(0,l.hw)(a.buses,s.buses)||b(e,s),(0,l.hw)(a.busArrivalTimes,s.busArrivalTimes)||g(e,s),(0,l.hw)(a.segmentBuffer,s.segmentBuffer)||p(e,i,s),a.nearest!==s.nearest&&A(e,i,s),a.progress!==s.progress&&I(i,s,a,o,d),a.id!==s.id&&(h(e,s),m(e,s),y(e,s),x(e,s),k(e,s)),d!==j&&w(e,i,d),o!==P&&($(e,i,o),q(e,i,o)))}var a=(0,p.gO)("window"),o=a.width,d=a.height,h=t.groupQuantity,b=t.itemQuantity,m=t.groupedItems;Z=h,M=o;for(var g=0,y=0;y<h;y++){var A=(0,u.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`往${t}`}))[y],500,"17px",'"Noto Sans TC", sans-serif')+G;_[`g_${y}`]={width:A,offset:g},g+=A}var w=-1*_[`g_${S}`].offset+.5*M-.5*_[`g_${S}`].width;C||Y(Z,w,_[`g_${S}`].width-G,S),I.innerHTML=`<span>${t.RouteName}</span>`,I.setAttribute("animation",(0,l.xZ)(i)),I.setAttribute("skeleton-screen",(0,l.xZ)(e)),q.setAttribute("animation",(0,l.xZ)(i)),q.setAttribute("skeleton-screen",(0,l.xZ)(e)),k.setAttribute("animation",(0,l.xZ)(i)),k.setAttribute("skeleton-screen",(0,l.xZ)(e)),$.setAttribute("onclick",`bus.route.openRouteDetails(${t.RouteID}, [${t.PathAttributeId.join(",")}])`);var L,E=(0,c.jg)(R,".om").length;if(h!==E){var D=E-h;if(D<0){for(var B=new DocumentFragment,z=new DocumentFragment,H=0;H<Math.abs(D);H++){var F=st();B.appendChild(F.element);var N=(L=void 0,(L=document.createElement("div")).classList.add("kq"),{element:L,id:""});z.appendChild(N.element)}R.append(B),x.append(z)}else for(var O=(0,c.jg)(R,".om"),U=(0,c.jg)(x,".kq"),Q=0;Q<Math.abs(D);Q++){var J=E-1-Q;O[J].remove(),U[J].remove()}}for(var W=(0,c.jg)(R,".om"),K=0;K<h;K++){var X=`g_${K}`,V=W[K],tt=(0,c.aI)(V,".rm"),rt=(0,c.aI)(V,".qm"),nt=(0,c.jg)(tt,".zq").length;if(b[X]!==nt){var at=nt-b[X];if(at<0){for(var ot=new DocumentFragment,dt=new DocumentFragment,ut=0;ut<Math.abs(at);ut++){var lt=et(),ct=it(lt.id);ot.appendChild(ct.element),dt.appendChild(lt.element)}tt.append(ot),rt.append(dt)}else for(var vt=(0,c.jg)(tt,".zq"),ft=(0,c.jg)(rt,".uq"),pt=0;pt<Math.abs(at);pt++){var ht=nt-1-pt;vt[ht].remove(),ft[ht].remove()}}}for(var bt=(0,c.jg)(x,".kq"),mt=0;mt<h;mt++){var gt=`g_${mt}`,yt=bt[mt];yt.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`<span>往${t}</span>`}))[mt],yt.style.setProperty("--aq",`${_[gt].width}px`),yt.style.setProperty("--zp",mt.toString());var At=W[mt];e&&(At.scrollTop=0);for(var It=(0,c.aI)(At,".rm"),$t=(0,c.aI)(At,".qm"),wt=(0,c.jg)(It,".zq"),qt=(0,c.jg)($t,".uq"),xt=0;xt<b[gt];xt++){var kt=wt[xt],Lt=qt[xt],Rt=m[gt][xt];if(T.hasOwnProperty("groupedItems"))if(T.groupedItems.hasOwnProperty(gt))if(T.groupedItems[gt][xt])s(kt,Lt,Rt,T.groupedItems[gt][xt],e,i);else s(kt,Lt,Rt,null,e,i);else s(kt,Lt,Rt,null,e,i);else s(kt,Lt,Rt,null,e,i)}}T=t,j=i,P=e}function nt(){return at.apply(this,arguments)}function at(){var t;return t=function*(){var t=(0,d.Js)("playing_animation"),e=(0,d.Js)("refresh_interval"),i=(0,p.gO)("route-bus-arrival-time-chart");F=e.dynamic,B=e.baseInterval,Q=!0,U=(0,l.zx)("r"),w.setAttribute("refreshing","true"),w.classList.remove("pq"),document.addEventListener(U,tt);var r=yield(0,o.R)(K,X,i.width,i.height,U);rt(r,!1,t);var n=0;F&&(n=yield(0,s.wz)()),N=(new Date).getTime(),O=F?Math.max(N+z,r.dataUpdateTime+B/n):N+B,H=Math.max(z,O-N),Q=!1,w.setAttribute("refreshing","false"),w.style.setProperty("--cq",`${H}ms`),w.classList.add("pq")},at=function(){var e=this,i=arguments;return new Promise((function(s,r){var n=t.apply(e,i);function a(t){g(n,s,r,a,o,"next",t)}function o(t){g(n,s,r,a,o,"throw",t)}a(void 0)}))},at.apply(this,arguments)}function ot(){nt().then((function(){J?setTimeout((function(){ot()}),Math.max(z,O-(new Date).getTime())):W=!1})).catch((function(t){console.error(t),J?((0,h.a)(`路線網路連線中斷，將在${D/1e3}秒後重試。`,"error"),setTimeout((function(){ot()}),D)):W=!1}))}function dt(t,e){(0,p.WR)("Route"),(0,a.XK)("route",t),K=t,X=e,S=0,y.setAttribute("displayed","true"),R.scrollLeft=0,function(){for(var t=(0,d.Js)("playing_animation"),e=(0,p.gO)("window"),i=(e.width,e.height),s=Math.floor(i/50)+5,r={},n=0;n<2;n++){var a=`g_${n}`;r[a]=[];for(var o=0;o<s;o++)r[a].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],nearbyLocations:[],sequence:o,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}rt({groupedItems:r,groupQuantity:2,itemQuantity:{g_0:s,g_1:s},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),J||(J=!0,W?nt():(W=!0,ot())),(0,p.Z_)()}function ut(){y.setAttribute("displayed","false"),J=!1,(0,p.l$)()}function lt(t,e){J=!1,dt(t,e)}function ct(t,e){var i=(0,c.aI)(R,`.om .pm .rm .zq#${t}`),s=(0,c.aI)(i,".fr"),r=(0,c.aI)(R,`.om .pm .qm .uq#${e}`),n=i.parentElement,a=r.parentElement,o=(0,c.ji)(r,"uq"),d=(0,c.ji)(i,"zq"),u=d.length,l=n.getBoundingClientRect(),v=i.getBoundingClientRect(),f=a.getBoundingClientRect(),p=r.getBoundingClientRect().top-f.top,h=v.top-l.top,b="true"===i.getAttribute("stretched"),m="true"===i.getAttribute("animation");if(m){var g=b?"2":"1";r.setAttribute("stretching","true"),r.style.setProperty("--rq",`${p}px`),i.setAttribute("stretching","true"),i.style.setProperty("--us",`${h}px`);for(var y=0;y<u;y++){var A=d[y],I=o[y];I.style.setProperty("--sq",(-1*y-1).toString()),I.setAttribute("push-direction",g),I.setAttribute("push-state","1"),A.setAttribute("push-direction",g),A.setAttribute("push-state","1")}i.addEventListener("transitionend",(function(){for(var t=0;t<u;t++){var e=d[t],s=o[t];s.setAttribute("push-direction","0"),s.setAttribute("push-state","0"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0")}r.setAttribute("stretching","false"),i.setAttribute("stretching","false")}),{once:!0}),i.addEventListener("transitionstart",(function(){for(var t=0;t<u;t++){var e=d[t];o[t].setAttribute("push-state","2"),e.setAttribute("push-state","2")}}),{once:!0})}b?(m?s.addEventListener("transitionend",(function(){s.setAttribute("displayed","false")}),{once:!0}):s.setAttribute("displayed","false"),i.setAttribute("stretched","false"),r.setAttribute("stretched","false")):(s.setAttribute("displayed","true"),i.setAttribute("stretched","true"),r.setAttribute("stretched","true"))}function vt(t,e){var i,s=(0,c.aI)(R,`.zq#${t}`),r=(0,c.aI)(s,".gr"),n=b((0,c.jg)(r,'.hr[highlighted="true"][type="tab"]'));try{for(n.s();!(i=n.n()).done;){i.value.setAttribute("highlighted","false")}}catch(t){n.e(t)}finally{n.f()}switch((0,c.aI)(r,`.hr[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,c.aI)(s,".jr").setAttribute("displayed","true"),(0,c.aI)(s,".lr").setAttribute("displayed","false"),(0,c.aI)(s,".kr").setAttribute("displayed","false"),(0,c.aI)(s,".mr").setAttribute("displayed","false");break;case 1:(0,c.aI)(s,".jr").setAttribute("displayed","false"),(0,c.aI)(s,".lr").setAttribute("displayed","true"),(0,c.aI)(s,".kr").setAttribute("displayed","false"),(0,c.aI)(s,".mr").setAttribute("displayed","false");break;case 2:(0,c.aI)(s,".jr").setAttribute("displayed","false"),(0,c.aI)(s,".lr").setAttribute("displayed","false"),(0,c.aI)(s,".kr").setAttribute("displayed","true"),(0,c.aI)(s,".mr").setAttribute("displayed","false");break;case 3:(0,c.aI)(s,".jr").setAttribute("displayed","false"),(0,c.aI)(s,".lr").setAttribute("displayed","false"),(0,c.aI)(s,".kr").setAttribute("displayed","false"),(0,c.aI)(s,".mr").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=5fcfb91d9e11deaf3fd4.js.map