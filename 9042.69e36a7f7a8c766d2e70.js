"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[6661,9042],{365(e,t,r){r.d(t,{G:()=>s});var n=r(467),i=r(3422),a=r(4778),o=r(2571),u=r(1172);function s(e){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(e){if(""===i.M3||""===i.se||void 0===e)return!1;var t=(0,a.F)("cancel",[e]),r=(0,o.b)("cancel",[e]),n=yield(0,u.R)("cancel",t,r);return!1!==n&&(200===n.code&&"cancel"===n.method&&(yield(0,i.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>i});var n=r(467);function i(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,n.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},i=yield fetch(t,n);if(!i.ok){yield i.text();return!1}try{var a=yield i.text(),o=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{b:()=>o});var n=r(8024),i=r(3422);function a(e,t,r){var i=(new Date).getTime(),a=(i-i%5e3)/5e3;return(0,n.Zf)((0,n.Zf)(`${e}\n${t}\n${a}\n${(0,n.Zf)(`${e}\n${t}\n${(0,n.Zf)(JSON.stringify(r))}`)}`))}function o(e,t){switch(e){case"cancel":return""!==i.M3&&""!==i.se&&1===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,n.Zf)(`${(0,n.Zf)(t[0])}${r.getTime()}`)};case"schedule":return""!==i.M3&&""!==i.se&&9===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==i.M3&&""!==i.se&&0===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{})};case"reschedule":return""!==i.M3&&""!==i.se&&3===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3422(e,t,r){r.d(t,{M3:()=>b,ph:()=>g,se:()=>w,z9:()=>U,hc:()=>J,D7:()=>M,cS:()=>C,e3:()=>H,Db:()=>T,VJ:()=>j,ms:()=>$,G7:()=>L,mD:()=>G,FX:()=>E,gc:()=>I,Je:()=>k,uQ:()=>x,Zc:()=>F});var n=r(467),i=r(8024),a=r(8011),o=r(4293),u=r(424),s=r(6788),l=r(3459),c=r(4311),d=r(2284),f=r(4778),p=r(2571),h=r(1172);function y(){return(y=(0,n.A)(function*(){if(""===b||""===w)return!1;var e=(0,f.F)("rotate"),t=(0,p.b)("rotate",[]),r=yield(0,h.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&(x(r.secret),yield $(),!0))})).apply(this,arguments)}function m(){return m=(0,n.A)(function*(e,t,r,n,i,a,o,u,s){if(""===b||""===w||void 0===e||void 0===t||void 0===r||void 0===n||void 0===i||void 0===a||"number"!=typeof o||void 0===s)return!1;var l=new Date;switch((0,d.A)(s)){case"string":case"number":l=new Date(s);break;default:if(!(s instanceof Date))return!1;l=s}var c=(0,f.F)("schedule"),m=(0,p.b)("schedule",[e,t,r,n,i,a,o,u,l.toISOString()]),v=yield(0,h.R)("schedule",c,m);return!1!==v&&(200===v.code&&"schedule"===v.method&&(Math.random()>.8&&(yield function(){return y.apply(this,arguments)}()),yield L(v.schedule_id,e,t,r,n,i,a,o,u,l.getTime()),v.schedule_id))}),m.apply(this,arguments)}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return _(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var g="",b="",w="",S=[],A={},O={};function $(){return N.apply(this,arguments)}function N(){return(N=(0,n.A)(function*(){var e={provider:g,client_id:b,secret:w};yield(0,c.mL)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function T(){return D.apply(this,arguments)}function D(){return(D=(0,n.A)(function*(){var e=yield(0,c.Ct)(9,"n_client");if(e){var t=JSON.parse(e);g=t.provider,b=t.client_id,w=t.secret}})).apply(this,arguments)}function J(){return""!==b&&""!==w}function k(e){if(!(0,i.Gz)(e))throw new Error("The provider is not valid.");var t=new URL(e);g=`${t.protocol}//${t.hostname}`}function M(){return String(g)}function I(e){void 0!==e&&(b=String(e))}function x(e){void 0!==e&&(w=String(e))}function C(){return P.apply(this,arguments)}function P(){return(P=(0,n.A)(function*(){(new Date).getTime();var e,t=0,r=v(yield(0,c.Su)(10));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,c.Ct)(10,n),a=JSON.parse(i),o=a.schedule_id,u=`s_${a.stop_id}`;S.push(a),A[o]=t,O.hasOwnProperty(u)||(O[u]=[]),O[u].push(t),t+=1}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function L(e,t,r,n,i,a,o,u,s,l){return Q.apply(this,arguments)}function Q(){return(Q=(0,n.A)(function*(e,t,r,n,i,a,o,u,s,l){var d={schedule_id:e,stop_id:t,location_name:r,route_id:n,route_name:i,direction:a,estimate_time:o,time_formatting_mode:u,time_offset:s,scheduled_time:l},f=`s_${t}`,p=S.length;S.push(d),A[e]=p,O.hasOwnProperty(f)||(O[f]=[]),O[f].push(p),yield(0,c.mL)(10,e,JSON.stringify(d))})).apply(this,arguments)}function j(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,n.A)(function*(e){if(A.hasOwnProperty(e)){var t=A[e],r=`s_${S[t].stop_id}`;S.splice(t,1,null),O[r].splice(O[r].indexOf(t),1),delete A[e],yield(0,c.iQ)(10,e)}})).apply(this,arguments)}function F(e){var t=(new Date).getTime(),r=`s_${e}`;if(O.hasOwnProperty(r)){var n,i=v(O[r]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=S[a];if(null!==o)if(o.scheduled_time>t)return!0}}catch(e){i.e(e)}finally{i.f()}}return!1}function U(){return R.apply(this,arguments)}function R(){return(R=(0,n.A)(function*(){var e=(new Date).getTime();for(var t in A){var r=A[t],n=S[r];if(n.scheduled_time<=e){var i=`s_${n.stop_id}`;S.splice(r,1,null),O[i].splice(O[i].indexOf(r),1),delete A[t],yield(0,c.iQ)(10,t)}}})).apply(this,arguments)}function H(e){return z.apply(this,arguments)}function z(){return(z=(0,n.A)(function*(e){var t,r=yield(0,o.a)(e,!0),n=function(){var e,t=(new Date).getTime(),r=[],n=v(S);try{for(n.s();!(e=n.n()).done;){var i=e.value;null!==i&&i.scheduled_time>t&&r.push(i)}}catch(e){n.e(e)}finally{n.f()}return r}(),i=(new Date).getTime(),a=[],u=v(n);try{for(u.s();!(t=u.n()).done;){var l=t.value,c={},d=l.location_name;c.name=d;var f=l.stop_id;c.stop_id=f;var p=l.estimate_time;c.estimate_time=p;var h=l.schedule_id;c.schedule_id=h;var y=l.scheduled_time;c.scheduled_time=y;var m=new Date(y),_=m.getDate(),g=m.getHours(),b=m.getMinutes();c.date=String(_).padStart(2,"0"),c.hours=String(g).padStart(2,"0"),c.minutes=String(b).padStart(2,"0"),c.route={};var w=l.route_name;c.route.name=w;var A=l.route_id;c.route.id=A;var O=l.direction;c.route.direction=O;var $=`r_${l.route_id}`;if(r.hasOwnProperty($)){var N=r[$].pid;c.route.pathAttributeId=N,a.push(c)}}}catch(e){u.e(e)}finally{u.f()}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});for(var T=[],D=0,J={},k=0,M=a;k<M.length;k++){var I=M[k],x=`g_${I.date}_${I.hours}`;J.hasOwnProperty(x)?I.is_first=!1:(J[x]=!0,I.is_first=!0),T.push(I),D+=1}var C={items:T,itemQuantity:D,dataUpdateTime:Math.max((0,s.Zt)(e),i)};return(0,s.gC)(e),(0,s.LQ)(e),C})).apply(this,arguments)}var E=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function G(e,t,r,n){return V.apply(this,arguments)}function V(){return V=(0,n.A)(function*(e,t,r,n){if(J()){var c=(0,l.Js)("time_formatting_mode"),d=(0,i.zx)(),f=yield(0,u.T)(d),p=yield(0,a.g)(d,0),h=yield(0,o.a)(d,!0);(0,s.LQ)(d),(0,s.gC)(d);var y=`s_${e}`,v={};if(!f.hasOwnProperty(y))return 0;var _=(v=f[y]).stopLocationId,g=v.goBack,b=`l_${_}`;if(!p.hasOwnProperty(b))return 0;var w=p[b].n,S=`r_${t}`,A={};if(!h.hasOwnProperty(S))return 0;var O=(A=h[S]).n,$=A.dep,N=[A.des,$,""][g?parseInt(g):0],T=E[n].time_offset,D=(new Date).getTime()+1e3*r+60*T*1e3,k=yield function(e,t,r,n,i,a,o,u,s){return m.apply(this,arguments)}(e,w,t,O,N,r,c,T,D);return!1===k?0:1}return 2}),V.apply(this,arguments)}},3937(e,t,r){r.d(t,{e:()=>s});var n=r(467),i=r(3422),a=r(4778),o=r(2571),u=r(1172);function s(e){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(e){if(!e)return!1;var t=(0,a.F)("register"),r=(0,o.b)("register",[e]),n=yield(0,u.R)("register",t,r);return!1!==n&&(200===n.code&&"register"===n.method&&((0,i.gc)(n.client_id),(0,i.uQ)(n.secret),yield(0,i.ms)(),!0))})).apply(this,arguments)}},4778(e,t,r){r.d(t,{F:()=>i});var n=r(3422);function i(e){if(""===n.ph)return!1;var t=new URL(n.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5314(e,t,r){r.d(t,{$i:()=>w,DF:()=>g,FU:()=>y,Qj:()=>p,XK:()=>v});var n=r(467),i=r(8024),a=r(5579),o=r(9734),u=r(8011),s=r(4293),l=r(6788),c=r(4311);function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(){var e,t=[],r=(new Date).getTime(),n=d(yield(0,c.Su)(8));try{for(n.s();!(e=n.n()).done;){var i=e.value,a=yield(0,c.Ct)(8,i),o=JSON.parse(a);r-new Date(o.time).getTime()<=12096e5&&t.push(o)}}catch(e){n.e(e)}finally{n.f()}return 0===t.length&&t.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),t})).apply(this,arguments)}function y(){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t=(new Date).getTime(),r=d(yield(0,c.Su)(8));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,c.Ct)(8,n),a=JSON.parse(i);t-new Date(a.time).getTime()>12096e5&&(yield(0,c.iQ)(8,n))}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,n.A)(function*(e,t){var r=(0,i.zx)(),n=`${e}_${t}`,a=(new Date).toISOString(),l=yield(0,c.Ct)(8,n);if(l){var d=JSON.parse(l);d.time=a,yield(0,c.mL)(8,n,JSON.stringify(d))}else switch(e){case"route":var f=yield(0,s.a)(r,!0),p=`r_${t}`;if(f.hasOwnProperty(p)){var h={type:"route",time:a,name:f[p].n,id:t};yield(0,c.mL)(8,n,JSON.stringify(h))}break;case"location":var y=yield(0,u.g)(r,1),m=`ml_${t}`;if(y.hasOwnProperty(m)){var v={type:"location",time:a,name:y[m].n,hash:t};yield(0,c.mL)(8,n,JSON.stringify(v))}break;case"bus":var _=yield(0,o.j)(r,!0),g=`c_${t}`;if(_.hasOwnProperty(g)){var b={type:"bus",time:a,name:_[g].CarNum,id:t};yield(0,c.mL)(8,n,JSON.stringify(b))}}})).apply(this,arguments)}function g(e,t){return b.apply(this,arguments)}function b(){return(b=(0,n.A)(function*(e,t){var r=`${e}_${t}`,n=yield(0,c.Ct)(8,r);return!!n&&JSON.parse(n)})).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=(0,n.A)(function*(e){var t,r=yield p(),n=yield(0,s.a)(e,!0),i=[],o=0,u=d(r);try{for(u.s();!(t=u.n()).done;){var c=t.value,f=c.type,h=new Date(c.time);switch(f){case"route":var y={type:"route"},m=c.name;y.name=m;var v=c.id;y.id=v;var _=n[`r_${v}`].pid;y.pid=_,y.time={absolute:h.getTime(),relative:(0,a.HN)(h)},i.push(y),o+=1;break;case"location":var g={type:"location"},b=c.hash;g.hash=b;var w=c.name;g.name=w,g.time={absolute:h.getTime(),relative:(0,a.HN)(h)},i.push(g),o+=1;break;case"bus":var S={type:"bus"},A=c.id;S.id=A;var O=c.name;S.name=O,S.time={absolute:h.getTime(),relative:(0,a.HN)(h)},i.push(S),o+=1;break;case"empty":var $={type:"empty"},N=c.id;$.id=N;var T=c.name;$.name=T,$.time={absolute:h.getTime(),relative:(0,a.HN)(h)},i.push($),o=1}}}catch(e){u.e(e)}finally{u.f()}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var D={items:i,itemQuantity:o,dataUpdateTime:(new Date).getTime()};return(0,l.LQ)(e),(0,l.gC)(e),D})).apply(this,arguments)}},5352(e,t,r){r.d(t,{Qh:()=>s,nL:()=>f,qZ:()=>c,ty:()=>h,vQ:()=>v});var n=r(467),i=r(8024),a=r(4311);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,a){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(e,t,r,n,u,s){var l=(0,i.zx)();if(t<0||t>23||r<0||r>59||n<0||n>23||u<0||u>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(n)&&Number.isInteger(u)))return!1;if(s.length>7)return!1;var c,d=o(s);try{for(d.s();!(c=d.n()).done;){var f=c.value;if("number"==typeof f&&(f<0||f>6||!Number.isInteger(f)))return!1}}catch(e){d.e(e)}finally{d.f()}var p={name:e,period:{start:{hours:t,minutes:r},end:{hours:n,minutes:u}},days:s,id:l};return yield(0,a.mL)(7,l,JSON.stringify(p)),!0})).apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(e){var t=yield(0,a.Ct)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=(0,n.A)(function*(e){(yield c(e.id))&&(yield(0,a.mL)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function h(){return y.apply(this,arguments)}function y(){return(y=(0,n.A)(function*(){var e,t=[],r=o(yield(0,a.Su)(7));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,a.Ct)(7,n);if(i){var u=JSON.parse(i);t.push(u)}}}catch(e){r.e(e)}finally{r.f()}return t.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),t.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),t})).apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t={},r=o(yield h());try{for(r.s();!(e=r.n()).done;){var n,i=e.value,a=o(i.days);try{for(a.s();!(n=a.n()).done;){var u=`d_${n.value}`;t.hasOwnProperty(u)||(t[u]=[]);var s={start:i.period.start,end:i.period.end};t[u].push(s)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}for(var l in t){for(var c=t[l],d=c.length,f=[],p=0;p<d;p++){var y=c[p-1]||c[p],m=c[p];0===f.length?f.push(m):60*m.start.hours+m.start.minutes>=60*y.start.hours+y.start.minutes&&60*m.start.hours+m.start.minutes<=60*y.end.hours+y.end.minutes?(f[f.length-1].end.hours=m.end.hours,f[f.length-1].end.minutes=m.end.minutes):f.push(m)}t[l]=f}return t})).apply(this,arguments)}function v(e){return _.apply(this,arguments)}function _(){return _=(0,n.A)(function*(e){var t=yield function(){return m.apply(this,arguments)}(),r=`d_${e.getDay()}`,n=e.getHours(),i=e.getMinutes();if(t.hasOwnProperty(r)){var a,u=o(t[r]);try{for(u.s();!(a=u.n()).done;){var s=a.value;if(60*n+i>=60*s.start.hours+s.start.minutes&&60*n+i<=60*s.end.hours+s.end.minutes)return!0}}catch(e){u.e(e)}finally{u.f()}}return!1}),_.apply(this,arguments)}}}]);
//# sourceMappingURL=9042.69e36a7f7a8c766d2e70.js.map