!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("bus",[],t):"object"==typeof exports?exports.bus=t():e.bus=t()}(self,()=>(()=>{"use strict";var e,t={6519(e,t,n){n.d(t,{default:()=>xv});var r=n(467),i=n(3453),a=n(2284);function o(e,t,n,r){var i=new Date;return i.setDate(1),i.setMonth(0),i.setHours(n),i.setMinutes(r),i.setSeconds(0),i.setMilliseconds(0),i.setFullYear(e.getFullYear()),i.setMonth(e.getMonth()),i.setDate(e.getDate()),i.setDate(i.getDate()+t),i}function s(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD hh:mm:ss").replaceAll(/Y{4,4}/g,e.getFullYear()).replaceAll(/M{2,2}/g,String(e.getMonth()+1).padStart(2,"0")).replaceAll(/D{2,2}/g,String(e.getDate()).padStart(2,"0")).replaceAll(/h{2,2}/g,String(e.getHours()).padStart(2,"0")).replaceAll(/m{2,2}/g,String(e.getMinutes()).padStart(2,"0")).replaceAll(/s{2,2}/g,String(e.getSeconds()).padStart(2,"0"))}function u(e){var t=e.getTime(),n=Math.floor(((new Date).getTime()-t)/1e3),r=Math.floor(n/31536e3);return r>=1?`${r}年前`:(r=Math.floor(n/2592e3))>=1?`${r}個月前`:(r=Math.floor(n/86400))>=1?`${r}天前`:(r=Math.floor(n/3600))>=1?`${r}小時前`:(r=Math.floor(n/60))>=1?`${r}分鐘前`:n>0?`${n}秒前`:"現在"}function l(e,t){var n=0|e;switch(t){case 0:return`${n}秒`;case 1:return[String((n-n%60)/60),String(n%60)].map(function(e){return e.padStart(2,"0")}).join(":");case 2:return`${n/60|0}分`;case 3:if(n>=3600)return`${parseFloat((n/3600).toFixed(1))}時`;if(60<=n&&n<3600)return`${n/60|0}分`;if(n<60)return`${n}秒`;break;default:return"--"}}function c(e){return[{name:"日",day:0,code:"d_0"},{name:"一",day:1,code:"d_1"},{name:"二",day:2,code:"d_2"},{name:"三",day:3,code:"d_3"},{name:"四",day:4,code:"d_4"},{name:"五",day:5,code:"d_5"},{name:"六",day:6,code:"d_6"}][e]}function d(e){return c(parseInt(e)-1)}function f(e){return`${String(e.hours).padStart(2,"0")}:${String(e.minutes).padStart(2,"0")}`}function p(e,t,n){var r=new Date;return r.setDate(1),r.setMonth(0),r.setFullYear(e),r.setMonth(t-1),r.setDate(n),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),r}var v=n(3790),h={cacheStore:!1,settingsStore:!1,dataUsageStatsStore:!1,updateRateDataStore:!1,updateRateDataWriteAheadLogStore:!1,busArrivalTimeDataWriteAheadLogStore:!1,busArrivalTimeDataStore:!1,personalScheduleStore:!1,recentViewsStore:!1,notificationStore:!1,notificationScheduleStore:!1,folderListStore:!1,folderContentIndexStore:!1,folderContentStore:!1},m=["cacheStore","settingsStore","dataUsageStatsStore","updateRateDataStore","updateRateDataWriteAheadLogStore","busArrivalTimeDataWriteAheadLogStore","busArrivalTimeDataStore","personalScheduleStore","recentViewsStore","notificationStore","notificationScheduleStore","folderListStore","folderContentIndexStore","folderContentStore"];function y(e,t,n){return g.apply(this,arguments)}function g(){return(g=(0,r.A)(function*(e,t,n){try{var r=m[e];return!1===h[r]&&(h[r]=yield v.createInstance({name:r})),yield h[r].setItem(t,n)}catch(e){return null}})).apply(this,arguments)}function b(e,t){return A.apply(this,arguments)}function A(){return(A=(0,r.A)(function*(e,t){try{var n=m[e];return!1===h[n]&&(h[n]=yield v.createInstance({name:n})),yield h[n].getItem(t)}catch(e){return null}})).apply(this,arguments)}function w(e,t){return S.apply(this,arguments)}function S(){return(S=(0,r.A)(function*(e,t){try{var n=m[e];return!1===h[n]&&(h[n]=yield v.createInstance({name:n})),yield h[n].removeItem(t)}catch(e){return null}})).apply(this,arguments)}function _(e){return k.apply(this,arguments)}function k(){return(k=(0,r.A)(function*(e){try{var t=m[e];return!1===h[t]&&(h[t]=yield v.createInstance({name:t})),yield h[t].keys()}catch(e){return[]}})).apply(this,arguments)}function $(){return I.apply(this,arguments)}function I(){return(I=(0,r.A)(function*(){if(navigator.storage&&navigator.storage.persist)return yield navigator.storage.persisted();return!1})).apply(this,arguments)}function T(){return(T=(0,r.A)(function*(){if(navigator.storage&&navigator.storage.persist)return(yield navigator.storage.persist())?"granted":"denied";return"unsupported"})).apply(this,arguments)}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function L(){return(L=(0,r.A)(function*(e,t){var n=`d_${s(t,"YYYY_MM_DD")}`,r=60*t.getHours()+t.getMinutes(),i=yield b(2,n);if(i){var a=JSON.parse(i);a.stats.sum+=e,a.data[r]+=e;var o=a.data[r];o>a.stats.max&&(a.stats.max=o),o<a.stats.min&&(a.stats.min=o),yield y(2,n,JSON.stringify(a))}else{var u={},l=new Uint32Array(1440);l[r]+=e,u.data=Array.from(l),u.stats={sum:e,max:e,min:0},u.date=[t.getFullYear(),t.getMonth()+1,t.getDate()],yield y(2,n,JSON.stringify(u))}})).apply(this,arguments)}function x(){return(x=(0,r.A)(function*(){var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);for(var t=o(e,-7,0,0),n=[],r=1;r<=7;r++){var i=o(t,r,0,0),a=`d_${s(i,"YYYY_MM_DD")}`,u=yield b(2,a);if(u){var l=JSON.parse(u);n.push(l)}else{var c={},d=new Uint32Array(1440);c.data=Array.from(d),c.stats={sum:0,max:0,min:0},c.date=[i.getFullYear(),i.getMonth()+1,i.getDate()],n.push(c)}}return n})).apply(this,arguments)}function M(){return(M=(0,r.A)(function*(){var e,t=(new Date).getTime(),n=E(yield _(2));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(2,r),a=JSON.parse(i);t-p(a.date[0],a.date[1],a.date[2]).getTime()>6048e5&&(yield w(2,r))}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function O(){return O=(0,r.A)(function*(e,t,r){var i=new Worker(new URL(n.p+n.u(818),n.b)),a=yield function(){return x.apply(this,arguments)}();return yield new Promise(function(n,o){i.onmessage=function(e){n(e.data),i.terminate()},i.onerror=function(e){o(e.message),i.terminate()},i.postMessage([a,e,t,r])})}),O.apply(this,arguments)}function D(e,t,n,r){var i=n*Math.PI/180-e*Math.PI/180,a=r*Math.PI/180-t*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 1e3*(6378.137*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))))}function j(e){for(var t=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=0;e>=1e3&&n<t.length-1;)e/=1e3,n++;return`${Math.floor(100*e)/100} ${t[n]}`}function P(e){for(var t="";e>0;){var n=(e-1)%26;t=String.fromCharCode(n+65)+t,e=Math.floor((e-1)/26)}return t}function N(e){return document.querySelector(e)}function R(e){return document.querySelectorAll(e)}function U(e,t){return e.querySelector(t)}function B(e,t){return e.querySelectorAll(t)}function J(e,t){for(var n=[],r=e.nextElementSibling;r;)r.classList.contains(t)&&n.push(r),r=r.nextElementSibling;return n}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4,i=["blobbus","ntpcbus"],a=["BusData","BusEvent","CarInfo","CarUnusual","EstimateTime","IStop","IStopPath","OrgPathAttribute","PathDetail","Provider","Route","Stop","SemiTimeTable","StopLocation","TimeTable","BusRouteFareList"],o=Hf("proxy");return n?`http://erichsia7.github.io/bus-alternative-static-apis/${i[e]}/Get${a[t]}.gz?_=${Kf(r)}`:o?`https://bus-proxy.erichsia7.workers.dev?url=https://tcgbusfs.blob.core.windows.net/${i[e]}/Get${a[t]}.gz&_=${Kf(r)}`:`https://tcgbusfs.blob.core.windows.net/${i[e]}/Get${a[t]}.gz?_=${Kf(r)}`}var q,H={};if("undefined"!=typeof SharedWorker){var z=new SharedWorker(new URL(n.p+n.u(444),n.b));(q=z.port).start()}else{var Q=new Worker(new URL(n.p+n.u(444),n.b));q=Q}function W(){return(W=(0,r.A)(function*(e){var t=Zf();return yield new Promise(function(n,r){H[t]=n,q.onerror=function(e){r(e.message)},q.postMessage([e,t])})})).apply(this,arguments)}function Y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return G(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}q.onmessage=function(e){var t=(0,i.A)(e.data,2),n=t[0],r=t[1];H[r]&&(H[r](n),delete H[r])},q.onerror=function(e){};var V={},Z=new Error("FetchError");function K(e,t,n,r){return X.apply(this,arguments)}function X(){return X=(0,r.A)(function*(e,t,n,r){if(V.hasOwnProperty(e)){if(V[e].processing)return yield new Promise(function(r,i){V[e].requests.push([r,i,t,n])});if(null!==V[e].result&&(new Date).getTime()<=V[e].timestamp)return ne(t,n,0,!0),V[e].result}else V[e]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var i=yield fetch(e);if(!i.ok)throw ne(t,n,0,!0),new Error(`HTTP error! status: ${i.status}`);for(var a=parseInt(String(i.headers.get("content-length"))),o=i.body.getReader(),s=[],u=0;;){var l=yield o.read(),c=l.done,d=l.value;if(c)break;s.push(d);var f=(u+=d.length)/a;if(ne(t,n,f,!1),V.hasOwnProperty(e)){var p,v=Y(V[e].requests);try{for(v.s();!(p=v.n()).done;){var h=p.value;ne(h[2],h[3],f,!1)}}catch(e){v.e(e)}finally{v.f()}}}for(var m=new Uint8Array(u),y=0,g=0,b=s;g<b.length;g++){var A=b[g];m.set(A,y),y+=A.length}var w,S=new Blob([m],{type:"application/gzip"}),_=yield S.arrayBuffer(),k=yield function(e){return W.apply(this,arguments)}(_);switch(r){case"json":w=/^<!doctype html>/.test(k)?yield K(e.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,n,r):JSON.parse(k);break;case"xml":w=k}var $=new Date;if(yield function(e,t){return L.apply(this,arguments)}(a,$),w){if(V.hasOwnProperty(e)){for(var I=u/a,T=V[e].requests.shift();T;)T[0](w),ne(T[2],T[3],I,!1),T=V[e].requests.shift();V[e].result=w,V[e].timestamp=$.getTime()+3e4,V[e].processing=!1}return ee(),w}if(V.hasOwnProperty(e)){for(var E=V[e].requests.shift();E;)E[1](Z),ne(E[2],E[3],0,!0),E=V[e].requests.shift();V[e].failed=!0}throw ee(),Z}),X.apply(this,arguments)}function ee(){var e=(new Date).getTime();for(var t in V)if(V.hasOwnProperty(t)){if(!V[t].processing&&e>V[t].timestamp){delete V[t];continue}if(V[t].failed){delete V[t];continue}}}var te={};function ne(e,t,n,r){te.hasOwnProperty(e)||(te[e]={}),te[e].hasOwnProperty(t)?(r?te[e][t].expel=!0:(te[e][t].expel=!1,te[e][t].progress=n),ae(e,"run")):(te[e][t]={expel:!1,progress:n,total:1},ae(e,"start"))}function re(e){if(te.hasOwnProperty(e)&&"object"===(0,a.A)(te[e])){var t=0,n=0;for(var r in te[e])te[e][r].expel||(t+=te[e][r].total,n+=te[e][r].progress);var i=Math.min(Math.max(n/t,0),1);return i===1/0||isNaN(i)?1:i}return 1}function ie(e){te.hasOwnProperty(e)&&(delete te[e],ae(e,"end"))}function ae(e,t){var n={target:e,stage:t,progress:re(e)},r=new CustomEvent(e,{detail:n});document.dispatchEvent(r)}var oe={};function se(e,t){oe.hasOwnProperty(e)||(oe[e]=0);var n=0;"string"==typeof t&&(n=function(e){var t=e.match(/[0-9\.]*/gm);if(t){var n=parseInt(t[0]),r=parseInt(t[2]),i=parseInt(t[4]),a=parseInt(t[6]),o=parseInt(t[8]),s=parseInt(t[10]),u=new Date;return u.setDate(1),u.setMonth(0),u.setFullYear(n),u.setMonth(r-1),u.setDate(i),u.setHours(a),u.setMinutes(o),u.setSeconds(s),u.getTime()}return 0}(t)),n>oe[e]&&(oe[e]=n)}function ue(e){return oe.hasOwnProperty(e)?1*oe[e]:0}function le(e){oe.hasOwnProperty(e)&&delete oe[e]}function ce(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return de(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?de(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fe(e){return pe.apply(this,arguments)}function pe(){return(pe=(0,r.A)(function*(e){var t,n=[],r=ce([[0,0],[1,0]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getBusData_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n})).apply(this,arguments)}function ve(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return he(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function me(e){return ye.apply(this,arguments)}function ye(){return(ye=(0,r.A)(function*(e){var t,n=[],r=ve([[0,1],[1,1]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getBusEvent_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n})).apply(this,arguments)}function ge(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return be(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ae={raw:{data:[],available:!1},simplified:{data:{},available:!1}};function we(e){return Se.apply(this,arguments)}function Se(){return(Se=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(439),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function _e(e){return ke.apply(this,arguments)}function ke(){return ke=(0,r.A)(function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(){return i.apply(this,arguments)}function i(){return i=(0,r.A)(function*(){var t,n=[],r=ge([[0,2],[1,2]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getCarInfo_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),i.apply(this,arguments)}var a=t?"simplified":"raw",o=`bus_${a}_car_info_cache`,s=yield b(0,`${o}_timestamp`);if(null===s){var u,l=yield n();return u=t?yield we(l):l,yield y(0,`${o}_timestamp`,(new Date).getTime()),yield y(0,o,JSON.stringify(u)),Ae[a].available||(Ae[a].available=!0,Ae[a].data=u),u}if((new Date).getTime()-parseInt(s)>2592e6){var c,d=yield n();return c=t?yield we(d):d,yield y(0,`${o}_timestamp`,(new Date).getTime()),yield y(0,o,JSON.stringify(c)),c}if(!Ae[a].available){var f=yield b(0,o);Ae[a].available=!0,Ae[a].data=JSON.parse(f)}return ne(e,"getCarInfo_0",0,!0),ne(e,"getCarInfo_1",0,!0),se(e,-1),Ae[a].data}),ke.apply(this,arguments)}function $e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ie(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ie(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Te={simplified:{available:!1,data:{}},merged:{available:!1,data:{}},indexed:{available:!1,data:{}}};function Ee(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(454),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function Le(e){return xe.apply(this,arguments)}function xe(){return(xe=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(473),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function Me(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(757),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function De(e,t){return je.apply(this,arguments)}function je(){return je=(0,r.A)(function*(e,t){function n(){return i.apply(this,arguments)}function i(){return i=(0,r.A)(function*(){var t,n=[],r=$e([[0,11],[1,11]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getLocation_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),i.apply(this,arguments)}var a=["simplified","merged","indexed"][t],o=`bus_${a}_location_cache`,s=yield b(0,`${o}_timestamp`);if(null===s){var u;switch(t){case 0:var l=yield n();u=yield Ee(l);break;case 1:var c=yield De(e,0);u=yield Le(c);break;case 2:var d=yield De(e,1);u=yield Me(d)}return yield y(0,`${o}_timestamp`,(new Date).getTime()),yield y(0,o,JSON.stringify(u)),Te[a].available||(Te[a].available=!0,Te[a].data=u),u}if((new Date).getTime()-parseInt(s)>2592e6){var f;switch(t){case 0:var p=yield n();f=yield Ee(p);break;case 1:var v=yield De(e,0);f=yield Le(v);break;case 2:var h=yield De(e,1);f=yield Me(h)}return yield y(0,`${o}_timestamp`,(new Date).getTime()),yield y(0,o,JSON.stringify(f)),Te[a].available||(Te[a].available=!0,Te[a].data=f),f}if(!Te[a].available){var m=yield b(0,o);Te[a].available=!0,Te[a].data=JSON.parse(m)}return ne(e,"getLocation_0",0,!0),ne(e,"getLocation_1",0,!0),se(e,-1),Te[a].data}),je.apply(this,arguments)}function Pe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ne(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ne(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Re=!1,Ue={};function Be(e){return Je.apply(this,arguments)}function Je(){return(Je=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(661),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function Fe(e){return qe.apply(this,arguments)}function qe(){return qe=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n=[],r=Pe([[0,11],[1,11]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getStop_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}var i="bus_stop_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t(),s=yield Be(o);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),Re||(Re=!0,Ue=s),s}if((new Date).getTime()-parseInt(a)>3888e6){var u=yield t(),l=yield Be(u);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(l)),l}if(!Re){var c=yield b(0,i);Re=!0,Ue=JSON.parse(c)}return ne(e,"getStop_0",0,!0),ne(e,"getStop_1",0,!0),se(e,-1),Ue}),qe.apply(this,arguments)}function He(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ze(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ze(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e,t){if("string"==typeof e){var n=parseInt(e);if(-3===n)return{code:6,text:"末班駛離",time:n};if(-4===n)return{code:5,text:"今日停駛",time:n};if(-2===n)return{code:4,text:"交通管制",time:n};if(-1===n)return{code:3,text:"未發車",time:n};if(0<=n&&n<=10)return{code:2,text:"進站中",time:n};if(10<n&&n<=180)return{code:1,text:l(n,t),time:n};if(180<n&&n<=250)return{code:.5,text:l(n,t),time:n};if(250<n)return{code:0,text:l(n,t),time:n}}return{code:7,text:"發生錯誤",time:-5}}function We(e,t){var n=e.length;if(0===t){var r=0,i=0;return 4===n&&(r=parseInt(e.substring(0,2)),i=parseInt(e.substring(2,4))),2===n&&(i=parseInt(e)),{type:"moment",hours:r,minutes:i}}if(1===t){var a=0,o=0;if(4===n){var s=parseInt(e.substring(0,2)),u=parseInt(e.substring(2,4));a=Math.min(s,u),o=Math.max(s,u)}if(2===n){var l=parseInt(e);a=l,o=l}return{type:"range",min:a,max:o}}}function Ye(e){var t="";switch(e){case"0":t="一般";break;case"1":t="低底盤";break;case"2":t="大復康巴士";break;case"3":t="狗狗友善專車";break;default:t="未知類型"}return t}function Ge(e){var t="";switch(e){case"0":t="離站";break;case"1":t="進站";break;default:t="未知狀態"}return t}function Ve(e){var t="";switch(e){case"0":t="正常";break;case"1":t="車禍";break;case"2":t="故障";break;case"3":t="塞車";break;case"4":t="緊急求援";break;case"5":t="加油";break;case"99":t="非營運狀態";break;default:t="未知狀態"}return t}function Ze(e){var t={},n=Ye(e.CarType);t.type=n;var r=Ge(e.CarOnStop),i=Ve(e.BusStatus);return t.carNumber=e.BusID,t.status={onStop:r,situation:i,text:`${r} | ${i}`},t.RouteName=e.RouteName,t.onThisRoute=e.onThisRoute,t.index=e.index,t.position=e.position,t}function Ke(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function et(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++)if(e[t]===e[n])return!1;return!0}function tt(e,t){var n=[];if(e.length<=t.length){var r,i=Ke(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.indexOf(a)>-1&&n.push(a)}}catch(e){i.e(e)}finally{i.f()}}else{var o,s=Ke(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;e.indexOf(u)>-1&&n.push(u)}}catch(e){s.e(e)}finally{s.f()}}return n}function nt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];if("string"==typeof e)for(var r=e.length,i=0;i<r;i++){var a=e.charCodeAt(i);(n.indexOf(a)<0||!t)&&n.push(a)}return n}function rt(e){return!!/[\u3100-\u312Fˇˋˊ˙]/gm.test(e)}function it(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return at(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?at(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ot=!1,st={};function ut(e){return lt.apply(this,arguments)}function lt(){return(lt=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(36),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function ct(e){return dt.apply(this,arguments)}function dt(){return dt=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n=[],r=it([[0,10],[1,10]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getRoute_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}if(!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]))return yield t();var i="bus_route_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t(),s=yield ut(o);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),ot||(ot=!0,st=s),s}if((new Date).getTime()-parseInt(a)>864e5){var u=yield t(),l=yield ut(u);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(l)),ot||(ot=!0,st=l),l}if(!ot){var c=yield b(0,i);ot=!0,st=JSON.parse(c)}return ne(e,"getRoute_0",0,!0),ne(e,"getRoute_1",0,!0),se(e,-1),st}),dt.apply(this,arguments)}function ft(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return pt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function vt(){return(vt=(0,r.A)(function*(e){var t=Zf(),n=yield ct(t,!0),r=[];for(var i in n){var a=n[i];String(a.n).indexOf(e)>-1&&r.push(a)}return ie(t),le(t),r})).apply(this,arguments)}function ht(e){return mt.apply(this,arguments)}function mt(){return(mt=(0,r.A)(function*(e){var t,n=Zf(),r=yield ct(n,!0),i=`r_${e}`;return!!r.hasOwnProperty(i)&&(t=r[i],ie(n),le(n),t)})).apply(this,arguments)}function yt(){return(yt=(0,r.A)(function*(e){var t=Zf(),n=yield ct(t,!0),r=[];for(var i in n){var a=n[i];String(a.pid).indexOf(e)>-1&&r.push(a)}return ie(t),le(t),r})).apply(this,arguments)}var gt={},bt=[],At=!1;function wt(){return(wt=(0,r.A)(function*(){if(!At){var e=Zf(),t=yield ct(e,!0),n=yield De(e,1),r=yield _e(e,!0);ie(e),le(e);var i={},a=[],o=0;for(var s in t){var u=t[s],l={id:u.id,pid:u.pid,dep:u.dep,des:u.des,n:u.n,hash:"",lo:"",la:"",r:"",s:"",type:0};a.push(l);var c,d=ft(nt(`${l.n.toLowerCase()}${l.dep.toLowerCase()}${l.des.toLowerCase()}`,!0));try{for(d.s();!(c=d.n()).done;){var f=`u_${c.value}`;i.hasOwnProperty(f)||(i[f]=[]),i[f].push(o)}}catch(e){d.e(e)}finally{d.f()}o+=1}for(var p in n){var v=n[p],h={id:v.id,n:v.n,lo:v.lo,la:v.la,r:v.r,s:v.s,hash:v.hash,dep:"",des:"",pid:[],type:1};a.push(h);var m,y=ft(nt(h.n.toLowerCase(),!0));try{for(y.s();!(m=y.n()).done;){var g=`u_${m.value}`;i.hasOwnProperty(g)||(i[g]=[]),i[g].push(o)}}catch(e){y.e(e)}finally{y.f()}o+=1}for(var b in r){var A=r[b],w={id:A.BusId,pid:[],dep:"",des:"",n:A.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};a.push(w);var S,_=ft(nt(w.n.toLowerCase(),!0));try{for(_.s();!(S=_.n()).done;){var k=`u_${S.value}`;i.hasOwnProperty(k)||(i[k]=[]),i[k].push(o)}}catch(e){_.e(e)}finally{_.f()}o+=1}gt=i,bt=a,At=!0}})).apply(this,arguments)}function St(e,t){var n,r=0,i=0,a=ft(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r+=e.indexOf(o,i)-i,i+=1}}catch(e){a.e(e)}finally{a.f()}return e===t&&(r=10*Math.abs(r)),r}function _t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return kt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $t(){return $t=(0,r.A)(function*(e,t){var n=`c_${e}`,r=yield _e(t,!0),i=yield fe(t),a=yield me(t),o=yield Fe(t),s=yield De(t,0),u={properties:[],LocationName:""},l={};if(!r.hasOwnProperty(n))return u;var c=(l=r[n]).CarNum;u.properties.push({key:"car_number",icon:"tag",value:c});var d=Ye(l.CarType);u.properties.push({key:"car_type",icon:"directions_bus",value:d});var f,p={},v=_t(i);try{for(v.s();!(f=v.n()).done;){var h=f.value;if(h.BusID===c){p=h;break}}}catch(e){v.e(e)}finally{v.f()}var m,y=parseInt(p.RouteID),g=Ve(p.BusStatus),b=parseInt(p.GoBack),A={},w=_t(a);try{for(w.s();!(m=w.n()).done;){var S=m.value;if(S.BusID===c){A=S;break}}}catch(e){w.e(e)}finally{w.f()}var _=Ge(A.CarOnStop);u.properties.push({key:"status",icon:"vital_signs",value:`${_} | ${g}`});var k=A.StopID,$=yield function(e){return yt.apply(this,arguments)}(y),I={};if(!($.length>0))return u;var T=(I=$[0]).id,E=I.pid,C=I.n,L=I.dep,x=[I.des,L,""][b||0];u.properties.push({key:"route",icon:"route",value:`${C} - 往${x}`}),u.RouteID=T,u.FullPathAttributeId=E;var M=`s_${k}`;if(!o.hasOwnProperty(M))return u;var O=s[`l_${o[M].stopLocationId}`].n;return u.properties.push({key:"location_name",icon:"location_on",value:O}),ie(t),le(t),u}),$t.apply(this,arguments)}function It(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Tt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Et(){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,r.A)(function*(){var e,t=[],n=(new Date).getTime(),r=It(yield _(8));try{for(r.s();!(e=r.n()).done;){var i=e.value,a=yield b(8,i),o=JSON.parse(a);n-new Date(o.time).getTime()<=12096e5&&t.push(o)}}catch(e){r.e(e)}finally{r.f()}return 0===t.length&&t.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),t})).apply(this,arguments)}function Lt(){return(Lt=(0,r.A)(function*(){var e,t=(new Date).getTime(),n=It(yield _(8));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(8,r),a=JSON.parse(i);t-new Date(a.time).getTime()>12096e5&&(yield w(8,r))}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function xt(e,t){return Mt.apply(this,arguments)}function Mt(){return(Mt=(0,r.A)(function*(e,t){var n=Zf(),r=`${e}_${t}`,i=(new Date).toISOString(),a=yield b(8,r);if(a){var o=JSON.parse(a);o.time=i,yield y(8,r,JSON.stringify(o))}else switch(e){case"route":var s=yield ct(n,!0),u=`r_${t}`;if(s.hasOwnProperty(u)){var l={type:"route",time:i,name:s[u].n,id:t};yield y(8,r,JSON.stringify(l))}break;case"location":var c=yield De(n,1),d=`ml_${t}`;if(c.hasOwnProperty(d)){var f={type:"location",time:i,name:c[d].n,hash:t};yield y(8,r,JSON.stringify(f))}break;case"bus":var p=yield _e(n,!0),v=`c_${t}`;if(p.hasOwnProperty(v)){var h={type:"bus",time:i,name:p[v].CarNum,id:t};yield y(8,r,JSON.stringify(h))}}})).apply(this,arguments)}function Ot(e,t){return Dt.apply(this,arguments)}function Dt(){return(Dt=(0,r.A)(function*(e,t){var n=`${e}_${t}`,r=yield b(8,n);return!!r&&JSON.parse(r)})).apply(this,arguments)}function jt(){return(jt=(0,r.A)(function*(e){var t,n=yield Et(),r=yield ct(e,!0),i=[],a=0,o=It(n);try{for(o.s();!(t=o.n()).done;){var s=t.value,l=s.type,c=new Date(s.time);switch(l){case"route":var d={type:"route"},f=s.name;d.name=f;var p=s.id;d.id=p;var v=r[`r_${p}`].pid;d.pid=v,d.time={absolute:c.getTime(),relative:u(c)},i.push(d),a+=1;break;case"location":var h={type:"location"},m=s.hash;h.hash=m;var y=s.name;h.name=y,h.time={absolute:c.getTime(),relative:u(c)},i.push(h),a+=1;break;case"bus":var g={type:"bus"},b=s.id;g.id=b;var A=s.name;g.name=A,g.time={absolute:c.getTime(),relative:u(c)},i.push(g),a+=1;break;case"empty":var w={type:"empty"},S=s.id;w.id=S;var _=s.name;w.name=_,w.time={absolute:c.getTime(),relative:u(c)},i.push(w),a=1}}}catch(e){o.e(e)}finally{o.f()}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var k={items:i,itemQuantity:a,dataUpdateTime:(new Date).getTime()};return ie(e),le(e),k})).apply(this,arguments)}function Pt(e){return`<span class="zc">${e}</span>`}function Nt(e){var t=document.createElement("span");return t.classList.add("zc"),t.innerText=e,t}function Rt(){var e=document.createElement("span");return e.classList.add("zc"),e}function Ut(e,t){U(e,"span.zc").innerText=t}var Bt=[],Jt=!1,Ft=!1;function qt(){var e=document.createElement("div");e.classList.add("fm");var t=document.createElement("div");t.classList.add("gm"),t.appendChild(Rt());var n=document.createElement("div");return n.classList.add("hm"),e.appendChild(t),e.appendChild(n),{element:e,id:""}}function Ht(e,t,n){function r(e,r,i){function a(e,t){Ut(U(e,".gm"),t.icon)}function o(e,t){U(e,".hm").innerText=t.value}function s(e,t){e.setAttribute("animation",t)}function u(e,t){e.setAttribute("skeleton-screen",t)}null==i?(a(e,r),o(e,r),u(e,t),s(e,n)):(Vf(i,r)||a(e,r),Vf(i,r)||o(e,r),t!==Jt&&u(e,t),n!==Ft&&s(e,n))}var i=e.length,a=B(Gt,".fm").length;if(i!==a){var o=a-i;if(o<0){for(var s=new DocumentFragment,u=0,l=Math.abs(o);u<l;u++){var c=qt();s.appendChild(c.element)}Gt.append(s)}else for(var d=B(Gt,".fm"),f=0,p=Math.abs(o);f<p;f++){d[a-1-f].remove()}}for(var v=B(Gt,".fm"),h=0;h<i;h++){var m=v[h],y=e[h];0===Bt.length?r(m,y,null):r(m,y,Bt[h])}Bt=e,Ft=n,Jt=t}var zt=N(".ul"),Qt=(U(zt,".vl"),U(zt,".zl")),Wt=U(Qt,"._l"),Yt=U(Wt,'.am[group="properties"]'),Gt=U(Yt,".em");U(Wt,'.am[group="location"]');function Vt(e){gd("Bus"),xt("bus",e),zt.setAttribute("displayed","true"),function(e){Kt.apply(this,arguments)}(e),Ad()}function Zt(){zt.setAttribute("displayed","false"),wd()}function Kt(){return Kt=(0,r.A)(function*(e){!function(){for(var e=Hf("playing_animation"),t=[],n=0;n<5;n++)t.push({key:n,icon:"",value:""});Ht(t,!0,e)}();var t=Hf("playing_animation"),n=Zf(),r=yield function(e,t){return $t.apply(this,arguments)}(e,n);Ht(r.properties,!1,t)}),Kt.apply(this,arguments)}function Xt(e,t,n,r,i,a){var o=n+a,s=(n*e+a*r)/o,u=(n*(Math.pow(t,2)+Math.pow(e,2))+a*(Math.pow(i,2)+Math.pow(r,2)))/o-Math.pow(s,2);return Math.sqrt(u)}function en(e){var t=Math.hypot(e),n=e.length,r=new Float32Array(n);if(t>0){for(var i=1/t,a=n;a>0;a--)r[a]=e[a]*i;return Array.from(r)}return e}function tn(e){var t=e.length;if(0===t)return[0,0];for(var n=1/0,r=-1/0,i=t-1;i>=0;i--){var a=e[i];a>r&&(r=a),a<n&&(n=a)}return[n,r]}function nn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return rn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var an=[],on="",sn=!1,un=0,ln={data:{},timestamp:0,id:""},cn=[],dn={};function fn(e){var t,n=0,r=0,i=0,a=0,o=0,s=nn(e);try{for(s.s();!(t=s.n()).done;){var u=t.value,l=u[0],c=u[1];o+=1,n+=l,i+=c,r+=Math.pow(l,2),a+=Math.pow(c,2)}}catch(e){s.e(e)}finally{s.f()}var d,f=n/o,p=i/o,v=r/o-Math.pow(f,2),h=a/o-Math.pow(p,2),m=Math.sqrt(v),y=Math.sqrt(h),g=0,b=nn(e);try{for(b.s();!(d=b.n()).done;){var A=d.value;g+=(A[0]-f)*(A[1]-p)}}catch(e){b.e(e)}finally{b.f()}return{estimate_time:{average:f,stdev:m},timestamp:{average:p,stdev:y},length:o,correlation:(g/=o)/(m*y)}}function pn(e,t){var n=e.length+t.length,r=(e.estimate_time.average*e.length+t.estimate_time.average*t.length)/n,i=(e.timestamp.average*e.length+t.timestamp.average*t.length)/n,a=Xt(e.estimate_time.average,e.estimate_time.stdev,e.length,t.estimate_time.average,t.estimate_time.stdev,t.length),o=Xt(e.timestamp.average,e.timestamp.stdev,e.length,t.timestamp.average,t.timestamp.stdev,t.length),s=function(e,t,n,r,i,a,o,s,u,l,c,d){var f=i+c;return(i*(n*r*a+e*t)+c*(u*l*d+o*s)-f*((i*e+c*o)/f)*((i*t+c*s)/f))/(f*Xt(e,n,i,o,u,c)*Xt(t,r,i,s,l,c))}(e.estimate_time.average,e.timestamp.average,e.estimate_time.stdev,e.timestamp.stdev,e.length,e.correlation,t.estimate_time.average,t.timestamp.average,t.estimate_time.stdev,t.timestamp.stdev,t.length,t.correlation);return{estimate_time:{average:r,stdev:a},timestamp:{average:i,stdev:o},length:n,correlation:s}}function vn(){return(vn=(0,r.A)(function*(e){var t=(new Date).getTime(),n=!1;if(!sn){sn=!0,an=[],on=Zf(),ln={data:{},timestamp:t,id:on},un=0;for(var r=e.length-1,i=0;i<32;i++){var a=e[Math.floor(Math.random()*r)];an.push(a.StopID)}}var o,s=nn(e);try{for(s.s();!(o=s.n()).done;){var u=o.value,l=u.StopID,c=`s_${l}`;an.indexOf(l)>-1&&(ln.data.hasOwnProperty(c)||(ln.data[c]=[]),ln.data[c].push([parseInt(u.EstimateTime),Math.floor((t-ln.timestamp)/1e3)]))}}catch(e){s.e(e)}finally{s.f()}if((un+=1)>45&&(n=!0),un%5==0&&(yield y(4,on,JSON.stringify(ln))),n){var d,f=nn(an);try{for(f.s();!(d=f.n()).done;){var p=d.value,v=`s_${p}`,h=ln.data[v],m={},g=yield b(3,v);if(g){var A=JSON.parse(g);m.stats=pn(A.stats,fn(h)),m.timestamp=A.timestamp,m.id=p}else m.stats=fn(h),m.timestamp=t,m.id=p;if(yield y(3,v,JSON.stringify(m)),dn.hasOwnProperty(v)){var S=dn[v];cn.splice(S,1,m)}else cn[v]=cn.length,cn.push(m);yield w(4,on)}}catch(e){f.e(e)}finally{f.f()}sn=!1}})).apply(this,arguments)}function hn(){return(hn=(0,r.A)(function*(){var e,t=(new Date).getTime()-252e5,n=nn(yield _(4));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(4,r);if(i){var a=JSON.parse(i),o=a.timestamp,s=a.id;if(o>t)for(var u in a.data){var l=a.data[u],c={},d=yield b(3,u);if(d){var f=JSON.parse(d);c.stats=pn(f.stats,fn(l)),c.timestamp=f.timestamp,c.id=f.id}else c.stats=fn(l),c.timestamp=o,c.id=parseInt(u.split("_")[1]);if(yield y(3,u,JSON.stringify(c)),dn.hasOwnProperty(u)){var p=dn[u];cn.splice(p,1,c)}else cn[u]=cn.length,cn.push(c)}yield w(4,s)}}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function mn(){return(mn=(0,r.A)(function*(){var e,t=(new Date).getTime()-252e5,n=0,r=nn(yield _(3));try{for(r.s();!(e=r.n()).done;){var i=e.value,a=yield b(3,i);if(a){var o=JSON.parse(a);o.timestamp>t&&(cn.push(o),dn[i]=n,n+=1)}}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function yn(){return gn.apply(this,arguments)}function gn(){return(gn=(0,r.A)(function*(){var e,t=(new Date).getTime()-252e5,n=nn(yield _(3));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(3,r);JSON.parse(i).timestamp<=t&&(yield w(3,r))}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}var bn,An={};if("undefined"!=typeof SharedWorker){var wn=new SharedWorker(new URL(n.p+n.u(275),n.b));(bn=wn.port).start()}else{var Sn=new Worker(new URL(n.p+n.u(275),n.b));bn=Sn}function _n(){return kn.apply(this,arguments)}function kn(){return(kn=(0,r.A)(function*(){var e,t=yield(e=(new Date).getTime()-252e5,cn.filter(function(t){return t.timestamp>e})),n=Zf();return yield new Promise(function(e,r){An[n]=e,bn.onerror=function(e){r(e.message)},bn.postMessage([t,n])})})).apply(this,arguments)}function $n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return In(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?In(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function In(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Tn(e){return En.apply(this,arguments)}function En(){return(En=(0,r.A)(function*(e){var t,n=[],r=$n([[0,4],[1,4]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getEstimateTime_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n})).apply(this,arguments)}bn.onmessage=function(e){var t=(0,i.A)(e.data,2),n=t[0],r=t[1];An[r]&&(An[r](n),delete An[r])},bn.onerror=function(e){};var Cn=!1,Ln=[];function xn(e){return Mn.apply(this,arguments)}function Mn(){return Mn=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t=function(){return`https://erichsia7.github.io/material-symbols-list/search-index.gz?_=${Kf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4)}`}();return yield K(t,e,"getMaterialSymbolsSearchIndex","json")}),n.apply(this,arguments)}var i="bus_material_symbols_search_index_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(o)),Cn||(Cn=!0,Ln=o),o}if((new Date).getTime()-parseInt(a)>6048e5){var s=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),Cn||(Cn=!0,Ln=s),s}if(!Cn){var u=yield b(0,i);Cn=!0,Ln=JSON.parse(u)}return ne(e,"getMaterialSymbolsSearchIndex",0,!0),Ln}),Mn.apply(this,arguments)}function On(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Dn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var jn={};function Pn(){return(Pn=(0,r.A)(function*(){var e,t=On(yield _(11));try{for(t.s();!(e=t.n()).done;){var n=e.value,r=yield b(11,n);if(r){var i=JSON.parse(r);jn.hasOwnProperty(n)||(jn[n]=i)}}}catch(e){t.e(e)}finally{t.f()}})).apply(this,arguments)}function Nn(e,t){return Rn.apply(this,arguments)}function Rn(){return(Rn=(0,r.A)(function*(e,t){var n=Zf(),r=yield xn(n);if(ie(n),!r.symbols.hasOwnProperty(t))return!1;var i=Zf(),a=`f_${i}`;if(jn.hasOwnProperty(a))return!1;if(yield b(11,a))return!1;var o={name:e,icon:t,id:i,timestamp:(new Date).getTime()};return jn[a]=o,yield y(11,a,JSON.stringify(o)),yield y(12,a,JSON.stringify([])),i})).apply(this,arguments)}function Un(e,t,n){return Bn.apply(this,arguments)}function Bn(){return(Bn=(0,r.A)(function*(e,t,n){var r=`f_${e}`,i=yield b(11,r);if(!i)return!1;var a=JSON.parse(i),o=Zf(),s=yield xn(o);if(ie(o),!s.symbols.hasOwnProperty(n))return!1;var u={name:t,icon:n,id:e,timestamp:a.timestamp};return jn[r]=u,yield y(11,r,JSON.stringify(u)),!0})).apply(this,arguments)}function Jn(e){var t=`f_${e}`;return!!jn.hasOwnProperty(t)&&{name:jn[t].name,icon:jn[t].icon,id:jn[t].id,timestamp:jn[t].timestamp}}function Fn(e){return qn.apply(this,arguments)}function qn(){return(qn=(0,r.A)(function*(e){var t=[],n=`f_${e}`,r=Jn(e);if("boolean"==typeof r&&!1===r)return t;var i=yield b(12,n);if(!i)return t;var a=JSON.parse(i);if(0===a.length){return t.push({type:"empty",id:0,index:0}),t}var o,s=On(a);try{for(s.s();!(o=s.n()).done;){var u=o.value,l=yield b(13,u);if(l){var c=JSON.parse(l);t.push(c)}}}catch(e){s.e(e)}finally{s.f()}return t})).apply(this,arguments)}function Hn(e){return zn.apply(this,arguments)}function zn(){return(zn=(0,r.A)(function*(e){var t=`f_${e}`,n=yield b(12,t);return n?JSON.parse(n).length:0})).apply(this,arguments)}function Qn(){return Wn.apply(this,arguments)}function Wn(){return(Wn=(0,r.A)(function*(){var e,t=yield function(){var e=[];for(var t in jn){var n={name:jn[t].name,icon:jn[t].icon,id:jn[t].id,timestamp:jn[t].timestamp};e.push(n)}return e.sort(function(e,t){return e.timestamp-t.timestamp}),e}(),n=[],r=On(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,a=yield Fn(i.id),o=yield Hn(i.id);n.push({name:i.name,icon:i.icon,id:i.id,timestamp:i.timestamp,content:a,contentLength:o})}}catch(e){r.e(e)}finally{r.f()}return n})).apply(this,arguments)}function Yn(){return(Yn=(0,r.A)(function*(e){var t=!0;"object"===(0,a.A)(e)&&Array.isArray(e)||(t=!1);var n,r=[],i=On(yield _(13));try{for(i.s();!(n=i.n()).done;){var o=n.value,s=yield b(13,o);if(s){var u=JSON.parse(s);t?e.indexOf(u.type)>-1&&r.push(u):r.push(u)}}}catch(e){i.e(e)}finally{i.f()}return r})).apply(this,arguments)}function Gn(){return Gn=(0,r.A)(function*(e){ne(e,"getEstimateTime_0",0,!1),ne(e,"getEstimateTime_1",0,!1),ne(e,"getRoute_0",0,!1),ne(e,"getRoute_1",0,!1);var t,n=yield Tn(e),r=yield ct(e,!0),i=yield Qn(),a=Hf("time_formatting_mode"),o=Hf("power_saving"),s=Hf("refresh_interval"),u=[],l=On(i);try{for(l.s();!(t=l.n()).done;){var c=t.value;u=u.concat(c.content.filter(function(e){return"stop"===e.type}).map(function(e){return e.id}))}}catch(e){l.e(e)}finally{l.f()}var d,f={},p=On(n);try{for(p.s();!(d=p.n()).done;){var v=d.value;if(u.indexOf(v.StopID)>-1)f[`s_${v.StopID}`]=v}}catch(e){p.e(e)}finally{p.f()}var h,m=[],y=On(i);try{for(y.s();!(h=y.n()).done;){var g,b=h.value,A={name:b.name,icon:b.icon,id:b.id,timestamp:b.timestamp,content:[],contentLength:b.contentLength},w=On(b.content);try{for(w.s();!(g=w.n()).done;){var S=g.value;switch(S.type){case"stop":var _=`s_${S.id}`,k={};if(!f.hasOwnProperty(_))break;k=f[_],S.status=Qe(k.EstimateTime,a);var $=r[`r_${S.route.id}`];S.route.pathAttributeId=$.pid;break;case"route":var I=r[`r_${S.id}`];S.pathAttributeId=I.pid}A.content.push(S)}}catch(e){w.e(e)}finally{w.f()}m.push(A)}}catch(e){y.e(e)}finally{y.f()}var T={folders:m,dataUpdateTime:ue(e)};return ie(e),le(e),o||(s.dynamic&&(yield function(e){return vn.apply(this,arguments)}(n)),yield function(e){return yp.apply(this,arguments)}(n)),T}),Gn.apply(this,arguments)}function Vn(e,t){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,r.A)(function*(e,t){var n=`f_${e}`,r=`${t.type}_${t.id}`,i=Jn(e);if("boolean"==typeof i&&!1===i)return!1;var a=yield b(12,n);if(!a)return!1;var o=JSON.parse(a);return(0===o.length||o.indexOf(r)<0)&&(yield y(12,n,JSON.stringify(o.concat(r))),yield y(13,r,JSON.stringify(t)),!0)})).apply(this,arguments)}function Kn(e,t){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,r.A)(function*(e,t){var n,r=`${e}_${t}`,i=On(yield _(12));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=yield b(12,a);if(o)if(JSON.parse(o).indexOf(r)>-1)return!0}}catch(e){i.e(e)}finally{i.f()}return!1})).apply(this,arguments)}function er(){return(er=(0,r.A)(function*(e,t,n){var r=`f_${e}`,i=`${t}_${n}`,a=Jn(e);if("boolean"==typeof a&&!1===a)return!1;var o=yield b(12,r);if(!o)return!1;var s=JSON.parse(o),u=s.indexOf(i);return u>-1&&s.length>0&&(s.splice(u,1),yield y(12,r,JSON.stringify(s))),!1===(yield Kn(t,n))&&(yield w(13,i)),!0})).apply(this,arguments)}function tr(e,t,n){return nr.apply(this,arguments)}function nr(){return(nr=(0,r.A)(function*(e,t,n){var r=Zf(),i=yield Fe(r),a=yield De(r,0),o=yield ct(r,!0),s=i[`s_${t}`],u=parseInt(s.goBack),l=a[`l_${s.stopLocationId}`].n,c=o[`r_${n}`],d=c.n,f=c.dep,p=c.des,v={type:"stop",id:t,timestamp:(new Date).getTime(),name:l,direction:u,route:{name:d,endPoints:{departure:f,destination:p},id:n}};return yield Vn(e,v)})).apply(this,arguments)}function rr(e,t){return ir.apply(this,arguments)}function ir(){return(ir=(0,r.A)(function*(e,t){var n=Zf(),r=yield ct(n,!0);ie(n),le(n);var i=`r_${t}`,a={};if(!r.hasOwnProperty(i))return!1;a=r[i];var o={type:"route",id:t,timestamp:(new Date).getTime(),name:a.n,endPoints:{departure:a.dep,destination:a.des}};return yield Vn(e,o)})).apply(this,arguments)}function ar(e,t){return or.apply(this,arguments)}function or(){return(or=(0,r.A)(function*(e,t){var n=Zf(),r=yield De(n,1);ie(n),le(n);var i=`ml_${t}`,a={};if(!r.hasOwnProperty(i))return!1;a=r[i];var o={type:"location",id:t,timestamp:(new Date).getTime(),name:a.n};return yield Vn(e,o)})).apply(this,arguments)}function sr(){return(sr=(0,r.A)(function*(e,t,n,r){var i=`f_${e}`,a=`${t}_${n}`,o=Jn(e);if("boolean"==typeof o&&!1===o)return!1;var s=yield b(12,i);if(!s)return!1;var u=JSON.parse(s),l=u.indexOf(a);if(l>-1&&u.length>1){var c=0;switch(r){case"up":c=-1;break;case"down":c=1;break;default:c=0}return u.splice(l,1),u.splice(l+c,0,a),yield y(12,i,JSON.stringify(u)),!0}return!1})).apply(this,arguments)}var ur=n(4668);function lr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return cr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var dr={},fr=!1;function pr(){return(pr=(0,r.A)(function*(){if(!fr){var e=Zf(),t=yield xn(e);ie(e);var n=t.dictionary.split(","),r=t.symbols,i=[],a={},o=0;for(var s in r){i.push(s);var u,l=lr(r[s]);try{for(l.s();!(u=l.n()).done;){var c=`w${u.value}`;a.hasOwnProperty(c)||(a[c]=[]),a[c].push(o)}}catch(e){l.e(e)}finally{l.f()}o++}dr={dictionary:n,names:i,wordToSymbols:a},fr=!0}})).apply(this,arguments)}var vr="downloadData",hr=!1,mr=U(N("._c"),".ed"),yr=U(mr,".hd"),gr=U(yr,'svg#download-svg path[progress="progress"]');function br(e){var t=e,n=189*(1-re(vr));gr.style.setProperty("--ad",`${n}px`),"end"===t.detail.stage&&(document.removeEventListener(t.detail.target,br),gr.addEventListener("transitionend",function(){yr.setAttribute("complete","true")},{once:!0}),gr.style.setProperty("--ad","0px"),hr=!0)}function Ar(){return(Ar=(0,r.A)(function*(){ne(vr,"getLocation_0",0,!1),ne(vr,"getLocation_1",0,!1),ne(vr,"getCarInfo_0",0,!1),ne(vr,"getCarInfo_1",0,!1),ne(vr,"getMaterialSymbolsSearchIndex",0,!1),document.addEventListener(vr,br),yield ct(vr,!0),yield De(vr,1),yield _e(vr,!0),yield xn(vr),ie(vr),le(vr)})).apply(this,arguments)}function wr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Sr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _r="",kr=N(".bo"),$r=N(".xo"),Ir=N(".kp");function Tr(e){var t=document.createElement("div");return t.classList.add("rp"),t.onclick=function(){!function(e){var t;switch(_r){case"editor":t=U(kr,'.fo .go .ho[group="folder-icon"] .lo .mo input');break;case"creator":t=U($r,'.bp .cp .dp[group="folder-icon"] .hp .ip input')}t.value=e,xr()}(e)},t.appendChild(Nt(e)),{element:t,id:""}}function Er(){return(Er=(0,r.A)(function*(){var e=U(Ir,".op .pp");e.innerHTML="";var t=Zf(),n=yield xn(t);ie(t);var r=new DocumentFragment;for(var i in n.symbols){var a=Tr(i);r.appendChild(a.element)}e.append(r)})).apply(this,arguments)}function Cr(e){var t=U(Ir,".op .qp"),n=U(Ir,".op .pp");if(!rt(e)){var r,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3;if(!fr)return[];for(var i=dr,a=i.dictionary,o=i.names,s=i.wordToSymbols,u=Math.round(o.length*r),l=Array.from(new Set(e.trim().toLowerCase().split(/[\s_-]+/))),c=l.length,d=new Uint8Array(c),f=new Int16Array(c).fill(-1),p=t;p<c;p++){d[p]=l[p].length;for(var v=0,h=a.length;v<h;v++){var m=ur(l[p],a[v]);m<=d[p]&&(d[p]=m,f[p]=v)}}for(var y=[],g=c-1;g>=0;g--)if(!(f[g]<0)){var b=s[`w${f[g]}`]||[];n&&b.length>u||y.push(b)}var A=y.length;if(0===A)return[];y.sort(function(e,t){return e.length-t.length});for(var w=y[0],S=1;S<A;S++)w=tt(w,y[S]);for(var _=[],k=0,$=w.length;k<$;k++){for(var I=0,T=c-1;T>=0;T--)f[T]<0||(s[`w${f[T]}`]||[]).indexOf(w[k])>-1&&(I-=T);_.push({item:o[w[k]],score:I})}return _.sort(function(e,t){return t.score-e.score}),_}(e),a=new DocumentFragment,o=wr(i);try{for(o.s();!(r=o.n()).done;){var s=Tr(r.value.item);a.appendChild(s.element)}}catch(e){o.e(e)}finally{o.f()}t.innerHTML="",t.append(a),t.setAttribute("displayed",i.length>0?"true":"false"),n.setAttribute("displayed",i.length>0?"false":"true")}}function Lr(e){switch(gd("FolderIconSelector"),e){case"editor":_r="editor",U(kr,'.fo .go .ho[group="folder-icon"] .lo .mo .no');break;case"creator":_r="creator",U($r,'.bp .cp .dp[group="folder-icon"] .hp .ip .jp')}hr?(Ir.setAttribute("displayed","true"),function(){Er.apply(this,arguments)}(_r),function(){pr.apply(this,arguments)}()):Wf("download_for_offline","資料還在下載中")}function xr(){bd("FolderIconSelector"),Ir.setAttribute("displayed","false")}var Mr=N(".xo"),Or=U(Mr,".bp"),Dr=U(Or,".cp"),jr=U(Dr,'.dp[group="folder-name"] .hp input'),Pr=U(Dr,'.dp[group="folder-icon"] .hp .ip input');function Nr(){gd("FolderCreator"),Mr.setAttribute("displayed","true"),Ad()}function Rr(){Mr.setAttribute("displayed","false"),wd()}function Ur(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Br(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Br(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}U(Dr,'.xo .bp .cp .dp[group="folder-icon"] .hp .ip .jp').onclick=function(){Lr("creator")};var Jr=N(".bo"),Fr=U(Jr,".co"),qr=U(Fr,".do"),Hr=U(Jr,".fo"),zr=U(Hr,".go"),Qr=U(zr,'.ho[group="folder-name"] .lo input'),Wr=U(zr,'.ho[group="folder-icon"] .lo .mo input'),Yr=U(zr,'.ho[group="folder-icon"] .lo .mo .no'),Gr=U(zr,'.ho[group="folder-content"] .lo');function Vr(e,t){var n=Zf(),r=document.createElement("div");r.id=n,r.classList.add("oo"),r.setAttribute("type",t.type);var i="",a="",o="";switch(t.type){case"stop":o="location_on",i=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`,a=t.name;break;case"route":o="route",i=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`,a=t.name;break;case"location":o="location_on",i="地點",a=t.name;break;case"bus":i="",a=t.name;break;case"empty":o="lightbulb",i="提示",a="沒有內容";break;default:o="",i="null",a="null"}var s=document.createElement("div");s.classList.add("po"),s.appendChild(Nt(o));var u=document.createElement("div");u.classList.add("qo"),u.appendChild(document.createTextNode(i));var l=document.createElement("div");l.classList.add("ro"),l.appendChild(document.createTextNode(a));var c=document.createElement("div");c.classList.add("so");var d=document.createElement("div");d.classList.add("to"),d.appendChild(Nt("keyboard_arrow_down")),d.onclick=function(){ti(n,e.id,t.type,t.id,"up")};var f=document.createElement("div");f.classList.add("uo"),f.appendChild(Nt("keyboard_arrow_down")),f.onclick=function(){ti(n,e.id,t.type,t.id,"down")};var p=document.createElement("div");p.classList.add("vo"),p.appendChild(Nt("delete")),p.onclick=function(){!function(e,t,n,r){var i=U(Jr,`.fo .go .ho[group="folder-content"] .lo .oo#${e}`);(function(e,t,n){return er.apply(this,arguments)})(t,n,r).then(function(e){if(e)switch(i.remove(),n){case"stop":Wf("delete","已移除站牌");break;case"route":Wf("delete","已移除路線");break;case"location":Wf("delete","已移除地點")}else Wf("error","無法移除")})}(n,e.id,t.type,t.id)};var v=document.createElement("div");v.classList.add("wo");var h=document.createElement("div");return h.classList.add("wo"),c.appendChild(d),c.appendChild(f),c.appendChild(p),c.appendChild(v),c.appendChild(h),r.appendChild(s),r.appendChild(u),r.appendChild(l),r.appendChild(c),{element:r,id:n}}function Zr(e,t){Qr.value=e.name,Wr.value=e.icon,qr.onclick=function(){var t,n,r;t=e.id,n=Qr.value,r=Wr.value,Un(t,n,r).then(function(e){e?(ei(),Wf("check_circle","已儲存變更")):Wf("error","無法儲存")})},Gr.innerHTML="";var n,r=new DocumentFragment,i=Ur(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=Vr(e,a);r.appendChild(o.element)}}catch(e){i.e(e)}finally{i.f()}Gr.append(r)}function Kr(){return(Kr=(0,r.A)(function*(e){Zr(Jn(e),yield Fn(e))})).apply(this,arguments)}function Xr(e){gd("FolderEditor"),Jr.setAttribute("displayed","true"),function(e){Kr.apply(this,arguments)}(e),Ad()}function ei(){Jr.setAttribute("displayed","false"),wd()}function ti(e,t,n,r,i){var a=U(Jr,`.fo .go .ho[group="folder-content"] .lo .oo#${e}`);(function(e,t,n,r){return sr.apply(this,arguments)})(t,n,r,i).then(function(e){if(e)switch(i){case"up":var t=a.previousElementSibling;t&&a.parentNode.insertBefore(a,t),Wf("arrow_circle_up","已往上移");break;case"down":var n=a.nextElementSibling;n&&a.parentNode.insertBefore(n,a),Wf("arrow_circle_down","已往下移")}else Wf("error","無法移動")})}function ni(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ri(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ri(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ri(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Yr.onclick=function(){Lr("editor")};var ii=N(".qn"),ai=U(ii,".vn"),oi=U(ai,".wn");function si(e){var t=document.createElement("div");t.classList.add("xn"),t.onclick=function(){Xr(e.id)};var n=document.createElement("div");n.classList.add("yn"),n.appendChild(Nt(e.icon));var r=document.createElement("div");r.classList.add("zn"),r.appendChild(document.createTextNode(e.name));var i=document.createElement("div");i.classList.add("_n"),i.appendChild(document.createTextNode(String(e.contentLength)));var a=document.createElement("div");return a.classList.add("ao"),a.appendChild(Nt("arrow_forward_ios")),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(a),{element:t,id:""}}function ui(){return(ui=(0,r.A)(function*(){var e=yield Qn();oi.innerHTML="";var t,n=new DocumentFragment,r=ni(e);try{for(r.s();!(t=r.n()).done;){var i=si(t.value);n.appendChild(i.element)}}catch(e){r.e(e)}finally{r.f()}oi.append(n)})).apply(this,arguments)}function li(){gd("FolderManager"),ii.setAttribute("displayed","true"),function(){ui.apply(this,arguments)}()}function ci(){bd("FolderManager"),ii.setAttribute("displayed","false")}function di(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return fi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fi(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function fi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function pi(e,t,n,r,i,a){return vi.apply(this,arguments)}function vi(){return(vi=(0,r.A)(function*(e,t,n,r,i,a){var o=Zf();if(t<0||t>23||n<0||n>59||r<0||r>23||i<0||i>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(n)&&Number.isInteger(r)&&Number.isInteger(i)))return!1;if(a.length>7)return!1;var s,u=di(a);try{for(u.s();!(s=u.n()).done;){var l=s.value;if("number"==typeof l&&(l<0||l>6||!Number.isInteger(l)))return!1}}catch(e){u.e(e)}finally{u.f()}var c={name:e,period:{start:{hours:t,minutes:n},end:{hours:r,minutes:i}},days:a,id:o};return yield y(7,o,JSON.stringify(c)),!0})).apply(this,arguments)}function hi(e){return mi.apply(this,arguments)}function mi(){return(mi=(0,r.A)(function*(e){var t=yield b(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function yi(e){return gi.apply(this,arguments)}function gi(){return(gi=(0,r.A)(function*(e){(yield hi(e.id))&&(yield y(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function bi(){return Ai.apply(this,arguments)}function Ai(){return(Ai=(0,r.A)(function*(){var e,t=[],n=di(yield _(7));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(7,r);if(i){var a=JSON.parse(i);t.push(a)}}}catch(e){n.e(e)}finally{n.f()}return t.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),t.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),t})).apply(this,arguments)}function wi(){return(wi=(0,r.A)(function*(){var e,t={},n=di(yield bi());try{for(n.s();!(e=n.n()).done;){var r,i=e.value,a=di(i.days);try{for(a.s();!(r=a.n()).done;){var o=`d_${r.value}`;t.hasOwnProperty(o)||(t[o]=[]);var s={start:i.period.start,end:i.period.end};t[o].push(s)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}for(var u in t){for(var l=t[u],c=l.length,d=[],f=0;f<c;f++){var p=l[f-1]||l[f],v=l[f];0===d.length?d.push(v):60*v.start.hours+v.start.minutes>=60*p.start.hours+p.start.minutes&&60*v.start.hours+v.start.minutes<=60*p.end.hours+p.end.minutes?(d[d.length-1].end.hours=v.end.hours,d[d.length-1].end.minutes=v.end.minutes):d.push(v)}t[u]=d}return t})).apply(this,arguments)}function Si(){return Si=(0,r.A)(function*(e){var t=yield function(){return wi.apply(this,arguments)}(),n=`d_${e.getDay()}`,r=e.getHours(),i=e.getMinutes();if(t.hasOwnProperty(n)){var a,o=di(t[n]);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(60*r+i>=60*s.start.hours+s.start.minutes&&60*r+i<=60*s.end.hours+s.end.minutes)return!0}}catch(e){o.e(e)}finally{o.f()}}return!1}),Si.apply(this,arguments)}var _i=N(".oq"),ki=U(_i,".tq"),$i=U(_i,".pq"),Ii=U($i,".qq"),Ti=U(ki,".uq"),Ei=U(Ti,'.vq[group="schedule-name"] .zq input'),Ci=U(Ti,'.vq[group="schedule-start-time"] .zq input'),Li=U(Ti,'.vq[group="schedule-end-time"] .zq input'),xi=U(Ti,'.vq[group="schedule-days"] .zq'),Mi=B(xi,"._q");function Oi(e){return Di.apply(this,arguments)}function Di(){return(Di=(0,r.A)(function*(e){for(var t=Ei.value,n=Ci.value,r=Li.value,a=String(n).split(":").map(function(e){return parseInt(e)}),o=(0,i.A)(a,2),s=o[0],u=o[1],l=String(r).split(":").map(function(e){return parseInt(e)}),c=(0,i.A)(l,2),d=c[0],f=c[1],p=[],v=0;v<7;v++){var h=Mi[v],m=h.getAttribute("highlighted"),y=parseInt(h.getAttribute("day"));"true"===m&&p.push(y)}var g=yield hi(e);g.name=t,g.days=p,g.period.start.hours=s,g.period.start.minutes=u,g.period.end.hours=d,g.period.end.minutes=f,yield yi(g),Ni()})).apply(this,arguments)}function ji(){return(ji=(0,r.A)(function*(e){var t=yield hi(e);Ei.value=t.name,Ci.value=f(t.period.start),Li.value=f(t.period.end);for(var n=0;n<7;n++){var r=Mi[n];t.days.indexOf(n)>-1?r.setAttribute("highlighted","true"):r.setAttribute("highlighted","false")}Ii.onclick=function(){Oi(e)}})).apply(this,arguments)}function Pi(e){gd("PersonalScheduleEditor"),_i.setAttribute("displayed","true"),function(e){ji.apply(this,arguments)}(e),Ad()}function Ni(){_i.setAttribute("displayed","false"),wd()}function Ri(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ui(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ui(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Bi=N(".sp"),Ji=U(Bi,".xp"),Fi=U(Ji,".yp");function qi(e){var t=document.createElement("div");t.classList.add("zp"),t.onclick=function(){Pi(e.id)};var n=document.createElement("div");n.classList.add("_p"),n.appendChild(document.createTextNode(e.name)),t.appendChild(n);var r=document.createElement("div");r.classList.add("aq");var i=document.createElement("span");return i.appendChild(Nt("arrow_forward_ios")),r.appendChild(i),t.appendChild(r),{element:t,id:""}}function Hi(){return(Hi=(0,r.A)(function*(){Fi.innerHTML="";var e,t=yield bi(),n=new DocumentFragment,r=Ri(t);try{for(r.s();!(e=r.n()).done;){var i=qi(e.value);n.appendChild(i.element)}}catch(e){r.e(e)}finally{r.f()}Fi.append(n)})).apply(this,arguments)}function zi(){gd("PersonalScheduleManager"),Bi.setAttribute("displayed","true"),function(){Hi.apply(this,arguments)}()}function Qi(){bd("PersonalScheduleManager"),Bi.setAttribute("displayed","false")}function Wi(e){if(""===na)return!1;var t=new URL(na);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}function Yi(e,t,n){var r=(new Date).getTime();return Gf(Gf(`${e}\n${t}\n${(r-r%5e3)/5e3}\n${Gf(`${e}\n${t}\n${Gf(JSON.stringify(n))}`)}`))}function Gi(e,t){switch(e){case"cancel":return""!==ra&&""!==ia&&1===t.length&&{client_id:ra,token:Yi(ra,ia,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var n=new Date;return n.setMilliseconds(0),n.setSeconds(0),{hash:Gf(`${Gf(t[0])}${n.getTime()}`)};case"schedule":return""!==ra&&""!==ia&&9===t.length&&{client_id:ra,token:Yi(ra,ia,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==ra&&""!==ia&&0===t.length&&{client_id:ra,token:Yi(ra,ia,{})};case"reschedule":return""!==ra&&""!==ia&&3===t.length&&{client_id:ra,token:Yi(ra,ia,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}function Vi(e,t,n){return Zi.apply(this,arguments)}function Zi(){return(Zi=(0,r.A)(function*(e,t,n){try{if(!1===t||!1===n)return!1;var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"omit"},i=yield fetch(t,r);if(!i.ok){yield i.text();return!1}try{var a=yield i.text(),o=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}})).apply(this,arguments)}function Ki(){return(Ki=(0,r.A)(function*(){if(""===ra||""===ia)return!1;var e=Wi("rotate"),t=Gi("rotate",[]),n=yield Vi("rotate",e,t);return!1!==n&&(200===n.code&&"rotate"===n.method&&(fa(n.secret),yield ua(),!0))})).apply(this,arguments)}function Xi(){return Xi=(0,r.A)(function*(e,t,n,r,i,o,s,u,l){if(""===ra||""===ia||void 0===e||void 0===t||void 0===n||void 0===r||void 0===i||void 0===o||"number"!=typeof s||void 0===l)return!1;var c=new Date;switch((0,a.A)(l)){case"string":case"number":c=new Date(l);break;default:if(!(l instanceof Date))return!1;c=l}var d=Wi("schedule"),f=Gi("schedule",[e,t,n,r,i,o,s,u,c.toISOString()]),p=yield Vi("schedule",d,f);return!1!==p&&(200===p.code&&"schedule"===p.method&&(Math.random()>.8&&(yield function(){return Ki.apply(this,arguments)}()),yield function(e,t,n,r,i,a,o,s,u,l){return va.apply(this,arguments)}(p.schedule_id,e,t,n,r,i,o,s,u,c.getTime()),p.schedule_id))}),Xi.apply(this,arguments)}function ea(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ta(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ta(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ta(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var na="",ra="",ia="",aa=[],oa={},sa={};function ua(){return la.apply(this,arguments)}function la(){return(la=(0,r.A)(function*(){var e={provider:na,client_id:ra,secret:ia};yield y(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function ca(){return(ca=(0,r.A)(function*(){var e=yield b(9,"n_client");if(e){var t=JSON.parse(e);na=t.provider,ra=t.client_id,ia=t.secret}})).apply(this,arguments)}function da(){return""!==ra&&""!==ia}function fa(e){void 0!==e&&(ia=String(e))}function pa(){return(pa=(0,r.A)(function*(){(new Date).getTime();var e,t=0,n=ea(yield _(10));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(10,r),a=JSON.parse(i),o=a.schedule_id,s=`s_${a.stop_id}`;aa.push(a),oa[o]=t,sa.hasOwnProperty(s)||(sa[s]=[]),sa[s].push(t),t+=1}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function va(){return(va=(0,r.A)(function*(e,t,n,r,i,a,o,s,u,l){var c={schedule_id:e,stop_id:t,location_name:n,route_id:r,route_name:i,direction:a,estimate_time:o,time_formatting_mode:s,time_offset:u,scheduled_time:l},d=`s_${t}`,f=aa.length;aa.push(c),oa[e]=f,sa.hasOwnProperty(d)||(sa[d]=[]),sa[d].push(f),yield y(10,e,JSON.stringify(c))})).apply(this,arguments)}function ha(){return(ha=(0,r.A)(function*(e){if(oa.hasOwnProperty(e)){var t=oa[e],n=`s_${aa[t].stop_id}`;aa.splice(t,1,null),sa[n].splice(sa[n].indexOf(t),1),delete oa[e],yield w(10,e)}})).apply(this,arguments)}function ma(e){var t=(new Date).getTime(),n=`s_${e}`;if(sa.hasOwnProperty(n)){var r,i=ea(sa[n]);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=aa[a];if(null!==o)if(o.scheduled_time>t)return!0}}catch(e){i.e(e)}finally{i.f()}}return!1}function ya(){return(ya=(0,r.A)(function*(){var e=(new Date).getTime();for(var t in oa){var n=oa[t],r=aa[n];if(r.scheduled_time<=e){var i=`s_${r.stop_id}`;aa.splice(n,1,null),sa[i].splice(sa[i].indexOf(n),1),delete oa[t],yield w(10,t)}}})).apply(this,arguments)}function ga(e){return ba.apply(this,arguments)}function ba(){return(ba=(0,r.A)(function*(e){var t,n=yield ct(e,!0),r=function(){var e,t=(new Date).getTime(),n=[],r=ea(aa);try{for(r.s();!(e=r.n()).done;){var i=e.value;null!==i&&i.scheduled_time>t&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}(),i=(new Date).getTime(),a=[],o=ea(r);try{for(o.s();!(t=o.n()).done;){var s=t.value,u={},l=s.location_name;u.name=l;var c=s.stop_id;u.stop_id=c;var d=s.estimate_time;u.estimate_time=d;var f=s.schedule_id;u.schedule_id=f;var p=s.scheduled_time;u.scheduled_time=p;var v=new Date(p),h=v.getDate(),m=v.getHours(),y=v.getMinutes();u.date=String(h).padStart(2,"0"),u.hours=String(m).padStart(2,"0"),u.minutes=String(y).padStart(2,"0"),u.route={};var g=s.route_name;u.route.name=g;var b=s.route_id;u.route.id=b;var A=s.direction;u.route.direction=A;var w=`r_${s.route_id}`;if(n.hasOwnProperty(w)){var S=n[w].pid;u.route.pathAttributeId=S,a.push(u)}}}catch(e){o.e(e)}finally{o.f()}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});for(var _=[],k=0,$={},I=0,T=a;I<T.length;I++){var E=T[I],C=`g_${E.date}_${E.hours}`;$.hasOwnProperty(C)?E.is_first=!1:($[C]=!0,E.is_first=!0),_.push(E),k+=1}var L={items:_,itemQuantity:k,dataUpdateTime:Math.max(ue(e),i)};return le(e),ie(e),L})).apply(this,arguments)}var Aa=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function wa(e,t,n,r){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,r.A)(function*(e,t,n,r){if(da()){var i=Hf("time_formatting_mode"),a=Zf(),o=yield Fe(a),s=yield De(a,0),u=yield ct(a,!0);ie(a),le(a);var l=`s_${e}`,c={};if(!o.hasOwnProperty(l))return 0;var d=(c=o[l]).stopLocationId,f=c.goBack,p=`l_${d}`;if(!s.hasOwnProperty(p))return 0;var v=s[p].n,h=`r_${t}`,m={};if(!u.hasOwnProperty(h))return 0;var y=(m=u[h]).n,g=m.dep,b=[m.des,g,""][f?parseInt(f):0],A=Aa[r].time_offset,w=(new Date).getTime()+1e3*n+60*A*1e3,S=yield function(e,t,n,r,i,a,o,s,u){return Xi.apply(this,arguments)}(e,v,t,y,b,n,i,A,w);return!1===S?0:1}return 2}),Sa.apply(this,arguments)}function _a(){return(_a=(0,r.A)(function*(e){if(!e)return!1;var t,n=Wi("register"),r=Gi("register",[e]),i=yield Vi("register",n,r);return!1!==i&&(200===i.code&&"register"===i.method&&(void 0!==(t=i.client_id)&&(ra=String(t)),fa(i.secret),yield ua(),!0))})).apply(this,arguments)}var ka=N(".tr"),$a=U(ka,".yr"),Ia=U($a,".zr"),Ta=U(Ia,'._r[group="provider"] .ds input'),Ea=U(Ia,'._r[group="registration-key"] .ds input');function Ca(){Ta.value=String(na),Ea.value=""}function La(){gd("RegisterNotification"),ka.setAttribute("displayed","true"),Ca(),Ad()}function xa(){ka.setAttribute("displayed","false"),wd()}function Ma(){return Ma=(0,r.A)(function*(){Wf("manufacturing","處理中");var e=Ta.value,t=Ea.value;if(np(e)){!function(e){if(!np(e))throw new Error("The provider is not valid.");var t=new URL(e);na=`${t.protocol}//${t.hostname}`}(e);var n=yield function(e){return _a.apply(this,arguments)}(t);return n?void Wf("check_circle","註冊成功"):void Wf("error","註冊失敗")}Wf("error","無效的提供者")}),Ma.apply(this,arguments)}function Oa(e,t,n,r){var i=(Oa.canvas||(Oa.canvas=document.createElement("canvas"))).getContext("2d"),a=`${t} ${n} ${r}`;return i.font=a,i.measureText(e).width}function Da(e,t,n,r,i,a,o){a="number"==typeof a?{tl:a,tr:a,br:a,bl:a}:{tl:a.tl||0,tr:a.tr||0,br:a.br||0,bl:a.bl||0},e.beginPath(),e.moveTo(t+a.tl,n),e.lineTo(t+r-a.tr,n),e.quadraticCurveTo(t+r,n,t+r,n+a.tr),e.lineTo(t+r,n+i-a.br),e.quadraticCurveTo(t+r,n+i,t+r-a.br,n+i),e.lineTo(t+a.bl,n+i),e.quadraticCurveTo(t,n+i,t,n+i-a.bl),e.lineTo(t,n+a.tl),e.quadraticCurveTo(t,n,t+a.tl,n),e.closePath(),e.fillStyle=o,e.fill()}function ja(e,t,n,r,i,a){var o=i="number"==typeof i?{tl:i,tr:i,br:i,bl:i}:{tl:i.tl||0,tr:i.tr||0,br:i.br||0,bl:i.bl||0},s=o.tl,u=o.tr,l=o.br,c=o.bl,d=[];return a?(0!==s&&d.push(`M${e} ${t+s}`,`Q${e} ${t} ${e+s} ${t}`,`H${e}`,`V${t+s}`),0!==u&&d.push(`M${e+n-u} ${t}`,`Q${e+n} ${t} ${e+n} ${t+u}`,`V${t}`,"H"+(e+n-u)),0!==l&&d.push(`M${e+n} ${t+r-l}`,`Q${e+n} ${t+r} ${e+n-l} ${t+r}`,`H${e+n}`,"V"+(t+r-l)),0!==c&&d.push(`M${e+c} ${t+r}`,`Q${e} ${t+r} ${e} ${t+r-c}`,`V${t+r}`,`H${e+c}`)):d.push(`M${e+s} ${t}`,"H"+(e+n-u),`Q${e+n} ${t} ${e+n} ${t+u}`,"V"+(t+r-l),`Q${e+n} ${t+r} ${e+n-l} ${t+r}`,`H${e+c}`,`Q${e} ${t+r} ${e} ${t+r-c}`,`V${t+s}`,`Q${e} ${t} ${e+s} ${t}`),d}var Pa={light:{},dark:{}};function Na(e){var t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(Pa[t].hasOwnProperty(e))return Pa[t][e];var n=getComputedStyle(document.documentElement).getPropertyValue(e);return Pa[t][e]=n,n}function Ra(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ua(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ua(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ua(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ba(e){for(var t=[],n=0;n<e;n++)t.push(`地點${P(n+1)}`);return t}function Ja(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Fa(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fa(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function qa(e){return`${e.city.join("")}${e.district.join("")}${e.road.join("、")}${e.road_section.sort(function(e,t){return e-t}).length>0?e.road_section.join("、")+"段":""}${e.alley.length>0?e.alley.sort(function(e,t){return e-t}).join("、")+"巷":""}${e.alley_branch.length>0?e.alley_branch.sort(function(e,t){return e-t}).join("、")+"弄":""}${e.doorplate.length>0?e.doorplate.sort(function(e,t){return e-t}).join("、")+"號":""}${e.floornumber.length>0?e.floornumber.join("、")+"樓":""}${e.direction.length>0?"（朝"+e.direction.join("、")+"）":""}`}var Ha={vector:[0,0],id:-1,name:"未知",symbol:"?",icon:"explore"},za={vector:[0,1],id:0,name:"北",symbol:"↑",icon:"north"},Qa={vector:[1,0],id:1,name:"東",symbol:"→",icon:"east"},Wa={vector:[0,-1],id:2,name:"南",symbol:"↓",icon:"south"},Ya={vector:[-1,0],id:3,name:"西",symbol:"←",icon:"west"},Ga={vector:[Math.SQRT1_2,Math.SQRT1_2],id:4,name:"東北",symbol:"↗",icon:"north_east"},Va={vector:[Math.SQRT1_2,-Math.SQRT1_2],id:5,name:"東南",symbol:"↘",icon:"south_east"},Za={vector:[-Math.SQRT1_2,-Math.SQRT1_2],id:6,name:"西南",symbol:"↙",icon:"south_west"},Ka={vector:[-Math.SQRT1_2,Math.SQRT1_2],id:7,name:"西北",symbol:"↖",icon:"north_west"};function Xa(e){for(var t=[Ha,za,Ya,Wa,Qa,Ga,Va,Za,Ka],n=en(e),r=-1/0,i=t[0],a=0,o=t;a<o.length;a++){var s=o[a],u=s.vector[0]*n[0]+s.vector[1]*n[1];u>r&&(r=u,i=s)}return i}var eo={current:-1,permission:{gained:!1,asked:!1},id:0};function to(){var e=eo.current;if(-1===e)return{degree:-1,cardinalDirection:Ha};var t=e+90;return t>360&&(t-=360),t*=Math.PI/180,{degree:e,cardinalDirection:Xa([Math.cos(t),Math.sin(t)])}}function no(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ro(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ro(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ro(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function io(e,t){var n={},r=[];for(var i in e){var a=e[i],o=a.StopID,s=parseInt(a.EstimateTime);s>=0&&t.indexOf(o)>-1&&r.push([o,s])}var u=r.length;r.sort(function(e,t){return e[1]-t[1]});for(var l=1,c=0,d=r;c<d.length;c++){var f=l/u,p=(f-f%.25)/.25;n[`s_${d[c][0]}`]={number:l,text:l.toString(),code:p},l+=1}return n}function ao(){return ao=(0,r.A)(function*(e,t,n,r){ne(r,"getLocation_0",0,!1),ne(r,"getLocation_1",0,!1),ne(r,"getRoute_0",0,!1),ne(r,"getRoute_1",0,!1),ne(r,"getStop_0",0,!1),ne(r,"getStop_1",0,!1),ne(r,"getEstimateTime_0",0,!1),ne(r,"getEstimateTime_1",0,!1),ne(r,"getBusEvent_0",0,!1),ne(r,"getBusEvent_1",0,!1);for(var i=yield Tn(r),a=yield De(r,1),o=yield ct(r,!0),s=yield Fe(r),u=yield me(r),l=yield fe(r),c=yield kp(t,n),d=Hf("time_formatting_mode"),f=Hf("location_labels"),p=Hf("display_user_orientation"),v={},h={},m={},y=to(),g=a[`ml_${e}`],b=g.n,A=g.id,w=g.v,S=[],_=[],k=A.length,$=0;$<k;$++)S=S.concat(g.s[$]),_=_.concat(g.r[$]);var I,T=function(e,t){var n,r={},i=no(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;t.indexOf(a.StopID)>-1&&(r[`s_${a.StopID}`]=a)}}catch(e){i.e(e)}finally{i.f()}return r}(i,S),E=function(e,t,n,r){var i,a={},o={},s=He(t);try{for(s.s();!(i=s.n()).done;){var u=i.value;o[u.BusID]=u}}catch(e){s.e(e)}finally{s.f()}var l,c=He(e);try{for(c.s();!(l=c.n()).done;){var d=l.value,f={},p=parseInt(d.StopID),v=parseInt(d.RouteID),h=String(d.BusID);if(!(r.indexOf(p)<0)){f.index=h.charCodeAt(0),f.onThisRoute=!0,f.CarType=d.CarType,f.BusStatus=d.BusStatus,f.BusID=d.BusID,f.CarOnStop=d.CarOnStop;var m={};if(o.hasOwnProperty(h)){m=o[h],f.position={latitude:parseFloat(m.Latitude),longitude:parseFloat(m.Longitude)};var y={},g=!1;for(var b in n){var A=n[b];if(A.pid.indexOf(v)>-1){y=A,g=!0;break}}f.RouteName=g?y.n:"未知路線",f.RouteID=g?y.id:null;var w=`s_${p}`;a.hasOwnProperty(w)||(a[w]=[]),a[w].push(f)}}}}catch(e){c.e(e)}finally{c.f()}return a}(u,l,o,S),C=[],L=no(w);try{for(L.s();!(I=L.n()).done;){var x,M=I.value,O=0,D=0,j=no(M);try{for(j.s();!(x=j.n()).done;){var P=x.value;O+=P[0],D+=P[1]}}catch(e){j.e(e)}finally{j.f()}var N=Xa(en([O,D]));C.push(N)}}catch(e){L.e(e)}finally{L.f()}var R=[];switch(f){case"address":R=function(e){var t,n=[],r={},i=Ja(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;for(var o in a)r.hasOwnProperty(o)||(r[o]=0),a[o].length>0&&(r[o]=r[o]+1)}}catch(e){i.e(e)}finally{i.f()}var s=Object.entries(r).map(function(e){return{key:e[0],value:e[1]}}).filter(function(t){return t.value===e.length}).sort(function(e,t){return e.value-t.value});if(s.length>0){var u,l=Ja(s);try{for(l.s();!(u=l.n()).done;){var c,d=u.value,f=[],p=-1/0,v=Ja(e);try{for(v.s();!(c=v.n()).done;){var h=c.value[d.key].join("");f.push(h);var m=h.length;m>p&&(p=m)}}catch(e){v.e(e)}finally{v.f()}et(f)&&n.push({components:f,len:p})}}catch(e){l.e(e)}finally{l.f()}}return n.length>0?(n.sort(function(e,t){return e.len-t.len}),n[0].components):Ba(e.length)}(g.a);break;case"letters":R=Ba(k);break;case"directions":R=function(e){var t,n=[],r=Ra(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(`向${i.name}${i.symbol}`)}}catch(e){r.e(e)}finally{r.f()}return n}(C)}for(var U=0;U<k;U++){var B=`g_${U}`;v[B]=[],h[B]=0,m[B]={name:R[U],properties:[{key:"address",icon:"personal_places",value:qa(g.a[U])},{key:"exact_position",icon:"location_on",value:`${g.la[U].toFixed(5)}, ${g.lo[U].toFixed(5)}`},{key:"cardinal_direction",icon:C[U].icon,value:`${C[U].name}${p&&-1!==y.cardinalDirection.id&&y.cardinalDirection.id===C[U].id?"（目前指向）":""}`}]};for(var J=g.s[U],F=J.length,q=io(T,J),H=0;H<F;H++){var z={},Q=g.s[U][H],W=`s_${Q}`,Y={};if(s.hasOwnProperty(W)){Y=s[W],z.stopId=Q;var G={number:0,text:"--",code:-1};q.hasOwnProperty(W)&&(G=q[W]),z.ranking=G;var V=g.r[U][H],Z=`r_${V}`,K={};if(o.hasOwnProperty(Z)){K=o[Z],z.route_name=K.n,z.route_direction=`往${[K.des,K.dep,""][parseInt(Y.goBack)]}`,z.routeId=V;if(T.hasOwnProperty(W)){var X=Qe(T[W].EstimateTime,d);z.status=X;var ee=[];E.hasOwnProperty(W)&&(ee=E[W].map(function(e){return Ze(e)})),z.buses=ee;var te=[];c.hasOwnProperty(W)&&(te=c[W]),z.busArrivalTimes=te,v[B].push(z),h[B]+=1}}}}}for(var re in v)v[re].sort(function(e,t){return e.routeId-t.routeId});var ae={groupedItems:v,groups:m,groupQuantity:k,itemQuantity:h,LocationName:b,hash:e,dataUpdateTime:ue(r)};return ie(r),le(r),ae}),ao.apply(this,arguments)}function oo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return so(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?so(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function so(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var uo=N(".hn"),lo=U(uo,".ln"),co=U(lo,".mn"),fo="已儲存至資料夾",po="無法儲存";function vo(e,t,n){var r=document.createElement("div");r.classList.add("nn");var i=document.createElement("div");i.classList.add("on");var a=document.createElement("span");a.appendChild(Nt(e.icon)),i.appendChild(a);var o=document.createElement("div");switch(o.classList.add("pn"),o.appendChild(document.createTextNode(e.name)),t){case"stop-on-route":r.onclick=function(){!function(e,t,n,r){var i=N(`._e .tf .uf .vf .xf .ag#${e}`),a=U(i,'.hg .ig .jg[type="save-to-folder"]');tr(t,n,r).then(function(e){e?Kn("stop",n).then(function(e){e&&(a.setAttribute("highlighted",tp(e)),Wf("folder",fo),yo())}):Wf("warning",po)})}(n[0],e.id,n[1],n[2])};break;case"stop-on-location":r.onclick=function(){!function(e,t,n,r){var i=N(`.zi .sj .tj .ak .bk#${e}`),a=U(i,'.nk .ok .pk[type="save-to-folder"]');tr(t,n,r).then(function(e){e?Kn("stop",n).then(function(e){e&&(a.setAttribute("highlighted",tp(e)),Wf("folder",fo),yo())}):Wf("warning",po)})}(n[0],e.id,n[1],n[2])};break;case"route":r.onclick=function(){var t,r,i;t=e.id,r=n[0],i=N('.ci .hi .ii .ji[group="actions"] .ni .oi[action="save-to-folder"]'),rr(t,r).then(function(e){e?Kn("route",r).then(function(e){e&&(i.setAttribute("highlighted","true"),Wf("folder",fo),yo())}):Wf("warning",po)})};break;case"route-on-route":r.onclick=function(){var t,r;t=e.id,r=n[0],rr(t,r).then(function(e){e?Kn("route",r).then(function(e){e&&(Wf("folder",fo),yo())}):Wf("warning",po)})};break;case"location":case"location-on-route":r.onclick=function(){var t,r;t=e.id,r=n[0],ar(t,r).then(function(e){e?Kn("location",r).then(function(e){e&&(Wf("folder",fo),yo())}):Wf("warning",po)})}}return r.appendChild(i),r.appendChild(o),{element:r,id:""}}function ho(){return(ho=(0,r.A)(function*(e,t){var n=yield Qn();co.innerHTML="";var r,i=new DocumentFragment,a=oo(n);try{for(a.s();!(r=a.n()).done;){var o=vo(r.value,e,t);i.appendChild(o.element)}}catch(e){a.e(e)}finally{a.f()}co.append(i)})).apply(this,arguments)}function mo(e,t){gd("SaveToFolder"),uo.setAttribute("displayed","true"),function(e,t){ho.apply(this,arguments)}(e,t)}function yo(){bd("SaveToFolder"),uo.setAttribute("displayed","false")}function go(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return bo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ao=N(".es"),wo=U(Ao,".is"),So=U(wo,".js");function _o(e,t,n){var r=document.createElement("div");r.classList.add("ks");var i=document.createElement("div");i.classList.add("ls");var a=document.createElement("span");a.appendChild(Nt(e.icon)),i.appendChild(a);var o=document.createElement("div");switch(o.classList.add("ms"),o.appendChild(document.createTextNode(e.name)),t){case"stop-on-route":r.onclick=function(){!function(e,t,n,r,i){var a=N(`._e .tf .uf .vf .xf .ag#${e}`),o=U(a,'.hg .ig .jg[type="schedule-notification"]');Wf("manufacturing","處理中"),o.setAttribute("enabled","false"),$o(),wa(t,n,r,i).then(function(e){switch(e){case 0:Wf("error","設定失敗"),o.setAttribute("enabled","true");break;case 1:Wf("check_circle","設定成功"),o.setAttribute("enabled","true"),o.setAttribute("highlighted","true");break;case 2:Wf("warning","在設定中註冊後才可設定到站通知"),o.setAttribute("enabled","true")}})}(n[0],n[1],n[2],n[3],e.index)};break;case"stop-on-location":r.onclick=function(){!function(e,t,n,r,i){var a=N(`.zi .sj .tj .ak .bk#${e}`),o=U(a,'.nk .ok .pk[type="schedule-notification"]');Wf("manufacturing","處理中"),o.setAttribute("enabled","false"),$o(),wa(t,n,r,i).then(function(e){switch(e){case 0:Wf("error","設定失敗"),o.setAttribute("enabled","true");break;case 1:Wf("check_circle","設定成功"),o.setAttribute("enabled","true"),o.setAttribute("highlighted","true");break;case 2:Wf("warning","在設定中註冊後才可設定到站通知"),o.setAttribute("enabled","true")}})}(n[0],n[1],n[2],n[3],e.index)}}return r.appendChild(i),r.appendChild(o),{element:r,id:""}}function ko(e,t){gd("ScheduleNotification"),Ao.setAttribute("displayed","true"),function(e,t){So.innerHTML="";var n,r=new DocumentFragment,i=go(Aa);try{for(i.s();!(n=i.n()).done;){var a=_o(n.value,e,t);r.appendChild(a.element)}}catch(e){i.e(e)}finally{i.f()}So.append(r)}(e,t)}function $o(){bd("ScheduleNotification"),Ao.setAttribute("displayed","false")}function Io(){return Io=(0,r.A)(function*(e,t){var n=yield De(t,1);ie(t),le(t);var r=`ml_${e}`;if(!n.hasOwnProperty(r))return{actions:[],actionsQuantity:0,hash:e};n[r];var i=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){mo("location",[e])}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){!function(e){tl.apply(this,arguments)}(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){!function(e){nl.apply(this,arguments)}(e)}}];return{actions:i,actionsQuantity:i.length,hash:e}}),Io.apply(this,arguments)}function To(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Eo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Eo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Eo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Co=!1,Lo={};function xo(e){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(93),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function Oo(e){return Do.apply(this,arguments)}function Do(){return(Do=(0,r.A)(function*(e){var t=new Worker(new URL(n.p+n.u(897),n.b));return yield new Promise(function(n,r){t.onmessage=function(e){n(e.data),t.terminate()},t.onerror=function(e){r(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function jo(){return jo=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n="",r=To([[0,15],[1,15]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value;n+=(yield K(i.url,e,`getSegmentBuffers_${i.e[0]}`,"xml")),se(e,-1)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}var i="bus_segment_buffers_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t(),s=yield xo(o),u=yield Oo(s);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(u)),Co||(Co=!0,Lo=u),u}if((new Date).getTime()-parseInt(a)>2592e6){var l=yield t(),c=yield xo(l),d=yield Oo(c);return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(d)),d}if(!Co){var f=yield b(0,i);Co=!0,Lo=JSON.parse(f)}return ne(e,"getSegmentBuffers_0",0,!0),ne(e,"getSegmentBuffers_1",0,!0),se(e,-1),Lo}),jo.apply(this,arguments)}var Po={current:{latitude:0,longitude:0},permission:{gained:!1,asked:!1},id:0};function No(){!1===Po.permission.asked&&Hf("display_user_location")&&(Po.permission.asked=!0,Po.id=navigator.geolocation.watchPosition(function(e){Po.permission.gained=!0,Po.current.latitude=e.coords.latitude,Po.current.longitude=e.coords.longitude},function(e){},{enableHighAccuracy:!0,timeout:3e4,maximumAge:0}))}function Ro(){return Po.permission.asked&&Po.permission.gained?Po.current:Po.permission.asked||Po.permission.gained?Po.permission.asked&&!Po.permission.gained?Po.current:void 0:(No(),Po.current)}function Uo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Jo(){return Jo=(0,r.A)(function*(e,t,n,r,i){ne(i,"getRoute_0",0,!1),ne(i,"getRoute_1",0,!1),ne(i,"getStop_0",0,!1),ne(i,"getStop_1",0,!1),ne(i,"getLocation_0",0,!1),ne(i,"getLocation_1",0,!1),ne(i,"getSegmentBuffers_0",0,!1),ne(i,"getSegmentBuffers_1",0,!1),ne(i,"getEstimateTime_0",0,!1),ne(i,"getEstimateTime_1",0,!1),ne(i,"getBusEvent_0",0,!1),ne(i,"getBusEvent_1",0,!1),ne(i,"getBusData_0",0,!1),ne(i,"getBusData_1",0,!1);var a=yield ct(i,!0),o=yield Fe(i),s=yield De(i,0),u=yield De(i,1),l=yield De(i,2),c=yield function(e){return jo.apply(this,arguments)}(i),d=yield Tn(i),f=yield me(i),p=yield fe(i),v=yield kp(n,r),h=function(e,t,n,r,i){var a,o={},s={},u=He(t);try{for(u.s();!(a=u.n()).done;){var l=a.value;s[l.BusID]=l}}catch(e){u.e(e)}finally{u.f()}var c,d=He(e);try{for(d.s();!(c=d.n()).done;){var f=c.value,p={};p.CarType=f.CarType,p.BusStatus=f.BusStatus,p.BusID=f.BusID,p.CarOnStop=f.CarOnStop;var v=parseInt(f.RouteID),h=String(f.BusID),m=!1,y=0;v===r||i.indexOf(v)>-1||v===10*r?(m=!0,y=h.charCodeAt(0)*Math.pow(10,-5)):(m=!1,y=h.charCodeAt(0)),p.onThisRoute=m,p.index=y;var g={};if(s.hasOwnProperty(h)){g=s[h],p.position={latitude:parseFloat(g.Latitude),longitude:parseFloat(g.Longitude)};var b={},A=!1;for(var w in n){var S=n[w];if(S.pid.indexOf(v)>-1){b=S,A=!0;break}}p.RouteName=A?b.n:"未知路線",p.RouteID=A?b.id:null;var _=`s_${f.StopID}`;o.hasOwnProperty(_)||(o[_]=[]),o[_].push(p)}}}catch(e){d.e(e)}finally{d.f()}return o}(f,p,a,e,t),m=!1,y={};c.hasOwnProperty(`r_${e}`)&&(m=!0,y=c[`r_${e}`]);var g,b=Hf("time_formatting_mode"),A=[],w=[],S=Uo(d);try{for(S.s();!(g=S.n()).done;){var _=g.value,k={},$=_.RouteID;if([e,10*e].includes($)||t.includes($)){k.status=Qe(null==_?void 0:_.EstimateTime,b);var I=`s_${_.StopID}`,T={};if(!o.hasOwnProperty(I))continue;T=o[I],k.id=_.StopID,k.sequence=T.seqNo,k.goBack=T.goBack;var E=`l_${T.stopLocationId}`,C={};if(!s.hasOwnProperty(E))continue;C=s[E],k.name=C.n,k.overlappingRoutes=C.r.filter(function(t){return t!==e}).map(function(e){var t=`r_${e}`;if(a.hasOwnProperty(t)){var n=a[t];return{name:n.n,RouteEndPoints:{RouteDeparture:n.dep,RouteDestination:n.des,text:`${n.dep} ↔ ${n.des}`,html:`<span>${n.dep}</span><span>↔</span><span>${n.des}</span>`},RouteID:n.id,PathAttributeId:n.pid}}return null}).filter(function(e){return null!==e}),k.position={longitude:C.lo,latitude:C.la},w.push({latitude:C.la,longitude:C.lo,id:_.StopID});var L=C.g,x=[];l.hasOwnProperty(L)&&(x=l[L]);var M,O=[],j=Uo(x);try{for(j.s();!(M=j.n()).done;){var P=`ml_${M.value.hash}`;if(u.hasOwnProperty(P)){var N=u[P],R={name:N.n,distance:0|D(N.la[0],N.lo[0],C.la,C.lo),hash:N.hash};O.push(R)}}}catch(e){j.e(e)}finally{j.f()}O.sort(function(e,t){return e.distance-t.distance}),k.nearbyLocations=O;var U,B=[],J=Uo(C.s);try{for(J.s();!(U=J.n()).done;){var F=`s_${U.value}`;h.hasOwnProperty(F)&&B.push(h[F].map(function(e){return Ze(e)}))}}catch(e){J.e(e)}finally{J.f()}k.buses=B.flat().sort(function(e,t){return e.index-t.index});var q=[];v.hasOwnProperty(I)&&(q=v[I]),k.busArrivalTimes=q;var H=!1,z=!1,Q=!1,W=!1;if(m){var Y=`g_${k.goBack}`,G=[];y.hasOwnProperty(Y)?G=y[Y]:"1"===k.goBack&&(W=!0,G=y.g_0);var V,Z=Uo(G);try{for(Z.s();!(V=Z.n()).done;){var K=V.value;K.OriginStopID!==_.StopID&&K.DestinationStopID!==_.StopID||(H=!0),W?(K.OriginStopID===_.StopID&&(Q=!0),K.DestinationStopID===_.StopID&&(z=!0)):(K.OriginStopID===_.StopID&&(z=!0),K.DestinationStopID===_.StopID&&(Q=!0))}}catch(e){Z.e(e)}finally{Z.f()}}k.segmentBuffer={isSegmentBuffer:H,isStartingPoint:z,isEndingPoint:Q},A.push(k)}}}catch(e){S.e(e)}finally{S.f()}A.sort(function(e,t){return e.sequence-t.sequence});for(var X=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:450,n=Ro(),r=1/0,i=-1,a=e.length-1;a>0;a--){var o=e[a],s=D(n.latitude,n.longitude,o.latitude,o.longitude);s<=t&&s<r&&(i=a,r=s)}return i>0?e[i]:null}(w,450),ee=!1,te=!1,re={},ae=0,oe={},se=A.length,ce=0;ce<se;ce++){var de=A[ce],pe=A[ce+1]||de,ve=0;if(de.buses.length>0&&de.buses[0].onThisRoute){var he=[de.buses[0].position.longitude,de.buses[0].position.latitude],ye=he[0],ge=he[1],be=[de.position.longitude,de.position.latitude],Ae=be[0],we=be[1],Se=[pe.position.longitude,pe.position.latitude],_e=Se[0],ke=Se[1];if((ye-Ae)*(_e-ye)+(ge-we)*(ke-ge)>=0){var $e=Math.hypot(ye-Ae,ge-we),Ie=Math.hypot(ye-_e,ge-ke);ve=Math.max(0,Math.min($e/($e+Ie),1))}}de.progress=ve,de.segmentBuffer.isStartingPoint&&(ee=!0),de.segmentBuffer.isEndingPoint&&ee&&(te=!0),ee&&!te&&(de.segmentBuffer.isSegmentBuffer=!0),ee&&te&&(ee=!1,te=!1);var Te=!1;null!==X&&X.id===de.id&&(Te=!0),de.nearest=Te;var Ee=`g_${de.goBack}`||"g_0";re.hasOwnProperty(Ee)||(re[Ee]=[],oe[Ee]=0,ae+=1),re[Ee].push(de),oe[Ee]+=1}var Ce=a[`r_${e}`],Le={groupedItems:re,groupQuantity:ae,itemQuantity:oe,RouteName:Ce.n,RouteEndPoints:{RouteDeparture:Ce.dep,RouteDestination:Ce.des},dataUpdateTime:ue(i),RouteID:e,PathAttributeId:t};return ie(i),le(i),Le}),Jo.apply(this,arguments)}function Fo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return qo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function qo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ho=!1,zo={};function Qo(){return Qo=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n=[],r=Fo([[0,9],[1,9]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getProvider_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}var i="bus_provider_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(o)),Ho||(Ho=!0,zo=o),o}if((new Date).getTime()-parseInt(a)>5184e6){var s=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),s}if(!Ho){var u=yield b(0,i);Ho=!0,zo=JSON.parse(u)}return ne(e,"getProvider_0",0,!0),ne(e,"getProvider_1",0,!0),se(e,-1),zo}),Qo.apply(this,arguments)}function Wo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Yo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Go=!1,Vo={};function Zo(){return Zo=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n=[],r=Wo([[0,12],[1,12]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getSemiTimeTable_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}var i="bus_semi_timetable_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(o)),Go||(Go=!0,Vo=o),o}if((new Date).getTime()-parseInt(a)>12096e5){var s=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),s}if(!Go){var u=yield b(0,i);Go=!0,Vo=JSON.parse(u)}return ne(e,"getSemiTimeTable_0",0,!0),ne(e,"getSemiTimeTable_1",0,!0),se(e,-1),Vo}),Zo.apply(this,arguments)}function Ko(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Xo(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Xo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var es=!1,ts={};function ns(){return ns=(0,r.A)(function*(e){function t(){return n.apply(this,arguments)}function n(){return n=(0,r.A)(function*(){var t,n=[],r=Ko([[0,14],[1,14]].map(function(e){return{url:F(e[0],e[1]),e}}));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=yield K(i.url,e,`getTimeTable_${i.e[0]}`,"json");n=n.concat(a.BusInfo),se(e,a.EssentialInfo.UpdateTime)}}catch(e){r.e(e)}finally{r.f()}return n}),n.apply(this,arguments)}var i="bus_timetable_cache",a=yield b(0,`${i}_timestamp`);if(null===a){var o=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(o)),es||(es=!0,ts=o),o}if((new Date).getTime()-parseInt(a)>12096e5){var s=yield t();return yield y(0,`${i}_timestamp`,(new Date).getTime()),yield y(0,i,JSON.stringify(s)),s}if(!es){var u=yield b(0,i);es=!0,ts=JSON.parse(u)}return ne(e,"getTimeTable_0",0,!0),ne(e,"getTimeTable_1",0,!0),se(e,-1),ts}),ns.apply(this,arguments)}function rs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return is(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?is(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function is(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function as(e,t,n,r,i){var a,u,l,c,f,p={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},v=(a=new Date,u=a.getDay(),l=a.getDate()-u,(c=new Date).setDate(l),c.setHours(0),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0),c),h=rs(r);try{for(h.s();!(f=h.n()).done;){var m=f.value;if(t.indexOf(m.PathAttributeId)>-1&&"0"===m.DateType)for(var y=d(m.DateValue),g=o(v,y.day,0,0),b=We(m.StartTime,0),A=o(g,0,b.hours,b.minutes),w=We(m.EndTime,0),S=o(g,0,w.hours,w.minutes),_=Math.abs(60*w.hours+w.minutes-(60*b.hours+b.minutes)),k=parseInt(m.LongHeadway),$=parseInt(m.LowHeadway),I=($+k)/2,T=_/I,E=0;E<T;E++){var C=!1,L=o(g,0,b.hours,b.minutes+$*E);L.getTime()<A.getTime()&&(C=!0),L.getTime()>S.getTime()&&(C=!0),!1===C&&(p.calendarEventGroups[y.code].push({date:L,dateString:s(L,"hh:mm"),duration:$,deviation:Math.abs(I-$)}),p.calendarEventQuantity[y.code]+=1)}}}catch(e){h.e(e)}finally{h.f()}var x,M=rs(i);try{for(M.s();!(x=M.n()).done;){var O=x.value;if(t.indexOf(O.PathAttributeId)>-1&&"0"===O.DateType){var D=d(O.DateValue),j=o(v,D.day,0,0),P=We(O.DepartureTime,0),N=o(j,0,P.hours,P.minutes);p.calendarEventGroups[D.code].push({date:N,dateString:s(N,"hh:mm"),duration:15,deviation:0}),p.calendarEventQuantity[D.code]+=1}}}catch(e){M.e(e)}finally{M.f()}for(var R in p.calendarEventGroups)p.calendarEventGroups[R].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return p}function os(){return os=(0,r.A)(function*(e,t,n){var r=function(e,t){var n,r={},i=rs(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.Id===t){r=a;break}}}catch(e){i.e(e)}finally{i.f()}return r}(yield ct(n,!1),e),i=yield function(e){return Zo.apply(this,arguments)}(n),a=yield function(e){return ns.apply(this,arguments)}(n),o=yield function(e){return Qo.apply(this,arguments)}(n),s=function(e){var t=We(e.goFirstBusTime,0),n=We(e.goLastBusTime,0),r=We(e.backFirstBusTime,0),i=We(e.backLastBusTime,0),a=We(e.holidayGoFirstBusTime,0),o=We(e.holidayGoLastBusTime,0),s=We(e.holidayBackFirstBusTime,0),u=We(e.holidayBackLastBusTime,0),l=We(e.peakHeadway,1),c=We(e.offPeakHeadway,1),d=We(e.holidayPeakHeadway,1),f=We(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:l,offRushHourWindow:c},holiday:{first:a,last:o,rushHourWindow:d,offRushHourWindow:f}},back:{weekday:{first:r,last:i,rushHourWindow:l,offRushHourWindow:c},holiday:{first:s,last:u,rushHourWindow:d,offRushHourWindow:f}},realSequence:e.realSequence}}(r),u=as(0,t,0,i,a),l=function(e,t){var n,r={},i=rs(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.id===t&&(r=a)}}catch(e){i.e(e)}finally{i.f()}return r}(o,r.providerId),c={timeTableRules:s,calendar:u,properties:[{key:"route_name",icon:"route",value:r.nameZh},{key:"pricing",icon:"attach_money",value:r.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:l.nameZn},{key:"provider_phone",icon:"call",value:l.phoneInfo},{key:"provider_email",icon:"alternate_email",value:l.email}]};return ie(n),le(n),c}),os.apply(this,arguments)}function ss(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return us(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?us(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function us(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ls=n(157);function cs(e){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000000",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4,o=[[[-1,0],[0,-1]],[[0,-1],[1,0]],[[1,0],[0,1]],[[0,1],[-1,0]]],s=[[[-1,0],[-1,-1],[0,-1]],[[0,-1],[1,-1],[1,0]],[[1,0],[1,1],[0,1]],[[0,1],[-1,1],[-1,0]]],u=function(e,t){for(var n=ls.create(e,{errorCorrectionLevel:t}),r=n.modules.size,i=[],a=0;a<r;a++){for(var o=[],s=0;s<r;s++){var u=n.modules.get(s,a);o.push(u)}i.push(o)}return i}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L"),l=u.length,c=[],d=0;d<l;d++)for(var f=0;f<l;f++)if(1===u[d][f]){for(var p=new Uint8Array(4),v=0;v<4;v++){var h,m=1,y=ss(o[v]);try{for(y.s();!(h=y.n()).done;){var g,b=h.value;1===(null===(g=u[d+b[1]])||void 0===g?void 0:g[f+b[0]])&&(m*=0)}}catch(e){y.e(e)}finally{y.f()}p[v]=m}c=c.concat(ja((f+r)*a,(d+r)*a,1*a,1*a,{tl:p[0]*t*a,tr:p[1]*t*a,br:p[2]*t*a,bl:p[3]*t*a},!1))}else{for(var A=new Uint8Array(4),w=0;w<4;w++){var S,_=1,k=ss(s[w]);try{for(k.s();!(S=k.n()).done;){var $,I=S.value;null!==($=u[d+I[1]])&&void 0!==$&&$[f+I[0]]||(_*=0)}}catch(e){k.e(e)}finally{k.f()}A[w]=_}A.some(function(e){return 0!==e})&&(c=c.concat(ja((f+r)*a,(d+r)*a,1*a,1*a,{tl:A[0]*n*a,tr:A[1]*n*a,br:A[2]*n*a,bl:A[3]*n*a},!0)))}return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${(l+2*r)*a} ${(l+2*r)*a}" shape-rendering="geometricPrecision"><path d="${c.join(" ")}" fill="${i}" stroke="${i}" stroke-width="0.1" stroke-linejoin="round" fill-rule="nonzero" /></svg>`}var ds=N(".ft"),fs=U(ds,".kt");function ps(e){gd("QRCode"),ds.setAttribute("displayed","true"),function(e){var t=cs(e,"M",.5,.3,1,"var(--lb)",4);fs.innerHTML=t}(e)}function vs(){return(vs=(0,r.A)(function*(e){var t=yield ht(e);if(!1!==t){var n=Hu(0,{id:e,name:t.n});navigator.share&&navigator.share({title:t.n,url:n}).then(function(){Wf("check_circle","已分享路線")}).catch(function(e){Wf("cancel","已取消分享")})}})).apply(this,arguments)}function hs(){return(hs=(0,r.A)(function*(e){var t=yield ht(e);!1!==t&&ps(Hu(0,{id:e,name:t.n}))})).apply(this,arguments)}function ms(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ys(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ys(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ys(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var gs='"Noto Sans TC", sans-serif',bs=$d("route-details-canvas"),As=bs.width,ws=bs.height,Ss=Math.min(window.devicePixelRatio,1.875)||1,_s={};function ks(){var e=document.createElement("div");return e.classList.add("ui"),{element:e,id:""}}function $s(){var e=document.createElement("div");e.classList.add("wi");var t=document.createElement("canvas");return t.classList.add("xi"),e.appendChild(t),{element:e,id:""}}function Is(e,t,n,r,i,a){e.innerText=t.name,e.setAttribute("day",a.toString()),e.onclick=function(){!function(e){for(var t=Hf("playing_animation"),n=B(Js,".ui"),r=B(Fs,".wi"),i=0;i<7;i++){var a,o,s=n[i],u=r[i],l=`d_${i}`,c=null===(a=_s)||void 0===a?void 0:a.calendarEventGroups[l],d=null===(o=_s)||void 0===o?void 0:o.calendarDays[l];if(c&&d){var f=Na("--b"),p=Na("--c"),v=Na("--d"),h=Na("--t"),m=Na("--a"),y=Na("--va");Is(s,d,e,!1,t,i),Ts(u,c,e,m,f,p,v,h,y,i)}}}(a)},e.setAttribute("highlighted",n===a?"true":"false"),e.setAttribute("animation",tp(i)),e.setAttribute("skeleton-screen",tp(r))}function Ts(e,t,n,r,i,a,o,s,u,l){function c(e,t,n){var r=70*t;e.fillStyle=n,e.fillRect(45,r+5,As-45,1.2),e.font=`400 12px ${gs}`,e.textBaseline="top";var i=`${String(t).padStart(2,"0")}:00`,a=e.measureText(i),o=a.width,s=a.actualBoundingBoxDescent;e.fillText(i,(45-o)/2,r+(10-s)/2,o)}function d(e,t,n,r,i,a,o){var s=new Date;s.setDate(1),s.setMonth(0),s.setFullYear(t.date.getFullYear()),s.setMonth(t.date.getMonth()),s.setDate(t.date.getDate()),s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0);var u=(t.date.getTime()-s.getTime())/864e5*24*70,l=As-45,c=60*t.duration*1e3/864e5*24*70;Da(e,45,u,l,c,3,`rgba(${r}, ${i}, ${a}, ${o})`),Da(e,45,u,3,c,{tl:3,tr:0,bl:3,br:0},n),e.font=`400 14px ${gs}`,e.textBaseline="top",e.fillStyle=n;var d=t.dateString,f=e.measureText(d),p=f.width,v=f.actualBoundingBoxDescent;e.fillText(d,53,u+(c-v)/2,p)}var f=U(e,".xi"),p=f.getContext("2d");if(function(e,t,n){var r=t===n;e.setAttribute("displayed",tp(r))}(e,n,l),function(e){bs=$d("route-details-canvas"),As=bs.width,ws=bs.height,Ss=Math.min(window.devicePixelRatio,1.875)||1,e.width=As*Ss,e.height=ws*Ss;var t=e.getContext("2d");t.setTransform(1,0,0,1,0,0),t.scale(Ss,Ss)}(f),n===l){p.clearRect(0,0,As,ws);for(var v=0;v<24;v++)c(p,v,u);var h,m=ms(t);try{for(m.s();!(h=m.n()).done;){d(p,h.value,r,i,a,o,s)}}catch(e){m.e(e)}finally{m.f()}}else p.clearRect(0,0,As,ws)}function Es(e,t,n){var r=(new Date).getDay(),i=Na("--b"),a=Na("--c"),o=Na("--d"),s=Na("--t"),u=Na("--a"),l=Na("--va"),c=e.calendarDays,d=e.calendarDayQuantity,f=e.calendarEventGroups,p=(e.calendarEventQuantity,B(Fs,".wi").length);if(d!==p){var v=p-d;if(v<0){for(var h=new DocumentFragment,m=new DocumentFragment,y=0,g=Math.abs(v);y<g;y++){var b=ks();h.appendChild(b.element);var A=$s();m.appendChild(A.element)}Js.append(h),Fs.append(m)}else for(var w=B(Js,".ui"),S=B(Fs,".wi"),_=0,k=Math.abs(v);_<k;_++){var $=p-1-_;w[$].remove(),S[$].remove()}}for(var I=B(Js,".ui"),T=B(Fs,".wi"),E=0;E<d;E++){var C=`d_${E}`,L=c[C],x=f[C],M=I[E],O=T[E];Is(M,L,r,t,n,E),Ts(O,x,r,u,i,a,o,s,l,E)}_s=e}var Cs=[],Ls=!1,xs=!1;function Ms(){var e=document.createElement("div");e.classList.add("pi");var t=document.createElement("div");t.classList.add("qi"),t.appendChild(Rt()),e.appendChild(t);var n=document.createElement("div");return n.classList.add("ri"),e.appendChild(n),{element:e,id:""}}function Os(e,t,n){function r(e,r,i){function a(e,t){Ut(U(e,".qi"),t.icon)}function o(e,t){U(e,".ri").innerText=t.value}function s(e,t){e.setAttribute("animation",tp(t))}function u(e,t){e.setAttribute("skeleton-screen",tp(t))}null==i?(a(e,r),o(e,r),s(e,n),u(e,t)):(Vf(i,r)||a(e,r),Vf(i,r)||o(e,r),Ls!==n&&s(e,n),xs!==t&&u(e,t))}var i=e.length;t!==xs&&Ws.setAttribute("skeleton-screen",tp(t));var a=B(Ys,".pi").length;if(i!==a){var o=a-i;if(o<0){for(var s=new DocumentFragment,u=0,l=Math.abs(o);u<l;u++){var c=Ms();s.appendChild(c.element)}Ys.append(s)}else for(var d=B(Ys,".pi"),f=0,p=Math.abs(o);f<p;f++){d[a-1-f].remove()}}for(var v=B(Ys,".pi"),h=0;h<i;h++){var m=v[h],y=e[h];0===Cs.length?r(m,y,null):r(m,y,Cs[h])}Cs=e,Ls=n,xs=t}function Ds(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return js(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?js(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function js(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ps=N(".ci"),Ns=U(Ps,".hi"),Rs=U(Ns,".ii"),Us=U(Rs,'.ji[group="calendar"]'),Bs=U(Us,".ni"),Js=U(Bs,".ti"),Fs=U(Bs,".vi"),qs=U(Ps,'.hi .ii .ji[group="actions"]'),Hs=U(qs,'.ni .oi[action="save-to-folder"]'),zs=U(qs,'.ni .oi[action="get-permalink"]'),Qs=U(qs,'.ni .oi[action="show-permalink-qrcode"]'),Ws=U(Rs,'.ji[group="properties"]'),Ys=U(Ws,".ni");function Gs(){return Gs=(0,r.A)(function*(e,t){var n=Hf("playing_animation"),r=yield Kn("route",e);Hs.setAttribute("animation",tp(n)),Hs.setAttribute("highlighted",tp(r)),Hs.onclick=function(){mo("route",[e])},zs.setAttribute("animation",tp(n)),zs.onclick=function(){!function(e){vs.apply(this,arguments)}(e)},Qs.setAttribute("animation",tp(n)),Qs.onclick=function(){!function(e){hs.apply(this,arguments)}(e)},function(){for(var e=Hf("playing_animation"),t=[],n=0;n<5;n++)t.push({key:n,icon:"none",value:""});Os(t,!0,e)}(),function(){for(var e=Hf("playing_animation"),t={d_0:47,d_1:47,d_2:47,d_3:47,d_4:47,d_5:47,d_6:47},n={},r={},i=0;i<7;i++){var a=`d_${i}`;n[a]=[],r[a]={day:i,code:"d_{i}",name:""};for(var o=0;o<t[a];o++){var s=new Date;s.setHours(0),s.setMinutes(30*o),s.setSeconds(0),s.setMilliseconds(0),n[a].push({date:s,dateString:"",duration:15})}}Es({calendarEventGroups:n,calendarDays:r,calendarDayQuantity:7,calendarEventQuantity:t},!0,e)}();var i=Zf(),a=yield function(e,t,n){return os.apply(this,arguments)}(e,t,i);Os(a.properties,!1,n),Es(a.calendar,!1,n)}),Gs.apply(this,arguments)}function Vs(e,t){gd("RouteDetails"),Ps.setAttribute("displayed","true"),function(e,t){Gs.apply(this,arguments)}(e,t)}function Zs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ks(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ks(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ks(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Xs=N("._e"),eu=U(Xs,".gf"),tu=U(eu,".jf"),nu=U(tu,"span"),ru=U(eu,".if"),iu=U(eu,".qf .rf"),au=U(eu,".kf"),ou=U(au,".lf"),su=U(eu,".of"),uu=U(su,".pf"),lu=U(Xs,".tf"),cu={},du=!1,fu=!1,pu=0,vu=0,hu=0,mu={},yu=0,gu=!1,bu=15e3,Au=5e3,wu=15e3,Su=!0,_u=0,ku=0,$u="",Iu=!1,Tu=!1,Eu=!1,Cu=0,Lu=[];function xu(e,t,n,r){lu.style.setProperty("--ze",e.toString()),uu.style.setProperty("--cf",n.toString()),ou.style.setProperty("--mf",`${t.toString()}px`),ou.style.setProperty("--af",r.toString())}function Mu(e){var t=e;if(Iu){var n=t.detail.progress-1;iu.style.setProperty("--ef",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Mu)}function Ou(){var e=Zf(),t=document.createElement("div");t.classList.add("yh"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var n=document.createElement("div");n.classList.add("_h");var r=document.createElement("div");r.classList.add("ai"),r.setAttribute("displayed","false"),n.appendChild(r);var i=document.createElement("div");i.classList.add("bi");var a=document.createElement("div");a.classList.add("ke"),a.setAttribute("code","0"),a.setAttribute("displayed","false"),i.appendChild(a);var o=document.createElement("div");return o.classList.add("le"),o.setAttribute("code","0"),o.setAttribute("displayed","true"),i.appendChild(o),t.appendChild(n),t.appendChild(i),{element:t,id:e}}function Du(e){var t=Zf(),n=document.createElement("div");n.classList.add("ag"),n.id=t,n.setAttribute("stretched","false"),n.setAttribute("stretching","false"),n.setAttribute("push-direction","0"),n.setAttribute("push-state","0");var r=document.createElement("div");r.classList.add("bg");var i=document.createElement("div");i.classList.add("cg"),r.appendChild(i);var a=document.createElement("div");a.classList.add("dg");var o=document.createElement("div");o.classList.add("gg");var s=document.createElement("div");s.classList.add("ke"),s.setAttribute("code","0"),s.setAttribute("displayed","false"),o.appendChild(s);var u=document.createElement("div");u.classList.add("le"),u.setAttribute("code","0"),u.setAttribute("displayed","true"),o.appendChild(u),a.appendChild(o);var l=document.createElement("div");l.classList.add("fg"),l.appendChild(Nt("keyboard_arrow_down")),l.onclick=function(){!function(e,t){var n=U(lu,`.uf .vf .xf .ag#${e}`),r=U(n,".hg"),i=U(lu,`.uf .vf .wf .yh#${t}`),a=n.parentElement,o=i.parentElement,s=J(i,"yh"),u=J(n,"ag"),l=u.length,c=a.getBoundingClientRect(),d=n.getBoundingClientRect(),f=o.getBoundingClientRect(),p=i.getBoundingClientRect().top-f.top,v=d.top-c.top,h="true"===n.getAttribute("stretched"),m="true"===n.getAttribute("animation");if(m){var y=h?"2":"1";i.setAttribute("stretching","true"),i.style.setProperty("--vh",`${p}px`),n.setAttribute("stretching","true"),n.style.setProperty("--zf",`${v}px`);for(var g=0;g<l;g++){var b=u[g],A=s[g];A.style.setProperty("--wh",(-1*g-1).toString()),A.setAttribute("push-direction",y),A.setAttribute("push-state","1"),b.setAttribute("push-direction",y),b.setAttribute("push-state","1")}n.addEventListener("transitionend",function(){for(var e=0;e<l;e++){var t=u[e],r=s[e];r.setAttribute("push-direction","0"),r.setAttribute("push-state","0"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0")}i.setAttribute("stretching","false"),n.setAttribute("stretching","false")},{once:!0}),n.addEventListener("transitionstart",function(){for(var e=0;e<l;e++){var t=u[e];s[e].setAttribute("push-state","2"),t.setAttribute("push-state","2")}},{once:!0})}h?(m?r.addEventListener("transitionend",function(){r.setAttribute("displayed","false")},{once:!0}):r.setAttribute("displayed","false"),n.setAttribute("stretched","false"),i.setAttribute("stretched","false")):(r.setAttribute("displayed","true"),n.setAttribute("stretched","true"),i.setAttribute("stretched","true"))}(t,e)},a.appendChild(l);var c=document.createElement("div");c.classList.add("eg"),a.appendChild(c),r.appendChild(a);var d=document.createElement("div");d.classList.add("hg"),d.setAttribute("displayed","false");var f=document.createElement("div");f.classList.add("ig");var p=document.createElement("div");p.classList.add("jg"),p.setAttribute("highlighted","true"),p.setAttribute("type","tab"),p.setAttribute("code","0"),p.onclick=function(){Fu(t,0)};var v=document.createElement("div");v.classList.add("kg"),v.appendChild(Nt("directions_bus")),p.appendChild(v),p.appendChild(document.createTextNode("公車")),f.appendChild(p);var h=document.createElement("div");h.classList.add("jg"),h.setAttribute("highlighted","false"),h.setAttribute("type","tab"),h.setAttribute("code","1"),h.onclick=function(){Fu(t,1)};var m=document.createElement("div");m.classList.add("kg"),m.appendChild(Nt("departure_board")),h.appendChild(m),h.appendChild(document.createTextNode("抵達時間")),f.appendChild(h);var y=document.createElement("div");y.classList.add("jg"),y.setAttribute("highlighted","false"),y.setAttribute("type","tab"),y.setAttribute("code","2"),y.onclick=function(){Fu(t,2)};var g=document.createElement("div");g.classList.add("kg"),g.appendChild(Nt("route")),y.appendChild(g),y.appendChild(document.createTextNode("路線")),f.appendChild(y);var b=document.createElement("div");b.classList.add("jg"),b.setAttribute("highlighted","false"),b.setAttribute("type","tab"),b.setAttribute("code","3"),b.onclick=function(){Fu(t,3)};var A=document.createElement("div");A.classList.add("kg"),A.appendChild(Nt("location_on")),b.appendChild(A),b.appendChild(document.createTextNode("地點")),f.appendChild(b);var w=document.createElement("div");w.classList.add("jg"),w.setAttribute("highlighted","false"),w.setAttribute("type","save-to-folder");var S=document.createElement("div");S.classList.add("kg"),S.appendChild(Nt("folder")),w.appendChild(S),w.appendChild(document.createTextNode("儲存")),f.appendChild(w);var _=document.createElement("div");_.classList.add("jg"),_.setAttribute("highlighted","false"),_.setAttribute("type","schedule-notification"),_.setAttribute("enabled","true");var k=document.createElement("div");k.classList.add("kg"),k.appendChild(Nt("notifications")),_.appendChild(k),_.appendChild(document.createTextNode("通知")),f.appendChild(_),d.appendChild(f);var $=document.createElement("div");$.classList.add("lg"),$.setAttribute("displayed","true"),d.appendChild($);var I=document.createElement("div");I.classList.add("mg"),I.setAttribute("displayed","false"),d.appendChild(I);var T=document.createElement("div");T.classList.add("ng"),T.setAttribute("displayed","false"),d.appendChild(T);var E=document.createElement("div");return E.classList.add("og"),E.setAttribute("displayed","false"),d.appendChild(E),n.appendChild(r),n.appendChild(d),{element:n,id:t}}function ju(){var e=document.createElement("div");e.classList.add("uf");var t=document.createElement("div");t.classList.add("vf");var n=document.createElement("div");n.classList.add("wf");var r=document.createElement("div");r.classList.add("xh");var i=document.createElement("div");i.classList.add("xf");var a=document.createElement("div");return a.classList.add("_f"),i.appendChild(a),n.appendChild(r),t.appendChild(n),t.appendChild(i),e.appendChild(t),{element:e,id:""}}function Pu(){var e=document.createElement("div");return e.classList.add("nf"),{element:e,id:""}}function Nu(e,t,n){var r,i;function a(t,n,r,i,a,o){function s(e,t,n,r,i){var a=U(t,".bi"),o=U(a,".le"),s=U(a,".ke"),u=U(e,".gg"),l=U(u,".le"),c=U(u,".ke");if(s.setAttribute("code",n.status.code.toString()),c.setAttribute("code",n.status.code.toString()),c.innerText=n.status.text,!r&&i){var d=e.getBoundingClientRect(),f=d.top,p=d.left,v=d.bottom,h=d.right,m=window.innerWidth,y=window.innerHeight;if(v>0&&f<y&&h>0&&p<m)return o.addEventListener("animationend",function(){o.setAttribute("code",n.status.code.toString()),o.classList.remove("me"),s.setAttribute("displayed","false")},{once:!0}),l.addEventListener("animationend",function(){l.setAttribute("code",n.status.code.toString()),l.innerText=n.status.text,l.classList.remove("me"),c.setAttribute("displayed","false")},{once:!0}),c.setAttribute("displayed","true"),s.setAttribute("displayed","true"),o.classList.add("me"),void l.classList.add("me")}o.setAttribute("code",n.status.code.toString()),l.setAttribute("code",n.status.code.toString()),l.innerText=n.status.text}function u(e,t,n){e.setAttribute("segment-buffer",tp(n.segmentBuffer.isSegmentBuffer)),t.setAttribute("segment-buffer",tp(n.segmentBuffer.isSegmentBuffer))}function l(e,t){U(e,".cg").innerText=t.name}function d(e,t){U(e,".lg").innerHTML=0===t.buses.length?'<div class="tg">目前沒有公車可顯示</div>':t.buses.map(function(e){return`<div class="pg" on-this-route="${e.onThisRoute}"><div class="xg"><div class="ah">${Pt("directions_bus")}</div><div class="eh">${e.carNumber}</div></div><div class="jh"><div class="lh">路線：${e.RouteName}</div><div class="mh">狀態：${e.status.text}</div><div class="nh">類型：${e.type}</div></div></div>`}).join("")}function p(e,t){U(e,".mg").innerHTML=0===t.overlappingRoutes.length?'<div class="ug">目前沒有路線可顯示</div>':t.overlappingRoutes.map(function(e){return`<div class="qg"><div class="yg"><div class="bh">${Pt("route")}</div><div class="fh">${e.name}</div></div><div class="oh">${e.RouteEndPoints.html}</div><div class="qh"><div class="sh" onclick="bus.route.switchRoute(${e.RouteID}, [${e.PathAttributeId.join(",")}])">查看路線</div><div class="sh" onclick="bus.folder.openSaveToFolder('route-on-route', [${e.RouteID}])">儲存路線</div></div></div>`}).join("")}function v(e,t){U(e,".ng").innerHTML=0===t.busArrivalTimes.length?'<div class="vg">目前沒有抵達時間可顯示</div>':t.busArrivalTimes.map(function(e){return`<div class="rg"><div class="zg"><div class="ch">${Pt("calendar_view_day")}</div><div class="gh">${e.personalSchedule.name}</div><div class="ih">週${c(e.day).name} ${f(e.personalSchedule.period.start)} - ${f(e.personalSchedule.period.end)}</div></div><div class="kh">${e.chart}</div></div>`}).join("")}function h(e,t){U(e,".og").innerHTML=0===t.nearbyLocations.length?'<div class="pt">目前沒有地點可顯示</div>':t.nearbyLocations.map(function(e){return`<div class="sg"><div class="_g"><div class="dh">${Pt("location_on")}</div><div class="hh">${e.name}</div></div><div class="ph">${e.distance}公尺</div><div class="rh"><div class="th" onclick="bus.location.openLocation('${e.hash}')">查看地點</div><div class="th" onclick="bus.folder.openSaveToFolder('location-on-route', ['${e.hash}'])">儲存地點</div></div></div>`}).join("")}function m(e,t,n){e.setAttribute("nearest",tp(n.nearest)),t.setAttribute("nearest",tp(n.nearest))}function y(e,t,n,r,i){var a=(null==n?void 0:n.progress)||0,o=(null==t?void 0:t.progress)||0,s=U(e,"._h .ai");if(!r&&i&&0!==a&&0===o&&Math.abs(o-a)>0)return s.style.setProperty("--zh","100%"),void s.addEventListener("transitionend",function(){s.setAttribute("displayed","false"),s.style.setProperty("--zh","-100%")},{once:!0});o>0?(s.setAttribute("displayed","true"),s.style.setProperty("--zh",100*(o-1)+"%")):s.setAttribute("displayed","false")}function g(e,t,n){n&&(U(e,".hg").setAttribute("displayed","false"),e.setAttribute("stretched","false"),t.setAttribute("stretched","false"))}function b(e,t,n){e.setAttribute("animation",tp(n)),t.setAttribute("animation",tp(n))}function A(e,t,n){e.setAttribute("skeleton-screen",tp(n)),t.setAttribute("skeleton-screen",tp(n))}function w(t,n){var r=U(t,'.hg .ig .jg[type="save-to-folder"]');r.onclick=function(){mo("stop-on-route",[t.id,n.id,e.RouteID])},Kn("stop",n.id).then(function(e){r.setAttribute("highlighted",tp(e))})}function S(t,n){var r=U(t,'.hg .ig .jg[type="schedule-notification"]');r.onclick=function(){ko("stop-on-route",[t.id,n.id,e.RouteID,n.status.time])};var i=ma(n.id);r.setAttribute("highlighted",tp(i))}null===i?(s(t,n,r,a,o),l(t,r),d(t,r),p(t,r),v(t,r),h(t,r),u(t,n,r),m(t,n,r),y(n,r,i,a,o),g(t,n,a),b(t,n,o),A(t,n,a),w(t,r),S(t,r)):(r.status.time!==i.status.time&&(s(t,n,r,a,o),S(t,r)),Vf(i.buses,r.buses)||d(t,r),Vf(i.busArrivalTimes,r.busArrivalTimes)||v(t,r),i.nearest!==r.nearest&&m(t,n,r),i.progress!==r.progress&&y(n,r,i,a,o),i.id!==r.id&&(l(t,r),u(t,n,r),p(t,r),h(t,r),w(t,r),S(t,r)),du!==o&&b(t,n,o),fu!==a&&(g(t,n,a),A(t,n,a)))}var o=$d("window"),s=o.width,u=o.height,l=e.groupQuantity,d=e.itemQuantity,p=e.groupedItems;hu=l,yu=s;for(var v=0,h=[e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,"未知"].map(function(e){return`往${e}`}),m=0;m<l;m++){var y=`g_${m}`,g=Oa(h[m],500,"17px",'"Noto Sans TC", sans-serif')+20;mu[y]={width:g,offset:v},v+=g}if(mu[`g_${l}`]={width:0,offset:v},!gu){var b=mu[`g_${pu}`],A=-1*b.offset+.5*yu-.5*b.width,w=b.width-20;xu(hu,A,w,pu)}fu!==t&&(tu.setAttribute("skeleton-screen",tp(t)),au.setAttribute("skeleton-screen",tp(t)),su.setAttribute("skeleton-screen",tp(t))),du!==n&&(tu.setAttribute("animation",tp(n)),au.setAttribute("animation",tp(n)),su.setAttribute("animation",tp(n))),(null===(r=cu)||void 0===r?void 0:r.RouteID)!==e.RouteID&&(ru.onclick=function(){Vs(e.RouteID,e.PathAttributeId)}),(null===(i=cu)||void 0===i?void 0:i.RouteName)!==e.RouteName&&(nu.innerText=e.RouteName);var S=B(lu,".uf").length;if(l!==S){var _=S-l;if(_<0){for(var k=new DocumentFragment,$=new DocumentFragment,I=0,T=Math.abs(_);I<T;I++){var E=ju();k.appendChild(E.element);var C=Pu();$.appendChild(C.element)}lu.append(k),ou.append($)}else for(var L=B(lu,".uf"),x=B(ou,".nf"),M=0,O=Math.abs(_);M<O;M++){var D=S-1-M;L[D].remove(),x[D].remove()}}for(var j=B(lu,".uf"),P=0;P<l;P++){var N=`g_${P}`,R=j[P],J=U(R,".xf"),F=U(R,".wf"),q=B(J,".ag").length;if(d[N]!==q){var H=q-d[N];if(H<0){for(var z=new DocumentFragment,Q=new DocumentFragment,W=0,Y=Math.abs(H);W<Y;W++){var G=Ou(),V=Du(G.id);z.appendChild(V.element),Q.appendChild(G.element)}J.append(z),F.append(Q)}else for(var Z=B(J,".ag"),K=B(F,".yh"),X=0,ee=Math.abs(H);X<ee;X++){var te=q-1-X;Z[te].remove(),K[te].remove()}}}for(var ne=B(ou,".nf"),re=0;re<l;re++){var ie=`g_${re}`,ae=ne[re];ae.innerHTML=[e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,""].map(function(e){return`<span>往${e}</span>`})[re],ae.style.setProperty("--df",`${mu[ie].width}px`),ae.style.setProperty("--bf",re.toString());var oe=j[re];t&&(oe.scrollTop=0);for(var se=U(oe,".xf"),ue=U(oe,".wf"),le=B(se,".ag"),ce=B(ue,".yh"),de=0;de<d[ie];de++){var fe=le[de],pe=ce[de],ve=p[ie][de];if(cu.hasOwnProperty("groupedItems"))if(cu.groupedItems.hasOwnProperty(ie))if(cu.groupedItems[ie][de])a(fe,pe,ve,cu.groupedItems[ie][de],t,n);else a(fe,pe,ve,null,t,n);else a(fe,pe,ve,null,t,n);else a(fe,pe,ve,null,t,n)}}cu=e,du=n,fu=t}function Ru(){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,r.A)(function*(){var e=Hf("playing_animation"),t=Hf("refresh_interval"),n=$d("route-bus-arrival-time-chart");Su=t.dynamic,bu=t.baseInterval,Iu=!0,$u=Zf(),iu.setAttribute("refreshing","true"),iu.classList.remove("sf"),document.addEventListener($u,Mu);var r=yield function(e,t,n,r,i){return Jo.apply(this,arguments)}(Cu,Lu,n.width,n.height,$u);Nu(r,!1,e);var i=0;Su&&(i=yield _n()),_u=(new Date).getTime(),ku=Su?Math.max(_u+Au,r.dataUpdateTime+bu/i):_u+bu,wu=Math.max(Au,ku-_u),Iu=!1,iu.setAttribute("refreshing","false"),iu.style.setProperty("--ff",`${wu}ms`),iu.classList.add("sf")}),Uu.apply(this,arguments)}function Bu(){Ru().then(function(){Tu?setTimeout(function(){Bu()},Math.max(Au,ku-(new Date).getTime())):Eu=!1}).catch(function(e){Tu?(Wf("error","路線網路連線中斷，將在10秒後重試。"),setTimeout(function(){Bu()},1e4)):Eu=!1})}function Ju(e,t){gd("Route"),xt("route",e),Cu=e,Lu=t,pu=0,mu={},Xs.setAttribute("displayed","true"),lu.scrollLeft=0,lu.focus(),function(e,t){for(var n=Hf("playing_animation"),r=$d("window"),i=(r.width,r.height),a=Math.floor(i/50)+5,o={},s=0;s<2;s++){var u=`g_${s}`;o[u]=[];for(var l=0;l<a;l++)o[u].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],nearbyLocations:[],sequence:l,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}Nu({groupedItems:o,groupQuantity:2,itemQuantity:{g_0:a,g_1:a},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:e,PathAttributeId:t,dataUpdateTime:0},!0,n)}(e,t),Tu||(Tu=!0,Eu?Ru():(Eu=!0,Bu())),Ad()}function Fu(e,t){var n,r=U(lu,`.ag#${e}`),i=U(r,".ig"),a=Zs(B(i,'.jg[highlighted="true"][type="tab"]'));try{for(a.s();!(n=a.n()).done;){n.value.setAttribute("highlighted","false")}}catch(e){a.e(e)}finally{a.f()}switch(U(i,`.jg[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:U(r,".lg").setAttribute("displayed","true"),U(r,".ng").setAttribute("displayed","false"),U(r,".mg").setAttribute("displayed","false"),U(r,".og").setAttribute("displayed","false");break;case 1:U(r,".lg").setAttribute("displayed","false"),U(r,".ng").setAttribute("displayed","true"),U(r,".mg").setAttribute("displayed","false"),U(r,".og").setAttribute("displayed","false");break;case 2:U(r,".lg").setAttribute("displayed","false"),U(r,".ng").setAttribute("displayed","false"),U(r,".mg").setAttribute("displayed","true"),U(r,".og").setAttribute("displayed","false");break;case 3:U(r,".lg").setAttribute("displayed","false"),U(r,".ng").setAttribute("displayed","false"),U(r,".mg").setAttribute("displayed","false"),U(r,".og").setAttribute("displayed","true")}}function qu(){var e=new URL(location.href).searchParams.get("permalink");if(null!==e){var t=String(e);if(/^[0-1]\@(.*)(\~.*){0,1}/.test(t)){var n=t.split(/[\@\~]/);switch(parseInt(n[0])){case 0:ht(parseInt(n[1],16)).then(function(e){!1!==e?Ju(e.id,e.pid):function(e){return vt.apply(this,arguments)}(n[2]).then(function(e){e.length>0&&Ju(e[0].id,e[0].pid)})});break;case 1:Ql(n[1])}}}}function Hu(e,t){var n=new URL("https://erichsia7.github.io/bus/");switch(e){case 0:n.searchParams.set("permalink",`0@${parseInt(t.id).toString(16)}~${t.name}`);break;case 1:n.searchParams.set("permalink",`1@${t.hash}`)}return decodeURIComponent(n.toString())}var zu={},Qu=!1,Wu=!1,Yu=N(".kl"),Gu=U(Yu,".pl"),Vu=U(Gu,".ql");function Zu(){var e=document.createElement("div");e.classList.add("rl");var t=document.createElement("div");t.classList.add("sl"),t.appendChild(Rt()),e.appendChild(t);var n=document.createElement("div");return n.classList.add("tl"),e.appendChild(n),{element:e,id:""}}function Ku(e,t,n){function r(e,r,i){function a(e,t){Ut(U(e,".sl"),t.icon)}function o(e,t){U(e,".tl").innerText=t.name}function s(e,t){e.onclick=t.action}function u(e,t){e.setAttribute("animation",tp(t))}function l(e,t){e.setAttribute("skeleton-screen",tp(t))}null==i?(a(e,r),o(e,r),s(e,r),u(e,n),l(e,t)):(i.key!==r.key&&(a(e,r),o(e,r),s(e,r)),n!==Qu&&u(e,n),t!==Wu&&l(e,t))}var i=e.actions,a=e.actionsQuantity,o=B(Vu,".rl").length;if(a!==o){var s=o-a;if(s<0){for(var u=new DocumentFragment,l=0,c=Math.abs(s);l<c;l++){var d=Zu();u.appendChild(d.element)}Vu.append(u)}else for(var f=B(Vu,".rl"),p=0,v=Math.abs(s);p<v;p++){f[o-1-p].remove()}}for(var h=B(Vu,".rl"),m=0;m<a;m++){var y=h[m],g=i[m];if(zu.hasOwnProperty("actions"))if(zu.actions[m])r(y,g,zu.actions[m]);else r(y,g,null);else r(y,g,null)}zu=e,Qu=n,Wu=t}function Xu(){return Xu=(0,r.A)(function*(e){var t=Hf("playing_animation"),n=Zf(),r=yield function(e,t){return Io.apply(this,arguments)}(e,n);Ku(r,!1,t)}),Xu.apply(this,arguments)}function el(e){gd("LocationDetails"),Yu.setAttribute("displayed","true"),function(){for(var e=Hf("playing_animation"),t=[],n=0;n<3;n++)t.push({name:"",icon:"",key:`action-${n}`,action:function(){}});Ku({actions:t,actionsQuantity:3,hash:""},!0,e)}(),function(e){Xu.apply(this,arguments)}(e)}function tl(){return(tl=(0,r.A)(function*(e){var t=Zf(),n=yield De(t,1);ie(t),le(t);var r=`ml_${e}`;if(n.hasOwnProperty(r)){var i=n[r],a=Hu(1,{hash:e});navigator.share&&navigator.share({title:i.n,url:a}).then(function(){Wf("check_circle","已分享地點")}).catch(function(e){Wf("cancel","已取消分享")})}})).apply(this,arguments)}function nl(){return(nl=(0,r.A)(function*(e){var t=Zf(),n=yield De(t,1);ie(t),le(t);var r=`ml_${e}`;n.hasOwnProperty(r)&&ps(Hu(1,{hash:e}))})).apply(this,arguments)}function rl(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return il(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?il(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function il(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var al=N(".zi"),ol=U(al,".fj"),sl=U(ol,".ij"),ul=U(sl,"span"),ll=U(ol,".hj"),cl=U(al,".sj"),dl=U(ol,".jj"),fl=U(dl,".kj"),pl=U(ol,".nj"),vl=U(pl,".oj"),hl=U(ol,".pj .qj"),ml={},yl=!1,gl=!1,bl=0,Al=0,wl=0,Sl={},_l=0,kl=!1,$l=15e3,Il=5e3,Tl=15e3,El=!0,Cl=0,Ll=0,xl="",Ml=!1,Ol=!1,Dl=!1,jl="";function Pl(e,t,n,r){cl.style.setProperty("--yi",e.toString()),vl.style.setProperty("--aj",n.toString()),fl.style.setProperty("--bj",`${t.toString()}px`),fl.style.setProperty("--cj",r.toString())}function Nl(e){var t=e;if(Ml){var n=t.detail.progress-1;hl.style.setProperty("--dj",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Nl)}function Rl(){var e=Zf(),t=document.createElement("div");t.classList.add("bk"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var n=document.createElement("div");n.classList.add("ck");var r=document.createElement("div");r.classList.add("dk");var i=document.createElement("div");i.classList.add("ek"),i.setAttribute("code","-1"),i.setAttribute("displayed","false");var a=document.createElement("div");a.classList.add("fk"),a.setAttribute("code","-1"),a.setAttribute("displayed","true"),r.appendChild(i),r.appendChild(a);var o=document.createElement("div");o.classList.add("hk");var s=document.createElement("div");s.classList.add("ik");var u=document.createElement("div");u.classList.add("jk");var l=document.createElement("div");l.classList.add("mk");var c=document.createElement("div");c.classList.add("ke"),c.setAttribute("code","0"),c.setAttribute("displayed","false");var d=document.createElement("div");d.classList.add("le"),d.setAttribute("code","0"),d.setAttribute("displayed","true"),l.appendChild(c),l.appendChild(d);var f=document.createElement("div");f.classList.add("lk"),f.appendChild(Nt("keyboard_arrow_down")),f.onclick=function(){!function(e){var t=U(cl,`.tj .ak .bk#${e}`),n=U(t,".nk"),r=t.parentElement,i=J(t,"bk"),a=i.length,o=r.getBoundingClientRect(),s=t.getBoundingClientRect(),u=s.top-o.top,l="true"===t.getAttribute("stretched"),c="true"===t.getAttribute("animation");if(c){var d=l?"2":"1";t.setAttribute("stretching","true"),t.style.setProperty("--_j",`${u}px`);for(var f=0;f<a;f++){var p=i[f];p.setAttribute("push-direction",d),p.setAttribute("push-state","1")}t.addEventListener("transitionend",function(){for(var e=0;e<a;e++){var n=i[e];n.setAttribute("push-direction","0"),n.setAttribute("push-state","0")}t.setAttribute("stretching","false")},{once:!0}),t.addEventListener("transitionstart",function(){for(var e=0;e<a;e++){i[e].setAttribute("push-state","2")}},{once:!0})}l?(c?n.addEventListener("transitionend",function(){n.setAttribute("displayed","false")},{once:!0}):n.setAttribute("displayed","false"),t.setAttribute("stretched","false")):(n.setAttribute("displayed","true"),t.setAttribute("stretched","true"))}(e)};var p=document.createElement("div");p.classList.add("kk"),u.appendChild(l),u.appendChild(f),u.appendChild(p),n.appendChild(r),n.appendChild(o),n.appendChild(s),n.appendChild(u);var v=document.createElement("div");v.classList.add("nk"),v.setAttribute("displayed","false");var h=document.createElement("div");h.classList.add("ok");var m=document.createElement("div");m.classList.add("pk"),m.setAttribute("highlighted","true"),m.setAttribute("type","tab"),m.setAttribute("code","0");var y=document.createElement("div");y.classList.add("qk"),y.appendChild(Nt("directions_bus")),m.appendChild(y),m.appendChild(document.createTextNode("公車")),m.onclick=function(){Wl(e,0)};var g=document.createElement("div");g.classList.add("pk"),g.setAttribute("highlighted","false"),g.setAttribute("type","tab"),g.setAttribute("code","1");var b=document.createElement("div");b.classList.add("qk"),b.appendChild(Nt("departure_board")),g.appendChild(b),g.appendChild(document.createTextNode("抵達時間")),g.onclick=function(){Wl(e,1)};var A=document.createElement("div");A.classList.add("pk"),A.setAttribute("highlighted","false"),A.setAttribute("type","save-to-folder");var w=document.createElement("div");w.classList.add("qk"),w.appendChild(Nt("folder")),A.appendChild(w),A.appendChild(document.createTextNode("儲存"));var S=document.createElement("div");S.classList.add("pk"),S.setAttribute("highlighted","false"),S.setAttribute("type","schedule-notification"),S.setAttribute("enabled","true");var _=document.createElement("div");_.classList.add("qk"),_.appendChild(Nt("notifications")),S.appendChild(_),S.appendChild(document.createTextNode("通知")),h.appendChild(m),h.appendChild(g),h.appendChild(A),h.appendChild(S);var k=document.createElement("div");k.classList.add("rk"),k.setAttribute("displayed","true");var $=document.createElement("div");return $.classList.add("sk"),$.setAttribute("displayed","false"),v.appendChild(h),v.appendChild(k),v.appendChild($),t.appendChild(n),t.appendChild(v),{element:t,id:e}}function Ul(){var e=document.createElement("div");e.classList.add("tj");var t=document.createElement("div");t.classList.add("uj");var n=document.createElement("div");n.classList.add("vj"),t.appendChild(n);var r=document.createElement("div");return r.classList.add("ak"),e.appendChild(t),e.appendChild(r),{element:e,id:""}}function Bl(){var e=document.createElement("div");e.classList.add("lj");var t=document.createElement("span");return e.appendChild(t),{element:e,id:""}}function Jl(){var e=document.createElement("div");e.classList.add("wj");var t=document.createElement("div");t.classList.add("xj"),t.appendChild(Rt());var n=document.createElement("div");return n.classList.add("yj"),e.appendChild(t),e.appendChild(n),{element:e,id:""}}function Fl(e,t,n){var r,i;function a(e,r,i){function a(e,t,n){var r=e.getBoundingClientRect(),i=r.top,a=r.left,o=r.bottom,s=r.right,u=window.innerWidth,l=window.innerHeight,c=U(e,".ck"),d=U(c,".mk"),f=U(d,".ke"),p=U(d,".le");f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,n&&o>0&&i<l&&s>0&&a<u?(p.addEventListener("animationend",function(){p.setAttribute("code",t.status.code.toString()),p.innerText=t.status.text,p.classList.remove("me"),f.setAttribute("displayed","false")},{once:!0}),f.setAttribute("displayed","true"),p.classList.add("me")):(p.setAttribute("code",t.status.code.toString()),p.innerText=t.status.text)}function o(e,t,n){var r=e.getBoundingClientRect(),i=r.top,a=r.left,o=r.bottom,s=r.right,u=window.innerWidth,l=window.innerHeight,c=U(e,".ck"),d=U(c,".dk"),f=U(d,".ek"),p=U(d,".fk");f.setAttribute("code",t.ranking.code.toString()),f.innerText=t.ranking.text,n&&o>0&&i<l&&s>0&&a<u?(p.addEventListener("animationend",function(){p.setAttribute("code",t.ranking.code.toString()),p.innerText=t.ranking.text,p.classList.remove("gk"),f.setAttribute("displayed","false")},{once:!0}),f.setAttribute("displayed","true"),p.classList.add("gk")):(p.setAttribute("code",t.ranking.code.toString()),p.innerText=t.ranking.text)}function s(e,t){var n=U(e,".ck");U(n,".hk").innerText=t.route_direction}function u(e,t){var n=U(e,".ck");U(n,".ik").innerText=t.route_name}function l(e,t){var n=U(e,".nk");U(n,".rk").innerHTML=0===t.buses.length?'<div class="il">目前沒有公車可顯示</div>':t.buses.map(function(e){return`<div class="tk" on-this-route="${e.onThisRoute}"><div class="vk"><div class="xk">${Pt("directions_bus")}</div><div class="zk">${e.carNumber}</div></div><div class="bl"><div class="dl">路線：${e.RouteName}</div><div class="el">狀態：${e.status.text}</div><div class="fl">類型：${e.type}</div></div></div>`}).join("")}function d(e,t){var n=U(e,".nk");U(n,".sk").innerHTML=0===t.busArrivalTimes.length?'<div class="jl">目前沒有抵達時間可顯示</div>':t.busArrivalTimes.map(function(e){return`<div class="uk"><div class="wk"><div class="yk">${Pt("calendar_view_day")}</div><div class="_k">${e.personalSchedule.name}</div><div class="al">週${c(e.day).name} ${f(e.personalSchedule.period.start)} - ${f(e.personalSchedule.period.end)}</div></div><div class="cl">${e.chart}</div></div>`}).join("")}function p(e,t){t&&e.setAttribute("stretched","false")}function v(e,t){e.setAttribute("animation",tp(t))}function h(e,t){e.setAttribute("skeleton-screen",tp(t))}function m(e,t){var n=U(e,".nk"),r=U(n,".ok"),i=U(r,'.pk[type="save-to-folder"]');i.onclick=function(){mo("stop-on-location",[e.id,t.stopId,t.routeId])},Kn("stop",t.stopId).then(function(e){i.setAttribute("highlighted",tp(e))})}function y(e,t){var n=U(e,".nk"),r=U(n,".ok"),i=U(r,'.pk[type="schedule-notification"]');i.onclick=function(){ko("stop-on-location",[e.id,t.stopId,t.routeId,t.status.time])};var a=ma(t.stopId);i.setAttribute("highlighted",tp(a))}null==i?(a(e,r,n),o(e,r,n),s(e,r),u(e,r),l(e,r),d(e,r),p(e,t),v(e,n),h(e,t),m(e,r),y(e,r)):(r.status.time!==i.status.time&&(a(e,r,n),y(e,r)),i.ranking.number===r.ranking.number&&i.ranking.code===r.ranking.code||o(e,r,n),i.stopId!==r.stopId&&(s(e,r),u(e,r),m(e,r)),Vf(i.buses,r.buses)||l(e,r),Vf(i.busArrivalTimes,r.busArrivalTimes)||d(e,r),n!==yl&&v(e,n),t!==gl&&(p(e,t),h(e,t)))}function o(e,r,i){function a(e,t){Ut(U(e,".xj"),t.icon)}function o(e,t){U(e,".yj").innerHTML=t.value}function s(e,t){e.setAttribute("animation",tp(t))}function u(e,t){e.setAttribute("skeleton-screen",tp(t))}null==i?(a(e,r),o(e,r),s(e,n),u(e,t)):(Vf(i.icon,r.icon)||a(e,r),Vf(i.value,r.value)||o(e,r),n!==yl&&s(e,n),t!==gl&&u(e,t))}var s=$d("window"),u=s.width,l=s.height,d=e.groupQuantity,p=e.itemQuantity,v=e.groupedItems,h=e.groups;wl=d,_l=u;for(var m=0,y=0;y<d;y++){var g=`g_${y}`,b=Oa(h[g].name,500,"17px",'"Noto Sans TC", sans-serif')+20;Sl[g]={width:b,offset:m},m+=b}if(Sl[`g_${d}`]={width:0,offset:m},!kl){var A=Sl[`g_${bl}`],w=-1*A.offset+.5*_l-.5*A.width,S=A.width-20;Pl(wl,w,S,bl)}(null===(r=ml)||void 0===r?void 0:r.hash)!==e.hash&&(ll.onclick=function(){el(e.hash)}),(null===(i=ml)||void 0===i?void 0:i.LocationName)!==e.LocationName&&(ul.innerText=e.LocationName),yl!==n&&(sl.setAttribute("animation",tp(n)),dl.setAttribute("animation",tp(n))),gl!==t&&(sl.setAttribute("skeleton-screen",tp(t)),dl.setAttribute("skeleton-screen",tp(t)),pl.setAttribute("skeleton-screen",tp(t)));var _=B(cl,".tj").length;if(d!==_){var k=_-d;if(k<0){for(var $=new DocumentFragment,I=new DocumentFragment,T=0,E=Math.abs(k);T<E;T++){var C=Ul();$.appendChild(C.element);var L=Bl();I.appendChild(L.element)}cl.append($),fl.append(I)}else for(var x=B(cl,".tj"),M=B(fl,".lj"),O=0,D=Math.abs(k);O<D;O++){var j=_-1-O;x[j].remove(),M[j].remove()}}for(var P=B(cl,".tj"),N=0;N<d;N++){var R=`g_${N}`,J=P[N],F=B(J,".ak .bk").length;if(p[R]!==F){var q=F-p[R];if(q<0)for(var H=U(J,".ak"),z=0,Q=Math.abs(q);z<Q;z++){var W=Rl();H.appendChild(W.element)}else for(var Y=B(J,".ak .bk"),G=0,V=Math.abs(q);G<V;G++){Y[F-1-G].remove()}}var Z=B(B(cl,".tj")[N],".uj .vj .wj").length,K=h[R].properties.length;if(K!==Z){var X=Z-K;if(X<0)for(var ee=U(J,".uj"),te=U(ee,".vj"),ne=0,re=Math.abs(X);ne<re;ne++){var ie=Jl();te.appendChild(ie.element)}else for(var ae=U(J,".uj"),oe=B(U(ae,".vj"),".wj"),se=0,ue=Math.abs(X);se<ue;se++){oe[Z-1-se].remove()}}}for(var le=B(fl,".lj"),ce=B(cl,".tj"),de=0;de<d;de++){var fe=`g_${de}`,pe=le[de];U(pe,"span").innerText=h[fe].name,pe.style.setProperty("--_i",`${Sl[fe].width}px`),pe.style.setProperty("--mj",de.toString());for(var ve=ce[de],he=B(ve,".uj .vj .wj"),me=B(ve,".ak .bk"),ye=h[fe].properties.length,ge=0;ge<ye;ge++){var be=h[fe].properties[ge],Ae=he[ge];if(ml.hasOwnProperty("groups"))if(ml.groups.hasOwnProperty(fe))if(ml.groups[fe].properties[ge])o(Ae,be,ml.groups[fe].properties[ge]);else o(Ae,be,null);else o(Ae,be,null);else o(Ae,be,null)}for(var we=0;we<p[fe];we++){var Se=me[we],_e=v[fe][we];if(ml.hasOwnProperty("groupedItems"))if(ml.groupedItems.hasOwnProperty(fe))if(ml.groupedItems[fe][we])a(Se,_e,ml.groupedItems[fe][we]);else a(Se,_e,null);else a(Se,_e,null);else a(Se,_e,null)}}ml=e,yl=n,gl=t}function ql(){return Hl.apply(this,arguments)}function Hl(){return Hl=(0,r.A)(function*(){var e=Hf("playing_animation"),t=Hf("refresh_interval"),n=$d("location-bus-arrival-time-chart");El=t.dynamic,$l=t.baseInterval,Ml=!0,xl=Zf(),hl.setAttribute("refreshing","true"),hl.classList.remove("rj"),document.addEventListener(xl,Nl);var r=yield function(e,t,n,r){return ao.apply(this,arguments)}(jl,n.width,n.height,xl);Fl(r,!1,e);var i=0;El&&(i=yield _n()),Cl=(new Date).getTime(),Ll=El?Math.max(Cl+Il,r.dataUpdateTime+$l/i):Cl+$l,Tl=Math.max(Il,Ll-Cl),Ml=!1,hl.setAttribute("refreshing","false"),hl.style.setProperty("--ej",`${Tl}ms`),hl.classList.add("rj")}),Hl.apply(this,arguments)}function zl(){ql().then(function(){Ol?setTimeout(function(){zl()},Math.max(Il,Ll-(new Date).getTime())):Dl=!1}).catch(function(e){Ol?(Wf("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){zl()},1e4)):Dl=!1})}function Ql(e){gd("Location"),xt("location",e),jl=e,bl=0,Sl={},al.setAttribute("displayed","true"),cl.scrollLeft=0,cl.focus(),function(e){for(var t=Hf("playing_animation"),n=$d("window"),r=(n.width,n.height),i={g_0:Math.floor(r/50)+5,g_1:Math.floor(r/50)+5},a={},o=0;o<2;o++){var s=`g_${o}`;a[s]=[];for(var u=0;u<i[s];u++)a[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}Fl({groupedItems:a,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:i,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),Ol||(Ol=!0,Dl?ql():(Dl=!0,zl())),Ad()}function Wl(e,t){var n,r=U(cl,`.tj .ak .bk#${e}`),i=U(r,".nk"),a=U(i,".ok"),o=rl(B(a,'.pk[highlighted="true"][type="tab"]'));try{for(o.s();!(n=o.n()).done;){n.value.setAttribute("highlighted","false")}}catch(e){o.e(e)}finally{o.f()}switch(U(a,`.pk[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:U(r,".rk").setAttribute("displayed","true"),U(r,".sk").setAttribute("displayed","false");break;case 1:U(r,".rk").setAttribute("displayed","false"),U(r,".sk").setAttribute("displayed","true")}}function Yl(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Gl(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gl(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Gl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Vl=[],Zl=N(".ne"),Kl=U(Zl,".oe"),Xl=U(Zl,".se"),ec=U(Kl,".pe #search_input"),tc=U(Kl,".pe canvas"),nc=U(Kl,".re"),rc=U(Xl,".te"),ic=U(Xl,".xe"),ac=tc.getContext("2d"),oc=window.devicePixelRatio,sc=15*oc,uc=1.8*oc,lc=.9*oc,cc=4*oc,dc=25*oc,fc=20*oc,pc=[["紅","藍","1","2","3"],["綠","棕","4","5","6"],["橘","小","7","8","9"],["鍵盤","幹線","清空","0","刪除"]],vc=Na("--lb"),hc=Na("--hb"),mc=Na("--a"),yc=0,gc=0,bc=0,Ac=!1,wc=0,Sc=$d("head-two-button"),_c=Sc.width*oc,kc=Sc.height*oc,$c=!1,Ic=!1;function Tc(){var e=Mc(),t=e.substring(0,e.length-1);ec.value=t,Nc(),Oc(-1,-1),Id()}function Ec(){ec.value="",Nc(),Oc(-1,-1),Id()}function Cc(e){e.preventDefault(),ec.focus(),Id()}function Lc(){!function(){if(!Ic){Ic=!0;var e,t=new DocumentFragment,n=Yl(pc);try{for(n.s();!(e=n.n()).done;){var r,i=Yl(e.value);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=document.createElement("button");o.classList.add("ye");var s=ep()?"touchstart":"mousedown";switch(a){case"刪除":o.addEventListener(s,Tc),o.appendChild(Nt("backspace"));break;case"清空":o.addEventListener(s,Ec),o.appendChild(document.createTextNode(a));break;case"鍵盤":o.addEventListener(s,Cc),o.appendChild(Nt("keyboard"));break;default:o.addEventListener(s,function(e){return function(){var t,n;t=e,n=`${Mc()}${t}`,ec.value=n,Nc(),Oc(-1,-1),Id()}}(a)),o.appendChild(document.createTextNode(a))}t.appendChild(o)}}catch(e){i.e(e)}finally{i.f()}}}catch(e){n.e(e)}finally{n.f()}ic.append(t)}}(),ic.setAttribute("displayed","true"),$c=!0,jc(),Oc(-1,-1)}function xc(){return parseInt(nc.getAttribute("type"))}function Mc(){return String(ec.value)}function Oc(e,t){var n=Mc(),r=!1;0===n.length?(n="搜尋路線、地點、公車",r=!0,e=0,t=0):-1===e&&-1===t&&(t=1*(e=n.length)),Sc=$d("head-two-button"),_c=Sc.width*oc,kc=Sc.height*oc,vc=Na("--lb"),hc=Na("--hb"),mc=Na("--a"),ac.font=`400 ${fc}px "Noto Sans TC", sans-serif`,ac.textAlign="center",ac.textBaseline="middle",yc=ac.measureText(n).width,gc=ac.measureText(n.substring(0,e)).width,bc=ac.measureText(n.substring(e,t)).width,wc=r?1:Math.max(1,gc),ac.clearRect(0,0,_c,kc),e===t?(Ac=!0,ac.globalAlpha=1,ac.fillStyle=r?hc:vc,ac.fillText(n,yc/2+(Math.min(wc,_c-sc)-wc),kc/2),Da(ac,Math.min(wc,_c-sc),(kc-dc)/2,uc,dc,lc,mc)):(Ac=!1,ac.globalAlpha=.27,Da(ac,Math.min(wc,_c-sc),(kc-dc)/2,bc,dc,cc,mc),ac.globalAlpha=1,ac.fillStyle=r?hc:vc,ac.fillText(n,yc/2+(Math.min(wc,_c-sc)-wc),kc/2),ac.globalAlpha=.08,Da(ac,Math.min(wc,_c-sc),(kc-dc)/2,bc,dc,cc,mc))}function Dc(){Sc=$d("head-two-button"),_c=Sc.width,kc=Sc.height,tc.width=_c*oc,tc.height=kc*oc,Oc(-1,-1)}function jc(){var e=performance.now(),t=1-Math.pow(Math.sin(Math.PI*e/960),4);Ac&&(ac.globalAlpha=t,ac.clearRect(Math.min(wc,_c-sc)-1,0,uc+2,kc),Da(ac,Math.min(wc,_c-sc),(kc-dc)/2,uc,dc,lc,mc)),$c&&window.requestAnimationFrame(jc)}function Pc(){var e=document.createElement("div");e.classList.add("ue");var t=document.createElement("div");t.classList.add("we");var n=document.createElement("div");return n.classList.add("ve"),n.appendChild(Rt()),e.appendChild(n),e.appendChild(t),{element:e,id:""}}function Nc(){var e=["route","location_on","directions_bus"];function t(t,n,r){function i(t,n){Ut(U(n,".ve"),e[t.item.type])}function a(e,t){U(t,".we").innerText=e.item.n}function o(e,t){switch(e.item.type){case 0:t.onclick=function(){Ju(e.item.id,e.item.pid)};break;case 1:t.onclick=function(){Ql(e.item.hash)};break;case 2:t.onclick=function(){Vt(e.item.id)}}}r?(n.item.type!==r.item.type&&i(n,t),n.item.id!==r.item.id&&(a(n,t),o(n,t))):(i(n,t),a(n,t),o(n,t))}var n=xc(),r=Mc();if(!rt(r)){var i=function(e,t,n){if(!At)return[];var r,i=e.toLowerCase(),a=nt(i,!0),o=nt(i,!1),s=[],u=ft(a);try{for(u.s();!(r=u.n()).done;){var l=`u_${r.value}`;gt.hasOwnProperty(l)&&s.push(gt[l])}}catch(e){u.e(e)}finally{u.f()}s.sort(function(e,t){return e.length-t.length});var c=s.length-1,d=[];if(0===c&&(d=s[0]),c>0)for(var f=0;f<c;f++){var p=s[f];d=tt(0===f?p:d,s[f+1])}var v=[],h=0,m=new Set;if(-1===t||2===t){var y,g=bt.filter(function(e){return e.n===i&&2===e.type}),b=ft(g);try{for(b.s();!(y=b.n()).done;){var A=y.value;if(v.push({item:A,score:1/0}),m.add(A.id),(h+=1)>=n)break}}catch(e){b.e(e)}finally{b.f()}}if(h<n){var w,S=ft(d);try{for(S.s();!(w=S.n()).done;){var _=w.value,k=bt[_];if((-1===t||t===k.type)&&!m.has(k.id)){var $=St(o,nt(k.n,!1));if(!(h<n))break;v.push({item:k,score:$}),h+=1}}}catch(e){S.e(e)}finally{S.f()}}return v.sort(function(e,t){return t.score-e.score}),v}(r,n,30),a=i.length,o=B(rc,".ue").length;if(a!==o){var s=o-a;if(s<0){for(var u=new DocumentFragment,l=0,c=Math.abs(s);l<c;l++){var d=Pc();u.appendChild(d.element)}rc.appendChild(u)}else for(var f=B(rc,".ue"),p=0,v=Math.abs(s);p<v;p++){f[o-1-p].remove()}}for(var h=B(rc,".ue"),m=0;m<a;m++){var y=Vl[m],g=i[m],b=h[m];t(b,g,y||null)}Vl=i}}function Rc(){hr?(gd("Search"),Zl.setAttribute("displayed","true"),Lc(),function(){wt.apply(this,arguments)}()):Wf("download_for_offline","資料還在下載中")}function Uc(){bd("Search"),ic.setAttribute("displayed","false"),$c=!1,Zl.setAttribute("displayed","false")}function Bc(){return(Bc=(0,r.A)(function*(){var e=yield Qn(),t=function(){var e=[];for(var t in Rf)if(Nf.indexOf(t)>-1&&Rf.hasOwnProperty(t)&&"select"===Rf[t].type){var n={key:t,option:Rf[t].option};e.push(n)}return e}(),n=yield bi(),r=yield Et(),i={};return i.time=(new Date).toISOString(),i.version=4,i.folders=e,i.settings=t,i.personal_schedules=n,i.recent_views=r,JSON.stringify(i)})).apply(this,arguments)}function Jc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Fc(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fc(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function qc(e){return Hc.apply(this,arguments)}function Hc(){return(Hc=(0,r.A)(function*(e){var t,n=Jc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r,a=!1,o=!1,s=`f_${i.id}`;if((yield b(11,s))?a=yield Un(i.id,i.name,i.icon):o=yield Nn(i.name,i.icon),a){var u,l=Jc(r.content);try{for(l.s();!(u=l.n()).done;){var c=u.value;yield Vn(r.id,c)}}catch(e){l.e(e)}finally{l.f()}}if(o){var d,f=Jc(r.content);try{for(f.s();!(d=f.n()).done;){var p=d.value;yield Vn(o,p)}}catch(e){f.e(e)}finally{f.f()}}}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function zc(e){return Qc.apply(this,arguments)}function Qc(){return(Qc=(0,r.A)(function*(e){var t,n=Jc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=qf(r.key);i&&"select"===i.type&&(yield Jf(r.key,r.option))}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function Wc(e){return Yc.apply(this,arguments)}function Yc(){return(Yc=(0,r.A)(function*(e){var t,n=Jc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;(yield hi(r.id))?yield yi(r):yield pi(r.name,r.period.start.hours,r.period.start.minutes,r.period.end.hours,r.period.end.minutes,r.days)}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function Gc(){return(Gc=(0,r.A)(function*(e){var t,n=Jc(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;switch(r.type){case"route":(yield Ot("route",r.id))||(yield xt(r.type,r.id));break;case"location":(yield Ot("location",r.hash))||(yield xt(r.type,r.hash));break;case"bus":(yield Ot("bus",r.id))||(yield xt(r.type,r.id))}}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function Vc(){return Vc=(0,r.A)(function*(e){var t=JSON.parse(e);switch(t.version){case 1:return yield qc(t.folders),!0;case 2:return yield qc(t.folders),yield zc(t.settings),!0;case 3:return yield qc(t.folders),yield zc(t.settings),yield Wc(t.personal_schedules),!0;case 4:return yield qc(t.folders),yield zc(t.settings),yield Wc(t.personal_schedules),yield function(e){return Gc.apply(this,arguments)}(t.recent_views),!0;default:return!1}}),Vc.apply(this,arguments)}function Zc(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new URLSearchParams(window.location.search);n.set("v",e);var r=window.location.pathname+"?"+n.toString();t?window.location.replace(r):history.replaceState(null,"",r)}function Kc(){return(Kc=(0,r.A)(function*(){try{var e=yield fetch(`./version.json?_=${(new Date).getTime()}`,{cache:"no-store"});if(!e.ok)throw new Error("Network response was not ok");return e.json()}catch(e){return!1}})).apply(this,arguments)}function Xc(){return N('head meta[name="version-hash"]').getAttribute("content")}function ed(){return N('head meta[name="version-branch-name"]').getAttribute("content")}function td(){return`https://github.com/EricHsia7/bus/tree/${N('head meta[name="version-full-hash"]').getAttribute("content")}`}function nd(){return N('head meta[name="version-time-stamp"]').getAttribute("content")}function rd(){return rd=(0,r.A)(function*(){var e=yield function(){return Kc.apply(this,arguments)}();return"boolean"==typeof e?!1===e?"fetchError":"unknownError":Xc()!==e.hash?(Zc(e.hash,!0),"refreshing"):(Zc(e.hash,!1),"ok")}),rd.apply(this,arguments)}function id(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ad(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ad(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ad(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var od=N(".im"),sd=U(od,".sm"),ud=U(sd,".um");function ld(e){var t=document.createElement("div");t.classList.add("wm"),t.setAttribute("type",e.type);var n=document.createElement("div");n.classList.add("ym");var r=document.createElement("span");r.appendChild(Nt(e.icon)),n.appendChild(r);var i=document.createElement("div");i.classList.add("zm"),i.appendChild(document.createTextNode(e.name));var a=document.createElement("div");a.classList.add("an"),a.appendChild(document.createTextNode(e.status));var o=document.createElement("div");o.classList.add("bn");var s=document.createElement("span");return s.appendChild(Nt("arrow_forward_ios")),o.appendChild(s),"function"==typeof e.action?t.onclick=function(){e.action()}:"string"==typeof e.action&&t.setAttribute("onclick",e.action),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(o),{element:t,id:""}}function cd(){return cd=(0,r.A)(function*(){var e=yield function(){return Bf.apply(this,arguments)}();ud.innerHTML="";var t,n=new DocumentFragment,r=id(e);try{for(r.s();!(t=r.n()).done;){var i=ld(t.value);n.appendChild(i.element)}}catch(e){r.e(e)}finally{r.f()}ud.append(n)}),cd.apply(this,arguments)}function dd(){gd("Settings"),od.setAttribute("displayed","true"),function(){cd.apply(this,arguments)}()}function fd(){bd("Settings"),od.setAttribute("displayed","false")}function pd(){return pd=(0,r.A)(function*(){Wf("manufacturing","資料匯出中");var e=yield function(){return Bc.apply(this,arguments)}();!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n=arguments.length>2?arguments[2]:void 0,r=new Blob([e],{type:t}),i=new File([r],n,{type:t});navigator.canShare&&navigator.canShare({files:[i]})?navigator.share({files:[i]}).catch(function(e){Wf("download","下載資料",{text:"下載",action:function(){Xf(r,n)}})}):Xf(r,n)}(e,"application/json","bus-export.json")}),pd.apply(this,arguments)}var vd=N(".tc"),hd=N(".xc"),md=(new Date).getTime(),yd=["Home"];function gd(e){var t=yd.length;yd[t-1]!==e&&yd.push(e)}function bd(e){if(yd.indexOf(e)>-1){var t=yd.length;yd[t-1]===e&&yd.pop()}}function Ad(){var e=yd.length;if(e>1)switch(yd[e-2]){case"Home":case"FolderIconSelector":case"Location":case"LocationDetails":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":case"QRCode":default:break;case"FolderCreator":Rr();break;case"FolderEditor":ei();break;case"FolderManager":ci();break;case"Search":Uc();break;case"Settings":fd();break;case"PersonalScheduleManager":Qi();break;case"PersonalScheduleEditor":Ni();break;case"Bus":Zt();break;case"RegisterNotification":xa()}}function wd(){var e=yd.length;if(e>1){var t=yd[e-2];switch(yd.pop(),t){case"Home":case"FolderIconSelector":case"Location":case"LocationDetails":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":case"QRCode":default:break;case"FolderCreator":Nr();break;case"FolderEditor":Xr();break;case"FolderManager":li();break;case"Search":Rc();break;case"Settings":dd();break;case"PersonalScheduleManager":zi();break;case"PersonalScheduleEditor":Pi();break;case"Bus":Vt();break;case"RegisterNotification":La()}}}function Sd(){var e=0;window.matchMedia("(display-mode: standalone)").matches&&(e=-1*(window.outerHeight-window.innerHeight)/2),N(".tc svg.uc").style.setProperty("--vc",`${e}px`)}function _d(e){function t(){vd.classList.add("wc"),vd.addEventListener("animationend",function(){vd.setAttribute("displayed","false"),vd.classList.remove("wc"),"function"==typeof e&&e()},{once:!0})}var n=(new Date).getTime();n-md<100?setTimeout(t,Math.max(1,n-md)):t()}function kd(){hd.setAttribute("displayed","true")}function $d(e){var t=0,n=0,r=window.innerWidth,i=window.innerHeight;switch(e){case"window":t=r,n=i;break;case"head":t=r,n=55;break;case"head-one-button":t=r-55,n=55;break;case"head-two-button":t=r-110,n=55;break;case"route-details-canvas":t=r-20-20,n=1680;break;case"route-bus-arrival-time-chart":t=r-45-15-20,n=75;break;case"location-bus-arrival-time-chart":t=r-30-20,n=75;break;default:t=0,n=0}return{width:t,height:n}}function Id(){window.scrollTo({top:0,behavior:"instant"})}var Td=N(".ns"),Ed=U(Td,".rs"),Cd=U(Ed,".ss"),Ld=U(Ed,".ts"),xd=U(Ld,'.us[name="total-data-usage"] .ws'),Md=U(Ld,'.us[name="max-data-usage-per-minute"] .ws'),Od=U(Ld,'.us[name="min-data-usage-per-minute"] .ws'),Dd=U(Ld,'.us[name="start-time"] .ws'),jd=U(Ld,'.us[name="end-time"] .ws');function Pd(){return Pd=(0,r.A)(function*(){var e=$d("window"),t=e.width,n=Math.min(5/18*t,.33*e.height),r=yield function(e,t,n){return O.apply(this,arguments)}(t,n,20);xd.innerText=j(r.stats.sum),Md.innerText=j(r.stats.max),Od.innerText=j(r.stats.min),Dd.innerText=s(r.period.start,"YYYY-MM-DD"),jd.innerText=s(r.period.end,"YYYY-MM-DD"),Cd.innerHTML=r.chart}),Pd.apply(this,arguments)}function Nd(){return Nd=(0,r.A)(function*(e){if(""===ra||""===ia||void 0===e)return!1;var t=Wi("cancel"),n=Gi("cancel",[e]),r=yield Vi("cancel",t,n);return!1!==r&&(200===r.code&&"cancel"===r.method&&(yield function(e){return ha.apply(this,arguments)}(e),!0))}),Nd.apply(this,arguments)}var Rd=N(".ar"),Ud=U(Rd,".dr"),Bd=U(Ud,".hr"),Jd=U(Bd,".ir"),Fd=U(Rd,".kr"),qd=U(Fd,".lr"),Hd={},zd=!1,Qd=15e3,Wd=5e3,Yd=15e3,Gd=!0,Vd=0,Zd=0,Kd="",Xd=!1,ef=!1,tf=!1;function nf(e){var t=e;if(Xd){var n=t.detail.progress-1;Jd.style.setProperty("--br",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,nf)}function rf(){var e=Zf(),t=document.createElement("div");t.classList.add("mr"),t.id=e;var n=document.createElement("div");n.classList.add("nr"),t.appendChild(n);var r=document.createElement("div");r.classList.add("or");var i=document.createElement("div");i.classList.add("pr"),r.appendChild(i);var a=document.createElement("div");a.classList.add("qr"),r.appendChild(a);var o=document.createElement("div");o.classList.add("rr"),r.appendChild(o);var s=document.createElement("div");s.classList.add("sr");var u=document.createElement("span");return u.appendChild(Nt("close")),s.appendChild(u),r.appendChild(s),t.appendChild(r),{element:t,id:e}}function af(e,t,n){function r(e,r,i){function a(e,t){U(e,".nr").innerText=t.hours}function o(e,t){var n=U(e,".or");U(n,".pr").innerText=t.minutes}function s(e,t){var n=U(e,".or");U(n,".rr").innerText=t.name}function u(e,t){var n=U(e,".or");U(n,".qr").innerText=`${t.route.name} - 往${t.route.direction}`}function l(e,t){var n=U(e,".or");U(n,".sr").onclick=function(){!function(e,t){df.apply(this,arguments)}(e.id,t.schedule_id)}}function c(e,t){e.setAttribute("first",tp(t.is_first))}function d(e,t){e.setAttribute("animation",tp(t))}function f(e,t){e.setAttribute("skeleton-screen",tp(t))}null==i?(a(e,r),o(e,r),s(e,r),u(e,r),l(e,r),c(e,r),d(e,n),f(e,t)):(r.hours!==i.hours&&a(e,r),r.minutes!==i.minutes&&o(e,r),Vf(i.schedule_id,r.schedule_id)||(s(e,r),u(e,r),l(e,r)),i.is_first!==r.is_first&&c(e,r),false!==n&&d(e,n),zd!==t&&f(e,t))}var i=e.itemQuantity,a=e.items,o=B(qd,".mr").length;if(i!==o){var s=o-i;if(s<0){for(var u=new DocumentFragment,l=0,c=Math.abs(s);l<c;l++){var d=rf();u.appendChild(d.element)}qd.append(u)}else for(var f=B(qd,".mr"),p=0,v=Math.abs(s);p<v;p++){f[o-1-p].remove()}}for(var h=B(qd,".mr"),m=0;m<i;m++){var y=h[m],g=a[m];if(Hd.hasOwnProperty("items"))if(Hd.items[m])r(y,g,Hd.items[m]);else r(y,g,null);else r(y,g,null)}Hd=e,zd=t}function of(){return sf.apply(this,arguments)}function sf(){return(sf=(0,r.A)(function*(){var e=Hf("playing_animation"),t=Hf("refresh_interval");Gd=t.dynamic,Qd=t.baseInterval,Xd=!0,Kd=Zf(),Jd.setAttribute("refreshing","true"),Jd.classList.remove("jr"),document.addEventListener(Kd,nf);var n=yield ga(Kd);af(n,!1,e);var r=0;Gd&&(r=yield _n()),Vd=(new Date).getTime(),Zd=Gd?Math.max(Vd+Wd,n.dataUpdateTime+Qd/r):Vd+Qd,Yd=Math.max(Wd,Zd-Vd),Xd=!1,Jd.setAttribute("refreshing","false"),Jd.style.setProperty("--cr",`${Yd}ms`),Jd.classList.add("jr")})).apply(this,arguments)}function uf(){return lf.apply(this,arguments)}function lf(){return(lf=(0,r.A)(function*(){of().then(function(){ef?setTimeout(function(){uf()},Math.max(Wd,Zd-(new Date).getTime())):tf=!1}).catch(function(e){ef?setTimeout(function(){uf()},1e4):tf=!1})})).apply(this,arguments)}function cf(){gd("NotificationScheduleManager"),Rd.setAttribute("displayed","true"),function(){for(var e=Hf("playing_animation"),t=$d("window"),n=(t.width,t.height),r=Math.floor(n/50)+5,i=[],a=0;a<r;a++)i.push({name:"",stop_id:0,estimate_time:0,schedule_id:"null",scheduled_time:0,route:{name:"",direction:"",id:0,pathAttributeId:[]},is_first:!0,date:"",hours:"",minutes:""});af({items:i,itemQuantity:r,dataUpdateTime:0},!0,e)}(),ef||(ef=!0,tf?of():(tf=!0,uf())),Ad()}function df(){return df=(0,r.A)(function*(e,t){Wf("manufacturing","處理中");var n=yield function(e){return Nd.apply(this,arguments)}(t);if(n){if(U(qd,`.mr#${e}`).remove(),Wf("check_circle","已取消通知"),!Xd){var r=Hf("playing_animation");af(yield ga(Kd),!1,r)}}else Wf("error","取消失敗")}),df.apply(this,arguments)}function ff(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return pf(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function pf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var vf=N(".jm"),hf=U(vf,".tm"),mf=U(hf,".vm"),yf=U(hf,".fn"),gf=U(vf,".lm"),bf=U(gf,".rm");function Af(e,t,n){var r=document.createElement("div");r.classList.add("xm");var i=document.createElement("div");i.classList.add("_m"),i.appendChild(document.createTextNode(t.name));var a=document.createElement("div");a.classList.add("cn");var o=document.createElement("input");return o.type="checkbox",o.checked=e.option===n,o.onclick=function(t){!function(e,t,n){var r,i=ff(R('.jm .tm .vm .xm .cn input[type="checkbox"]'));try{for(i.s();!(r=i.n()).done;){r.value.checked=!1}}catch(e){i.e(e)}finally{i.f()}var a=e.target;a.checked=!0,Jf(t,n)}(t,e.key,n)},a.appendChild(o),r.appendChild(i),r.appendChild(a),{element:r,id:""}}function wf(e){gd("SettingsOptions"),vf.setAttribute("displayed","true"),function(e){var t=qf(e);bf.innerText=t.name,yf.innerText=t.description,mf.innerHTML="";var n,r=new DocumentFragment,i=0,a=ff(t.options);try{for(a.s();!(n=a.n()).done;){var o=Af(t,n.value,i);r.appendChild(o.element),i+=1}}catch(e){a.e(e)}finally{a.f()}mf.append(r)}(e),Ad()}function Sf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function kf(e){var t=[["快取","cache"],["設定","settings"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["個人化行程","personalSchedule"],["最近檢視","recentViews"],["通知","notification"],["通知","notification"],["資料夾","folders"],["資料夾","folders"],["資料夾","folders"]][e]||["其他","others"],n=(0,i.A)(t,2);return{name:n[0],key:n[1]}}function $f(){return($f=(0,r.A)(function*(){for(var e=0,t={},n=m.length,r=0;r<n;r++){var i,a=0,o=Sf(yield _(r));try{for(o.s();!(i=o.n()).done;){var s=i.value,u=yield b(r,s),l=String(u).length+s.length;e+=l,a+=l}}catch(e){o.e(e)}finally{o.f()}var c=kf(r),d=c.key;t.hasOwnProperty(d)||(t[d]={category:c,size:0}),t[c.key].size+=a}var f=j(e),p={};for(var v in t){var h=t[v].category,y=t[v].size;p[v]={category:h,size:j(y)}}return{totalSize:f,categorizedSizes:p}})).apply(this,arguments)}var If=[],Tf=!1,Ef=!1,Cf=N(".xs"),Lf=U(Cf,".at"),xf=U(Lf,".bt");function Mf(){var e=document.createElement("div");e.classList.add("ct");var t=document.createElement("div");t.classList.add("dt");var n=document.createElement("div");return n.classList.add("et"),e.appendChild(t),e.appendChild(n),{element:e,id:""}}function Of(e,t,n){function r(e,r,i){function a(e,t){U(e,".et").innerText=t.size}function o(e,t){U(e,".dt").innerText=t.category.name}function s(e,t){e.setAttribute("animation",tp(t))}function u(e,t){e.setAttribute("skeleton-screen",tp(t))}i?(r.category.key!==i.category.key&&(o(e,r),a(e,r)),r.size!==i.size&&a(e,r),Tf!==n&&s(e,n),Ef!==t&&u(e,t)):(a(e,r),o(e,r),s(e,n),u(e,t))}var i=[];for(var a in e.categorizedSizes){var o=e.categorizedSizes[a];i.push(o)}var s=i.length,u=B(xf,".ct").length;if(s!==u){var l=u-s;if(l<0){for(var c=new DocumentFragment,d=0,f=Math.abs(l);d<f;d++){var p=Mf();c.appendChild(p.element)}xf.appendChild(c)}else for(var v=B(xf,".ct"),h=0,m=Math.abs(l);h<m;h++){v[u-1-h].remove()}}for(var y=B(xf,".ct"),g=0;g<s;g++){var b=If[g],A=i[g],w=y[g];r(w,A,b||null)}If=i,Ef=t,Tf=n}function Df(){return Df=(0,r.A)(function*(){var e=Hf("playing_animation");!function(){for(var e=Hf("playing_animation"),t=$d("window").height,n=Math.min(7,Math.floor(t/55)+2),r={categorizedSizes:{},totalSize:0},i=0;i<n;i++){var a=`store-${i}`;r.categorizedSizes[a]={category:{name:"",key:a},size:`size-${i}`}}Of(r,!0,e)}();var t=yield function(){return $f.apply(this,arguments)}();Of(t,!1,e)}),Df.apply(this,arguments)}function jf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Pf(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Pf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Nf=["time_formatting_mode","refresh_interval","display_user_location","display_user_orientation","location_labels","proxy","folder","personal_schedule","notification","playing_animation","power_saving","data_usage","storage","persistent_storage","export","import","version","branch","last_update_date","github"],Rf={time_formatting_mode:{key:"time_formatting_mode",name:"預估時間格式",icon:"glyphs",status:"",action:function(){wf("time_formatting_mode")},type:"select",default_option:0,option:0,options:[{name:`${l(11,3)}/${l(61,3)}/${l(3661,3)}`,value:{type:1,number:3},resourceIntensive:!1,powerSavingAlternative:-1},{name:`${l(11,2)}/${l(61,2)}/${l(3661,2)}`,value:{type:1,number:2},resourceIntensive:!1,powerSavingAlternative:-1},{name:`${l(11,1)}/${l(61,1)}/${l(3661,1)}`,value:{type:1,number:1},resourceIntensive:!1,powerSavingAlternative:-1},{name:`${l(11,0)}/${l(61,0)}/${l(3661,0)}`,value:{type:1,number:0},resourceIntensive:!1,powerSavingAlternative:-1}],description:"在首頁、路線頁面、地點頁面上的預估公車到站時間的顯示格式。"},refresh_interval:{key:"refresh_interval",name:"預估時間更新頻率",icon:"pace",status:"",action:function(){wf("refresh_interval")},type:"select",default_option:0,option:0,options:[{name:"自動",value:{baseInterval:15e3,dynamic:!0,type:3},resourceIntensive:!0,powerSavingAlternative:2},{name:"10秒",value:{baseInterval:1e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:2},{name:"20秒",value:{baseInterval:2e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:3},{name:"30秒",value:{baseInterval:3e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:4},{name:"40秒",value:{baseInterval:4e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:5},{name:"50秒",value:{baseInterval:5e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:6},{name:"60秒",value:{baseInterval:6e4,dynamic:!1,type:3},resourceIntensive:!0,powerSavingAlternative:6}],description:"在首頁、路線頁面、地點頁面上的預估公車到站時間、公車等即時資料更新的頻率。"},display_user_location:{key:"display_user_location",name:"顯示所在位置",icon:"near_me",status:"",action:function(){wf("display_user_location")},type:"select",default_option:1,option:1,options:[{name:"開啟",value:{type:2,boolean:!0},resourceIntensive:!0,powerSavingAlternative:1},{name:"關閉",value:{type:2,boolean:!1},resourceIntensive:!1,powerSavingAlternative:-1}],description:"是否在路線頁面上標註目前所在位置。若設為開啟，本應用程式將要求位置存取權限。"},display_user_orientation:{key:"display_user_orientation",name:"顯示裝置指向",icon:"explore",status:"",action:function(){wf("display_user_orientation")},type:"select",default_option:1,option:1,options:[{name:"開啟",value:{type:2,boolean:!0},resourceIntensive:!0,powerSavingAlternative:1},{name:"關閉",value:{type:2,boolean:!1},resourceIntensive:!1,powerSavingAlternative:-1}],description:"是否在地點頁面上顯示裝置所指方向。若設為開啟，本應用程式將要求動作與方向存取權限。"},location_labels:{key:"location_labels",name:"站牌位置標籤",icon:"tag",status:"",action:function(){wf("location_labels")},type:"select",default_option:0,option:0,options:[{name:"行徑方向",value:{type:0,string:"directions"},resourceIntensive:!1,powerSavingAlternative:-1},{name:"地址特徵",value:{type:0,string:"address"},resourceIntensive:!1,powerSavingAlternative:-1},{name:"英文字母",value:{type:0,string:"letters"},resourceIntensive:!1,powerSavingAlternative:-1}],description:"用於區分位於同個地點的不同站牌。行徑方向表示可搭乘路線從本站到下一站的方向（與車流同向）；地址特徵表示不同站牌的地址差異處；英文字母表示按照順序以字母編號。"},proxy:{key:"proxy",name:"網路代理",icon:"router",status:"",action:function(){wf("proxy")},type:"select",default_option:1,option:1,options:[{name:"開啟",value:{type:2,boolean:!0},resourceIntensive:!1,powerSavingAlternative:-1},{name:"關閉",value:{type:2,boolean:!1},resourceIntensive:!1,powerSavingAlternative:-1}],description:"使用網路代理來擷取資料。"},folder:{key:"folder",name:"資料夾",icon:"folder",status:"",type:"page",action:li,description:""},personal_schedule:{key:"personal_schedule",name:"個人化行程",icon:"calendar_view_day",status:"",action:zi,type:"page",description:""},notification:{key:"notification",name:"通知",icon:"notifications",status:"",action:cf,type:"page",description:""},playing_animation:{key:"playing_animation",name:"動畫",icon:"animation",description:"是否在介面中播放動畫。",status:"",type:"select",action:function(){wf("playing_animation")},default_option:0,option:0,options:[{name:"開啟",value:{type:2,boolean:!0},resourceIntensive:!0,powerSavingAlternative:1},{name:"關閉",value:{type:2,boolean:!1},resourceIntensive:!1,powerSavingAlternative:-1}]},power_saving:{key:"power_saving",name:"省電模式",icon:"battery_low",description:"暫停使用耗電功能來節省電力。",status:"",type:"select",action:function(){wf("power_saving")},default_option:1,option:1,options:[{name:"開啟",value:{type:2,boolean:!0},resourceIntensive:!1,powerSavingAlternative:-1},{name:"關閉",value:{type:2,boolean:!1},resourceIntensive:!1,powerSavingAlternative:-1}]},data_usage:{key:"data_usage",name:"網路使用量",icon:"bigtop_updates",status:"",type:"page",action:function(){gd("DataUsage"),Td.setAttribute("displayed","true"),function(){Pd.apply(this,arguments)}(),Ad()},description:""},storage:{key:"storage",name:"儲存空間",icon:"database",status:"",type:"page",action:function(){Cf.setAttribute("displayed","true"),function(){Df.apply(this,arguments)}()},description:""},persistent_storage:{key:"persistent_storage",name:"永久儲存",icon:"storage",status:"",action:function(){(function(){return T.apply(this,arguments)})().then(function(e){switch(e){case"granted":Wf("check_circle","已開啟永久儲存");break;case"denied":Wf("cancel","永久儲存權限已被拒絕");break;case"unsupported":Wf("warning","此瀏覽器不支援永久儲存");break;default:Wf("error","發生錯誤")}})},type:"action",description:"開啟此選項以避免瀏覽器自動刪除重要資料。"},export:{key:"export",name:"匯出資料",icon:"upload",status:"",type:"action",action:function(){return pd.apply(this,arguments)},description:""},import:{key:"import",name:"匯入資料",icon:"download",status:"",type:"action",action:function(){var e=Zf(),t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","application/json"),t.setAttribute("name",e),t.id=e,t.classList.add("gn"),t.addEventListener("change",function(t){if(0===t.target.files.length)N(`body #${e}`).remove();else{var n=t.target.files[0],r=new FileReader;r.onload=function(t){(function(e){return Vc.apply(this,arguments)})(t.target.result).then(function(t){t?Wf("check_circle","已匯入資料"):Wf("error","無法匯入資料"),N(`body #${e}`).remove()})},r.readAsText(n)}},{once:!0}),t.addEventListener("cancel",function(){N(`body #${e}`).remove()},{once:!0}),document.body.append(t),N(`body #${e}`).click()},description:""},version:{key:"version",name:"版本",icon:"commit",status:"",type:"info",action:function(){var e=td();window.open(e)},description:""},branch:{key:"branch",name:"分支",icon:"rebase",status:"",type:"info",action:function(){},description:""},last_update_date:{key:"last_update_date",name:"更新時間",icon:"update",status:"",type:"info",action:function(){},description:""},github:{key:"github",name:"GitHub",icon:"book_2",status:"@EricHsia7/bus",type:"info",action:function(){window.open("https://github.com/EricHsia7/bus")},description:""}};function Uf(){return(Uf=(0,r.A)(function*(){var e,t=jf(yield _(1));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(Nf.indexOf(n)>-1){var r=yield b(1,n);if(null!==r){if("select"===Rf[n].type){var i=parseInt(r);Rf[n].option=i}}else"select"===Rf[n].type&&(Rf[n].option=Rf[n].default_option)}}}catch(e){t.e(e)}finally{t.f()}return!0})).apply(this,arguments)}function Bf(){return(Bf=(0,r.A)(function*(){var e=[];for(var t in Rf){var n=Rf[t];switch(n.type){case"select":n.status=n.options[n.option].name;break;case"page":if("notification"===t)n.status=da()?"已註冊":"未註冊";else n.status="";break;case"action":n.status="","persistent_storage"===t&&(n.status=(yield $())?"開啟":"關閉");break;case"info":if("version"===t&&(n.status=Xc()),"branch"===t&&(n.status=ed()),"last_update_date"===t){var r=new Date(nd());n.status=u(r)}}e.push(n)}return e})).apply(this,arguments)}function Jf(e,t){return Ff.apply(this,arguments)}function Ff(){return(Ff=(0,r.A)(function*(e,t){return!!(Nf.indexOf(e)>-1&&Rf.hasOwnProperty(e)&&"select"===Rf[e].type&&void 0!==Rf[e].options[t]&&null!==Rf[e].options[t])&&(yield y(1,e,t),Rf[e].option=t,!0)})).apply(this,arguments)}function qf(e){if(Nf.indexOf(e)>-1&&Rf.hasOwnProperty(e))return Rf[e]}function Hf(e){if(Nf.indexOf(e)>-1&&Rf.hasOwnProperty(e)){var t=Rf.power_saving,n=t.options[t.option].value.boolean,r=Rf[e],i=r.options[r.option];n&&i.resourceIntensive&&(i=r.options[i.powerSavingAlternative]);var a=i.value;switch(a.type){case 0:return a.string;case 1:return a.number;case 2:return a.boolean;case 3:return a;default:return""}}return""}function zf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Qf(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Qf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Wf(e,t,n){var r=R(".lt");if(null!==r){var i,o=zf(r);try{for(o.s();!(i=o.n()).done;){i.value.remove()}}catch(e){o.e(e)}finally{o.f()}}var s=Hf("playing_animation"),u=document.createElement("div");u.classList.add("lt"),u.setAttribute("animation",tp(s));var l=document.createElement("div");l.classList.add("mt"),l.appendChild(Nt(e)),u.appendChild(l);var c=document.createElement("div");if(c.classList.add("nt"),c.innerText=t,u.appendChild(c),"object"===(0,a.A)(n)&&null!=n&&"function"==typeof(null==n?void 0:n.action)){var d=document.createElement("div");d.classList.add("ot"),d.innerText=n.text,d.addEventListener("click",function(){n.action()},{once:!0}),u.appendChild(d)}u.addEventListener("animationend",function(e){null!=e&&e.target&&e.target.remove()},{once:!0}),document.body.appendChild(u)}var Yf=n(3503),Gf=n(4462).sha512;function Vf(e,t){function n(e){return JSON.stringify({e})}var r=n(e),i=n(t),a=r.length,o=i.length;if(a===o){if(a>32||o>32){for(var s=Yf(r),u=Yf(i),l=!0,c=0;c<8;c++){if(s.charAt(c)!==u.charAt(c)){l=!1;break}}return l}return r===i}return!1}function Zf(){var e=[[48,10],[97,26],[65,26]],t=Math.floor(268435456*Math.random()),n=Math.floor(268435456*Math.random()),r=new Uint8Array(17);r[0]=95;for(var i=16;i>0;i--){var a=e[n%3],o=a[0]+t%a[1];r[i]=o,t>>>=1,n>>>=1}return String.fromCharCode.apply(null,r)}function Kf(e){return((new Date).getTime()/e|0).toString(16)}function Xf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32e3,r=URL.createObjectURL(e),i=document.createElement("a");return i.href=r,i.download=t,document.body.appendChild(i),i.click(),i.remove(),setTimeout(function(){URL.revokeObjectURL(r)},n),r}function ep(){return!(!("ontouchstart"in window)&&!navigator.maxTouchPoints)}function tp(e){if("boolean"==typeof e)return e?"true":"false"}function np(e){try{return new URL(e),!0}catch(e){return!1}}function rp(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ip(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ip(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ip(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ap,op="",sp=!1,up=[],lp={data:{},timestamp:0,id:""},cp=0,dp={};if("undefined"!=typeof SharedWorker){var fp=new SharedWorker(new URL(n.p+n.u(627),n.b));(ap=fp.port).start()}else{var pp=new Worker(new URL(n.p+n.u(627),n.b));ap=pp}function vp(e){return hp.apply(this,arguments)}function hp(){return(hp=(0,r.A)(function*(e){var t=Zf();return yield new Promise(function(n,r){dp[t]=n,ap.onerror=function(e){r(e.message)},ap.postMessage([e,t])})})).apply(this,arguments)}function mp(e,t){for(var n=new Uint32Array(1440),r=1439;r>=0;r--)n[r]=e[r]+t[r];return Array.from(n)}function yp(){return yp=(0,r.A)(function*(e){var t=new Date,n=t.getTime(),r=t.getDay(),i=!1;if(!sp){sp=!0,op=Zf(),lp={id:op,timestamp:n,data:{}},cp=0;var a=yield function(e){return Yn.apply(this,arguments)}(["stop"]);up=a.map(function(e){return e.id})}if(function(e){return Si.apply(this,arguments)}(t)){var o,s=rp(e);try{for(s.s();!(o=s.n()).done;){var u=o.value,l=u.StopID,c=`s_${l}_${r}`;up.indexOf(l)>-1&&(lp.data.hasOwnProperty(c)||(lp.data[c]=[]),lp.data[c].push([parseInt(u.EstimateTime),n]))}}catch(e){s.e(e)}finally{s.f()}if((cp+=1)>32&&(i=!0),(i||cp%8==0)&&(yield y(5,op,JSON.stringify(lp))),i){var d,f=rp(up);try{for(f.s();!(d=f.n()).done;){var p=d.value,v=`s_${p}_${r}`,h=lp.data[v],m={},g=yield b(6,v);if(g){var A=JSON.parse(g),S=vp(h),_=mp(A.stats,S);m.stats=_;var k=tn(_);m.min=k[0],m.max=k[1],m.day=r,m.timestamp=A.timestamp,m.id=p}else{var $=vp(h);m.stats=$;var I=tn($);m.min=I[0],m.max=I[1],m.day=r,m.timestamp=n,m.id=p}yield y(6,v,JSON.stringify(m)),yield w(5,op)}}catch(e){f.e(e)}finally{f.f()}sp=!1}}}),yp.apply(this,arguments)}function gp(){return(gp=(0,r.A)(function*(){var e,t=new Date,n=t.getTime(),r=t.getDay(),i=rp(yield _(5));try{for(i.s();!(e=i.n()).done;){var a=e.value,o=yield b(5,a),s=JSON.parse(o),u=s.id;for(var l in s.data){var c=s.data[l],d={},f=yield b(6,l),p=parseInt(l.split("_")[1]);if(f){var v=JSON.parse(f),h=vp(c),m=mp(v.stats,h);d.stats=m;var g=tn(m);d.min=g[0],d.max=g[1],d.day=v.day,d.timestamp=v.timestamp,d.id=p}else{var A=vp(c);d.stats=A;var S=tn(A);d.min=S[0],d.max=S[1],d.day=r,d.timestamp=n,d.id=p}yield y(6,l,JSON.stringify(d))}yield w(5,u)}}catch(e){i.e(e)}finally{i.f()}})).apply(this,arguments)}function bp(){return(bp=(0,r.A)(function*(){var e,t=[],n=rp(yield _(6));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=yield b(6,r);if(i){var a=JSON.parse(i);t.push(a)}}}catch(e){n.e(e)}finally{n.f()}return t})).apply(this,arguments)}ap.onmessage=function(e){var t=(0,i.A)(e.data,2),n=t[0],r=t[1];dp[r]&&(dp[r](n),delete dp[r])},ap.onerror=function(e){};var Ap,wp={};if("undefined"!=typeof SharedWorker){var Sp=new SharedWorker(new URL(n.p+n.u(113),n.b));(Ap=Sp.port).start()}else{var _p=new Worker(new URL(n.p+n.u(494),n.b));Ap=_p}function kp(e,t){return $p.apply(this,arguments)}function $p(){return $p=(0,r.A)(function*(e,t){var n=Zf(),r=yield bi(),i=yield function(){return bp.apply(this,arguments)}();return yield new Promise(function(a,o){wp[n]=a,Ap.onerror=function(e){o(e.message)},Ap.postMessage([r,i,e,t,n])})}),$p.apply(this,arguments)}Ap.onmessage=function(e){var t=(0,i.A)(e.data,2),n=t[0],r=t[1];wp[r]&&(wp[r](n),delete wp[r])},Ap.onerror=function(e){};var Ip=N("._c"),Tp=U(Ip,".ed"),Ep=U(Ip,".ld"),Cp=U(Ep,".xd"),Lp=U(Tp,".id .jd"),xp={},Mp=!1,Op=!1,Dp=15e3,jp=5e3,Pp=15e3,Np=!0,Rp=0,Up=0,Bp="",Jp=!1,Fp=!1,qp=!1;function Hp(){var e=document.createElement("div");e.classList.add("ce"),e.setAttribute("type","stop");var t=document.createElement("div");t.classList.add("de"),t.appendChild(Nt("location_on"));var n=document.createElement("div");n.classList.add("ee");var r=document.createElement("div");r.classList.add("fe");var i=document.createElement("div");i.classList.add("ge");var a=document.createElement("div");a.classList.add("je");var o=document.createElement("div");o.classList.add("ke"),o.setAttribute("code","0"),o.setAttribute("displayed","false");var s=document.createElement("div");s.classList.add("le"),s.setAttribute("code","0"),s.setAttribute("displayed","true"),a.appendChild(o),a.appendChild(s);var u=document.createElement("div");u.classList.add("he"),u.appendChild(Nt("keyboard_arrow_right"));var l=document.createElement("div");return l.classList.add("ie"),i.appendChild(a),i.appendChild(u),i.appendChild(l),e.appendChild(t),e.appendChild(n),e.appendChild(r),e.appendChild(i),{element:e,id:""}}function zp(){var e=document.createElement("div");e.classList.add("yd");var t=document.createElement("div");t.classList.add("zd");var n=document.createElement("div");n.classList.add("_d"),n.appendChild(Rt());var r=document.createElement("div");r.classList.add("ae"),t.appendChild(n),t.appendChild(r);var i=document.createElement("div");return i.classList.add("be"),e.appendChild(t),e.appendChild(i),{element:e,id:""}}function Qp(e){var t=e;if(Jp){var n=t.detail.progress-1;Lp.style.setProperty("--cd",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Qp)}function Wp(){for(var e=Hf("playing_animation"),t=$d("window"),n=(t.width,t.height),r=Math.floor(n/50/3)+2,i=[],a=0;a<3;a++){for(var o={name:"",icon:"",id:"",timestamp:0,content:[],contentLength:r},s=0;s<r;s++){o.content.push({type:"stop",id:0,timestamp:0,name:"",status:{code:8,text:"",time:-6},direction:0,route:{name:"",endPoints:{departure:"",destination:""},id:0,pathAttributeId:[]}})}i.push(o)}Yp({folders:i,dataUpdateTime:0},!0,e)}function Yp(e,t,n){function r(e,r,i){function a(e,t){e.setAttribute("type",t.type)}function o(e,t){var n=U(e,".de"),r="";switch(t.type){case"stop":case"location":r="location_on";break;case"route":r="route";break;case"bus":r="directions_bus";break;case"empty":r="lightbulb";break;default:r=""}Ut(n,r)}function s(e,t,n){if("stop"===t.type){var r=e.getBoundingClientRect(),i=r.top,a=r.left,o=r.bottom,s=r.right,u=window.innerWidth,l=window.innerHeight,c=U(e,".ge .je"),d=U(c,".ke"),f=U(c,".le");d.setAttribute("code",t.status.code.toString()),d.innerText=t.status.text,n&&o>0&&i<l&&s>0&&a<u?(f.addEventListener("animationend",function(){f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,f.classList.remove("me"),d.setAttribute("displayed","false")},{once:!0}),d.setAttribute("displayed","true"),f.classList.add("me")):(f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text)}}function u(e,t){var n="";switch(t.type){case"stop":case"route":case"location":n=t.name;break;case"bus":n=t.busID;break;case"empty":n="沒有內容";break;default:n="null"}U(e,".fe").innerText=n}function l(e,t){var n="";switch(t.type){case"stop":n=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`;break;case"route":n=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`;break;case"location":n="地點";break;case"bus":break;case"empty":n="提示";break;default:n="null"}U(e,".ee").innerText=n}function c(e,t){var n=U(e,".ge .he");switch(t.type){case"stop":n.onclick=function(){Ju(t.route.id,t.route.pathAttributeId)};break;case"route":n.onclick=function(){Ju(t.id,t.pathAttributeId)};break;case"location":n.onclick=function(){Ql(t.id)}}}function d(e,t){e.setAttribute("animation",tp(t))}function f(e,t){e.setAttribute("skeleton-screen",tp(t))}if(null==i)a(e,r),o(e,r),s(e,r,n),u(e,r),l(e,r),c(e,r),d(e,n),f(e,t);else if(r.type!==i.type)a(e,r),o(e,r),s(e,r,n),u(e,r),l(e,r),c(e,r),d(e,n),f(e,t);else{switch(r.type){case"stop":Vf(i.route,r.route)||(l(e,r),c(e,r)),i.name!==r.name&&u(e,r),i.status.time!==r.status.time&&s(e,r,n);break;case"route":i.id!==r.id&&c(e,r),Vf(i.endPoints,r.endPoints)||l(e,r),i.name!==r.name&&u(e,r);break;case"location":i.id!==r.id&&c(e,r),i.name!==r.name&&u(e,r);break;case"bus":default:break;case"empty":r.type!==i.type&&(l(e,r),u(e,r))}t!==Op&&f(e,t),n!==Mp&&d(e,n)}}function i(e,r,i){function a(e,t){var n=U(e,".zd");U(n,".ae").innerText=t.name}function o(e,t){var n=U(e,".zd");Ut(U(n,"._d"),t.icon)}function s(e,t){e.setAttribute("animation",tp(t))}function u(e,t){e.setAttribute("skeleton-screen",tp(t))}null==i?(a(e,r),o(e,r),s(e,n),u(e,t)):(r.name!==i.name&&a(e,r),r.icon!==i.icon&&o(e,r),n!==Mp&&s(e,n),t!==Op&&u(e,t))}var a=e.folders,o=a.length,s=B(Cp,".yd").length;if(o!==s){var u=s-o;if(u<0){for(var l=new DocumentFragment,c=0,d=Math.abs(u);c<d;c++){var f=zp();l.appendChild(f.element)}Cp.append(l)}else for(var p=B(Cp,".yd"),v=0,h=Math.abs(u);v<h;v++){p[s-1-v].remove()}}for(var m=B(Cp,".yd"),y=0;y<o;y++){var g=a[y].content.length,b=U(m[y],".be"),A=B(b,".ce").length;if(g!==A){var w=A-g;if(w<0)for(var S=0,_=Math.abs(w);S<_;S++){var k=Hp();b.appendChild(k.element)}else for(var $=B(b,".ce"),I=0,T=Math.abs(w);I<T;I++){$[A-1-I].remove()}}}for(var E=B(Cp,".yd"),C=0;C<o;C++){var L=a[C],x=L.content,M=x.length,O=E[C],D=U(O,".be");if(xp.hasOwnProperty("folders"))if(xp.folders[C])i(O,L,xp.folders[C]);else i(O,L,null);else i(O,L,null);for(var j=B(D,".ce"),P=0;P<M;P++){var N=j[P],R=x[P];if(xp.hasOwnProperty("folders"))if(xp.folders[C])if(xp.folders[C].content[P])r(N,R,xp.folders[C].content[P]);else r(N,R,null);else r(N,R,null);else r(N,R,null)}}xp=e,Mp=n,Op=t}function Gp(){return Vp.apply(this,arguments)}function Vp(){return Vp=(0,r.A)(function*(){var e=Hf("playing_animation"),t=Hf("refresh_interval");Np=t.dynamic,Dp=t.baseInterval,Jp=!0,Bp=Zf(),Lp.setAttribute("refreshing","true"),Lp.classList.remove("kd"),document.addEventListener(Bp,Qp);var n=yield function(e){return Gn.apply(this,arguments)}(Bp);Yp(n,!1,e);var r=0;Np&&(r=yield _n()),Rp=(new Date).getTime(),Up=Np?Math.max(Rp+jp,n.dataUpdateTime+Dp/r):Rp+Dp,Pp=Math.max(jp,Up-Rp),Jp=!1,Lp.setAttribute("refreshing","false"),Lp.style.setProperty("--dd",`${Pp}ms`),Lp.classList.add("kd")}),Vp.apply(this,arguments)}function Zp(){return Kp.apply(this,arguments)}function Kp(){return(Kp=(0,r.A)(function*(){Gp().then(function(){Fp?setTimeout(function(){Zp()},Math.max(jp,Up-(new Date).getTime())):qp=!1}).catch(function(e){Fp?(Wf("error","資料夾網路連線中斷，將在10秒後重試。"),setTimeout(function(){Zp()},1e4)):qp=!1})})).apply(this,arguments)}var Xp=U(N("._c"),".ld"),ev=U(Xp,".md"),tv=U(ev,".qd"),nv={},rv=!1,iv=!1,av=15e3,ov=5e3,sv=!0,uv=!1,lv=0,cv=0,dv="",fv=!1;function pv(){var e=document.createElement("div");e.classList.add("rd");var t=document.createElement("div");t.classList.add("sd");var n=document.createElement("div");n.classList.add("td"),n.appendChild(Rt());var r=document.createElement("div");r.classList.add("ud");var i=document.createElement("div");i.classList.add("vd"),t.appendChild(n),t.appendChild(r),t.appendChild(i);var a=document.createElement("div");return a.classList.add("wd"),e.appendChild(t),e.appendChild(a),{element:e,id:""}}function vv(e,t,n){function r(e,r,i){function a(e,t){var n=U(e,".sd"),r=U(n,".td"),i="";switch(t.type){case"route":i="route";break;case"location":i="location_on";break;case"bus":i="directions_bus";break;case"empty":i="lightbulb"}Ut(r,i)}function o(e,t){var n=U(e,".sd .ud"),r="";switch(t.type){case"route":r="路線";break;case"location":r="地點";break;case"bus":r="公車";break;case"empty":r="提示"}n.innerText=r}function s(e,t){U(e,".sd .vd").innerText=t.time.relative}function u(e,t){U(e,".wd").innerText=t.name}function l(e,t){switch(t.type){case"route":e.onclick=function(){Ju(t.id,t.pid)};break;case"location":e.onclick=function(){Ql(t.hash)};break;case"bus":e.onclick=function(){Vt(t.id)};break;case"empty":e.onclick=null}}function c(e,t){e.setAttribute("animation",tp(t))}function d(e,t){e.setAttribute("skeleton-screen",tp(t))}if(null==i)a(e,r),o(e,r),s(e,r),u(e,r),l(e,r),c(e,n),d(e,t);else if(r.type!==i.type)a(e,r),o(e,r),s(e,r),u(e,r),l(e,r),c(e,n),d(e,t);else{switch(r.type){case"location":Vf(i.name,r.name)||u(e,r),i.time!==r.time&&s(e,r),Vf(i.hash,r.hash)||l(e,r);break;case"route":Vf(i.name,r.name)||u(e,r),i.time!==r.time&&s(e,r),Vf(i.id,r.id)&&Vf(i.pid,r.pid)||l(e,r);break;case"bus":Vf(i.name,r.name)||u(e,r),i.time!==r.time&&s(e,r),Vf(i.id,r.id)||l(e,r);break;case"empty":i.time!==r.time&&s(e,r)}n!==rv&&c(e,n),t!==iv&&d(e,t)}}var i=e.itemQuantity,a=B(tv,".rd").length;if(i!==a){var o=a-i;if(o<0){for(var s=new DocumentFragment,u=0,l=Math.abs(o);u<l;u++){var c=pv();s.appendChild(c.element)}tv.append(s)}else for(var d=B(tv,".rd"),f=0,p=Math.abs(o);f<p;f++){d[a-1-f].remove()}}for(var v=B(tv,".rd"),h=0;h<i;h++){var m=v[h],y=e.items[h];if(nv.hasOwnProperty("items"))if(nv.items[h])r(m,y,nv.items[h]);else r(m,y,null);else r(m,y,null)}nv=e,rv=n,iv=t}function hv(){for(var e=Hf("playing_animation"),t=$d("window"),n=Math.floor(t.height/70/3)+2,r=[],i=0;i<n;i++)r.push({type:"route",id:0,pid:[],time:{absolute:0,relative:""},name:""});vv({items:r,itemQuantity:r.length,dataUpdateTime:0},!0,e)}function mv(){return yv.apply(this,arguments)}function yv(){return yv=(0,r.A)(function*(){var e=Hf("playing_animation"),t=Hf("refresh_interval");sv=t.dynamic,av=t.baseInterval,dv=Zf();var n=yield function(e){return jt.apply(this,arguments)}(dv);vv(n,!1,e);var r=0;sv&&(r=yield _n()),lv=(new Date).getTime(),cv=sv?Math.max(lv+ov,n.dataUpdateTime+av/r):lv+av,Math.max(ov,cv-lv)}),yv.apply(this,arguments)}function gv(){return bv.apply(this,arguments)}function bv(){return(bv=(0,r.A)(function*(){mv().then(function(){uv?setTimeout(function(){gv()},Math.max(ov,cv-(new Date).getTime())):fv=!1}).catch(function(e){uv?setTimeout(function(){gv()},1e4):fv=!1})})).apply(this,arguments)}var Av=N(".bq"),wv=U(Av,".gq"),Sv=U(wv,".hq"),_v=U(Sv,'.iq[group="schedule-name"] .mq input'),kv=U(Sv,'.iq[group="schedule-start-time"] .mq input'),$v=U(Sv,'.iq[group="schedule-end-time"] .mq input'),Iv=U(Sv,'.iq[group="schedule-days"] .mq'),Tv=B(Iv,".nq");function Ev(){Av.setAttribute("displayed","false"),wd()}var Cv=!1,Lv=!1;window.bus={initialize:function(){!1===Cv&&(Cv=!0,Sd(),function(){return Uf.apply(this,arguments)}().then(function(){hv(),Wp(),function(){return rd.apply(this,arguments)}().then(function(e){if("ok"===e){lu.addEventListener("touchstart",function(){pu=Math.round(lu.scrollLeft/yu)},{passive:!0}),lu.addEventListener("scroll",function(e){gu=!0;var t=e.target.scrollLeft/yu;vu=t>pu?pu+1:pu-1;var n=t-pu,r=Math.abs(n);r>1&&(n>0?(pu=Math.floor(t),vu=pu+1):(pu=Math.ceil(t),vu=pu-1),r=Math.abs(t-pu));var i=mu[`g_${pu}`]||{width:0,offset:0},a=mu[`g_${vu}`]||{width:0,offset:0},o=i.width+(a.width-i.width)*r,s=-1*(i.offset+(a.offset-i.offset)*r)+.5*yu-.5*o;xu(hu,s,o-20,t),t===vu&&(pu=Math.round(lu.scrollLeft/yu),gu=!1)},{passive:!0}),cl.addEventListener("touchstart",function(){bl=Math.round(cl.scrollLeft/_l)},{passive:!0}),cl.addEventListener("scroll",function(e){kl=!0;var t=e.target.scrollLeft/_l;Al=t>bl?bl+1:bl-1;var n=t-bl,r=Math.abs(n);r>1&&(n>0?(bl=Math.floor(t),Al=bl+1):(bl=Math.ceil(t),Al=bl-1),r=Math.abs(t-bl));var i=Sl[`g_${bl}`]||{width:0,offset:0},a=Sl[`g_${Al}`]||{width:0,offset:0},o=i.width+(a.width-i.width)*r,s=-1*(i.offset+(a.offset-i.offset)*r)+.5*_l-.5*o;Pl(wl,s,o-20,t),t===Al&&(bl=Math.round(cl.scrollLeft/_l),kl=!1)},{passive:!0}),Dc(),window.addEventListener("resize",function(){Dc()}),screen&&screen.orientation&&screen.orientation.addEventListener("change",function(){Dc()}),hv(),uv||(uv=!0,fv?mv():(fv=!0,gv())),function(){return Pn.apply(this,arguments)}().then(function(){Wp(),Fp||(Fp=!0,qp?Gp():(qp=!0,Zp()))});var t=window.matchMedia("(prefers-color-scheme: dark)"),n=N(".ne .oe .pe #search_input");t.addEventListener("change",function(){Oc(n.selectionStart,n.selectionEnd)}),n.addEventListener("paste",function(){Nc(),Oc(n.selectionStart,n.selectionEnd)}),n.addEventListener("cut",function(){Nc(),Oc(n.selectionStart,n.selectionEnd)}),n.addEventListener("selectionchange",function(){Nc(),Oc(n.selectionStart,n.selectionEnd)}),document.addEventListener("selectionchange",function(){Nc(),Oc(n.selectionStart,n.selectionEnd)}),n.addEventListener("keyup",function(){Nc(),Oc(n.selectionStart,n.selectionEnd)});var r=N(".kp .lp .mp #search_material_symbols_input");r.addEventListener("paste",function(){Cr(r.value)}),r.addEventListener("cut",function(){Cr(r.value)}),r.addEventListener("selectionchange",function(){Cr(r.value)}),document.addEventListener("selectionchange",function(){Cr(r.value)}),r.addEventListener("keyup",function(){Cr(r.value)}),qu(),_d(function(){!function(){ca.apply(this,arguments)}(),function(){return pa.apply(this,arguments)}().then(function(){!function(){ya.apply(this,arguments)}()}),document.addEventListener("click",function(){No(),!1===eo.permission.asked&&!0===Hf("display_user_orientation")&&(eo.permission.asked=!0,"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){"granted"===e&&window.addEventListener("deviceorientation",function(e){e.absolute?eo.current=(null==e?void 0:e.alpha)||-1:e.webkitCompassHeading?eo.current=e.webkitCompassHeading||-1:eo.current=(null==e?void 0:e.alpha)||-1},!0)}).catch(function(e){}):console.log("DeviceOrientation isn't supported."))},{once:!0})})}"fetchError"!==e&&"unknownError"!==e||(kd(),_d())}).catch(function(){kd(),_d()})}))},secondlyInitialize:function(){Lv||(Lv=!0,function(){Ar.apply(this,arguments)}(),yn(),function(){M.apply(this,arguments)}(),function(){gp.apply(this,arguments)}(),function(){Lt.apply(this,arguments)}(),yn().then(function(){(function(){return mn.apply(this,arguments)})().then(function(){!function(){hn.apply(this,arguments)}()})}))},route:{closeRoute:function(){Xs.setAttribute("displayed","false"),Tu=!1,wd()},switchRoute:function(e,t){Tu=!1,Ju(e,t)},closeRouteDetails:function(){bd("RouteDetails"),Ps.setAttribute("displayed","false");var e,t=Ds(B(Fs,".wi"));try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}var n,r=Ds(B(Js,".ui"));try{for(r.s();!(n=r.n()).done;){n.value.remove()}}catch(e){r.e(e)}finally{r.f()}}},location:{openLocation:Ql,closeLocation:function(){al.setAttribute("displayed","false"),Ol=!1,wd()},closeLocationDetails:function(){bd("LocationDetails"),Yu.setAttribute("displayed","false")}},folder:{openSaveToFolder:mo,closeSaveToFolder:yo,closeFolderManager:ci,closeFolderIconSelector:xr,openFolderCreator:Nr,closeFolderCreator:Rr,createFormulatedFolder:function(){Nn(jr.value,Pr.value).then(function(e){e?(Rr(),Wf("folder","已建立資料夾")):Wf("error","無法建立資料夾")})}},search:{openSearch:Rc,closeSearch:Uc,switchSearchTypeFilter:function(){var e=xc(),t=-1;Ut(nc,["filter_list","route","location_on","directions_bus"][(t=e>=-1&&e<2?e+1:-1)+1]),nc.setAttribute("type",t.toString()),Nc()}},storage:{closeStorage:function(){Cf.setAttribute("displayed","false")}},dataUsage:{closeDataUsage:function(){Td.setAttribute("displayed","false"),wd()}},personalSchedule:{closePersonalScheduleManager:Qi,openPersonalScheduleCreator:function(){gd("PersonalScheduleCreator"),Av.setAttribute("displayed","true"),Ad()},closePersonalScheduleCreator:Ev,createFormulatedPersonalSchedule:function(){for(var e=_v.value,t=kv.value,n=$v.value,r=String(t).split(":").map(function(e){return parseInt(e)}),a=(0,i.A)(r,2),o=a[0],s=a[1],u=String(n).split(":").map(function(e){return parseInt(e)}),l=(0,i.A)(u,2),c=l[0],d=l[1],f=[],p=0;p<7;p++){var v=Tv[p],h=v.getAttribute("highlighted"),m=parseInt(v.getAttribute("day"));"true"===h&&f.push(m)}pi(e,o,s,c,d,f).then(function(e){e?(Ev(),Wf("calendar_view_day","已建立個人化行程")):Wf("error","無法建立個人化行程")})},switchPersonalScheduleCreatorDay:function(e){var t=U(Iv,`.nq[day="${e}"]`);"true"===t.getAttribute("highlighted")?t.setAttribute("highlighted","false"):t.setAttribute("highlighted","true")},openPersonalScheduleEditor:Pi,closePersonalScheduleEditor:Ni,switchPersonalScheduleEditorDay:function(e){var t=U(xi,`._q[day="${e}"]`);"true"===t.getAttribute("highlighted")?t.setAttribute("highlighted","false"):t.setAttribute("highlighted","true")},saveEditedPersonalSchedule:Oi},settings:{openSettings:dd,closeSettings:fd,closeSettingsOptions:function(){vf.setAttribute("displayed","false"),wd()}},bus:{openBus:Vt,closeBus:Zt},notification:{openNotificationScheduleManager:cf,closeNotificationScheduleManager:function(){Rd.setAttribute("displayed","false"),ef=!1,wd()},openRegisterNotification:La,closeRegisterNotification:xa,saveFormulatedRegisterNotification:function(){return Ma.apply(this,arguments)},closeScheduleNotification:$o},qrcode:{openQRCode:ps,closeQRCode:function(){bd("QRCode"),ds.setAttribute("displayed","false")}}};const xv=window.bus}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,r.amdO={},e=[],r.O=(t,n,i,a)=>{if(!n){var o=1/0;for(c=0;c<e.length;c++){for(var[n,i,a]=e[c],s=!0,u=0;u<n.length;u++)(!1&a||o>=a)&&Object.keys(r.O).every(e=>r.O[e](n[u]))?n.splice(u--,1):(s=!1,a<o&&(o=a));if(s){e.splice(c--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.u=e=>(({36:"simplifyRoute-worker",93:"extractSegmentBuffers-worker",275:"getUpdateRate-worker",439:"simplifyCarInfo-worker",444:"pakoInflate-worker",454:"simplifyLocation-worker",473:"mergeLocationByName-worker",627:"getBusArrivalTimeDataStats-worker",661:"simplifyStop-worker",757:"indexLocationByGeohash-worker",818:"getDataUsageStats-worker",897:"simplifySegmentBuffers-worker"}[e]||e)+"."+{36:"f8d9d6dd61ca508f8b97",93:"1e01584f4dc705054c33",113:"980a2bd5c76ebe76878c",275:"b569cc4f0daa96891992",439:"054ffb4a4294b11b17de",444:"fdbb2e8558e5ee42b8ef",454:"81fdde400df4e1b317de",473:"01d95f115b41468004ce",494:"980a2bd5c76ebe76878c",627:"7899c940614cbd654d2b",661:"1c25d8990601fa977d16",757:"470ac98b5c1d5d032240",818:"d20b1f30a1a3b2c032f8",897:"89749e6b138f2494beeb"}[e]+".js"),r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.p="./",(()=>{r.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={792:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[o,s,u]=n,l=0;if(o.some(t=>0!==e[t])){for(i in s)r.o(s,i)&&(r.m[i]=s[i]);if(u)var c=u(r)}for(t&&t(n);l<o.length;l++)a=o[l],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(c)},n=self.webpackChunkbus=self.webpackChunkbus||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=r.O(void 0,[377],()=>r(6519));return i=(i=r.O(i)).default})());
//# sourceMappingURL=main.65ef6d9fe3df7889a7fc.js.map