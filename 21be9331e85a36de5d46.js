"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[20],{365(e,t,r){r.d(t,{a:()=>s});var i=r(467),n=r(3422),a=r(4778),u=r(2571),o=r(1172);function s(e){return d.apply(this,arguments)}function d(){return(d=(0,i.a)(function*(e){if(""===n.a||""===n.c||void 0===e)return!1;var t=(0,a.a)("cancel",[e]),r=(0,u.a)("cancel",[e]),i=yield(0,o.a)("cancel",t,r);return!1!==i&&(200===i.code&&"cancel"===i.method&&(yield(0,n.j)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{a:()=>n});var i=r(467);function n(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,i.a)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},n=yield fetch(t,i);if(!n.ok){yield n.text();return!1}try{var a=yield n.text(),u=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return u;default:return!1}}catch(e){throw new Error("E23")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{a:()=>u});var i=r(8024),n=r(3422);function a(e,t,r){var n=(new Date).getTime(),a=(n-n%5e3)/5e3;return(0,i.j)((0,i.j)(`${e}\n${t}\n${a}\n${(0,i.j)(`${e}\n${t}\n${(0,i.j)(JSON.stringify(r))}`)}`))}function u(e,t){switch(e){case"cancel":return""!==n.a&&""!==n.c&&1===t.length&&{client_id:n.a,token:a(n.a,n.c,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,i.j)(`${(0,i.j)(t[0])}${r.getTime()}`)};case"schedule":return""!==n.a&&""!==n.c&&9===t.length&&{client_id:n.a,token:a(n.a,n.c,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==n.a&&""!==n.c&&0===t.length&&{client_id:n.a,token:a(n.a,n.c,{})};case"reschedule":return""!==n.a&&""!==n.c&&3===t.length&&{client_id:n.a,token:a(n.a,n.c,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3422(e,t,r){r.d(t,{a:()=>_,b:()=>v,c:()=>g,d:()=>H,e:()=>D,f:()=>J,g:()=>j,h:()=>Q,i:()=>N,j:()=>U,k:()=>$,l:()=>C,m:()=>B,n:()=>A,o:()=>x,p:()=>T,q:()=>I,r:()=>q});var i=r(467),n=r(8024),a=r(8011),u=r(4293),o=r(424),s=r(6788),d=r(3459),c=r(4311),l=r(2284),f=r(4778),p=r(2571),h=r(1172);function m(){return(m=(0,i.a)(function*(){if(""===_||""===g)return!1;var e=(0,f.a)("rotate"),t=(0,p.a)("rotate",[]),r=yield(0,h.a)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&(I(r.secret),yield $(),!0))})).apply(this,arguments)}function y(){return y=(0,i.a)(function*(e,t,r,i,n,a,u,o,s){if(""===_||""===g||void 0===e||void 0===t||void 0===r||void 0===i||void 0===n||void 0===a||"number"!=typeof u||void 0===s)return!1;var d=new Date;switch((0,l.a)(s)){case"string":case"number":d=new Date(s);break;default:if(!(s instanceof Date))return!1;d=s}var c=(0,f.a)("schedule"),y=(0,p.a)("schedule",[e,t,r,i,n,a,u,o,d.toISOString()]),v=yield(0,h.a)("schedule",c,y);return!1!==v&&(200===v.code&&"schedule"===v.method&&(Math.random()>.8&&(yield function(){return m.apply(this,arguments)}()),yield C(v.schedule_id,e,t,r,i,n,a,u,o,d.getTime()),v.schedule_id))}),y.apply(this,arguments)}var v="",_="",g="",b=[],S={},w={};function $(){return O.apply(this,arguments)}function O(){return(O=(0,i.a)(function*(){var e={provider:v,client_id:_,secret:g};yield(0,c.g)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function N(){return k.apply(this,arguments)}function k(){return(k=(0,i.a)(function*(){var e=yield(0,c.d)(9,"n_client");if(e){var t=JSON.parse(e);v=t.provider,_=t.client_id,g=t.secret}})).apply(this,arguments)}function D(){return""!==_&&""!==g}function T(e){if(!(0,n.g)(e))throw new Error("E24");var t=new URL(e);v=`${t.protocol}//${t.hostname}`}function J(){return String(v)}function x(e){void 0!==e&&(_=String(e))}function I(e){void 0!==e&&(g=String(e))}function j(){return M.apply(this,arguments)}function M(){return(M=(0,i.a)(function*(){(new Date).getTime();var e=yield(0,c.e)(10),t=0;for(var r of e){var i=yield(0,c.d)(10,r),a=JSON.parse(i),u=a.schedule_id,o=`s_${a.stop_id}`;b.push(a),S[u]=t,(0,n.e)(w,o)||(w[o]=[]),w[o].push(t),t+=1}})).apply(this,arguments)}function C(e,t,r,i,n,a,u,o,s,d){return E.apply(this,arguments)}function E(){return(E=(0,i.a)(function*(e,t,r,i,a,u,o,s,d,l){var f={schedule_id:e,stop_id:t,location_name:r,route_id:i,route_name:a,direction:u,estimate_time:o,time_formatting_mode:s,time_offset:d,scheduled_time:l},p=`s_${t}`,h=b.length;b.push(f),S[e]=h,(0,n.e)(w,p)||(w[p]=[]),w[p].push(h),yield(0,c.g)(10,e,JSON.stringify(f))})).apply(this,arguments)}function U(e){return L.apply(this,arguments)}function L(){return(L=(0,i.a)(function*(e){if((0,n.e)(S,e)){var t=S[e],r=`s_${b[t].stop_id}`;b.splice(t,1,null),w[r].splice(w[r].indexOf(t),1),delete S[e],yield(0,c.f)(10,e)}})).apply(this,arguments)}function q(e){var t=(new Date).getTime(),r=`s_${e}`;if((0,n.e)(w,r)){var i=w[r];for(var a of i){var u=b[a];if(null!==u)if(u.scheduled_time>t)return!0}}return!1}function H(){return P.apply(this,arguments)}function P(){return(P=(0,i.a)(function*(){var e=(new Date).getTime();for(var t in S){var r=S[t],i=b[r];if(i.scheduled_time<=e){var n=`s_${i.stop_id}`;b.splice(r,1,null),w[n].splice(w[n].indexOf(r),1),delete S[t],yield(0,c.f)(10,t)}}})).apply(this,arguments)}function Q(e){return R.apply(this,arguments)}function R(){return(R=(0,i.a)(function*(e){var t=yield(0,u.a)(e,!0),r=function(){var e=(new Date).getTime(),t=[];for(var r of b)null!==r&&r.scheduled_time>e&&t.push(r);return t}(),i=(new Date).getTime(),a=[];for(var o of r){var d={},c=o.location_name;d.name=c;var l=o.stop_id;d.stop_id=l;var f=o.estimate_time;d.estimate_time=f;var p=o.schedule_id;d.schedule_id=p;var h=o.scheduled_time;d.scheduled_time=h;var m=new Date(h),y=m.getDate(),v=m.getHours(),_=m.getMinutes();d.date=String(y).padStart(2,"0"),d.hours=String(v).padStart(2,"0"),d.minutes=String(_).padStart(2,"0"),d.route={};var g=o.route_name;d.route.name=g;var S=o.route_id;d.route.id=S;var w=o.direction;d.route.direction=w;var $=`r_${o.route_id}`;if((0,n.e)(t,$)){var O=t[$].pid;d.route.pathAttributeId=O,a.push(d)}}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});var N=[],k=0,D={};for(var T of a){var J=`g_${T.date}_${T.hours}`;(0,n.e)(D,J)?T.is_first=!1:(D[J]=!0,T.is_first=!0),N.push(T),k+=1}var x={items:N,itemQuantity:k,dataUpdateTime:Math.max((0,s.e)(e),i)};return(0,s.b)(e),(0,s.a)(e),x})).apply(this,arguments)}var A=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function B(e,t,r,i){return z.apply(this,arguments)}function z(){return z=(0,i.a)(function*(e,t,r,i){if(D()){var c=(0,d.b)("time_formatting_mode"),l=(0,n.c)(),f=yield(0,o.a)(l),p=yield(0,a.a)(l,0),h=yield(0,u.a)(l,!0);(0,s.a)(l),(0,s.b)(l);var m=`s_${e}`,v={};if(!(0,n.e)(f,m))return 0;var _=(v=f[m]).stopLocationId,g=v.goBack,b=`l_${_}`;if(!(0,n.e)(p,b))return 0;var S=p[b].n,w=`r_${t}`,$={};if(!(0,n.e)(h,w))return 0;var O=($=h[w]).n,N=$.dep,k=[$.des,N,""][g?parseInt(g):0],T=A[i].time_offset,J=(new Date).getTime()+1e3*r+60*T*1e3,x=yield function(e,t,r,i,n,a,u,o,s){return y.apply(this,arguments)}(e,S,t,O,k,r,c,T,J);return!1===x?0:1}return 2}),z.apply(this,arguments)}},3937(e,t,r){r.d(t,{a:()=>s});var i=r(467),n=r(3422),a=r(4778),u=r(2571),o=r(1172);function s(e){return d.apply(this,arguments)}function d(){return(d=(0,i.a)(function*(e){if(!e)return!1;var t=(0,a.a)("register"),r=(0,u.a)("register",[e]),i=yield(0,o.a)("register",t,r);return!1!==i&&(200===i.code&&"register"===i.method&&((0,n.o)(i.client_id),(0,n.q)(i.secret),yield(0,n.k)(),!0))})).apply(this,arguments)}},4778(e,t,r){r.d(t,{a:()=>n});var i=r(3422);function n(e){if(""===i.b)return!1;var t=new URL(i.b);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5314(e,t,r){r.d(t,{a:()=>p,b:()=>v,c:()=>g,d:()=>l,e:()=>m});var i=r(467),n=r(8024),a=r(5579),u=r(9734),o=r(8011),s=r(4293),d=r(6788),c=r(4311);function l(){return f.apply(this,arguments)}function f(){return(f=(0,i.a)(function*(){var e=[],t=(new Date).getTime(),r=yield(0,c.e)(8);for(var i of r){var n=yield(0,c.d)(8,i),a=JSON.parse(n);t-new Date(a.time).getTime()<=12096e5&&e.push(a)}return 0===e.length&&e.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),e})).apply(this,arguments)}function p(){return h.apply(this,arguments)}function h(){return(h=(0,i.a)(function*(){var e=(new Date).getTime(),t=yield(0,c.e)(8);for(var r of t){var i=yield(0,c.d)(8,r),n=JSON.parse(i);e-new Date(n.time).getTime()>12096e5&&(yield(0,c.f)(8,r))}})).apply(this,arguments)}function m(e,t){return y.apply(this,arguments)}function y(){return(y=(0,i.a)(function*(e,t){var r=(0,n.c)(),i=`${e}_${t}`,a=(new Date).toISOString(),d=yield(0,c.d)(8,i);if(d){var l=JSON.parse(d);l.time=a,yield(0,c.g)(8,i,JSON.stringify(l))}else switch(e){case"route":var f=yield(0,s.a)(r,!0),p=`r_${t}`;if((0,n.e)(f,p)){var h={type:"route",time:a,name:f[p].n,id:t};yield(0,c.g)(8,i,JSON.stringify(h))}break;case"location":var m=yield(0,o.a)(r,1),y=`ml_${t}`;if((0,n.e)(m,y)){var v={type:"location",time:a,name:m[y].n,hash:t};yield(0,c.g)(8,i,JSON.stringify(v))}break;case"bus":var _=yield(0,u.a)(r,!0),g=`c_${t}`;if((0,n.e)(_,g)){var b={type:"bus",time:a,name:_[g].CarNum,id:t};yield(0,c.g)(8,i,JSON.stringify(b))}}})).apply(this,arguments)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,i.a)(function*(e,t){var r=`${e}_${t}`,i=yield(0,c.d)(8,r);return!!i&&JSON.parse(i)})).apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,i.a)(function*(e){var t=yield l(),r=yield(0,s.a)(e,!0),i=[],n=0;for(var u of t){var o=u.type,c=new Date(u.time);switch(o){case"route":var f={type:"route"},p=u.name;f.name=p;var h=u.id;f.id=h;var m=r[`r_${h}`].pid;f.pid=m,f.time={absolute:c.getTime(),relative:(0,a.b)(c)},i.push(f),n+=1;break;case"location":var y={type:"location"},v=u.hash;y.hash=v;var _=u.name;y.name=_,y.time={absolute:c.getTime(),relative:(0,a.b)(c)},i.push(y),n+=1;break;case"bus":var g={type:"bus"},b=u.id;g.id=b;var S=u.name;g.name=S,g.time={absolute:c.getTime(),relative:(0,a.b)(c)},i.push(g),n+=1;break;case"empty":var w={type:"empty"},$=u.id;w.id=$;var O=u.name;w.name=O,w.time={absolute:c.getTime(),relative:(0,a.b)(c)},i.push(w),n=1}}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var N={items:i,itemQuantity:n,dataUpdateTime:(new Date).getTime()};return(0,d.a)(e),(0,d.b)(e),N})).apply(this,arguments)}},5352(e,t,r){r.d(t,{a:()=>u,b:()=>s,c:()=>m,d:()=>f,e:()=>c});var i=r(467),n=r(8024),a=r(4311);function u(e,t,r,i,n,a){return o.apply(this,arguments)}function o(){return(o=(0,i.a)(function*(e,t,r,i,u,o){var s=(0,n.c)();if(t<0||t>23||r<0||r>59||i<0||i>23||u<0||u>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(i)&&Number.isInteger(u)))return!1;if(o.length>7)return!1;for(var d of o)if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1;var c={name:e,period:{start:{hours:t,minutes:r},end:{hours:i,minutes:u}},days:o,id:s};return yield(0,a.g)(7,s,JSON.stringify(c)),!0})).apply(this,arguments)}function s(e){return d.apply(this,arguments)}function d(){return(d=(0,i.a)(function*(e){var t=yield(0,a.d)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return(l=(0,i.a)(function*(e){(yield s(e.id))&&(yield(0,a.g)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function f(){return p.apply(this,arguments)}function p(){return(p=(0,i.a)(function*(){var e=[],t=yield(0,a.e)(7);for(var r of t){var i=yield(0,a.d)(7,r);if(i){var n=JSON.parse(i);e.push(n)}}return e.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),e.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),e})).apply(this,arguments)}function h(){return(h=(0,i.a)(function*(){var e=yield f(),t={};for(var r of e)for(var i of r.days){var a=`d_${i}`;(0,n.e)(t,a)||(t[a]=[]);var u={start:r.period.start,end:r.period.end};t[a].push(u)}for(var o in t){for(var s=t[o],d=s.length,c=[],l=0;l<d;l++){var p=s[l-1]||s[l],h=s[l];0===c.length?c.push(h):60*h.start.hours+h.start.minutes>=60*p.start.hours+p.start.minutes&&60*h.start.hours+h.start.minutes<=60*p.end.hours+p.end.minutes?(c[c.length-1].end.hours=h.end.hours,c[c.length-1].end.minutes=h.end.minutes):c.push(h)}t[o]=c}return t})).apply(this,arguments)}function m(e){return y.apply(this,arguments)}function y(){return y=(0,i.a)(function*(e){var t=yield function(){return h.apply(this,arguments)}(),r=`d_${e.getDay()}`,i=e.getHours(),a=e.getMinutes();if((0,n.e)(t,r)){var u=t[r];for(var o of u)if(60*i+a>=60*o.start.hours+o.start.minutes&&60*i+a<=60*o.end.hours+o.end.minutes)return!0}return!1}),y.apply(this,arguments)}}}]);
//# sourceMappingURL=21be9331e85a36de5d46.js.map