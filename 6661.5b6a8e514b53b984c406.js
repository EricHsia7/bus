"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[6661,9042],{365(e,t,r){r.d(t,{G:()=>s});var n=r(467),i=r(3422),a=r(4778),o=r(2571),u=r(1172);function s(e){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e){if(""===i.M3||""===i.se||void 0===e)return!1;var t=(0,a.F)("cancel",[e]),r=(0,o.b)("cancel",[e]),n=yield(0,u.R)("cancel",t,r);return!1!==n&&(200===n.code&&"cancel"===n.method&&(yield(0,i.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>i});var n=r(467);function i(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,n.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},i=yield fetch(t,n);if(!i.ok){yield i.text();return!1}try{var a=yield i.text(),o=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{b:()=>o});var n=r(8024),i=r(3422);function a(e,t,r){var i=(new Date).getTime(),a=(i-i%5e3)/5e3;return(0,n.Zf)((0,n.Zf)(`${e}\n${t}\n${a}\n${(0,n.Zf)(`${e}\n${t}\n${(0,n.Zf)(JSON.stringify(r))}`)}`))}function o(e,t){switch(e){case"cancel":return""!==i.M3&&""!==i.se&&1===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,n.Zf)(`${(0,n.Zf)(t[0])}${r.getTime()}`)};case"schedule":return""!==i.M3&&""!==i.se&&9===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==i.M3&&""!==i.se&&0===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{})};case"reschedule":return""!==i.M3&&""!==i.se&&3===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3422(e,t,r){r.d(t,{M3:()=>S,ph:()=>g,se:()=>b,hc:()=>I,D7:()=>M,e3:()=>L,VJ:()=>x,ms:()=>$,G7:()=>k,mD:()=>Z,FX:()=>j,uQ:()=>J,Zc:()=>C});var n=r(467),i=r(8024),a=r(8011),o=r(4293),u=r(424),s=r(6788),c=r(3459),l=r(4311),f=r(2284),d=r(4778),h=r(2571),y=r(1172);function m(){return(m=(0,n.A)(function*(){if(""===S||""===b)return!1;var e=(0,d.F)("rotate"),t=(0,h.b)("rotate",[]),r=yield(0,y.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&(J(r.secret),yield $(),!0))})).apply(this,arguments)}function p(){return p=(0,n.A)(function*(e,t,r,n,i,a,o,u,s){if(""===S||""===b||void 0===e||void 0===t||void 0===r||void 0===n||void 0===i||void 0===a||"number"!=typeof o||void 0===s)return!1;var c=new Date;switch((0,f.A)(s)){case"string":case"number":c=new Date(s);break;default:if(!(s instanceof Date))return!1;c=s}var l=(0,d.F)("schedule"),p=(0,h.b)("schedule",[e,t,r,n,i,a,o,u,c.toISOString()]),v=yield(0,y.R)("schedule",l,p);return!1!==v&&(200===v.code&&"schedule"===v.method&&(Math.random()>.8&&(yield function(){return m.apply(this,arguments)}()),yield k(v.schedule_id,e,t,r,n,i,a,o,u,c.getTime()),v.schedule_id))}),p.apply(this,arguments)}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return _(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var g="",S="",b="",w=[],O={},A={};function $(){return N.apply(this,arguments)}function N(){return(N=(0,n.A)(function*(){var e={provider:g,client_id:S,secret:b};yield(0,l.mL)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function I(){return""!==S&&""!==b}function M(){return String(g)}function J(e){void 0!==e&&(b=String(e))}function k(e,t,r,n,i,a,o,u,s,c){return D.apply(this,arguments)}function D(){return(D=(0,n.A)(function*(e,t,r,n,i,a,o,u,s,c){var f={schedule_id:e,stop_id:t,location_name:r,route_id:n,route_name:i,direction:a,estimate_time:o,time_formatting_mode:u,time_offset:s,scheduled_time:c},d=`s_${t}`,h=w.length;w.push(f),O[e]=h,A.hasOwnProperty(d)||(A[d]=[]),A[d].push(h),yield(0,l.mL)(10,e,JSON.stringify(f))})).apply(this,arguments)}function x(e){return T.apply(this,arguments)}function T(){return(T=(0,n.A)(function*(e){if(O.hasOwnProperty(e)){var t=O[e],r=`s_${w[t].stop_id}`;w.splice(t,1,null),A[r].splice(A[r].indexOf(t),1),delete O[e],yield(0,l.iQ)(10,e)}})).apply(this,arguments)}function C(e){var t=(new Date).getTime(),r=`s_${e}`;if(A.hasOwnProperty(r)){var n,i=v(A[r]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=w[a];if(null!==o)if(o.scheduled_time>t)return!0}}catch(e){i.e(e)}finally{i.f()}}return!1}function L(e){return P.apply(this,arguments)}function P(){return(P=(0,n.A)(function*(e){var t,r=yield(0,o.a)(e,!0),n=function(){var e,t=(new Date).getTime(),r=[],n=v(w);try{for(n.s();!(e=n.n()).done;){var i=e.value;null!==i&&i.scheduled_time>t&&r.push(i)}}catch(e){n.e(e)}finally{n.f()}return r}(),i=(new Date).getTime(),a=[],u=v(n);try{for(u.s();!(t=u.n()).done;){var c=t.value,l={},f=c.location_name;l.name=f;var d=c.stop_id;l.stop_id=d;var h=c.estimate_time;l.estimate_time=h;var y=c.schedule_id;l.schedule_id=y;var m=c.scheduled_time;l.scheduled_time=m;var p=new Date(m),_=p.getDate(),g=p.getHours(),S=p.getMinutes();l.date=String(_).padStart(2,"0"),l.hours=String(g).padStart(2,"0"),l.minutes=String(S).padStart(2,"0"),l.route={};var b=c.route_name;l.route.name=b;var O=c.route_id;l.route.id=O;var A=c.direction;l.route.direction=A;var $=`r_${c.route_id}`;if(r.hasOwnProperty($)){var N=r[$].pid;l.route.pathAttributeId=N,a.push(l)}}}catch(e){u.e(e)}finally{u.f()}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});for(var I=[],M=0,J={},k=0,D=a;k<D.length;k++){var x=D[k],T=`g_${x.date}_${x.hours}`;J.hasOwnProperty(T)?x.is_first=!1:(J[T]=!0,x.is_first=!0),I.push(x),M+=1}var C={items:I,itemQuantity:M,dataUpdateTime:Math.max((0,s.Zt)(e),i)};return(0,s.gC)(e),(0,s.LQ)(e),C})).apply(this,arguments)}var j=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function Z(e,t,r,n){return Q.apply(this,arguments)}function Q(){return Q=(0,n.A)(function*(e,t,r,n){if(I()){var l=(0,c.Js)("time_formatting_mode"),f=(0,i.zx)(),d=yield(0,u.T)(f),h=yield(0,a.g)(f,0),y=yield(0,o.a)(f,!0);(0,s.LQ)(f),(0,s.gC)(f);var m=`s_${e}`,v={};if(!d.hasOwnProperty(m))return 0;var _=(v=d[m]).stopLocationId,g=v.goBack,S=`l_${_}`;if(!h.hasOwnProperty(S))return 0;var b=h[S].n,w=`r_${t}`,O={};if(!y.hasOwnProperty(w))return 0;var A=(O=y[w]).n,$=O.dep,N=[O.des,$,""][g?parseInt(g):0],M=j[n].time_offset,J=(new Date).getTime()+1e3*r+60*M*1e3,k=yield function(e,t,r,n,i,a,o,u,s){return p.apply(this,arguments)}(e,b,t,A,N,r,l,M,J);return!1===k?0:1}return 2}),Q.apply(this,arguments)}},3937(e,t,r){r(3422),r(4778),r(2571)},4778(e,t,r){r.d(t,{F:()=>i});var n=r(3422);function i(e){if(""===n.ph)return!1;var t=new URL(n.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5314(e,t,r){r.d(t,{DF:()=>m,Qj:()=>f,XK:()=>h});var n=r(467),i=r(8024),a=r(9734),o=r(8011),u=r(4293),s=(r(6788),r(4311));function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(){var e,t=[],r=(new Date).getTime(),n=c(yield(0,s.Su)(8));try{for(n.s();!(e=n.n()).done;){var i=e.value,a=yield(0,s.Ct)(8,i),o=JSON.parse(a);r-new Date(o.time).getTime()<=12096e5&&t.push(o)}}catch(e){n.e(e)}finally{n.f()}return 0===t.length&&t.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),t})).apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return(y=(0,n.A)(function*(e,t){var r=(0,i.zx)(),n=`${e}_${t}`,c=(new Date).toISOString(),l=yield(0,s.Ct)(8,n);if(l){var f=JSON.parse(l);f.time=c,yield(0,s.mL)(8,n,JSON.stringify(f))}else switch(e){case"route":var d=yield(0,u.a)(r,!0),h=`r_${t}`;if(d.hasOwnProperty(h)){var y={type:"route",time:c,name:d[h].n,id:t};yield(0,s.mL)(8,n,JSON.stringify(y))}break;case"location":var m=yield(0,o.g)(r,1),p=`ml_${t}`;if(m.hasOwnProperty(p)){var v={type:"location",time:c,name:m[p].n,hash:t};yield(0,s.mL)(8,n,JSON.stringify(v))}break;case"bus":var _=yield(0,a.j)(r,!0),g=`c_${t}`;if(_.hasOwnProperty(g)){var S={type:"bus",time:c,name:_[g].CarNum,id:t};yield(0,s.mL)(8,n,JSON.stringify(S))}}})).apply(this,arguments)}function m(e,t){return p.apply(this,arguments)}function p(){return(p=(0,n.A)(function*(e,t){var r=`${e}_${t}`,n=yield(0,s.Ct)(8,r);return!!n&&JSON.parse(n)})).apply(this,arguments)}},5352(e,t,r){r.d(t,{Qh:()=>s,nL:()=>d,qZ:()=>l,ty:()=>y});var n=r(467),i=r(8024),a=r(4311);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,a){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e,t,r,n,u,s){var c=(0,i.zx)();if(t<0||t>23||r<0||r>59||n<0||n>23||u<0||u>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(n)&&Number.isInteger(u)))return!1;if(s.length>7)return!1;var l,f=o(s);try{for(f.s();!(l=f.n()).done;){var d=l.value;if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1}}catch(e){f.e(e)}finally{f.f()}var h={name:e,period:{start:{hours:t,minutes:r},end:{hours:n,minutes:u}},days:s,id:c};return yield(0,a.mL)(7,c,JSON.stringify(h)),!0})).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=(0,n.A)(function*(e){var t=yield(0,a.Ct)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function d(e){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(e){(yield l(e.id))&&(yield(0,a.mL)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function y(){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t=[],r=o(yield(0,a.Su)(7));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,a.Ct)(7,n);if(i){var u=JSON.parse(i);t.push(u)}}}catch(e){r.e(e)}finally{r.f()}return t.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),t.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),t})).apply(this,arguments)}}}]);
//# sourceMappingURL=6661.5b6a8e514b53b984c406.js.map