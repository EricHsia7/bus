"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[323],{7123(e,t,n){n.d(t,{R:()=>S});var a=n(467),r=n(7183),i=n(8024),o=n(6483),u=n(6802),s=n(7810),d=n(2063),f=n(8011),l=n(4293),c=n(1932),y=n(424),p=n(2303),m=n(6788),v=n(3459),h=n(1531);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("E0")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function S(e,t,n,a,r){return D.apply(this,arguments)}function D(){return(D=(0,a.A)(function*(e,t,n,a,_){(0,m.Mf)(_,"getRoute_0",0,!1),(0,m.Mf)(_,"getRoute_1",0,!1),(0,m.Mf)(_,"getStop_0",0,!1),(0,m.Mf)(_,"getStop_1",0,!1),(0,m.Mf)(_,"getLocation_0",0,!1),(0,m.Mf)(_,"getLocation_1",0,!1),(0,m.Mf)(_,"getSegmentBuffers_0",0,!1),(0,m.Mf)(_,"getSegmentBuffers_1",0,!1),(0,m.Mf)(_,"getEstimateTime_0",0,!1),(0,m.Mf)(_,"getEstimateTime_1",0,!1),(0,m.Mf)(_,"getBusEvent_0",0,!1),(0,m.Mf)(_,"getBusEvent_1",0,!1),(0,m.Mf)(_,"getBusData_0",0,!1),(0,m.Mf)(_,"getBusData_1",0,!1);var S=yield(0,l.a)(_,!0),D=yield(0,y.T)(_),I=yield(0,f.g)(_,0),T=yield(0,f.g)(_,1),b=yield(0,f.g)(_,2),w=yield(0,c.L)(_),k=yield(0,d.K)(_),B=yield(0,s.J)(_),E=yield(0,u.d)(_),M=yield(0,o.Io)(n,a),R=(0,p.w_)(B,E,S,e,t),$=!1,Q={};(0,i.mQ)(w,`r_${e}`)&&($=!0,Q=w[`r_${e}`]);var A,U=(0,v.Js)("time_formatting_mode"),P=[],H=[],L=g(k);try{for(L.s();!(A=L.n()).done;){var x=A.value,O={},W=x.RouteID;if([e,10*e].includes(W)||t.includes(W)){O.status=(0,p.$Q)(null==x?void 0:x.EstimateTime,U);var G=`s_${x.StopID}`,q={};if(!(0,i.mQ)(D,G))continue;q=D[G],O.id=x.StopID,O.sequence=q.seqNo,O.goBack=q.goBack;var C=`l_${q.stopLocationId}`,F={};if(!(0,i.mQ)(I,C))continue;F=I[C],O.name=F.n;var Z=F.r.length;O.overlappingRoutes=[];for(var V=0;V<Z;V++){var j=F.r[V];if(j!==e){var J=`r_${j}`;if((0,i.mQ)(S,J)){var N=S[J],K={name:N.n,RouteEndPoints:{RouteDeparture:N.dep,RouteDestination:N.des,text:`${N.dep} ↔ ${N.des}`,html:`<span>${N.dep}</span><span>↔</span><span>${N.des}</span>`},RouteID:N.id,PathAttributeId:N.pid};O.overlappingRoutes.push(K)}}}O.position={longitude:F.lo,latitude:F.la},H.push({latitude:F.la,longitude:F.lo,id:x.StopID});var Y=F.g,z=[];(0,i.mQ)(b,Y)&&(z=b[Y]);var X,ee=[],te=g(z);try{for(te.s();!(X=te.n()).done;){var ne=`ml_${X.value.hash}`;if((0,i.mQ)(T,ne)){var ae=T[ne],re={name:ae.n,distance:0|(0,r.aV)(ae.la[0],ae.lo[0],F.la,F.lo),hash:ae.hash};ee.push(re)}}}catch(e){te.e(e)}finally{te.f()}ee.sort(function(e,t){return e.distance-t.distance}),O.nearbyLocations=ee;var ie,oe=[],ue=g(F.s);try{for(ue.s();!(ie=ue.n()).done;){var se=`s_${ie.value}`;(0,i.mQ)(R,se)&&oe.push(R[se].map(function(e){return(0,p.s$)(e)}))}}catch(e){ue.e(e)}finally{ue.f()}O.buses=oe.flat().sort(function(e,t){return e.index-t.index});var de=[];(0,i.mQ)(M,G)&&(de=M[G]),O.busArrivalTimes=de;var fe=!1,le=!1,ce=!1,ye=!1;if($){var pe=`g_${O.goBack}`,me=[];(0,i.mQ)(Q,pe)?me=Q[pe]:"1"===O.goBack&&(ye=!0,me=Q.g_0);var ve,he=g(me);try{for(he.s();!(ve=he.n()).done;){var ge=ve.value;ge.OriginStopID!==x.StopID&&ge.DestinationStopID!==x.StopID||(fe=!0),ye?(ge.OriginStopID===x.StopID&&(ce=!0),ge.DestinationStopID===x.StopID&&(le=!0)):(ge.OriginStopID===x.StopID&&(le=!0),ge.DestinationStopID===x.StopID&&(ce=!0))}}catch(e){he.e(e)}finally{he.f()}}O.segmentBuffer={isSegmentBuffer:fe,isStartingPoint:le,isEndingPoint:ce},P.push(O)}}}catch(e){L.e(e)}finally{L.f()}P.sort(function(e,t){return e.sequence-t.sequence});for(var _e=(0,h.uQ)(H,450),Se=!1,De=!1,Ie={},Te=0,be={},we=P.length,ke=0;ke<we;ke++){var Be=P[ke],Ee=P[ke+1]||Be,Me=0;if(Be.buses.length>0&&Be.buses[0].onThisRoute){var Re=[Be.buses[0].position.longitude,Be.buses[0].position.latitude],$e=Re[0],Qe=Re[1],Ae=[Be.position.longitude,Be.position.latitude],Ue=Ae[0],Pe=Ae[1],He=[Ee.position.longitude,Ee.position.latitude],Le=He[0],xe=He[1];if(($e-Ue)*(Le-$e)+(Qe-Pe)*(xe-Qe)>=0){var Oe=Math.hypot($e-Ue,Qe-Pe),We=Math.hypot($e-Le,Qe-xe);Me=Math.max(0,Math.min(Oe/(Oe+We),1))}}Be.progress=Me,Be.segmentBuffer.isStartingPoint&&(Se=!0),Be.segmentBuffer.isEndingPoint&&Se&&(De=!0),Se&&!De&&(Be.segmentBuffer.isSegmentBuffer=!0),Se&&De&&(Se=!1,De=!1);var Ge=!1;null!==_e&&_e.id===Be.id&&(Ge=!0),Be.nearest=Ge;var qe=`g_${Be.goBack}`||"g_0";(0,i.mQ)(Ie,qe)||(Ie[qe]=[],be[qe]=0,Te+=1),Ie[qe].push(Be),be[qe]+=1}var Ce=S[`r_${e}`],Fe={groupedItems:Ie,groupQuantity:Te,itemQuantity:be,RouteName:Ce.n,RouteEndPoints:{RouteDeparture:Ce.dep,RouteDestination:Ce.des},dataUpdateTime:(0,m.Zt)(_),RouteID:e,PathAttributeId:t};return(0,m.LQ)(_),(0,m.gC)(_),Fe})).apply(this,arguments)}},8621(e,t,n){n.d(t,{p:()=>y});var a=n(467),r=n(5579),i=n(313),o=n(4293),u=n(8201),s=n(8671),d=n(2303),f=n(6788);function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("E0")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function y(e,t,n){return p.apply(this,arguments)}function p(){return(p=(0,a.A)(function*(e,t,n){var a=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.Id===t){a=i;break}}}catch(e){r.e(e)}finally{r.f()}return a}(yield(0,o.a)(n,!1),e),c=yield(0,u.Y)(n),y=yield(0,s.s)(n),p=yield(0,i.s)(n),m=function(e){var t=(0,d.aU)(e.goFirstBusTime,0),n=(0,d.aU)(e.goLastBusTime,0),a=(0,d.aU)(e.backFirstBusTime,0),r=(0,d.aU)(e.backLastBusTime,0),i=(0,d.aU)(e.holidayGoFirstBusTime,0),o=(0,d.aU)(e.holidayGoLastBusTime,0),u=(0,d.aU)(e.holidayBackFirstBusTime,0),s=(0,d.aU)(e.holidayBackLastBusTime,0),f=(0,d.aU)(e.peakHeadway,1),l=(0,d.aU)(e.offPeakHeadway,1),c=(0,d.aU)(e.holidayPeakHeadway,1),y=(0,d.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:f,offRushHourWindow:l},holiday:{first:i,last:o,rushHourWindow:c,offRushHourWindow:y}},back:{weekday:{first:a,last:r,rushHourWindow:f,offRushHourWindow:l},holiday:{first:u,last:s,rushHourWindow:c,offRushHourWindow:y}},realSequence:e.realSequence}}(a),v=function(e,t,n,a,i){var o,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,r.P$)(),f=l(a);try{for(f.s();!(o=f.n()).done;){var c=o.value;if(t.indexOf(c.PathAttributeId)>-1&&"0"===c.DateType)for(var y=(0,r.mr)(c.DateValue),p=(0,r.S1)(s,y.day,0,0),m=(0,d.aU)(c.StartTime,0),v=(0,r.S1)(p,0,m.hours,m.minutes),h=(0,d.aU)(c.EndTime,0),g=(0,r.S1)(p,0,h.hours,h.minutes),_=Math.abs(60*h.hours+h.minutes-(60*m.hours+m.minutes)),S=parseInt(c.LongHeadway),D=parseInt(c.LowHeadway),I=(D+S)/2,T=_/I,b=0;b<T;b++){var w=!1,k=(0,r.S1)(p,0,m.hours,m.minutes+D*b);k.getTime()<v.getTime()&&(w=!0),k.getTime()>g.getTime()&&(w=!0),!1===w&&(u.calendarEventGroups[y.code].push({date:k,dateString:(0,r.$T)(k,"hh:mm"),duration:D,deviation:Math.abs(I-D)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){f.e(e)}finally{f.f()}var B,E=l(i);try{for(E.s();!(B=E.n()).done;){var M=B.value;if(t.indexOf(M.PathAttributeId)>-1&&"0"===M.DateType){var R=(0,r.mr)(M.DateValue),$=(0,r.S1)(s,R.day,0,0),Q=(0,d.aU)(M.DepartureTime,0),A=(0,r.S1)($,0,Q.hours,Q.minutes);u.calendarEventGroups[R.code].push({date:A,dateString:(0,r.$T)(A,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[R.code]+=1}}}catch(e){E.e(e)}finally{E.f()}for(var U in u.calendarEventGroups)u.calendarEventGroups[U].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return u}(0,t,0,c,y),h=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.id===t&&(a=i)}}catch(e){r.e(e)}finally{r.f()}return a}(p,a.providerId),g={timeTableRules:m,calendar:v,properties:[{key:"route_name",icon:"route",value:a.nameZh},{key:"pricing",icon:"attach_money",value:a.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:h.nameZn},{key:"provider_phone",icon:"call",value:h.phoneInfo},{key:"provider_email",icon:"alternate_email",value:h.email}]};return(0,f.LQ)(n),(0,f.gC)(n),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=aa9bf910f8d76d7304a1.js.map