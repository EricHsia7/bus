"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{2937(t,e,a){a.d(e,{a:()=>s});var n=a(467),r=a(8201),i=a(2303),o=a(6788);function s(t,e){return u.apply(this,arguments)}function u(){return(u=(0,n.a)(function*(t,e){var a=yield(0,r.a)(e),n={repeated:[[],[],[],[],[],[],[]],scheduled:[],timeZoneOffset:-480};for(var s of a)if(!(t.indexOf(s.PathAttributeId)<0)){var u=(0,i.h)(s.StartTime,0),f=(0,i.h)(s.EndTime,0),p=60*u.hours+u.minutes,d=60*f.hours+f.minutes,l=parseInt(s.LongHeadway,10),c=parseInt(s.LowHeadway,10);if("0"===s.DateType){var v=parseInt(s.DateValue,10),h={type:"repeated",time:[p,d],interval:[l,c],count:[Math.ceil((d-p)/c),Math.floor((d-p)/l)],day:v};n.repeated[v-1].push(h)}else if("1"===s.DateType){var g=s.DateValue,m={type:"scheduled",time:[p,d],interval:[l,c],count:[Math.ceil((d-p)/c),Math.floor((d-p)/l)],date:[parseInt(g.slice(0,-4),10),parseInt(g.slice(-4,-2),10),parseInt(g.slice(-2),10)]};n.scheduled.push(m)}}for(var y=0;y<7;y++)n.repeated[y].sort(function(t,e){return t.time[0]-e.time[0]});return(0,o.b)(e),(0,o.a)(e),n})).apply(this,arguments)}},8621(t,e,a){a.d(e,{a:()=>p});var n=a(467),r=a(4131),i=a(4373),o=a(3041),s=a(8024),u=a(4293),f=a(6788);function p(t,e,a){return d.apply(this,arguments)}function d(){return(d=(0,n.a)(function*(t,e,a){var n=yield(0,u.a)(a,!0);(0,f.a)(a),(0,f.b)(a);var p=`r_${t}`;if(!(0,s.f)(n,p))return{actions:[],actionsQuantity:0,RouteID:t};n[p];var d=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,o.c)("route",[t],null)}},{icon:"calendar_today",name:"時刻表",key:"calendar",action:function(){(0,r.c)(e)}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,i.d)(t)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,i.f)(t)}}];return{actions:d,actionsQuantity:d.length,RouteID:t}})).apply(this,arguments)}},7123(t,e,a){a.d(e,{a:()=>b});var n=a(3453),r=a(467),i=a(7183),o=a(8024),s=a(6483),u=a(6802),f=a(7810),p=a(2063),d=a(8011),l=a(4293),c=a(1932),v=a(424),h=a(2303),g=a(6788),m=a(3459),y=a(1531);function b(t,e,a,n,r){return _.apply(this,arguments)}function _(){return(_=(0,r.a)(function*(t,e,a,r,b){(0,g.f)(b,"getRoute_0",0,!1),(0,g.f)(b,"getRoute_1",0,!1),(0,g.f)(b,"getStop_0",0,!1),(0,g.f)(b,"getStop_1",0,!1),(0,g.f)(b,"getLocation_0",0,!1),(0,g.f)(b,"getLocation_1",0,!1),(0,g.f)(b,"getSegmentBuffers_0",0,!1),(0,g.f)(b,"getSegmentBuffers_1",0,!1),(0,g.f)(b,"getEstimateTime_0",0,!1),(0,g.f)(b,"getEstimateTime_1",0,!1),(0,g.f)(b,"getBusEvent_0",0,!1),(0,g.f)(b,"getBusEvent_1",0,!1),(0,g.f)(b,"getBusData_0",0,!1),(0,g.f)(b,"getBusData_1",0,!1);var _=yield Promise.all([(0,l.a)(b,!0),(0,v.a)(b),(0,c.a)(b),(0,p.a)(b)]),I=(0,n.a)(_,4),D=I[0],S=I[1],$=I[2],B=I[3],k=yield Promise.all([(0,d.a)(b,0),(0,d.a)(b,1),(0,d.a)(b,2),(0,f.a)(b)]),R=(0,n.a)(k,4),L=R[0],w=R[1],P=R[2],E=R[3],T=yield Promise.all([(0,u.a)(b),(0,s.b)(a,r)]),C=(0,n.a)(T,2),M=C[0],x=C[1],O=(0,h.b)(E,M,D,t,e),q=!1,A={};(0,o.f)($,`r_${t}`)&&(q=!0,A=$[`r_${t}`]);var N=(0,m.b)("time_formatting_mode"),Q=[],H=[];for(var V of B){var U={},Z=V.RouteID;if([t,10*t].includes(Z)||e.includes(Z)){U.status=(0,h.g)(null==V?void 0:V.EstimateTime,N);var j=`s_${V.StopID}`,z={};if(!(0,o.f)(S,j))continue;z=S[j],U.id=V.StopID,U.sequence=z.seqNo,U.goBack=z.goBack;var F=`l_${z.stopLocationId}`,G={};if(!(0,o.f)(L,F))continue;G=L[F],U.name=G.n;var J=G.r.length;U.overlappingRoutes=[];for(var K=0;K<J;K++){var W=G.r[K];if(W!==t){var X=`r_${W}`;if((0,o.f)(D,X)){var Y=D[X],tt={name:Y.n,RouteEndPoints:{RouteDeparture:Y.dep,RouteDestination:Y.des,text:`${Y.dep} ↔ ${Y.des}`,html:`<span>${Y.dep}</span><span>↔</span><span>${Y.des}</span>`},RouteID:Y.id,PathAttributeId:Y.pid};U.overlappingRoutes.push(tt)}}}U.position={longitude:G.lo,latitude:G.la},H.push({latitude:G.la,longitude:G.lo,id:V.StopID});var et=G.g,at=[];for(var nt of((0,o.f)(P,et)&&(at=P[et]),U.nearbyLocations=[],at)){var rt=`ml_${nt.hash}`;if((0,o.f)(w,rt)){var it=w[rt],ot={name:it.n,distance:0|(0,i.c)(it.la[0],it.lo[0],G.la,G.lo),hash:it.hash};U.nearbyLocations.push(ot)}}for(var st of(U.nearbyLocations.sort(function(t,e){return t.distance-e.distance}),U.buses=[],G.s)){var ut=`s_${st}`;if((0,o.f)(O,ut))for(var ft=O[ut].length-1;ft>=0;ft--)U.buses.push((0,h.c)(O[ut][ft]))}U.buses.sort(function(t,e){return t.index-e.index});var pt=[];(0,o.f)(x,j)&&(pt=x[j]),U.busArrivalTimes=pt;var dt=!1,lt=!1,ct=!1,vt=!1;if(q){var ht=`g_${U.goBack}`,gt=[];for(var mt of((0,o.f)(A,ht)?gt=A[ht]:"1"===U.goBack&&(vt=!0,gt=A.g_0),gt))mt.OriginStopID!==V.StopID&&mt.DestinationStopID!==V.StopID||(dt=!0),vt?(mt.OriginStopID===V.StopID&&(ct=!0),mt.DestinationStopID===V.StopID&&(lt=!0)):(mt.OriginStopID===V.StopID&&(lt=!0),mt.DestinationStopID===V.StopID&&(ct=!0))}U.segmentBuffer={isSegmentBuffer:dt,isStartingPoint:lt,isEndingPoint:ct},Q.push(U)}}Q.sort(function(t,e){return t.sequence-e.sequence});for(var yt=(0,y.b)(H,450),bt=!1,_t=!1,It={},Dt=0,St={},$t=Q.length,Bt=0;Bt<$t;Bt++){var kt=Q[Bt],Rt=Q[Bt+1]||kt,Lt=0;if(kt.buses.length>0&&kt.buses[0].onThisRoute){var wt=[kt.buses[0].position.longitude,kt.buses[0].position.latitude],Pt=wt[0],Et=wt[1],Tt=[kt.position.longitude,kt.position.latitude],Ct=Tt[0],Mt=Tt[1],xt=[Rt.position.longitude,Rt.position.latitude],Ot=xt[0],qt=xt[1];if((Pt-Ct)*(Ot-Pt)+(Et-Mt)*(qt-Et)>=0){var At=Math.hypot(Pt-Ct,Et-Mt),Nt=Math.hypot(Pt-Ot,Et-qt);Lt=Math.max(0,Math.min(At/(At+Nt),1))}}kt.progress=Lt,kt.segmentBuffer.isStartingPoint&&(bt=!0),kt.segmentBuffer.isEndingPoint&&bt&&(_t=!0),bt&&!_t&&(kt.segmentBuffer.isSegmentBuffer=!0),bt&&_t&&(bt=!1,_t=!1);var Qt=!1;null!==yt&&yt.id===kt.id&&(Qt=!0),kt.nearest=Qt;var Ht=`g_${kt.goBack}`||"g_0";(0,o.f)(It,Ht)||(It[Ht]=[],St[Ht]=0,Dt+=1),It[Ht].push(kt),St[Ht]+=1}var Vt=D[`r_${t}`],Ut=Vt.n,Zt=Vt.dep,jt=Vt.des,zt={groupNames:[`往${jt}`,`往${Zt}`],groupedItems:It,groupQuantity:Dt,itemQuantity:St,RouteName:Ut,RouteEndPoints:[Zt,jt],dataUpdateTime:(0,g.e)(b),RouteID:t,PathAttributeId:e};return(0,g.a)(b),(0,g.b)(b),zt})).apply(this,arguments)}},8134(t,e,a){a.d(e,{a:()=>_,b:()=>S,c:()=>d,d:()=>h,e:()=>c});var n=a(467),r=a(2129),i=a(8024),o=a(4781),s=a(9734),u=a(8011),f=a(4293),p=a(6788);function d(t){return l.apply(this,arguments)}function l(){return(l=(0,n.a)(function*(t){var e=(0,i.c)(),a=yield(0,f.a)(e,!0),n=[];for(var r in a){var o=a[r];String(o.n).indexOf(t)>-1&&n.push(o)}return(0,p.a)(e),(0,p.b)(e),n})).apply(this,arguments)}function c(t){return v.apply(this,arguments)}function v(){return(v=(0,n.a)(function*(t){var e,a=(0,i.c)(),n=yield(0,f.a)(a,!0),r=`r_${t}`;return!!(0,i.f)(n,r)&&(e=n[r],(0,p.a)(a),(0,p.b)(a),e)})).apply(this,arguments)}function h(t){return g.apply(this,arguments)}function g(){return(g=(0,n.a)(function*(t){var e=(0,i.c)(),a=yield(0,f.a)(e,!0),n=[];for(var r in a){var o=a[r];String(o.pid).indexOf(t)>-1&&n.push(o)}return(0,p.a)(e),(0,p.b)(e),n})).apply(this,arguments)}var m={},y=[],b=!1;function _(){return I.apply(this,arguments)}function I(){return(I=(0,n.a)(function*(){if(!b){var t=(0,i.c)(),e=yield(0,f.a)(t,!0),a=yield(0,u.a)(t,1),n=yield(0,s.a)(t,!0);(0,p.a)(t),(0,p.b)(t);var r={},d=[],l=0;for(var c in e){var v=e[c],h={id:v.id,pid:v.pid,dep:v.dep,des:v.des,n:v.n,hash:"",lo:"",la:"",r:"",s:"",type:0};d.push(h);var g=(0,o.b)(`${h.n.toLowerCase()}${h.dep.toLowerCase()}${h.des.toLowerCase()}`,!0);for(var _ of g){var I=`u_${_}`;(0,i.f)(r,I)||(r[I]=[]),r[I].push(l)}l+=1}for(var D in a){var S=a[D],$={id:S.id,n:S.n,lo:S.lo,la:S.la,r:S.r,s:S.s,hash:S.hash,dep:"",des:"",pid:[],type:1};d.push($);var B=(0,o.b)($.n.toLowerCase(),!0);for(var k of B){var R=`u_${k}`;(0,i.f)(r,R)||(r[R]=[]),r[R].push(l)}l+=1}for(var L in n){var w=n[L],P={id:w.BusId,pid:[],dep:"",des:"",n:w.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};d.push(P);var E=(0,o.b)(P.n.toLowerCase(),!0);for(var T of E){var C=`u_${T}`;(0,i.f)(r,C)||(r[C]=[]),r[C].push(l)}l+=1}m=r,y=d,b=!0}})).apply(this,arguments)}function D(t,e){var a=0,n=0;for(var r of e){a+=t.indexOf(r,n)-n,n+=1}return t===e&&(a=10*Math.abs(a)),a}function S(t,e,a){if(!b)return[];var n=t.toLowerCase(),s=(0,o.b)(n,!0),u=(0,o.b)(n,!1),f=[];for(var p of s){var d=`u_${p}`;(0,i.f)(m,d)&&f.push(m[d])}f.sort(function(t,e){return t.length-e.length});var l=f.length-1,c=[];if(0===l&&(c=f[0]),l>0)for(var v=0;v<l;v++){var h=f[v],g=f[v+1];c=0===v?(0,r.b)(h,g):(0,r.b)(c,g)}var _=[],I=0,S=new Set;if(-1===e||2===e){var $=y.filter(function(t){return t.n===n&&2===t.type});for(var B of $)if(_.push({item:B,score:1/0}),S.add(B.id),(I+=1)>=a)break}if(I<a)for(var k of c){var R=y[k];if((-1===e||e===R.type)&&!S.has(R.id)){var L=D(u,(0,o.b)(R.n,!1));if(!(I<a))break;_.push({item:R,score:L}),I+=1}}return _.sort(function(t,e){return e.score-t.score}),_}}}]);
//# sourceMappingURL=585ebc43073204ff8d5c.js.map