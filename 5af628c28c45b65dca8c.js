"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,n)=>{n.d(e,{Ch:()=>pt,S5:()=>nt,SR:()=>ft,U7:()=>mt,aB:()=>it,py:()=>gt,q0:()=>ht});var i=n(7123),a=n(4537),s=n(6788),o=n(3459),r=n(8024),c=n(7968),d=n(3648),u=n(5767),l=n(9566),v=n(904),f=n(9119),m=n(5579),p=n(5314),h=n(4636);function g(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw s}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function y(t,e,n,i,a,s,o){try{var r=t[s](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,a)}var k=(0,d.bv)(".jk"),A=(0,d.aI)(k,"._l"),I=(0,d.aI)(A,".cm"),w=(0,d.aI)(A,".bm"),x=(0,d.aI)(A,".jm .km"),R=(0,d.aI)(A,".dm"),_=(0,d.aI)(R,".em"),T=(0,d.aI)(A,".hm"),j=(0,d.aI)(T,".im"),P=(0,d.aI)(k,".kk"),L={},S=!0,M=!1,Z=0,E=0,D=0,B={},C=0,z=0,F=!1,H=1e4,q=15e3,N=5e3,O=15e3,Q=!0,U=!1,J=0,$=0,K=!1,W="",X=-1,G=-1,V=!1,Y=0,tt=[],et=20;function nt(){P.addEventListener("touchstart",(function(){Z=Math.round(P.scrollLeft/C)}),{passive:!0}),P.addEventListener("scroll",(function(t){F=!0;var e=t.target.scrollLeft/C;E=e>Z?Z+1:Z-1;var n=B["g_".concat(Z)]||{width:0,offset:0},i=B["g_".concat(E)]||{width:0,offset:0},a=n.width+(i.width-n.width)*Math.abs(e-Z),s=-1*(n.offset+(i.offset-n.offset)*Math.abs(e-Z))+.5*C-.5*a;at(D,s,a-et,e),e===E&&(Z=Math.round(P.scrollLeft/C),F=!1)}),{passive:!0})}function it(){var t=(0,v.gO)("window"),e=t.width,n=t.height;k.style.setProperty("--gk","".concat(e,"px")),k.style.setProperty("--hk","".concat(n,"px"))}function at(t,e,n,i){P.style.setProperty("--ik",t.toString()),j.style.setProperty("--yl",(n/10).toString()),_.style.setProperty("--fm","".concat(e.toFixed(5),"px")),_.style.setProperty("--wl",i.toFixed(5))}function st(){var t=(new Date).getTime();K?(G=-1+(0,s._M)(W),X+=.1*(G-X)):(G=-1*Math.min(1,Math.max(0,Math.abs(t-J)/O)),X=G),x.style.setProperty("--z",X.toString()),window.requestAnimationFrame((function(){U&&st()}))}function ot(){var t=(0,r.zx)("i"),e=document.createElement("div");return e.classList.add("lm"),e.id=t,e.setAttribute("stretched","false"),e.innerHTML='<div class="qm"></div><div class="tm"><div class="ia" code="0"></div><div class="ja" code="0"></div></div>',{element:e,id:t}}function rt(t){var e=(0,r.zx)("i"),n=document.createElement("div");return n.classList.add("wm"),n.id=e,n.setAttribute("stretched","false"),n.innerHTML='<div class="xm"><div class="ym"></div><div class="zm"><div class="_m"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="an" onclick="bus.route.stretchRouteItemBody(\''.concat(e,"', '").concat(t,"')\">").concat((0,a.Z)("keyboard_arrow_down"),'</div><div class="bn"></div></div></div><div class="cn" displayed="false"><div class="dn"><div class="en" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 0)" code="0"><div class="fn">').concat((0,a.Z)("directions_bus"),'</div>公車</div><div class="en" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 1)" code="1"><div class="fn">').concat((0,a.Z)("departure_board"),'</div>抵達時間</div><div class="en" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 2)" code="2"><div class="fn">').concat((0,a.Z)("route"),'</div>路線</div><div class="en" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder(\'stop-on-route\', [\'').concat(e,'\', null, null])"><div class="fn">').concat((0,a.Z)("folder"),'</div>儲存至資料夾</div><div class="en" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification(\'stop-on-route\', [\'').concat(e,'\', null, null, null])" enabled="true"><div class="fn">').concat((0,a.Z)("notifications"),'</div>設定到站通知</div></div><div class="gn" displayed="true"></div><div class="hn" displayed="false"></div><div class="in" displayed="false"></div></div>'),{element:n,id:e}}function ct(){var t=document.createElement("div");t.classList.add("lk");var e=document.createElement("div");e.classList.add("mk");var n=document.createElement("div");n.classList.add("nk");var i=document.createElement("div");return i.classList.add("ok"),e.appendChild(n),e.appendChild(i),t.appendChild(e),{element:t,id:""}}function dt(t,e,n,i){function s(t,s,o,c,u,v,f){function p(t,e,n,i,a,s,o){var r=(0,d.aI)(e,".tm"),c=(0,d.aI)(r,".ja"),u=(0,d.aI)(r,".ia"),l=(0,d.aI)(t,"._m"),v=(0,d.aI)(l,".ja"),f=(0,d.aI)(l,".ia");u.setAttribute("code",n.status.code.toString()),f.setAttribute("code",n.status.code.toString()),f.innerText=n.status.text,o&&function(t,e,n,i){if(Z!==e&&E!==e)return!1;var a=Math.floor(i/50)-1,s=Math.floor(t/50)+1;return!(n<a||n>a+s)}(z,i,a,s)?(c.addEventListener("animationend",(function(){c.setAttribute("code",n.status.code.toString()),c.classList.remove("_a")}),{once:!0}),v.addEventListener("animationend",(function(){v.setAttribute("code",n.status.code.toString()),v.innerText=n.status.text,v.classList.remove("_a")}),{once:!0}),c.classList.add("_a"),v.classList.add("_a")):(c.setAttribute("code",n.status.code.toString()),v.setAttribute("code",n.status.code.toString()),v.innerText=n.status.text)}function g(t,e,n){t.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer))}function b(t,e){(0,d.aI)(t,".ym").innerText=e.name}function y(t,e){(0,d.aI)(t,".gn").innerHTML=0===e.buses.length?'<div class="jn">目前沒有公車可顯示</div>':e.buses.map((function(t){return'<div class="kn" on-this-route="'.concat(t.onThisRoute,'"><div class="ln"><div class="mn">').concat((0,a.Z)("directions_bus"),'</div><div class="nn">').concat(t.carNumber,'</div></div><div class="on"><div class="pn">路線：').concat(t.RouteName,'</div><div class="qn">狀態：').concat(t.status.text,'</div><div class="rn">類型：').concat(t.type,"</div></div></div>")})).join("")}function k(t,e){(0,d.aI)(t,".hn").innerHTML=0===e.overlappingRoutes.length?'<div class="sn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return'<div class="tn"><div class="un"><div class="vn">'.concat((0,a.Z)("route"),'</div><div class="wn">').concat(t.name,'</div></div><div class="xn">').concat(t.RouteEndPoints.html,'</div><div class="yn"><div class="zn" onclick="bus.route.switchRoute(').concat(t.RouteID,", [").concat(t.PathAttributeId.join(","),'])">查看路線</div><div class="zn" onclick="bus.folder.openSaveToFolder(\'route-on-route\', [').concat(t.RouteID,'])">收藏路線</div></div></div>')})).join("")}function A(t,e){(0,d.aI)(t,".in").innerHTML=0===e.busArrivalTimes.length?'<div class="_n">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return'<div class="ao"><div class="bo"><div class="co">'.concat((0,a.Z)("calendar_view_day"),'</div><div class="do">').concat(t.personalSchedule.name,'</div><div class="eo">週').concat((0,m.kd)(t.day).name," ").concat((0,m.pn)(t.personalSchedule.period.start)," - ").concat((0,m.pn)(t.personalSchedule.period.end),'</div></div><div class="fo">').concat(t.chart,"</div></div>")})).join("")}function I(t,e,n){t.setAttribute("nearest",(0,r.xZ)(n.nearest)),e.setAttribute("nearest",(0,r.xZ)(n.nearest))}function w(t,e,n,i){var a=(null==n?void 0:n.progress)||0,s=(null==e?void 0:e.progress)||0,o=(0,d.aI)(t,".qm");i&&0!==a&&0===s&&Math.abs(s-a)>0?(o.style.setProperty("--om","".concat(100,"%")),o.style.setProperty("--pm","".concat(100,"%")),o.addEventListener("transitionend",(function(){o.style.setProperty("--om","".concat(0,"%")),o.style.setProperty("--pm","".concat(0,"%"))}),{once:!0})):(o.style.setProperty("--om","".concat(0,"%")),o.style.setProperty("--pm","".concat(100*s,"%")))}function x(t,e,n){n&&((0,d.aI)(t,".cn").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function R(t,e,n){t.setAttribute("animation",(0,r.xZ)(n)),e.setAttribute("animation",(0,r.xZ)(n))}function _(t,e,n){t.setAttribute("skeleton-screen",(0,r.xZ)(n)),e.setAttribute("skeleton-screen",(0,r.xZ)(n))}function T(t,n){var i=(0,d.aI)(t,'.cn .dn .en[type="save-to-folder"]');i.setAttribute("onclick","bus.folder.openSaveToFolder('stop-on-route', ['".concat(t.id,"', ").concat(n.id,", ").concat(e.RouteID,"])")),(0,l.LH)("stop",n.id).then((function(t){i.setAttribute("highlighted",(0,r.xZ)(t))}))}function j(t,n){var i=(0,d.aI)(t,'.cn .dn .en[type="schedule-notification"]');i.setAttribute("onclick","bus.notification.openScheduleNotification('stop-on-route', ['".concat(t.id,"', ").concat(n.id,", ").concat(e.RouteID,", ").concat(n.status.time,"])"));var a=(0,h.Zc)(n.id);i.setAttribute("highlighted",(0,r.xZ)(a))}null===c?(p(t,s,o,u,v,f,i),b(t,o),y(t,o),k(t,o),A(t,o),g(t,s,o),I(t,s,o),w(s,o,c,i),x(t,s,n),R(t,s,i),_(t,s,n),T(t,o),j(t,o)):(o.status.time!==c.status.time&&(p(t,s,o,u,v,f,i),j(t,o)),(0,r.hw)(c.buses,o.buses)||y(t,o),(0,r.hw)(c.busArrivalTimes,o.busArrivalTimes)||A(t,o),(0,r.hw)(c.segmentBuffer,o.segmentBuffer)||g(t,s,o),c.nearest!==o.nearest&&I(t,s,o),c.progress!==o.progress&&w(s,o,c,i),c.id!==o.id&&(b(t,o),k(t,o),T(t,o),j(t,o)),i!==S&&R(t,s,i),n!==M&&(x(t,s,n),_(t,s,n)))}var o=(0,v.gO)("window"),u=o.width,f=o.height,p=e.groupQuantity,g=e.itemQuantity,b=e.groupedItems;D=p,C=u,z=f;for(var y=0,k=0;k<p;k++){var A="g_".concat(k),x=(0,c.q_)([e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,""].map((function(t){return"往".concat(t)}))[k],500,"17px",'"Noto Sans TC", sans-serif')+et;B[A]={width:x,offset:y},y+=x}var j=-1*B["g_".concat(Z)].offset+.5*C-.5*B["g_".concat(Z)].width;F||at(D,j,B["g_".concat(Z)].width-et,Z),I.innerHTML="<span>".concat(e.RouteName,"</span>"),I.setAttribute("animation",(0,r.xZ)(i)),I.setAttribute("skeleton-screen",(0,r.xZ)(n)),R.setAttribute("animation",(0,r.xZ)(i)),R.setAttribute("skeleton-screen",(0,r.xZ)(n)),T.setAttribute("animation",(0,r.xZ)(i)),T.setAttribute("skeleton-screen",(0,r.xZ)(n)),w.setAttribute("onclick","bus.route.openRouteDetails(".concat(e.RouteID,", [").concat(e.PathAttributeId.join(","),"])"));var H,q,N=(0,d.jg)(P,".lk").length;if(p!==N){var O=N-p;if(O<0){for(var Q=new DocumentFragment,U=new DocumentFragment,J=0;J<Math.abs(O);J++){var $=ct();Q.appendChild($.element);var K=(H=void 0,q=void 0,H=(0,r.zx)("t"),(q=document.createElement("div")).classList.add("gm"),q.id=H,{element:q,id:H});U.appendChild(K.element)}P.append(Q),_.append(U)}else for(var W=(0,d.jg)(P,".lk"),X=(0,d.jg)(t,"._l .dm .em .gm"),G=0;G<Math.abs(O);G++){var V=N-1-G;W[V].remove(),X[V].remove()}}for(var Y=0;Y<p;Y++){var tt="g_".concat(Y),nt=(0,d.jg)((0,d.aI)((0,d.jg)(t,".kk .lk")[Y],".ok"),".wm").length;if(g[tt]!==nt){var it=nt-g[tt];if(it<0){for(var st=(0,d.aI)((0,d.jg)(t,".kk .lk")[Y],".ok"),dt=(0,d.aI)((0,d.jg)(t,".kk .lk")[Y],".nk"),ut=new DocumentFragment,lt=new DocumentFragment,vt=0;vt<Math.abs(it);vt++){var ft=ot(),mt=rt(ft.id);ut.appendChild(mt.element),lt.appendChild(ft.element)}st.append(ut),dt.append(lt)}else for(var pt=(0,d.jg)((0,d.aI)((0,d.jg)(t,".kk .lk")[Y],".ok"),".wm"),ht=(0,d.jg)((0,d.aI)((0,d.jg)(t,".kk .lk")[Y],".nk"),".lm"),gt=0;gt<Math.abs(it);gt++){var bt=nt-1-gt;pt[bt].remove(),ht[bt].remove()}}}for(var yt=(0,d.jg)(P,".lk"),kt=0;kt<p;kt++){var At="g_".concat(kt),It=(0,d.jg)(t,"._l .dm .em .gm")[kt];It.innerHTML=[e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,""].map((function(t){return"<span>往".concat(t,"</span>")}))[kt],It.style.setProperty("--zl","".concat(B[At].width,"px")),It.style.setProperty("--xl","".concat(kt));for(var wt=yt[kt],xt=wt.scrollTop,Rt=(0,d.aI)(wt,".ok"),_t=(0,d.aI)(wt,".nk"),Tt=(0,d.jg)(Rt,".wm"),jt=(0,d.jg)(_t,".lm"),Pt=0;Pt<g[At];Pt++){var Lt=Tt[Pt],St=jt[Pt],Mt=b[At][Pt];if(L.hasOwnProperty("groupedItems"))if(L.groupedItems.hasOwnProperty(At))if(L.groupedItems[At][Pt])s(Lt,St,Mt,L.groupedItems[At][Pt],kt,Pt,xt);else s(Lt,St,Mt,null,kt,Pt,xt);else s(Lt,St,Mt,null,kt,Pt,xt);else s(Lt,St,Mt,null,kt,Pt,xt)}}L=e,S=i,M=n}function ut(){return lt.apply(this,arguments)}function lt(){var t;return t=function*(){var t=(0,o.Js)("playing_animation"),e=(0,o.Js)("refresh_interval"),n=(0,v.gO)("route-bus-arrival-time-chart");Q=e.dynamic,q=e.baseInterval,K=!0,W=(0,r.zx)("r"),x.setAttribute("refreshing","true");var a=yield(0,i.R)(Y,tt,n.width,n.height,W);dt(k,a,!1,t);var s=0;Q&&(s=yield(0,u.wz)()),J=(new Date).getTime(),$=Q?Math.max(J+N,a.dataUpdateTime+q/s):J+q,O=Math.max(N,$-J),K=!1,x.setAttribute("refreshing","false")},lt=function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function o(t){y(s,i,a,o,r,"next",t)}function r(t){y(s,i,a,o,r,"throw",t)}o(void 0)}))},lt.apply(this,arguments)}function vt(){ut().then((function(){U?setTimeout((function(){vt()}),Math.max(N,$-(new Date).getTime())):V=!1})).catch((function(t){console.error(t),U?((0,f.a)("（路線）發生網路錯誤，將在".concat(H/1e3,"秒後重試。"),"error"),setTimeout((function(){vt()}),H)):V=!1}))}function ft(t,e){(0,v.WR)("Route"),(0,p.XK)("route",t),Y=t,tt=e,Z=0,k.setAttribute("displayed","true"),(0,d.aI)(k,".kk").scrollLeft=0,function(t){for(var e=(0,o.Js)("playing_animation"),n=(0,v.gO)("window"),i=(n.width,n.height),a=Math.floor(i/50)+5,s={},r=0;r<2;r++){var c="g_".concat(r);s[c]=[];for(var d=0;d<a;d++)s[c].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],sequence:d,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}dt(t,{groupedItems:s,groupQuantity:2,itemQuantity:{g_0:a,g_1:a},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,e)}(k),U||(U=!0,V?ut():(V=!0,vt()),X=-1,G=-1,st()),(0,v.Z_)()}function mt(){k.setAttribute("displayed","false"),U=!1,X=-1,G=-1,(0,v.l$)()}function pt(t,e){U=!1,X=-1,G=-1,ft(t,e)}function ht(t,e){var n=(0,d.bv)(".jk .kk .lk .mk .ok .wm#".concat(t)),i=(0,d.aI)(n,".cn"),a=(0,d.bv)(".jk .kk .lk .mk .nk .lm#".concat(e));"true"===n.getAttribute("stretched")?("true"===n.getAttribute("animation")?i.addEventListener("transitionend",(function(){i.setAttribute("displayed","false")}),{once:!0}):i.setAttribute("displayed","false"),n.setAttribute("stretched","false"),a.setAttribute("stretched","false")):(i.setAttribute("displayed","true"),n.setAttribute("stretched","true"),a.setAttribute("stretched","true"))}function gt(t,e){var n,i=(0,d.aI)(P,".wm#".concat(t)),a=(0,d.aI)(i,".dn"),s=g((0,d.jg)(a,'.en[highlighted="true"][type="tab"]'));try{for(s.s();!(n=s.n()).done;){n.value.setAttribute("highlighted","false")}}catch(t){s.e(t)}finally{s.f()}switch((0,d.aI)(a,'.en[code="'.concat(e,'"]')).setAttribute("highlighted","true"),e){case 0:(0,d.aI)(i,".gn").setAttribute("displayed","true"),(0,d.aI)(i,".hn").setAttribute("displayed","false"),(0,d.aI)(i,".in").setAttribute("displayed","false");break;case 1:(0,d.aI)(i,".gn").setAttribute("displayed","false"),(0,d.aI)(i,".hn").setAttribute("displayed","false"),(0,d.aI)(i,".in").setAttribute("displayed","true");break;case 2:(0,d.aI)(i,".gn").setAttribute("displayed","false"),(0,d.aI)(i,".hn").setAttribute("displayed","true"),(0,d.aI)(i,".in").setAttribute("displayed","false")}}}}]);
//# sourceMappingURL=5af628c28c45b65dca8c.js.map