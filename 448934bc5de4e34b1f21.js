!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("bus",[],t):"object"==typeof exports?exports.bus=t():r.bus=t()}(self,(()=>(()=>{var r={5241:r=>{for(var t="0123456789bcdefghjkmnpqrstuvwxyz",e={},n=0;n<32;n++)e[t.charAt(n)]=n;var o="auto",u=-90,a=90,i=-180,f=180,l=[0,5,7,8,11,12,13,15,16,17,18],d=function(r,e,n){if(n===o){if("number"==typeof r||"number"==typeof e)throw new Error("string notation required for auto precision.");var d=r.split(".")[1].length,c=e.split(".")[1].length,s=Math.max(d,c);n=l[s]}else void 0===n&&(n=9);for(var v,h=[],p=0,g=0,y=0,b=a,m=u,x=f,I=i;h.length<n;)if(g%2==0?e>(v=(x+I)/2)?(y=1+(y<<1),I=v):(y=0+(y<<1),x=v):r>(v=(b+m)/2)?(y=1+(y<<1),m=v):(y=0+(y<<1),b=v),g++,5===++p){var _=t[y];h.push(_),p=0,y=0}return h.join("")},c=function(r,t,e){e=e||52;for(var n,o=0,l=a,d=u,c=f,s=i,v=0;o<e;)v*=2,o%2==0?t>(n=(c+s)/2)?(v+=1,s=n):c=n:r>(n=(l+d)/2)?(v+=1,d=n):l=n,o++;return v},s=function(r){for(var t,n=!0,o=a,l=u,d=f,c=i,s=0,v=0,h=r.length;v<h;v++){var p=r[v].toLowerCase();s=e[p];for(var g=4;g>=0;g--){var y=s>>g&1;n?(t=(d+c)/2,1===y?c=t:d=t):(t=(o+l)/2,1===y?l=t:o=t),n=!n}}return[l,c,o,d]},v=function(r,t){for(var e=a,n=u,o=f,l=i,d=0,c=(t=t||52)/2,s=0;s<c;s++)d=h(r,2*(c-s)-1),0===h(r,2*(c-s)-2)?e=(e+n)/2:n=(e+n)/2,0===d?o=(o+l)/2:l=(o+l)/2;return[n,l,e,o]};function h(r,t){return r/Math.pow(2,t)&1}var p=function(r){var t=s(r),e=(t[0]+t[2])/2,n=(t[1]+t[3])/2;return{latitude:e,longitude:n,error:{latitude:t[2]-e,longitude:t[3]-n}}},g=function(r,t){var e=v(r,t),n=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return{latitude:n,longitude:o,error:{latitude:e[2]-n,longitude:e[3]-o}}},y=function(r,t){var e=p(r),n=e.latitude+t[0]*e.error.latitude*2,o=e.longitude+t[1]*e.error.longitude*2;return o=m(o),n=x(n),d(n,o,r.length)},b=function(r,t,e){var n=g(r,e=e||52),o=n.latitude+t[0]*n.error.latitude*2,u=n.longitude+t[1]*n.error.longitude*2;return u=m(u),o=x(o),c(o,u,e)};function m(r){return r>f?i+r%f:r<i?f+r%f:r}function x(r){return r>a?a:r<u?u:r}var I={ENCODE_AUTO:o,encode:d,encode_uint64:c,encode_int:c,decode:p,decode_int:g,decode_uint64:g,decode_bbox:s,decode_bbox_uint64:v,decode_bbox_int:v,neighbor:y,neighbor_int:b,neighbors:function(r){var t,e,n=r.length,o=p(r),u=o.latitude,a=o.longitude,i=2*o.error.latitude,f=2*o.error.longitude;function l(r,o){return t=u+r*i,e=m(e=a+o*f),t=x(t),d(t,e,n)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},neighbors_int:function(r,t){var e,n,o=g(r,t=t||52),u=o.latitude,a=o.longitude,i=2*o.error.latitude,f=2*o.error.longitude;function l(r,o){return e=u+r*i,n=m(n=a+o*f),e=x(e),c(e,n,t)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},bboxes:function(r,t,e,n,o){for(var u=d(r,t,o=o||9),a=d(e,n,o),i=p(u),f=2*i.error.latitude,l=2*i.error.longitude,c=s(u),v=s(a),h=Math.round((v[0]-c[0])/f),g=Math.round((v[1]-c[1])/l),b=[],m=0;m<=h;m++)for(var x=0;x<=g;x++)b.push(y(u,[m,x]));return b},bboxes_int:function(r,t,e,n,o){for(var u=c(r,t,o=o||52),a=c(e,n,o),i=g(u,o),f=2*i.error.latitude,l=2*i.error.longitude,d=v(u,o),s=v(a,o),h=Math.round((s[0]-d[0])/f),p=Math.round((s[1]-d[1])/l),y=[],m=0;m<=h;m++)for(var x=0;x<=p;x++)y.push(b(u,[m,x],o));return y}};r.exports=I}},t={};function e(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return r[n](u,u.exports,e),u.exports}var n={};return(()=>{"use strict";var r=e(5241).encode;function t(t,e,n){return r(t,e,n)}function n(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return o(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,u=function(){};return{s:u,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,f=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){f=!0,a=r},f:function(){try{i||null==e.return||e.return()}finally{if(f)throw a}}}}function o(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}function u(r){var t=Math.hypot(r),e=[];if(t>0){var o,u=1/t,a=n(r);try{for(a.s();!(o=a.n()).done;){var i=o.value;e.push(i*u)}}catch(r){a.e(r)}finally{a.f()}return e}return r}function a(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return i(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,o=function(){};return{s:o,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,f=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return a=r.done,r},e:function(r){f=!0,u=r},f:function(){try{a||null==e.return||e.return()}finally{if(f)throw u}}}}function i(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}self.onmessage=function(r){var e=function(r){var e,n={},o=a(r);try{for(o.s();!(e=o.n()).done;){var i=e.value,f=`r_${i.routeId}`;n.hasOwnProperty(f)||(n[f]=[]),n[f].push(i)}}catch(r){o.e(r)}finally{o.f()}for(var l in n)n[l]=n[l].sort((function(r,t){return r.seqNo-t.seqNo}));var d,c={},s=a(r);try{for(s.s();!(d=s.n()).done;){for(var v=d.value,h=`r_${v.routeId}`,p=parseFloat(v.longitude),g=parseFloat(v.latitude),y=[0,0],b=n[h],m=b.length,x=null,I=0;I<m;I++)if(b[I].Id===v.Id){var _=0;I<m-1&&(_=I+1),x=b[_]}if(x)y=u([parseFloat(x.longitude)-p,parseFloat(x.latitude)-g]);var w=`l_${v.stopLocationId}`;if(c.hasOwnProperty(w))c[w].r.indexOf(v.routeId)<0&&c[w].r.push(v.routeId),c[w].s.indexOf(v.Id)<0&&(c[w].s.push(v.Id),c[w].v.push(y)),c[w].a.push(v.address);else{var A={};A.n=v.nameZh,A.lo=p,A.la=g,A.g=t(g,p,6),A.r=[v.routeId],A.s=[v.Id],A.v=[y],A.a=[v.address],A.id=v.stopLocationId,c[w]=A}}}catch(r){s.e(r)}finally{s.f()}return c}(r.data);self.postMessage(e)}})(),n=n.default})()));
//# sourceMappingURL=448934bc5de4e34b1f21.js.map