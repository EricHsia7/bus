"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[324],{540(e,t,a){a.d(t,{a:()=>N,b:()=>F});var n=a(467),i=a(5767),r=a(9566),d=a(3459),s=a(8179),o=a(8024),c=a(4537),l=a(904),u=a(3030),p=a(9119),f=a(4690),b=(0,s.c)(".qd"),h=(0,s.e)(b,".rd"),v=(0,s.e)(b,".sd"),m=(0,s.e)(v,".td"),y=(0,s.e)(h,".ud .vd"),k={},g=!1,C=!1,L=15e3,w=5e3,A=15e3,_=!0,x=0,T=0,P="",$=!1,M=!1,S=!1;function z(){var e=(0,s.a)();e.classList.add("wd"),e.setAttribute("type","stop");var t=(0,s.a)();t.classList.add("xd"),t.appendChild((0,c.b)("location_on"));var a=(0,s.a)();a.classList.add("yd");var n=(0,s.a)();n.classList.add("zd");var i=(0,s.a)();i.classList.add("_d");var r=(0,s.a)();r.classList.add("ae");var d=(0,s.a)();d.classList.add("cb"),d.setAttribute("code","0"),d.setAttribute("displayed","false");var o=(0,s.a)();o.classList.add("db"),o.setAttribute("code","0"),o.setAttribute("displayed","true"),r.appendChild(d),r.appendChild(o);var l=(0,s.a)();l.classList.add("be"),l.appendChild((0,c.b)("keyboard_arrow_right"));var u=(0,s.a)();return u.classList.add("ce"),i.appendChild(r),i.appendChild(l),i.appendChild(u),e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(i),e}function D(){var e=(0,s.a)();e.classList.add("de");var t=(0,s.a)();t.classList.add("ee");var a=(0,s.a)();a.classList.add("fe"),a.appendChild((0,c.a)());var n=(0,s.a)();n.classList.add("ge"),t.appendChild(a),t.appendChild(n);var i=(0,s.a)();return i.classList.add("he"),e.appendChild(t),e.appendChild(i),e}function E(e){var t=e;if($){var a=t.detail.progress-1;y.style.setProperty("--ke",a.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,E)}function F(){for(var e=(0,d.b)("playing_animation"),t=(0,l.e)("window"),a=(t.width,t.height),n=Math.floor(a/50/3)+2,i=[],r=0;r<3;r++){for(var s={name:"",icon:"",id:"",timestamp:0,content:[],contentLength:n},o=0;o<n;o++){s.content.push({type:"stop",id:0,timestamp:0,name:"",status:{code:8,text:"",time:-6},direction:0,route:{name:"",endPoints:{departure:"",destination:""},id:0,pathAttributeId:[]}})}i.push(s)}I({folders:i,dataUpdateTime:0},!0,e)}function I(e,t,a){function n(e,n,i){function r(e,t){e.setAttribute("type",t.type)}function d(e,t){var a=(0,s.e)(e,".xd"),n="";switch(t.type){case"stop":case"location":n="location_on";break;case"route":n="route";break;case"bus":n="directions_bus";break;case"empty":n="lightbulb";break;default:n=""}(0,c.c)(a,n)}function l(e,t,a){if("stop"===t.type){var n=e.getBoundingClientRect(),i=n.top,r=n.left,d=n.bottom,o=n.right,c=window.innerWidth,l=window.innerHeight,u=(0,s.e)(e,"._d .ae"),p=(0,s.e)(u,".cb"),f=(0,s.e)(u,".db");p.setAttribute("code",t.status.code.toString()),p.innerText=t.status.text,a&&d>0&&i<l&&o>0&&r<c?(f.addEventListener("animationend",function(){f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,f.classList.remove("nb"),p.setAttribute("displayed","false")},{once:!0}),p.setAttribute("displayed","true"),f.classList.add("nb")):(f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text)}}function p(e,t){var a="";switch(t.type){case"stop":case"route":case"location":a=t.name;break;case"bus":a=t.busID;break;case"empty":a="沒有內容";break;default:a="null"}(0,s.e)(e,".zd").innerText=a}function b(e,t){var a="";switch(t.type){case"stop":a=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`;break;case"route":a=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`;break;case"location":a="地點";break;case"bus":break;case"empty":a="提示";break;default:a="null"}(0,s.e)(e,".yd").innerText=a}function h(e,t){var a=(0,s.e)(e,"._d .be");switch(t.type){case"stop":a.onclick=function(){(0,f.c)(t.route.id,t.route.pathAttributeId)};break;case"route":a.onclick=function(){(0,f.c)(t.id,t.pathAttributeId)};break;case"location":a.onclick=function(){(0,u.c)(t.id)}}}function v(e,t){e.setAttribute("animation",(0,o.a)(t))}function m(e,t){e.setAttribute("skeleton-screen",(0,o.a)(t))}if(null==i)r(e,n),d(e,n),l(e,n,a),p(e,n),b(e,n),h(e,n),v(e,a),m(e,t);else if(n.type!==i.type)r(e,n),d(e,n),l(e,n,a),p(e,n),b(e,n),h(e,n),v(e,a),m(e,t);else{switch(n.type){case"stop":(0,o.b)(i.route,n.route)||(b(e,n),h(e,n)),i.name!==n.name&&p(e,n),i.status.time!==n.status.time&&l(e,n,a);break;case"route":i.id!==n.id&&h(e,n),(0,o.b)(i.endPoints,n.endPoints)||b(e,n),i.name!==n.name&&p(e,n);break;case"location":i.id!==n.id&&h(e,n),i.name!==n.name&&p(e,n);break;case"bus":default:break;case"empty":n.type!==i.type&&(b(e,n),p(e,n))}t!==C&&m(e,t),a!==g&&v(e,a)}}function i(e,n,i){function r(e,t){var a=(0,s.e)(e,".ee");(0,s.e)(a,".ge").innerText=t.name}function d(e,t){var a=(0,s.e)(e,".ee"),n=(0,s.e)(a,".fe");(0,c.c)(n,t.icon)}function l(e,t){e.setAttribute("animation",(0,o.a)(t))}function u(e,t){e.setAttribute("skeleton-screen",(0,o.a)(t))}null==i?(r(e,n),d(e,n),l(e,a),u(e,t)):(n.name!==i.name&&r(e,n),n.icon!==i.icon&&d(e,n),a!==g&&l(e,a),t!==C&&u(e,t))}var r=e.folders,d=r.length,l=Array.from((0,s.d)(m,".de")),p=l.length;if(d!==p){var b=p-d;if(b<0){for(var h=new DocumentFragment,v=0;v>b;v--){var y=D();h.appendChild(y),l.push(y)}m.append(h)}else if(b>0)for(var L=p-1,w=p-b-1;L>w;L--)l[L].remove(),l.splice(L,1)}for(var A=0;A<d;A++){var _=r[A],x=_.content,T=x.length,P=l[A],$=(0,s.e)(P,".he"),M=Array.from((0,s.d)($,".wd")),S=M.length;if(T!==S){var E=S-T;if(E<0)for(var F=0;F>E;F--){var I=z();$.appendChild(I),M.push(I)}else if(E>0)for(var j=S-1,q=S-E-1;j>q;j--)M[j].remove(),M.splice(j,1)}if((0,o.e)(k,"folders"))if(k.folders[A])i(P,_,k.folders[A]);else i(P,_,null);else i(P,_,null);for(var B=0;B<T;B++){var H=M[B],N=x[B];if((0,o.e)(k,"folders"))if(k.folders[A])if(k.folders[A].content[B])n(H,N,k.folders[A].content[B]);else n(H,N,null);else n(H,N,null);else n(H,N,null)}}k=e,g=a,C=t}function j(){return q.apply(this,arguments)}function q(){return(q=(0,n.a)(function*(){var e=(0,d.b)("playing_animation"),t=(0,d.b)("refresh_interval");_=t.dynamic,L=t.baseInterval,$=!0,P=(0,o.c)(),y.setAttribute("refreshing","true"),y.classList.remove("je"),document.addEventListener(P,E);var a=yield(0,r.d)(P);I(a,!1,e);var n=0;_&&(n=yield(0,i.c)()),x=(new Date).getTime(),T=_?Math.max(x+w,a.dataUpdateTime+L/n):x+L,A=Math.max(w,T-x),$=!1,y.setAttribute("refreshing","false"),y.style.setProperty("--ie",`${A}ms`),y.classList.add("je")})).apply(this,arguments)}function B(){return H.apply(this,arguments)}function H(){return(H=(0,n.a)(function*(){j().then(function(){M?setTimeout(function(){B()},Math.max(w,T-(new Date).getTime())):S=!1}).catch(function(e){M?((0,p.a)("error","資料夾網路連線中斷，將在10秒後重試。"),setTimeout(function(){B()},1e4)):S=!1})})).apply(this,arguments)}function N(){F(),M||(M=!0,S?j():(S=!0,B()))}},1924(){},3951(){},4504(){},4526(){},4946(){},6590(){},6732(){},6738(){},7482(){},8379(e,t,a){a.d(t,{a:()=>h,b:()=>b});var n=a(467),i=a(9566),r=a(8179),d=a(9333),s=a(4537),o=a(904),c=(0,r.c)(".le"),l=(0,r.e)(c,".me"),u=(0,r.e)(l,".ne");function p(e){var t=(0,r.a)();t.classList.add("oe"),t.onclick=function(){(0,d.b)(e.id)};var a=(0,r.a)();a.classList.add("pe"),a.appendChild((0,s.b)(e.icon));var n=(0,r.a)();n.classList.add("qe"),n.innerText=e.name;var i=(0,r.a)();i.classList.add("re"),i.innerText=String(e.contentLength);var o=(0,r.a)();return o.classList.add("se"),o.appendChild((0,s.b)("arrow_forward_ios")),t.appendChild(a),t.appendChild(n),t.appendChild(i),t.appendChild(o),t}function f(){return(f=(0,n.a)(function*(){var e=yield(0,i.h)();u.innerHTML="";var t=new DocumentFragment;for(var a of e){var n=p(a);t.appendChild(n)}u.append(t)})).apply(this,arguments)}function b(){(0,o.d)("FolderManager"),c.setAttribute("displayed","true"),function(){f.apply(this,arguments)}()}function h(){(0,o.f)("FolderManager"),c.setAttribute("displayed","false")}},8456(){},8592(){},9333(e,t,a){a.d(t,{a:()=>w,b:()=>L});var n=a(467),i=a(9566),r=a(8179),d=a(4294),s=a(4537),o=a(904),c=a(9119),l=(0,r.c)(".te"),u=(0,r.e)(l,".ue"),p=(0,r.e)(u,".ve"),f=(0,r.e)(l,".we"),b=(0,r.e)(f,".xe"),h=(0,r.e)(b,'.ye[group="folder-name"] .ze input'),v=(0,r.e)(b,'.ye[group="folder-icon"] .ze ._e input'),m=(0,r.e)(b,'.ye[group="folder-icon"] .ze ._e .af'),y=(0,r.e)(b,'.ye[group="folder-content"] .ze');function k(e,t){var a=(0,r.a)();a.classList.add("bf"),a.setAttribute("type",t.type);var n="",d="",o="";switch(t.type){case"stop":o="location_on",n=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`,d=t.name;break;case"route":o="route",n=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`,d=t.name;break;case"location":o="location_on",n="地點",d=t.name;break;case"bus":n="",d=t.name;break;case"empty":o="lightbulb",n="提示",d="沒有內容";break;default:o="",n="null",d="null"}var l=(0,r.a)();l.classList.add("cf"),l.appendChild((0,s.b)(o));var u=(0,r.a)();u.classList.add("df"),u.innerText=n;var p=(0,r.a)();p.classList.add("ef"),p.innerText=d;var f=(0,r.a)();f.classList.add("ff");var b=(0,r.a)();b.classList.add("gf"),b.appendChild((0,s.b)("keyboard_arrow_down")),b.onclick=function(){A(a,e.id,t.type,t.id,"up")};var h=(0,r.a)();h.classList.add("hf"),h.appendChild((0,s.b)("keyboard_arrow_down")),h.onclick=function(){A(a,e.id,t.type,t.id,"down")};var v=(0,r.a)();v.classList.add("if"),v.appendChild((0,s.b)("delete")),v.onclick=function(){!function(e,t,a,n){(0,i.k)(t,a,n).then(function(t){if(t)switch(e.remove(),a){case"stop":(0,c.a)("delete","已移除站牌");break;case"route":(0,c.a)("delete","已移除路線");break;case"location":(0,c.a)("delete","已移除地點")}else(0,c.a)("error","無法移除")})}(a,e.id,t.type,t.id)};var m=(0,r.a)();m.classList.add("jf");var y=(0,r.a)();return y.classList.add("jf"),f.appendChild(b),f.appendChild(h),f.appendChild(v),f.appendChild(m),f.appendChild(y),a.appendChild(l),a.appendChild(u),a.appendChild(p),a.appendChild(f),a}function g(e,t){h.value=e.name,v.value=e.icon,p.onclick=function(){var t,a,n;t=e.id,a=h.value,n=v.value,(0,i.q)(t,a,n).then(function(e){e?(w(),(0,c.a)("check_circle","已儲存變更")):(0,c.a)("error","無法儲存")})},y.innerHTML="";var a=new DocumentFragment;for(var n of t){var r=k(e,n);a.appendChild(r)}y.append(a)}function C(){return(C=(0,n.a)(function*(e){g((0,i.b)(e),yield(0,i.g)(e))})).apply(this,arguments)}function L(e){(0,o.d)("FolderEditor"),l.setAttribute("displayed","true"),function(e){C.apply(this,arguments)}(e),(0,o.a)()}function w(){l.setAttribute("displayed","false"),(0,o.c)()}function A(e,t,a,n,r){(0,i.p)(t,a,n,r).then(function(t){if(t)switch(r){case"up":var a=e.previousElementSibling;a&&e.parentNode.insertBefore(e,a),(0,c.a)("arrow_circle_up","已往上移");break;case"down":var n=e.nextElementSibling;n&&e.parentNode.insertBefore(n,e),(0,c.a)("arrow_circle_down","已往下移")}else(0,c.a)("error","無法移動")})}m.onclick=function(){(0,d.c)(v)}},9422(){}}]);
//# sourceMappingURL=92064c59689c6d3ff9d4.js.map