{"version":3,"file":"93f45f3baade90200609.js","mappings":"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","sources":["webpack://bus/./src/data/notification/apis/cancelNotification/index.ts","webpack://bus/./src/data/notification/apis/loader.ts","webpack://bus/./src/data/notification/apis/getNotificationToken/index.ts","webpack://bus/./src/data/notification/apis/getNotificationRequestBody/index.ts","webpack://bus/./src/data/location/index.ts","webpack://bus/./src/data/notification/apis/registerNotificationClient/index.ts","webpack://bus/./src/data/notification/apis/getNotificationAPIURL/index.ts","webpack://bus/./src/data/notification/apis/rescheduleNotification/index.ts","webpack://bus/./src/data/location/details.ts","webpack://bus/./src/data/notification/apis/rotateNotificationSecret/index.ts","webpack://bus/./src/data/notification/apis/scheduleNotification/index.ts"],"sourcesContent":["import { NotificationClientID, NotificationSchedule, NotificationSecret, removeNotificationSchedule } from '../../index';\nimport { getNotificationAPIURL } from '../getNotificationAPIURL/index';\nimport { getNotificationRequestBody } from '../getNotificationRequestBody/index';\nimport { makeNotificationRequest } from '../loader';\n\nexport async function cancelNotification(schedule_id: NotificationSchedule['schedule_id']): Promise<boolean> {\n  if (NotificationClientID === '' || NotificationSecret === '' || schedule_id === undefined) {\n    return false;\n  }\n  const url = getNotificationAPIURL('cancel', [schedule_id]);\n  const requestBody = getNotificationRequestBody('cancel', [schedule_id]);\n  const response = await makeNotificationRequest('cancel', url, requestBody);\n  if (response === false) {\n    return false;\n  } else {\n    if (response.code === 200 && response.method === 'cancel') {\n      await removeNotificationSchedule(schedule_id);\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","type NotificationResponseCode = 200 | 400 | 401 | 404 | 500;\n\ninterface NotificationResponseCancel {\n  result: string;\n  code: NotificationResponseCode;\n  method: 'cancel';\n}\n\ninterface NotificationResponseRegister {\n  result: string;\n  code: NotificationResponseCode;\n  method: 'register';\n  client_id: string | 'null';\n  secret: string | 'null';\n}\n\ninterface NotificationResponseSchedule {\n  result: string;\n  code: NotificationResponseCode;\n  method: 'schedule';\n  schedule_id: string | 'null';\n}\n\ninterface NotificationResponseRotate {\n  result: string;\n  code: NotificationResponseCode;\n  method: 'rotate';\n  secret: string | 'null';\n}\n\ninterface NotificationResponseReschedule {\n  result: string;\n  code: NotificationResponseCode;\n  method: 'reschedule';\n}\n\nexport type NotificationResponse = NotificationResponseCancel | NotificationResponseRegister | NotificationResponseSchedule | NotificationResponseRotate | NotificationResponseReschedule;\n\nexport async function makeNotificationRequest(method: NotificationResponse['method'], url: string | false, body: object | false): Promise<NotificationResponse | false> {\n  try {\n    if (url === false || body === false) {\n      return false;\n    }\n\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body),\n      credentials: 'omit'\n    };\n\n    // Send the request\n    const response = await fetch(url, requestOptions);\n\n    if (!response.ok) {\n      // Log additional details for debugging\n      const errorText = await response.text();\n      console.error('API request failed', {\n        status: response.status,\n        statusText: response.statusText,\n        body: errorText\n      });\n      return false;\n    }\n\n    // Attempt to parse the JSON response\n    try {\n      const text = await response.text();\n      const json = JSON.parse(text);\n      switch (method) {\n        case 'cancel':\n          return json as NotificationResponseCancel;\n          break;\n        case 'register':\n          return json as NotificationResponseRegister;\n          break;\n        case 'schedule':\n          return json as NotificationResponseSchedule;\n          break;\n        case 'rotate':\n          return json as NotificationResponseRotate;\n          break;\n        case 'reschedule':\n          return json as NotificationResponseReschedule;\n          break;\n        default:\n          return false;\n          break;\n      }\n    } catch (jsonError) {\n      console.error('Failed to parse JSON response', jsonError);\n      throw new Error('Invalid JSON response from server');\n    }\n  } catch (error) {\n    // Catch and log errors\n    console.error('Error making request:', error);\n    return false;\n  }\n}\n","import { sha512 } from '../../../../tools/index';\nimport { NotificationClient } from '../../index';\n\nexport function getNotificationToken(client_id: NotificationClient['client_id'], secret: NotificationClient['secret'], payload: object): string {\n  const now = new Date().getTime();\n  const window = 10 * 1000;\n  const i = (now - (now % window)) / window;\n  const result = sha512(sha512(`${client_id} ${secret} ${i.toString(16)} ${sha512(JSON.stringify(payload))}`));\n  return result;\n}\n","import { sha512 } from '../../../../tools/index';\nimport { NotificationClientID, NotificationResponse, NotificationSecret } from '../../index';\nimport { getNotificationToken } from '../getNotificationToken/index';\n\nexport function getNotificationRequestBody(method: NotificationResponse['method'], parameters: Array<any>): object | false {\n  switch (method) {\n    case 'cancel':\n      if (NotificationClientID === '' || NotificationSecret === '' || parameters.length !== 1) {\n        return false;\n      } else {\n        return {\n          client_id: NotificationClientID,\n          token: getNotificationToken(NotificationClientID, NotificationSecret, { schedule_id: parameters[0] }),\n          schedule_id: parameters[0]\n        };\n      }\n      break;\n    case 'register':\n      if (parameters.length !== 1) {\n        return false;\n      } else {\n        const currentDate = new Date();\n        currentDate.setMilliseconds(0);\n        currentDate.setSeconds(0);\n        return {\n          hash: sha512(`${sha512(parameters[0])}${currentDate.getTime()}`)\n        };\n      }\n      break;\n    case 'schedule':\n      if (NotificationClientID === '' || NotificationSecret === '' || parameters.length !== 9) {\n        return false;\n      } else {\n        return {\n          client_id: NotificationClientID,\n          token: getNotificationToken(NotificationClientID, NotificationSecret, { stop_id: parameters[0], location_name: parameters[1], route_id: parameters[2], route_name: parameters[3], direction: parameters[4], estimate_time: parameters[5], time_formatting_mode: parameters[6], time_offset: parameters[7], scheduled_time: parameters[8] }),\n          stop_id: parameters[0],\n          location_name: parameters[1],\n          route_id: parameters[2],\n          route_name: parameters[3],\n          direction: parameters[4],\n          estimate_time: parameters[5],\n          time_formatting_mode: parameters[6],\n          time_offset: parameters[7],\n          scheduled_time: parameters[8]\n        };\n      }\n      break;\n    case 'rotate':\n      if (NotificationClientID === '' || NotificationSecret === '' || parameters.length !== 0) {\n        return false;\n      } else {\n        return {\n          client_id: NotificationClientID,\n          token: getNotificationToken(NotificationClientID, NotificationSecret, {})\n        };\n      }\n      break;\n    case 'reschedule':\n      if (NotificationClientID === '' || NotificationSecret === '' || parameters.length !== 3) {\n        return false;\n      } else {\n        return {\n          client_id: NotificationClientID,\n          token: getNotificationToken(NotificationClientID, NotificationSecret, { schedule_id: parameters[0], estimate_time: parameters[1], scheduled_time: parameters[2] }),\n          schedule_id: parameters[0],\n          estimate_time: parameters[1],\n          scheduled_time: parameters[2]\n        };\n      }\n      break;\n    default:\n      return false;\n      break;\n  }\n}\n","import { MaterialSymbols } from '../../interface/icons/material-symbols-type';\nimport { addressToString, generateLabelFromAddresses } from '../../tools/address';\nimport { CardinalDirection, getCardinalDirectionFromVector } from '../../tools/cardinal-direction';\nimport { generateDirectionLabels, generateLetterLabels } from '../../tools/labels';\nimport { normalizeVector } from '../../tools/math';\nimport { BusArrivalTime, getBusArrivalTimes } from '../analytics/bus-arrival-time/index';\nimport { getBusData } from '../apis/getBusData/index';\nimport { getBusEvent } from '../apis/getBusEvent/index';\nimport { EstimateTime, EstimateTimeItem, getEstimateTime } from '../apis/getEstimateTime/index';\nimport { getLocation, MergedLocation } from '../apis/getLocation/index';\nimport { getRoute, SimplifiedRoute } from '../apis/getRoute/index';\nimport { getStop } from '../apis/getStop/index';\nimport { batchFindBusesForLocation, EstimateTimeStatus, formatBus, FormattedBus, parseEstimateTime } from '../apis/index';\nimport { deleteDataReceivingProgress, deleteDataUpdateTime, getDataUpdateTime, setDataReceivingProgress } from '../apis/loader';\nimport { getSettingOptionValue } from '../settings/index';\nimport { getUserOrientation } from '../user-orientation/index';\n\ninterface BatchFoundEstimateTimeItem extends EstimateTimeItem {}\n\ntype BatchFoundEstimateTime = {\n  [key: string]: BatchFoundEstimateTimeItem;\n};\n\nfunction batchFindEstimateTime(EstimateTime: EstimateTime, StopIDList: Array<number>): BatchFoundEstimateTime {\n  const result = {};\n  for (const item of EstimateTime) {\n    if (StopIDList.indexOf(item.StopID) > -1) {\n      const thisStopKey: string = `s_${item.StopID}`;\n      result[thisStopKey] = item;\n    }\n  }\n  return result;\n}\n\ntype BatchFoundEstimateTimeRanking = {\n  [key: string]: IntegratedLocationItemRanking;\n};\n\nfunction rankBatchFoundEstimateTime(batchFoundEstimateTime: BatchFoundEstimateTime, StopIDList: Array<number>): BatchFoundEstimateTimeRanking {\n  // StopIDList act as a secondary filter\n  const result: BatchFoundEstimateTimeRanking = {};\n  const rankingArray: Array<[number, number]> = []; // StopID, EstimateTime\n  for (const thisStopKey in batchFoundEstimateTime) {\n    const thisBatchFoundEstimateTimeItem = batchFoundEstimateTime[thisStopKey];\n    const thisStopID = thisBatchFoundEstimateTimeItem.StopID;\n    const thisEstimateTime = parseInt(thisBatchFoundEstimateTimeItem.EstimateTime);\n    if (thisEstimateTime >= 0 && StopIDList.indexOf(thisStopID) > -1) {\n      rankingArray.push([thisStopID, thisEstimateTime]);\n    }\n  }\n  const rankingArrayLength = rankingArray.length;\n  rankingArray.sort(function (a, b) {\n    return a[1] - b[1];\n  });\n  let index = 1;\n  for (const rankingItem of rankingArray) {\n    // Classify into 4 groups and give a code\n    const rankingRatio = index / rankingArrayLength;\n    const rankingCode = (rankingRatio - (rankingRatio % 0.25)) / 0.25;\n    const thisStopID = rankingItem[0];\n    const thisStopKey = `s_${thisStopID}`;\n    result[thisStopKey] = {\n      number: index,\n      text: index.toString(),\n      code: rankingCode\n    };\n    index += 1;\n  }\n  return result;\n}\n\nexport interface LocationGroupProperty {\n  key: string;\n  icon: MaterialSymbols;\n  value: string;\n}\n\nexport interface LocationGroup {\n  name: string;\n  properties: Array<LocationGroupProperty>;\n}\n\nexport interface IntegratedLocationItemRanking {\n  number: number;\n  text: '--' | string;\n  code: -1 | 0 | 1 | 2 | 3 | 4; // -1: not applicable, 0: 0-25%, 1: 25-50%, 2: 50-75%, 3: 75-100%, 4: 100%\n}\n\nexport interface IntegratedLocationItem {\n  route_name: string;\n  route_direction: string;\n  routeId: number;\n  stopId: number;\n  status: EstimateTimeStatus;\n  ranking: IntegratedLocationItemRanking;\n  buses: Array<FormattedBus>;\n  busArrivalTimes: Array<BusArrivalTime>;\n}\n\nexport interface IntegratedLocation {\n  groupedItems: {\n    [g_index: string]: Array<IntegratedLocationItem>;\n  };\n  groups: {\n    [g_index: string]: LocationGroup;\n  };\n  groupQuantity: number;\n  itemQuantity: {\n    [g_index: string]: number;\n  };\n  LocationName: string;\n  dataUpdateTime: number;\n  hash: string;\n}\n\nexport async function integrateLocation(hash: string, chartWidth: number, chartHeight: number, requestID: string): Promise<IntegratedLocation> {\n  setDataReceivingProgress(requestID, 'getLocation_0', 0, false);\n  setDataReceivingProgress(requestID, 'getLocation_1', 0, false);\n  setDataReceivingProgress(requestID, 'getRoute_0', 0, false);\n  setDataReceivingProgress(requestID, 'getRoute_1', 0, false);\n  setDataReceivingProgress(requestID, 'getStop_0', 0, false);\n  setDataReceivingProgress(requestID, 'getStop_1', 0, false);\n  setDataReceivingProgress(requestID, 'getEstimateTime_0', 0, false);\n  setDataReceivingProgress(requestID, 'getEstimateTime_1', 0, false);\n  setDataReceivingProgress(requestID, 'getBusEvent_0', 0, false);\n  setDataReceivingProgress(requestID, 'getBusEvent_1', 0, false);\n  const EstimateTime = await getEstimateTime(requestID);\n  const Location = (await getLocation(requestID, 1)) as MergedLocation;\n  const Route = (await getRoute(requestID, true)) as SimplifiedRoute;\n  const Stop = await getStop(requestID);\n  const BusEvent = await getBusEvent(requestID);\n  const BusData = await getBusData(requestID);\n  const BusArrivalTimes = await getBusArrivalTimes(chartWidth, chartHeight);\n\n  const time_formatting_mode = getSettingOptionValue('time_formatting_mode');\n  const location_labels = getSettingOptionValue('location_labels');\n  const display_user_orientation = getSettingOptionValue('display_user_orientation');\n\n  const groupedItems = {} as IntegratedLocation['groupedItems'];\n  const itemQuantity = {} as IntegratedLocation['itemQuantity'];\n  const groups = {} as IntegratedLocation['groups'];\n\n  const userOrientation = getUserOrientation();\n\n  const thisLocationKey = `ml_${hash}`;\n  const thisLocation = Location[thisLocationKey];\n  const thisLocationName = thisLocation.n;\n  const stopLocationIds = thisLocation.id;\n  const setsOfVectors = thisLocation.v;\n\n  let StopIDs = [];\n  let RouteIDs = [];\n  const stopLocationQuantity = stopLocationIds.length;\n\n  for (let i = 0; i < stopLocationQuantity; i++) {\n    StopIDs = StopIDs.concat(thisLocation.s[i]);\n    RouteIDs = RouteIDs.concat(thisLocation.r[i]);\n  }\n\n  const batchFoundEstimateTime = batchFindEstimateTime(EstimateTime, StopIDs);\n  const batchFoundBuses = batchFindBusesForLocation(BusEvent, BusData, Route, StopIDs);\n\n  const cardinalDirections: Array<CardinalDirection> = [];\n  for (const vectorSet of setsOfVectors) {\n    let x: number = 0;\n    let y: number = 0;\n    for (const vector of vectorSet) {\n      x += vector[0];\n      y += vector[1];\n    }\n    const meanVector = normalizeVector([x, y]);\n    const cardinalDirection = getCardinalDirectionFromVector(meanVector);\n    cardinalDirections.push(cardinalDirection);\n  }\n\n  let labels: Array<string> = [];\n  switch (location_labels) {\n    case 'address':\n      labels = generateLabelFromAddresses(thisLocation.a);\n      break;\n    case 'letters':\n      labels = generateLetterLabels(stopLocationQuantity);\n      break;\n    case 'directions':\n      labels = generateDirectionLabels(cardinalDirections);\n      break;\n    default:\n      break;\n  }\n\n  for (let i = 0; i < stopLocationQuantity; i++) {\n    const groupKey = `g_${i}`;\n    groupedItems[groupKey] = [];\n    itemQuantity[groupKey] = 0;\n    groups[groupKey] = {\n      name: labels[i],\n      properties: [\n        {\n          key: 'address',\n          icon: 'personal_places',\n          value: addressToString(thisLocation.a[i])\n        },\n        {\n          key: 'exact_position',\n          icon: 'location_on',\n          value: `${thisLocation.la[i].toFixed(5)}, ${thisLocation.lo[i].toFixed(5)}`\n        },\n        {\n          key: 'cardinal_direction',\n          icon: cardinalDirections[i].icon,\n          value: `${cardinalDirections[i].name}${display_user_orientation && userOrientation.cardinalDirection.id !== -1 && userOrientation.cardinalDirection.id === cardinalDirections[i].id ? '（目前指向）' : ''}`\n        }\n      ]\n    };\n\n    const thisGroupStops = thisLocation.s[i];\n    const stopQuantity = thisGroupStops.length;\n    const thisGroupRanking = rankBatchFoundEstimateTime(batchFoundEstimateTime, thisGroupStops);\n\n    for (let o = 0; o < stopQuantity; o++) {\n      const integratedItem = {} as IntegratedLocationItem;\n      // Collect data from 'Stop'\n      const thisStopID = thisLocation.s[i][o];\n      const thisStopKey = `s_${thisStopID}`;\n      let thisStop: SimplifiedStopItem = {};\n      if (Stop.hasOwnProperty(thisStopKey)) {\n        thisStop = Stop[thisStopKey];\n      } else {\n        continue;\n      }\n      integratedItem.stopId = thisStopID;\n\n      // Collect data from 'thisGroupRanking'\n      let thisItemRanking = { number: 0, text: '--', code: -1 } as IntegratedLocationItemRanking;\n      if (thisGroupRanking.hasOwnProperty(thisStopKey)) {\n        thisItemRanking = thisGroupRanking[thisStopKey];\n      }\n      integratedItem.ranking = thisItemRanking;\n\n      // Collect data from 'Route'\n      const thisRouteID: number = thisLocation.r[i][o];\n      const thisRouteKey = `r_${thisRouteID}`;\n      let thisRoute: SimplifiedRouteItem = {};\n      if (Route.hasOwnProperty(thisRouteKey)) {\n        thisRoute = Route[thisRouteKey];\n      } else {\n        continue;\n      }\n      integratedItem.route_name = thisRoute.n;\n      integratedItem.route_direction = `往${[thisRoute.des, thisRoute.dep, ''][parseInt(thisStop.goBack)]}`;\n      integratedItem.routeId = thisRouteID;\n\n      // Collect data from 'batchFoundEstimateTime'\n      let thisEstimateTime = {} as EstimateTimeItem;\n      if (batchFoundEstimateTime.hasOwnProperty(thisStopKey)) {\n        thisEstimateTime = batchFoundEstimateTime[thisStopKey];\n      } else {\n        continue;\n      }\n      const parsedEstimateTime = parseEstimateTime(thisEstimateTime.EstimateTime, time_formatting_mode);\n      integratedItem.status = parsedEstimateTime;\n\n      // Collect data from 'batchFoundBuses'\n      let buses = [];\n      if (batchFoundBuses.hasOwnProperty(thisStopKey)) {\n        buses = batchFoundBuses[thisStopKey].map((e) => formatBus(e));\n      }\n      integratedItem.buses = buses;\n\n      // Collect data from 'BusArrivalTimes'\n      let thisBusArrivalTimes = [];\n      if (BusArrivalTimes.hasOwnProperty(thisStopKey)) {\n        thisBusArrivalTimes = BusArrivalTimes[thisStopKey];\n      }\n      integratedItem.busArrivalTimes = thisBusArrivalTimes;\n\n      groupedItems[groupKey].push(integratedItem);\n      itemQuantity[groupKey] += 1;\n    }\n  }\n\n  for (const key in groupedItems) {\n    groupedItems[key].sort(function (a, b) {\n      return a.routeId - b.routeId;\n    });\n    /*\n      .map((item: IntegratedLocationItem) => {\n        // accessing ranking[key] inside map callback will cause constant violations any way\n        return {\n          route_name: item.route_name,\n          route_direction: item.route_direction,\n          routeId: item.routeId,\n          stopId: item.stopId,\n          status: item.status,\n          rank: {\n            number: thisRankingIndex + 1,\n            code: 0\n          },\n          buses: item.buses,\n          busArrivalTimes: item.busArrivalTimes\n        };\n      })*/\n  }\n  const result: IntegratedLocation = {\n    groupedItems: groupedItems,\n    groups: groups,\n    groupQuantity: stopLocationQuantity,\n    itemQuantity: itemQuantity,\n    LocationName: thisLocationName,\n    hash: hash,\n    dataUpdateTime: getDataUpdateTime(requestID)\n  };\n  deleteDataReceivingProgress(requestID);\n  deleteDataUpdateTime(requestID);\n  //await recordEstimateTimeForUpdateRate(EstimateTime);\n  return result;\n}\n","import { saveNotificationClient, setNotificationClientID, setNotificationSecret } from '../..';\nimport { getNotificationAPIURL } from '../getNotificationAPIURL/index';\nimport { getNotificationRequestBody } from '../getNotificationRequestBody/index';\nimport { makeNotificationRequest } from '../loader';\n\nexport async function registerNotificationClient(registrationKey: string): Promise<boolean> {\n  if (!registrationKey) {\n    return false;\n  }\n  const url = getNotificationAPIURL('register');\n  const requestBody = getNotificationRequestBody('register', [registrationKey]);\n  const response = await makeNotificationRequest('register', url, requestBody);\n  if (response === false) {\n    return false;\n  } else {\n    if (response.code === 200 && response.method === 'register') {\n      setNotificationClientID(response.client_id)\n      setNotificationSecret(response.secret)\n      await saveNotificationClient();\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { NotificationProvider, NotificationResponse } from '../../index';\n\nexport function getNotificationAPIURL(method: NotificationResponse['method']): string | false {\n  if (NotificationProvider === '') {\n    return false;\n  }\n  const url = new URL(NotificationProvider);\n  if (['cancel', 'register', 'schedule', 'rotate', 'reschedule'].indexOf(method) > -1) {\n    url.searchParams.set('method', method);\n    return url.toString();\n  } else {\n    return false;\n  }\n}\n","import { NotificationClientID, NotificationSchedule, NotificationSecret, updateNotificationSchedule } from '../../index';\nimport { getNotificationAPIURL } from '../getNotificationAPIURL/index';\nimport { getNotificationRequestBody } from '../getNotificationRequestBody/index';\nimport { makeNotificationRequest } from '../loader';\n\nexport async function rescheduleNotification(schedule_id: NotificationSchedule['schedule_id'], estimate_time: NotificationSchedule['estimate_time'], scheduled_time: string | number | Date): Promise<boolean> {\n  if (NotificationClientID === '' || NotificationSecret === '' || schedule_id === undefined || estimate_time === undefined || scheduled_time === undefined) {\n    return false;\n  }\n  let processed_schedule_time = new Date();\n  switch (typeof scheduled_time) {\n    case 'string':\n      processed_schedule_time = new Date(scheduled_time);\n      break;\n    case 'number':\n      processed_schedule_time = new Date(scheduled_time);\n      break;\n    default:\n      if (scheduled_time instanceof Date) {\n        processed_schedule_time = scheduled_time;\n      } else {\n        return false;\n      }\n      break;\n  }\n  const url = getNotificationAPIURL('reschedule');\n  const requestBody = getNotificationRequestBody('reschedule', [schedule_id, estimate_time, processed_schedule_time.toISOString()]);\n  const response = await makeNotificationRequest('reschedule', url, requestBody);\n  if (response === false) {\n    return false;\n  } else {\n    if (response.code === 200 && response.method === 'reschedule') {\n      await updateNotificationSchedule(schedule_id, estimate_time, processed_schedule_time.getTime());\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { MaterialSymbols } from '../../interface/icons/material-symbols-type';\nimport { shareLocationPermalink, showLocationPermalinkQRCode } from '../../interface/location/details/index';\nimport { openSaveToFolder } from '../../interface/save-to-folder/index';\nimport { generateIdentifier } from '../../tools/index';\nimport { getLocation, MergedLocation, MergedLocationItem } from '../apis/getLocation/index';\nimport { deleteDataReceivingProgress, deleteDataUpdateTime } from '../apis/loader';\n\nexport interface IntegratedLocationDetailsAction {\n  icon: MaterialSymbols;\n  action: Function;\n  key: string,\n  name: string;\n}\n\nexport type IntegratedLocationDetailsActionArray = Array<IntegratedLocationDetailsAction>;\n\nexport interface IntegratedLocationDetails {\n  actions: IntegratedLocationDetailsActionArray;\n  actionsQuantity: number\n  hash: string;\n}\n\nexport async function integrateLocationDetails(hash: string, requestID: string): Promise<IntegratedLocationDetails> {\n  const Location = (await getLocation(requestID, 1)) as MergedLocation;\n  deleteDataReceivingProgress(requestID);\n  deleteDataUpdateTime(requestID);\n  const thisLocationKey = `ml_${hash}`;\n  let thisLocation = {} as MergedLocationItem;\n  if (Location.hasOwnProperty(thisLocationKey)) {\n    thisLocation = Location[thisLocationKey];\n  } else {\n    return {\n      actions: [],\n      actionsQuantity: 0,\n      hash: hash\n    };\n  }\n  const actions: IntegratedLocationDetailsActionArray = [\n    {\n      icon: 'folder',\n      name: '儲存',\n      key: 'save-to-folder',\n      action: function () {\n        openSaveToFolder('location', [hash]);\n      }\n    },\n    {\n      icon: 'ios_share',\n      name: '分享',\n      key: 'permalink',\n      action: function () {\n        shareLocationPermalink(hash);\n      }\n    },\n    {\n      icon: 'qr_code_2',\n      name: '二維條碼',\n      key: 'permalink-qr-code',\n      action: function () {\n        showLocationPermalinkQRCode(hash);\n      }\n    }\n  ];\n  const result: IntegratedLocationDetails = {\n    actions: actions,\n    actionsQuantity: actions.length,\n    hash: hash\n  };\n  return result;\n}\n","import { NotificationClientID, NotificationSecret, saveNotificationClient, setNotificationSecret } from '../../index';\nimport { getNotificationAPIURL } from '../getNotificationAPIURL/index';\nimport { getNotificationRequestBody } from '../getNotificationRequestBody/index';\nimport { makeNotificationRequest } from '../loader';\n\nexport async function rotateNotificationSecret(): Promise<boolean> {\n  if (NotificationClientID === '' || NotificationSecret === '') {\n    return false;\n  }\n  const url = getNotificationAPIURL('rotate');\n  const requestBody = getNotificationRequestBody('rotate', []);\n  const response = await makeNotificationRequest('rotate', url, requestBody);\n  if (response === false) {\n    return false;\n  } else {\n    if (response.code === 200 && response.method === 'rotate') {\n      setNotificationSecret(response.secret);\n      await saveNotificationClient();\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { NotificationClientID, NotificationSchedule, NotificationSecret, saveNotificationSchedule } from '../../index';\nimport { getNotificationAPIURL } from '../getNotificationAPIURL/index';\nimport { getNotificationRequestBody } from '../getNotificationRequestBody/index';\nimport { makeNotificationRequest } from '../loader';\nimport { rotateNotificationSecret } from '../rotateNotificationSecret/index';\n\nexport async function scheduleNotification(stop_id: NotificationSchedule['stop_id'], location_name: NotificationSchedule['location_name'], route_id: NotificationSchedule['route_id'], route_name: NotificationSchedule['route_name'], direction: NotificationSchedule['direction'], estimate_time: NotificationSchedule['estimate_time'], time_formatting_mode: NotificationSchedule['time_formatting_mode'], time_offset: NotificationSchedule['time_offset'], scheduled_time: string | number | Date): Promise<string | false> {\n  if (NotificationClientID === '' || NotificationSecret === '' || stop_id === undefined || location_name === undefined || route_id === undefined || route_name === undefined || direction === undefined || estimate_time === undefined || typeof time_formatting_mode !== 'number' || scheduled_time === undefined) {\n    return false;\n  }\n  let processed_schedule_time = new Date();\n  switch (typeof scheduled_time) {\n    case 'string':\n      processed_schedule_time = new Date(scheduled_time);\n      break;\n    case 'number':\n      processed_schedule_time = new Date(scheduled_time);\n      break;\n    default:\n      if (scheduled_time instanceof Date) {\n        processed_schedule_time = scheduled_time;\n      } else {\n        return false;\n      }\n      break;\n  }\n  const url = getNotificationAPIURL('schedule');\n  const requestBody = getNotificationRequestBody('schedule', [stop_id, location_name, route_id, route_name, direction, estimate_time, time_formatting_mode, time_offset, processed_schedule_time.toISOString()]);\n  const response = await makeNotificationRequest('schedule', url, requestBody);\n  if (response === false) {\n    return false;\n  } else {\n    if (response.code === 200 && response.method === 'schedule') {\n      if (Math.random() > 0.8) {\n        await rotateNotificationSecret();\n      }\n      await saveNotificationSchedule(response.schedule_id, stop_id, location_name, route_id, route_name, direction, estimate_time, time_formatting_mode, time_offset, processed_schedule_time.getTime());\n      return response.schedule_id;\n    } else {\n      return false;\n    }\n  }\n}\n"],"names":["cancelNotification","_x","_cancelNotification","apply","arguments","_asyncToGenerator","schedule_id","NotificationClientID","NotificationSecret","undefined","url","getNotificationAPIURL","requestBody","getNotificationRequestBody","response","makeNotificationRequest","code","method","removeNotificationSchedule","_x2","_x3","_makeNotificationRequest","body","requestOptions","headers","JSON","stringify","credentials","fetch","ok","text","json","parse","jsonError","Error","error","getNotificationToken","client_id","secret","payload","now","Date","getTime","i","sha512","toString","parameters","length","token","currentDate","setMilliseconds","setSeconds","hash","stop_id","location_name","route_id","route_name","direction","estimate_time","time_formatting_mode","time_offset","scheduled_time","rankBatchFoundEstimateTime","batchFoundEstimateTime","StopIDList","result","rankingArray","thisStopKey","thisBatchFoundEstimateTimeItem","thisStopID","StopID","thisEstimateTime","parseInt","EstimateTime","indexOf","push","rankingArrayLength","sort","a","b","index","_i","_rankingArray","rankingRatio","rankingCode","number","integrateLocation","_x4","_integrateLocation","chartWidth","chartHeight","requestID","setDataReceivingProgress","getEstimateTime","Location","getLocation","Route","getRoute","Stop","getStop","BusEvent","getBusEvent","BusData","getBusData","BusArrivalTimes","getBusArrivalTimes","getSettingOptionValue","location_labels","display_user_orientation","groupedItems","itemQuantity","groups","userOrientation","getUserOrientation","thisLocation","thisLocationName","n","stopLocationIds","id","setsOfVectors","v","StopIDs","RouteIDs","stopLocationQuantity","concat","s","r","_step2","_step","_iterator","_createForOfIteratorHelper","done","item","value","err","e","f","batchFindEstimateTime","batchFoundBuses","batchFindBusesForLocation","cardinalDirections","_iterator2","_step3","vectorSet","x","y","_iterator3","vector","meanVector","normalizeVector","cardinalDirection","getCardinalDirectionFromVector","labels","generateLabelFromAddresses","generateLetterLabels","generateDirectionLabels","groupKey","name","properties","key","icon","addressToString","la","toFixed","lo","thisGroupStops","stopQuantity","thisGroupRanking","o","integratedItem","thisStop","hasOwnProperty","stopId","thisItemRanking","ranking","thisRouteID","thisRouteKey","thisRoute","route_direction","des","dep","goBack","routeId","parsedEstimateTime","parseEstimateTime","status","buses","map","formatBus","thisBusArrivalTimes","busArrivalTimes","groupQuantity","LocationName","dataUpdateTime","getDataUpdateTime","deleteDataReceivingProgress","deleteDataUpdateTime","registerNotificationClient","_registerNotificationClient","registrationKey","setNotificationClientID","setNotificationSecret","saveNotificationClient","NotificationProvider","URL","searchParams","set","rescheduleNotification","_rescheduleNotification","processed_schedule_time","_typeof","toISOString","updateNotificationSchedule","integrateLocationDetails","_integrateLocationDetails","thisLocationKey","actions","actionsQuantity","action","openSaveToFolder","shareLocationPermalink","showLocationPermalinkQRCode","_rotateNotificationSecret","scheduleNotification","_x5","_x6","_x7","_x8","_x9","_scheduleNotification","Math","random","rotateNotificationSecret","saveNotificationSchedule"],"ignoreList":[],"sourceRoot":""}