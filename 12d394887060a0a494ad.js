"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[317,4470],{1932(t,r,e){e.d(r,{L:()=>d});var n=e(4311),o=e(3153),i=e(6788);function a(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return u(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(s)throw i}}}}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function s(t,r,e,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void e(t)}u.done?r(s):Promise.resolve(s).then(n,o)}function f(t){return function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function a(t){s(i,n,o,a,u,"next",t)}function u(t){s(i,n,o,a,u,"throw",t)}a(void 0)})}}var l=!1,c={};function y(t){return p.apply(this,arguments)}function p(){return(p=f(function*(t){var r=new Worker(new URL(e.p+e.u(5332),e.b));return yield new Promise(function(e,n){r.onmessage=function(t){e(t.data),r.terminate()},r.onerror=function(t){n(t.message),r.terminate()},r.postMessage(t)})})).apply(this,arguments)}function v(t){return h.apply(this,arguments)}function h(){return(h=f(function*(t){var r=new Worker(new URL(e.p+e.u(8892),e.b));return yield new Promise(function(e,n){r.onmessage=function(t){e(t.data),r.terminate()},r.onerror=function(t){n(t.message),r.terminate()},r.postMessage(t)})})).apply(this,arguments)}function d(t){return m.apply(this,arguments)}function m(){return m=f(function*(t){function r(){return e.apply(this,arguments)}function e(){return e=f(function*(){var r,e="",n=a([[0,15],[1,15]].map(function(t){return{url:(0,o.y)(t[0],t[1]),e:t}}));try{for(n.s();!(r=n.n()).done;){var u=r.value;e+=(yield(0,i.Fd)(u.url,t,`getSegmentBuffers_${u.e[0]}`,"xml")),(0,i.ZL)(t,-1)}}catch(t){n.e(t)}finally{n.f()}return e}),e.apply(this,arguments)}var u="bus_segment_buffers_cache",s=yield(0,n.Ct)(0,`${u}_timestamp`);if(null===s){var p=yield r(),h=yield y(p),d=yield v(h);return yield(0,n.mL)(0,`${u}_timestamp`,(new Date).getTime()),yield(0,n.mL)(0,u,JSON.stringify(d)),l||(l=!0,c=d),d}if((new Date).getTime()-parseInt(s)>2592e6){var m=yield r(),g=yield y(m),b=yield v(g);return yield(0,n.mL)(0,`${u}_timestamp`,(new Date).getTime()),yield(0,n.mL)(0,u,JSON.stringify(b)),b}if(!l){var w=yield(0,n.Ct)(0,u);l=!0,c=JSON.parse(w)}return(0,i.Mf)(t,"getSegmentBuffers_0",0,!0),(0,i.Mf)(t,"getSegmentBuffers_1",0,!0),(0,i.ZL)(t,-1),c}),m.apply(this,arguments)}},6160(t,r,e){e.d(r,{i:()=>v});var n=e(6802),o=e(7810),i=e(9734),a=e(8011),u=e(424),s=e(2303),f=e(6788),l=e(8134);function c(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return y(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?y(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(u)throw i}}}}function y(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function p(t,r,e,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void e(t)}u.done?r(s):Promise.resolve(s).then(n,o)}function v(t,r){return h.apply(this,arguments)}function h(){var t;return t=function*(t,r){var e=`c_${t}`,y=yield(0,i.j)(r,!0),p=yield(0,n.d)(r),v=yield(0,o.J)(r),h=yield(0,u.T)(r),d=yield(0,a.g)(r,0),m={properties:[],LocationName:""},g={};if(!y.hasOwnProperty(e))return m;var b=(g=y[e]).CarNum;m.properties.push({key:"car_number",icon:"tag",value:b});var w=g.CarType,S=(0,s.Ov)(w);m.properties.push({key:"car_type",icon:"directions_bus",value:S});var A,I={},P=c(p);try{for(P.s();!(A=P.n()).done;){var O=A.value;if(O.BusID===b){I=O;break}}}catch(t){P.e(t)}finally{P.f()}var $,_=parseInt(I.RouteID),x=I.BusStatus,j=(0,s.eu)(x),k=parseInt(I.GoBack),T={},L=c(v);try{for(L.s();!($=L.n()).done;){var C=$.value;if(C.BusID===b){T=C;break}}}catch(t){L.e(t)}finally{L.f()}var B=T.CarOnStop,E=(0,s.zi)(B);m.properties.push({key:"status",icon:"vital_signs",value:`${E} | ${j}`});var M=T.StopID,D=yield(0,l.F6)(_),U={};if(!(D.length>0))return m;var N=(U=D[0]).id,F=U.pid,q=U.n,Z=U.dep,J=[U.des,Z,""][k||0];m.properties.push({key:"route",icon:"route",value:`${q} - 往${J}`}),m.RouteID=N,m.FullPathAttributeId=F;var R=`s_${M}`;if(!h.hasOwnProperty(R))return m;var z=d[`l_${h[R].stopLocationId}`].n;return m.properties.push({key:"location_name",icon:"location_on",value:z}),(0,f.LQ)(r),(0,f.gC)(r),m},h=function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function a(t){p(i,n,o,a,u,"next",t)}function u(t){p(i,n,o,a,u,"throw",t)}a(void 0)})},h.apply(this,arguments)}},6788(t,r,e){e.d(r,{Fd:()=>y,LQ:()=>g,Mf:()=>d,ZL:()=>S,Zt:()=>A,gC:()=>I});var n=e(4750),o=e(5579),i=e(8925);function a(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return u(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(s)throw i}}}}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function f(t,r,e,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void e(t)}u.done?r(s):Promise.resolve(s).then(n,o)}var l={},c=new Error("FetchError");function y(t,r,e,n){return p.apply(this,arguments)}function p(){var t;return t=function*(t,r,e,o){if(l.hasOwnProperty(t)){if(l[t].processing)return yield new Promise(function(n,o){l[t].requests.push([n,o,r,e])});if(null!==l[t].result&&(new Date).getTime()<=l[t].timestamp)return d(r,e,0,!0),l[t].result}else l[t]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var u=yield fetch(t);if(!u.ok)throw d(r,e,0,!0),new Error(`HTTP error! status: ${u.status}`);for(var s=parseInt(String(u.headers.get("content-length"))),f=u.body.getReader(),p=[],h=0;;){var m=yield f.read(),g=m.done,b=m.value;if(g)break;p.push(b);var w=(h+=b.length)/s;if(d(r,e,w,!1),l.hasOwnProperty(t)){var S,A=a(l[t].requests);try{for(A.s();!(S=A.n()).done;){var I=S.value;d(I[2],I[3],w,!1)}}catch(t){A.e(t)}finally{A.f()}}}for(var P=new Uint8Array(h),O=0,$=0,_=p;$<_.length;$++){var x=_[$];P.set(x,O),O+=x.length}var j,k=new Blob([P],{type:"application/gzip"}),T=yield k.arrayBuffer(),L=yield(0,n.h)(T);switch(o){case"json":j=/^<!doctype html>/.test(L)?yield y(t.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),r,e,o):JSON.parse(L);break;case"xml":j=L}var C=new Date;if(yield(0,i.N$)(s,C),j){if(l.hasOwnProperty(t)){for(var B=h/s,E=l[t].requests.shift();E;)E[0](j),d(E[2],E[3],B,!1),E=l[t].requests.shift();l[t].result=j,l[t].timestamp=C.getTime()+3e4,l[t].processing=!1}return v(),j}if(l.hasOwnProperty(t)){for(var M=l[t].requests.shift();M;)M[1](c),d(M[2],M[3],0,!0),M=l[t].requests.shift();l[t].failed=!0}throw v(),c},p=function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function a(t){f(i,n,o,a,u,"next",t)}function u(t){f(i,n,o,a,u,"throw",t)}a(void 0)})},p.apply(this,arguments)}function v(){var t=(new Date).getTime();for(var r in l)if(l.hasOwnProperty(r)){if(!l[r].processing&&t>l[r].timestamp){delete l[r];continue}if(l[r].failed){delete l[r];continue}}}var h={};function d(t,r,e,n){h.hasOwnProperty(t)||(h[t]={}),h[t].hasOwnProperty(r)?(n?h[t][r].expel=!0:(h[t][r].expel=!1,h[t][r].progress=e),b(t,"run")):(h[t][r]={expel:!1,progress:e,total:1},b(t,"start"))}function m(t){if(h.hasOwnProperty(t)&&"object"===s(h[t])){var r=0,e=0;for(var n in h[t])h[t][n].expel||(r+=h[t][n].total,e+=h[t][n].progress);var o=Math.min(Math.max(e/r,0),1);return o===1/0||isNaN(o)?1:o}return 1}function g(t){h.hasOwnProperty(t)&&(delete h[t],b(t,"end"))}function b(t,r){var e={target:t,stage:r,progress:m(t)},n=new CustomEvent(t,{detail:e});document.dispatchEvent(n)}var w={};function S(t,r){w.hasOwnProperty(t)||(w[t]=0);var e=0;"string"==typeof r&&(e=(0,o.Zn)(r)),e>w[t]&&(w[t]=e)}function A(t){return w.hasOwnProperty(t)?1*w[t]:0}function I(t){w.hasOwnProperty(t)&&delete w[t]}},6802(t,r,e){e.d(r,{d:()=>s});var n=e(3153),o=e(6788);function i(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return a(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){s=!0,i=t},f:function(){try{u||null==e.return||e.return()}finally{if(s)throw i}}}}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function u(t,r,e,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void e(t)}u.done?r(s):Promise.resolve(s).then(n,o)}function s(t){return f.apply(this,arguments)}function f(){var t;return t=function*(t){var r,e=[],a=i([[0,0],[1,0]].map(function(t){return{url:(0,n.y)(t[0],t[1]),e:t}}));try{for(a.s();!(r=a.n()).done;){var u=r.value,s=yield(0,o.Fd)(u.url,t,`getBusData_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,o.ZL)(t,s.EssentialInfo.UpdateTime)}}catch(t){a.e(t)}finally{a.f()}return e},f=function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function a(t){u(i,n,o,a,s,"next",t)}function s(t){u(i,n,o,a,s,"throw",t)}a(void 0)})},f.apply(this,arguments)}},7810(t,r,e){e.d(r,{J:()=>s});var n=e(3153),o=e(6788);function i(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return a(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){s=!0,i=t},f:function(){try{u||null==e.return||e.return()}finally{if(s)throw i}}}}function a(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function u(t,r,e,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void e(t)}u.done?r(s):Promise.resolve(s).then(n,o)}function s(t){return f.apply(this,arguments)}function f(){var t;return t=function*(t){var r,e=[],a=i([[0,1],[1,1]].map(function(t){return{url:(0,n.y)(t[0],t[1]),e:t}}));try{for(a.s();!(r=a.n()).done;){var u=r.value,s=yield(0,o.Fd)(u.url,t,`getBusEvent_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,o.ZL)(t,s.EssentialInfo.UpdateTime)}}catch(t){a.e(t)}finally{a.f()}return e},f=function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function a(t){u(i,n,o,a,s,"next",t)}function s(t){u(i,n,o,a,s,"throw",t)}a(void 0)})},f.apply(this,arguments)}},9609(t,r,e){var n=e(4256),o=e(8024);self.onmessage=function(t){var r=function(t){var r={};for(var e in t){var i=(0,o.Fx)(String(t[e].n).trim().replaceAll(/[\(（）\)\:：\~～]*/gim,"")),a=`ml_${i}`;r.hasOwnProperty(a)?(r[a].lo.push(t[e].lo),r[a].la.push(t[e].la),r[a].g.indexOf(t[e].g)<0&&r[a].g.push(t[e].g),r[a].r.push(t[e].r),r[a].s.push(t[e].s),r[a].v.push(t[e].v),r[a].a.push((0,n.bj)(t[e].a)),r[a].id.push(t[e].id)):r[a]={n:t[e].n,lo:[t[e].lo],la:[t[e].la],g:[t[e].g],r:[t[e].r],s:[t[e].s],v:[t[e].v],a:[(0,n.bj)(t[e].a)],id:[t[e].id],hash:i}}return r}(t.data);self.postMessage(r)}}}]);
//# sourceMappingURL=12d394887060a0a494ad.js.map