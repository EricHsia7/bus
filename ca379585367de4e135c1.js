"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{2937(e,t,a){a.d(t,{a:()=>f});var r=a(3453),n=a(467),i=a(8201),o=a(8671),s=a(2303),u=a(6788);function f(e,t){return p.apply(this,arguments)}function p(){return(p=(0,n.a)(function*(e,t){var a=yield Promise.all([(0,i.a)(t),(0,o.a)(t)]),n=(0,r.a)(a,2),f=n[0],p=n[1],d={repeated:[[],[],[],[],[],[],[]],scheduled:[],timeZoneOffset:-480};for(var l of f)if(!(e.indexOf(l.PathAttributeId)<0)){var c=(0,s.h)(l.StartTime,0),v=(0,s.h)(l.EndTime,0),h=60*c.hours+c.minutes,g=60*v.hours+v.minutes,m=parseInt(l.LongHeadway,10),y=parseInt(l.LowHeadway,10);if("0"===l.DateType){var b=parseInt(l.DateValue,10)-1,_={type:"repeated",time:[h,g],interval:[m,y],count:[Math.ceil((g-h)/y),Math.floor((g-h)/m)],day:b};d.repeated[b].push(_)}else if("1"===l.DateType){var I=l.DateValue,D={type:"scheduled",time:[h,g],interval:[m,y],count:[Math.ceil((g-h)/y),Math.floor((g-h)/m)],date:[parseInt(I.slice(0,-4),10),parseInt(I.slice(-4,-2),10),parseInt(I.slice(-2),10)]};d.scheduled.push(D)}}for(var S of p)if(!(e.indexOf(S.PathAttributeId)<0)){var $=(0,s.h)(S.DepartureTime,0),B=60*$.hours+$.minutes,k=B+30;if("0"===S.DateType){var R=parseInt(S.DateValue,10)-1,L={type:"repeated",time:[B,k],interval:[30,30],count:[1,1],day:R};d.repeated[R].push(L)}else if("1"===S.DateType){var P=S.DateValue,T={type:"scheduled",time:[B,k],interval:[30,30],count:[1,1],date:[parseInt(P.slice(0,-4),10),parseInt(P.slice(-4,-2),10),parseInt(P.slice(-2),10)]};d.scheduled.push(T)}}for(var w=0;w<7;w++)d.repeated[w].sort(function(e,t){return e.time[0]-t.time[0]});return(0,u.b)(t),(0,u.a)(t),d})).apply(this,arguments)}},8621(e,t,a){a.d(t,{a:()=>p});var r=a(467),n=a(4131),i=a(4373),o=a(3041),s=a(8024),u=a(4293),f=a(6788);function p(e,t,a){return d.apply(this,arguments)}function d(){return(d=(0,r.a)(function*(e,t,a){var r=yield(0,u.a)(a,!0);(0,f.a)(a),(0,f.b)(a);var p=`r_${e}`;if(!(0,s.f)(r,p))return{actions:[],actionsQuantity:0,RouteID:e};r[p];var d=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,o.c)("route",[e],null)}},{icon:"calendar_today",name:"時刻表",key:"calendar",action:function(){(0,n.c)(t)}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,i.d)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,i.f)(e)}}];return{actions:d,actionsQuantity:d.length,RouteID:e}})).apply(this,arguments)}},7123(e,t,a){a.d(t,{a:()=>b});var r=a(3453),n=a(467),i=a(7183),o=a(8024),s=a(6483),u=a(6802),f=a(7810),p=a(2063),d=a(8011),l=a(4293),c=a(1932),v=a(424),h=a(2303),g=a(6788),m=a(3459),y=a(1531);function b(e,t,a,r,n){return _.apply(this,arguments)}function _(){return(_=(0,n.a)(function*(e,t,a,n,b){(0,g.f)(b,"getRoute_0",0,!1),(0,g.f)(b,"getRoute_1",0,!1),(0,g.f)(b,"getStop_0",0,!1),(0,g.f)(b,"getStop_1",0,!1),(0,g.f)(b,"getLocation_0",0,!1),(0,g.f)(b,"getLocation_1",0,!1),(0,g.f)(b,"getSegmentBuffers_0",0,!1),(0,g.f)(b,"getSegmentBuffers_1",0,!1),(0,g.f)(b,"getEstimateTime_0",0,!1),(0,g.f)(b,"getEstimateTime_1",0,!1),(0,g.f)(b,"getBusEvent_0",0,!1),(0,g.f)(b,"getBusEvent_1",0,!1),(0,g.f)(b,"getBusData_0",0,!1),(0,g.f)(b,"getBusData_1",0,!1);var _=yield Promise.all([(0,l.a)(b,!0),(0,v.a)(b),(0,c.a)(b),(0,p.a)(b)]),I=(0,r.a)(_,4),D=I[0],S=I[1],$=I[2],B=I[3],k=yield Promise.all([(0,d.a)(b,0),(0,d.a)(b,1),(0,d.a)(b,2),(0,f.a)(b)]),R=(0,r.a)(k,4),L=R[0],P=R[1],T=R[2],w=R[3],E=yield Promise.all([(0,u.a)(b),(0,s.b)(a,n)]),x=(0,r.a)(E,2),C=x[0],M=x[1],O=(0,h.b)(w,C,D,e,t),q=!1,A={};(0,o.f)($,`r_${e}`)&&(q=!0,A=$[`r_${e}`]);var N=(0,m.b)("time_formatting_mode"),Q=[],V=[];for(var H of B){var U={},Z=H.RouteID;if([e,10*e].includes(Z)||t.includes(Z)){U.status=(0,h.g)(null==H?void 0:H.EstimateTime,N);var j=`s_${H.StopID}`,z={};if(!(0,o.f)(S,j))continue;z=S[j],U.id=H.StopID,U.sequence=z.seqNo,U.goBack=z.goBack;var F=`l_${z.stopLocationId}`,G={};if(!(0,o.f)(L,F))continue;G=L[F],U.name=G.n;var J=G.r.length;U.overlappingRoutes=[];for(var K=0;K<J;K++){var W=G.r[K];if(W!==e){var X=`r_${W}`;if((0,o.f)(D,X)){var Y=D[X],ee={name:Y.n,RouteEndPoints:{RouteDeparture:Y.dep,RouteDestination:Y.des,text:`${Y.dep} ↔ ${Y.des}`,html:`<span>${Y.dep}</span><span>↔</span><span>${Y.des}</span>`},RouteID:Y.id,PathAttributeId:Y.pid};U.overlappingRoutes.push(ee)}}}U.position={longitude:G.lo,latitude:G.la},V.push({latitude:G.la,longitude:G.lo,id:H.StopID});var te=G.g,ae=[];for(var re of((0,o.f)(T,te)&&(ae=T[te]),U.nearbyLocations=[],ae)){var ne=`ml_${re.hash}`;if((0,o.f)(P,ne)){var ie=P[ne],oe={name:ie.n,distance:0|(0,i.c)(ie.la[0],ie.lo[0],G.la,G.lo),hash:ie.hash};U.nearbyLocations.push(oe)}}for(var se of(U.nearbyLocations.sort(function(e,t){return e.distance-t.distance}),U.buses=[],G.s)){var ue=`s_${se}`;if((0,o.f)(O,ue))for(var fe=O[ue].length-1;fe>=0;fe--)U.buses.push((0,h.c)(O[ue][fe]))}U.buses.sort(function(e,t){return e.index-t.index});var pe=[];(0,o.f)(M,j)&&(pe=M[j]),U.busArrivalTimes=pe;var de=!1,le=!1,ce=!1,ve=!1;if(q){var he=`g_${U.goBack}`,ge=[];for(var me of((0,o.f)(A,he)?ge=A[he]:"1"===U.goBack&&(ve=!0,ge=A.g_0),ge))me.OriginStopID!==H.StopID&&me.DestinationStopID!==H.StopID||(de=!0),ve?(me.OriginStopID===H.StopID&&(ce=!0),me.DestinationStopID===H.StopID&&(le=!0)):(me.OriginStopID===H.StopID&&(le=!0),me.DestinationStopID===H.StopID&&(ce=!0))}U.segmentBuffer={isSegmentBuffer:de,isStartingPoint:le,isEndingPoint:ce},Q.push(U)}}Q.sort(function(e,t){return e.sequence-t.sequence});for(var ye=(0,y.b)(V,450),be=!1,_e=!1,Ie={},De=0,Se={},$e=Q.length,Be=0;Be<$e;Be++){var ke=Q[Be],Re=Q[Be+1]||ke,Le=0;if(ke.buses.length>0&&ke.buses[0].onThisRoute){var Pe=[ke.buses[0].position.longitude,ke.buses[0].position.latitude],Te=Pe[0],we=Pe[1],Ee=[ke.position.longitude,ke.position.latitude],xe=Ee[0],Ce=Ee[1],Me=[Re.position.longitude,Re.position.latitude],Oe=Me[0],qe=Me[1];if((Te-xe)*(Oe-Te)+(we-Ce)*(qe-we)>=0){var Ae=Math.hypot(Te-xe,we-Ce),Ne=Math.hypot(Te-Oe,we-qe);Le=Math.max(0,Math.min(Ae/(Ae+Ne),1))}}ke.progress=Le,ke.segmentBuffer.isStartingPoint&&(be=!0),ke.segmentBuffer.isEndingPoint&&be&&(_e=!0),be&&!_e&&(ke.segmentBuffer.isSegmentBuffer=!0),be&&_e&&(be=!1,_e=!1);var Qe=!1;null!==ye&&ye.id===ke.id&&(Qe=!0),ke.nearest=Qe;var Ve=`g_${ke.goBack}`||"g_0";(0,o.f)(Ie,Ve)||(Ie[Ve]=[],Se[Ve]=0,De+=1),Ie[Ve].push(ke),Se[Ve]+=1}var He=D[`r_${e}`],Ue=He.n,Ze=He.dep,je=He.des,ze={groupNames:[`往${je}`,`往${Ze}`],groupedItems:Ie,groupQuantity:De,itemQuantity:Se,RouteName:Ue,RouteEndPoints:[Ze,je],dataUpdateTime:(0,g.e)(b),RouteID:e,PathAttributeId:t};return(0,g.a)(b),(0,g.b)(b),ze})).apply(this,arguments)}},8134(e,t,a){a.d(t,{a:()=>_,b:()=>S,c:()=>d,d:()=>h,e:()=>c});var r=a(467),n=a(2129),i=a(8024),o=a(4781),s=a(9734),u=a(8011),f=a(4293),p=a(6788);function d(e){return l.apply(this,arguments)}function l(){return(l=(0,r.a)(function*(e){var t=(0,i.c)(),a=yield(0,f.a)(t,!0),r=[];for(var n in a){var o=a[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,p.a)(t),(0,p.b)(t),r})).apply(this,arguments)}function c(e){return v.apply(this,arguments)}function v(){return(v=(0,r.a)(function*(e){var t,a=(0,i.c)(),r=yield(0,f.a)(a,!0),n=`r_${e}`;return!!(0,i.f)(r,n)&&(t=r[n],(0,p.a)(a),(0,p.b)(a),t)})).apply(this,arguments)}function h(e){return g.apply(this,arguments)}function g(){return(g=(0,r.a)(function*(e){var t=(0,i.c)(),a=yield(0,f.a)(t,!0),r=[];for(var n in a){var o=a[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,p.a)(t),(0,p.b)(t),r})).apply(this,arguments)}var m={},y=[],b=!1;function _(){return I.apply(this,arguments)}function I(){return(I=(0,r.a)(function*(){if(!b){var e=(0,i.c)(),t=yield(0,f.a)(e,!0),a=yield(0,u.a)(e,1),r=yield(0,s.a)(e,!0);(0,p.a)(e),(0,p.b)(e);var n={},d=[],l=0;for(var c in t){var v=t[c],h={id:v.id,pid:v.pid,dep:v.dep,des:v.des,n:v.n,hash:"",lo:"",la:"",r:"",s:"",type:0};d.push(h);var g=(0,o.b)(`${h.n.toLowerCase()}${h.dep.toLowerCase()}${h.des.toLowerCase()}`,!0);for(var _ of g){var I=`u_${_}`;(0,i.f)(n,I)||(n[I]=[]),n[I].push(l)}l+=1}for(var D in a){var S=a[D],$={id:S.id,n:S.n,lo:S.lo,la:S.la,r:S.r,s:S.s,hash:S.hash,dep:"",des:"",pid:[],type:1};d.push($);var B=(0,o.b)($.n.toLowerCase(),!0);for(var k of B){var R=`u_${k}`;(0,i.f)(n,R)||(n[R]=[]),n[R].push(l)}l+=1}for(var L in r){var P=r[L],T={id:P.BusId,pid:[],dep:"",des:"",n:P.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};d.push(T);var w=(0,o.b)(T.n.toLowerCase(),!0);for(var E of w){var x=`u_${E}`;(0,i.f)(n,x)||(n[x]=[]),n[x].push(l)}l+=1}m=n,y=d,b=!0}})).apply(this,arguments)}function D(e,t){var a=0,r=0;for(var n of t){a+=e.indexOf(n,r)-r,r+=1}return e===t&&(a=10*Math.abs(a)),a}function S(e,t,a){if(!b)return[];var r=e.toLowerCase(),s=(0,o.b)(r,!0),u=(0,o.b)(r,!1),f=[];for(var p of s){var d=`u_${p}`;(0,i.f)(m,d)&&f.push(m[d])}f.sort(function(e,t){return e.length-t.length});var l=f.length-1,c=[];if(0===l&&(c=f[0]),l>0)for(var v=0;v<l;v++){var h=f[v],g=f[v+1];c=0===v?(0,n.b)(h,g):(0,n.b)(c,g)}var _=[],I=0,S=new Set;if(-1===t||2===t){var $=y.filter(function(e){return e.n===r&&2===e.type});for(var B of $)if(_.push({item:B,score:1/0}),S.add(B.id),(I+=1)>=a)break}if(I<a)for(var k of c){var R=y[k];if((-1===t||t===R.type)&&!S.has(R.id)){var L=D(u,(0,o.b)(R.n,!1));if(!(I<a))break;_.push({item:R,score:L}),I+=1}}return _.sort(function(e,t){return t.score-e.score}),_}}}]);
//# sourceMappingURL=ca379585367de4e135c1.js.map