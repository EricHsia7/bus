"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[470],{2303(e,t,r){r.d(t,{$Q:()=>u,AS:()=>l,Ov:()=>c,aU:()=>s,eu:()=>v,s$:()=>d,w_:()=>f,zi:()=>p});var n=r(8024),a=r(5579);function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){if("string"==typeof e){var r=parseInt(e);if(-3===r)return{code:6,text:"末班駛離",time:r};if(-4===r)return{code:5,text:"今日停駛",time:r};if(-2===r)return{code:4,text:"交通管制",time:r};if(-1===r)return{code:3,text:"未發車",time:r};if(0<=r&&r<=10)return{code:2,text:"進站中",time:r};if(10<r&&r<=180)return{code:1,text:(0,a.fU)(r,t),time:r};if(180<r&&r<=250)return{code:.5,text:(0,a.fU)(r,t),time:r};if(250<r)return{code:0,text:(0,a.fU)(r,t),time:r}}return{code:7,text:"發生錯誤",time:-5}}function s(e,t){var r=e.length;if(0===t){var n=0,a=0;return 4===r&&(n=parseInt(e.substring(0,2)),a=parseInt(e.substring(2,4))),2===r&&(a=parseInt(e)),{type:"moment",hours:n,minutes:a}}if(1===t){var i=0,o=0;if(4===r){var u=parseInt(e.substring(0,2)),s=parseInt(e.substring(2,4));i=Math.min(u,s),o=Math.max(u,s)}if(2===r){var f=parseInt(e);i=f,o=f}return{type:"range",min:i,max:o}}}function f(e,t,r,a,o){var u,s={},f={},l=i(t);try{for(l.s();!(u=l.n()).done;){var c=u.value;f[c.BusID]=c}}catch(e){l.e(e)}finally{l.f()}var p,v=i(e);try{for(v.s();!(p=v.n()).done;){var d=p.value,y={};y.CarType=d.CarType,y.BusStatus=d.BusStatus,y.BusID=d.BusID,y.CarOnStop=d.CarOnStop;var m=parseInt(d.RouteID),h=String(d.BusID),b=!1,g=0;m===a||o.indexOf(m)>-1||m===10*a?(b=!0,g=h.charCodeAt(0)*Math.pow(10,-5)):(b=!1,g=h.charCodeAt(0)),y.onThisRoute=b,y.index=g;var I={};if((0,n.mQ)(f,h)){I=f[h],y.position={latitude:parseFloat(I.Latitude),longitude:parseFloat(I.Longitude)};var S={},w=!1;for(var k in r){var x=r[k];if(x.pid.indexOf(m)>-1){S=x,w=!0;break}}y.RouteName=w?S.n:"未知路線",y.RouteID=w?S.id:null;var A=`s_${d.StopID}`;(0,n.mQ)(s,A)||(s[A]=[]),s[A].push(y)}}}catch(e){v.e(e)}finally{v.f()}return s}function l(e,t,r,a){var o,u={},s={},f=i(t);try{for(f.s();!(o=f.n()).done;){var l=o.value;s[l.BusID]=l}}catch(e){f.e(e)}finally{f.f()}var c,p=i(e);try{for(p.s();!(c=p.n()).done;){var v=c.value,d={},y=parseInt(v.StopID),m=parseInt(v.RouteID),h=String(v.BusID);if(!(a.indexOf(y)<0)){d.index=h.charCodeAt(0),d.onThisRoute=!0,d.CarType=v.CarType,d.BusStatus=v.BusStatus,d.BusID=v.BusID,d.CarOnStop=v.CarOnStop;var b={};if((0,n.mQ)(s,h)){b=s[h],d.position={latitude:parseFloat(b.Latitude),longitude:parseFloat(b.Longitude)};var g={},I=!1;for(var S in r){var w=r[S];if(w.pid.indexOf(m)>-1){g=w,I=!0;break}}d.RouteName=I?g.n:"未知路線",d.RouteID=I?g.id:null;var k=`s_${y}`;(0,n.mQ)(u,k)||(u[k]=[]),u[k].push(d)}}}}catch(e){p.e(e)}finally{p.f()}return u}function c(e){var t="";switch(e){case"0":t="一般";break;case"1":t="低底盤";break;case"2":t="大復康巴士";break;case"3":t="狗狗友善專車";break;default:t="未知類型"}return t}function p(e){var t="";switch(e){case"0":t="離站";break;case"1":t="進站";break;default:t="未知狀態"}return t}function v(e){var t="";switch(e){case"0":t="正常";break;case"1":t="車禍";break;case"2":t="故障";break;case"3":t="塞車";break;case"4":t="緊急求援";break;case"5":t="加油";break;case"99":t="非營運狀態";break;default:t="未知狀態"}return t}function d(e){var t={},r=c(e.CarType);t.type=r;var n=p(e.CarOnStop),a=v(e.BusStatus);return t.carNumber=e.BusID,t.status={onStop:n,situation:a,text:`${n} | ${a}`},t.RouteName=e.RouteName,t.onThisRoute=e.onThisRoute,t.index=e.index,t.position=e.position,t}},6160(e,t,r){r.d(t,{i:()=>y});var n=r(467),a=r(8024),i=r(6802),o=r(7810),u=r(9734),s=r(8011),f=r(424),l=r(2303),c=r(6788),p=r(8134);function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(e,t){var r=`c_${e}`,n=yield(0,u.j)(t,!0),d=yield(0,i.d)(t),y=yield(0,o.J)(t),m=yield(0,f.T)(t),h=yield(0,s.g)(t,0),b={properties:[],LocationName:""},g={};if(!(0,a.mQ)(n,r))return b;var I=(g=n[r]).CarNum;b.properties.push({key:"car_number",icon:"tag",value:I});var S=g.CarType,w=(0,l.Ov)(S);b.properties.push({key:"car_type",icon:"directions_bus",value:w});var k,x={},A=v(d);try{for(A.s();!(k=A.n()).done;){var C=k.value;if(C.BusID===I){x=C;break}}}catch(e){A.e(e)}finally{A.f()}var D,Q=parseInt(x.RouteID),B=x.BusStatus,T=(0,l.eu)(B),$=parseInt(x.GoBack),O={},R=v(y);try{for(R.s();!(D=R.n()).done;){var _=D.value;if(_.BusID===I){O=_;break}}}catch(e){R.e(e)}finally{R.f()}var N=O.CarOnStop,M=(0,l.zi)(N);b.properties.push({key:"status",icon:"vital_signs",value:`${M} | ${T}`});var j=O.StopID,L=yield(0,p.F6)(Q),E={};if(!(L.length>0))return b;var F=(E=L[0]).id,U=E.pid,q=E.n,z=E.dep,P=[E.des,z,""][$||0];b.properties.push({key:"route",icon:"route",value:`${q} - 往${P}`}),b.RouteID=F,b.FullPathAttributeId=U;var Z=`s_${j}`;if(!(0,a.mQ)(m,Z))return b;var J=h[`l_${m[Z].stopLocationId}`].n;return b.properties.push({key:"location_name",icon:"location_on",value:J}),(0,c.LQ)(t),(0,c.gC)(t),b})).apply(this,arguments)}},6788(e,t,r){r.d(t,{Fd:()=>v,LQ:()=>g,Mf:()=>h,ZL:()=>w,Zt:()=>k,_M:()=>b,gC:()=>x});var n=r(2284),a=r(467),i=r(8024),o=r(4750),u=r(5579),s=r(8925);function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var c={},p=new Error("FetchError");function v(e,t,r,n){return d.apply(this,arguments)}function d(){return(d=(0,a.A)(function*(e,t,r,n){if((0,i.mQ)(c,e)){if(c[e].processing)return yield new Promise(function(n,a){c[e].requests.push([n,a,t,r])});if(null!==c[e].result&&(new Date).getTime()<=c[e].timestamp)return h(t,r,0,!0),c[e].result}else c[e]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var a=yield fetch(e);if(!a.ok)throw h(t,r,0,!0),new Error(`HTTP error! status: ${a.status}`);for(var u=parseInt(String(a.headers.get("content-length"))),l=a.body.getReader(),d=[],m=0;;){var b=yield l.read(),g=b.done,I=b.value;if(g)break;d.push(I);var S=(m+=I.length)/u;if(h(t,r,S,!1),(0,i.mQ)(c,e)){var w,k=f(c[e].requests);try{for(k.s();!(w=k.n()).done;){var x=w.value;h(x[2],x[3],S,!1)}}catch(e){k.e(e)}finally{k.f()}}}for(var A=new Uint8Array(m),C=0,D=0,Q=d;D<Q.length;D++){var B=Q[D];A.set(B,C),C+=B.length}var T,$=new Blob([A],{type:"application/gzip"}),O=yield $.arrayBuffer(),R=yield(0,o.h)(O);switch(n){case"json":T=/^<!doctype html>/.test(R)?yield v(e.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,r,n):JSON.parse(R);break;case"xml":T=R}var _=new Date;if(yield(0,s.N$)(u,_),T){if((0,i.mQ)(c,e)){for(var N=m/u,M=c[e].requests.shift();M;)M[0](T),h(M[2],M[3],N,!1),M=c[e].requests.shift();c[e].result=T,c[e].timestamp=_.getTime()+3e4,c[e].processing=!1}return y(),T}if((0,i.mQ)(c,e)){for(var j=c[e].requests.shift();j;)j[1](p),h(j[2],j[3],0,!0),j=c[e].requests.shift();c[e].failed=!0}throw y(),p})).apply(this,arguments)}function y(){var e=(new Date).getTime();for(var t in c)if((0,i.mQ)(c,t)){if(!c[t].processing&&e>c[t].timestamp){delete c[t];continue}if(c[t].failed){delete c[t];continue}}}var m={};function h(e,t,r,n){(0,i.mQ)(m,e)||(m[e]={}),(0,i.mQ)(m[e],t)?(n?m[e][t].expel=!0:(m[e][t].expel=!1,m[e][t].progress=r),I(e,"run")):(m[e][t]={expel:!1,progress:r,total:1},I(e,"start"))}function b(e){if((0,i.mQ)(m,e)&&"object"===(0,n.A)(m[e])){var t=0,r=0;for(var a in m[e])m[e][a].expel||(t+=m[e][a].total,r+=m[e][a].progress);var o=Math.min(Math.max(r/t,0),1);return o===1/0||isNaN(o)?1:o}return 1}function g(e){(0,i.mQ)(m,e)&&(delete m[e],I(e,"end"))}function I(e,t){var r={target:e,stage:t,progress:b(e)},n=new CustomEvent(e,{detail:r});document.dispatchEvent(n)}var S={};function w(e,t){(0,i.mQ)(S,e)||(S[e]=0);var r=0;"string"==typeof t&&(r=(0,u.Zn)(t)),r>S[e]&&(S[e]=r)}function k(e){return(0,i.mQ)(S,e)?1*S[e]:0}function x(e){(0,i.mQ)(S,e)&&delete S[e]}}}]);
//# sourceMappingURL=674ba4a1306c2d0afbd3.js.map