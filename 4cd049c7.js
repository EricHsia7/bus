"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[8153],{1932(t,r,e){e.d(r,{L:()=>v});var n=e(467),o=e(4311),a=e(3153),i=e(6788);function u(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return s(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function s(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}var l=!1,f={};function c(t){return y.apply(this,arguments)}function y(){return(y=(0,n.A)(function*(t){var r=new Worker(new URL(e.p+e.u(5332),e.b));return yield new Promise(function(e,n){r.onmessage=function(t){e(t.data),r.terminate()},r.onerror=function(t){n(t.message),r.terminate()},r.postMessage(t)})})).apply(this,arguments)}function p(t){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(t){var r=new Worker(new URL(e.p+e.u(8892),e.b));return yield new Promise(function(e,n){r.onmessage=function(t){e(t.data),r.terminate()},r.onerror=function(t){n(t.message),r.terminate()},r.postMessage(t)})})).apply(this,arguments)}function v(t){return h.apply(this,arguments)}function h(){return h=(0,n.A)(function*(t){function r(){return e.apply(this,arguments)}function e(){return e=(0,n.A)(function*(){var r,e="",n=u([[0,15],[1,15]].map(function(t){return{url:(0,a.y)(t[0],t[1]),e:t}}));try{for(n.s();!(r=n.n()).done;){var o=r.value;e+=(yield(0,i.Fd)(o.url,t,`getSegmentBuffers_${o.e[0]}`,"xml")),(0,i.ZL)(t,-1)}}catch(t){n.e(t)}finally{n.f()}return e}),e.apply(this,arguments)}var s="bus_segment_buffers_cache",y=yield(0,o.Ct)(0,`${s}_timestamp`);if(null===y){var d=yield r(),v=yield c(d),h=yield p(v);return yield(0,o.mL)(0,`${s}_timestamp`,(new Date).getTime()),yield(0,o.mL)(0,s,JSON.stringify(h)),l||(l=!0,f=h),h}if((new Date).getTime()-parseInt(y)>2592e6){var m=yield r(),g=yield c(m),b=yield p(g);return yield(0,o.mL)(0,`${s}_timestamp`,(new Date).getTime()),yield(0,o.mL)(0,s,JSON.stringify(b)),b}if(!l){var w=yield(0,o.Ct)(0,s);l=!0,f=JSON.parse(w)}return(0,i.Mf)(t,"getSegmentBuffers_0",0,!0),(0,i.Mf)(t,"getSegmentBuffers_1",0,!0),(0,i.ZL)(t,-1),f}),h.apply(this,arguments)}},6160(t,r,e){e.d(r,{i:()=>d});var n=e(467),o=e(6802),a=e(7810),i=e(9734),u=e(8011),s=e(424),l=e(2303),f=e(6788),c=e(8134);function y(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return p(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?p(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function p(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function d(t,r){return v.apply(this,arguments)}function v(){return(v=(0,n.A)(function*(t,r){var e=`c_${t}`,n=yield(0,i.j)(r,!0),p=yield(0,o.d)(r),d=yield(0,a.J)(r),v=yield(0,s.T)(r),h=yield(0,u.g)(r,0),m={properties:[],LocationName:""},g={};if(!n.hasOwnProperty(e))return m;var b=(g=n[e]).CarNum;m.properties.push({key:"car_number",icon:"tag",value:b});var w=g.CarType,A=(0,l.Ov)(w);m.properties.push({key:"car_type",icon:"directions_bus",value:A});var S,I={},O=y(p);try{for(O.s();!(S=O.n()).done;){var _=S.value;if(_.BusID===b){I=_;break}}}catch(t){O.e(t)}finally{O.f()}var $,P=parseInt(I.RouteID),k=I.BusStatus,T=(0,l.eu)(k),L=parseInt(I.GoBack),j={},C=y(d);try{for(C.s();!($=C.n()).done;){var B=$.value;if(B.BusID===b){j=B;break}}}catch(t){C.e(t)}finally{C.f()}var E=j.CarOnStop,M=(0,l.zi)(E);m.properties.push({key:"status",icon:"vital_signs",value:`${M} | ${T}`});var x=j.StopID,D=yield(0,c.F6)(P),U={};if(!(D.length>0))return m;var N=(U=D[0]).id,q=U.pid,F=U.n,Z=U.dep,J=[U.des,Z,""][L||0];m.properties.push({key:"route",icon:"route",value:`${F} - å¾€${J}`}),m.RouteID=N,m.FullPathAttributeId=q;var R=`s_${x}`;if(!v.hasOwnProperty(R))return m;var z=h[`l_${v[R].stopLocationId}`].n;return m.properties.push({key:"location_name",icon:"location_on",value:z}),(0,f.LQ)(r),(0,f.gC)(r),m})).apply(this,arguments)}},6788(t,r,e){e.d(r,{Fd:()=>y,LQ:()=>g,Mf:()=>h,ZL:()=>A,Zt:()=>S,_M:()=>m,gC:()=>I});var n=e(2284),o=e(467),a=e(4750),i=e(5579),u=e(8925);function s(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return l(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function l(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}var f={},c=new Error("FetchError");function y(t,r,e,n){return p.apply(this,arguments)}function p(){return(p=(0,o.A)(function*(t,r,e,n){if(f.hasOwnProperty(t)){if(f[t].processing)return yield new Promise(function(n,o){f[t].requests.push([n,o,r,e])});if(null!==f[t].result&&(new Date).getTime()<=f[t].timestamp)return h(r,e,0,!0),f[t].result}else f[t]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var o=yield fetch(t);if(!o.ok)throw h(r,e,0,!0),new Error(`HTTP error! status: ${o.status}`);for(var i=parseInt(String(o.headers.get("content-length"))),l=o.body.getReader(),p=[],v=0;;){var m=yield l.read(),g=m.done,b=m.value;if(g)break;p.push(b);var w=(v+=b.length)/i;if(h(r,e,w,!1),f.hasOwnProperty(t)){var A,S=s(f[t].requests);try{for(S.s();!(A=S.n()).done;){var I=A.value;h(I[2],I[3],w,!1)}}catch(t){S.e(t)}finally{S.f()}}}for(var O=new Uint8Array(v),_=0,$=0,P=p;$<P.length;$++){var k=P[$];O.set(k,_),_+=k.length}var T,L=new Blob([O],{type:"application/gzip"}),j=yield L.arrayBuffer(),C=yield(0,a.h)(j);switch(n){case"json":T=/^<!doctype html>/.test(C)?yield y(t.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),r,e,n):JSON.parse(C);break;case"xml":T=C}var B=new Date;if(yield(0,u.N$)(i,B),T){if(f.hasOwnProperty(t)){for(var E=v/i,M=f[t].requests.shift();M;)M[0](T),h(M[2],M[3],E,!1),M=f[t].requests.shift();f[t].result=T,f[t].timestamp=B.getTime()+3e4,f[t].processing=!1}return d(),T}if(f.hasOwnProperty(t)){for(var x=f[t].requests.shift();x;)x[1](c),h(x[2],x[3],0,!0),x=f[t].requests.shift();f[t].failed=!0}throw d(),c})).apply(this,arguments)}function d(){var t=(new Date).getTime();for(var r in f)if(f.hasOwnProperty(r)){if(!f[r].processing&&t>f[r].timestamp){delete f[r];continue}if(f[r].failed){delete f[r];continue}}}var v={};function h(t,r,e,n){v.hasOwnProperty(t)||(v[t]={}),v[t].hasOwnProperty(r)?(n?v[t][r].expel=!0:(v[t][r].expel=!1,v[t][r].progress=e),b(t,"run")):(v[t][r]={expel:!1,progress:e,total:1},b(t,"start"))}function m(t){if(v.hasOwnProperty(t)&&"object"===(0,n.A)(v[t])){var r=0,e=0;for(var o in v[t])v[t][o].expel||(r+=v[t][o].total,e+=v[t][o].progress);var a=Math.min(Math.max(e/r,0),1);return a===1/0||isNaN(a)?1:a}return 1}function g(t){v.hasOwnProperty(t)&&(delete v[t],b(t,"end"))}function b(t,r){var e={target:t,stage:r,progress:m(t)},n=new CustomEvent(t,{detail:e});document.dispatchEvent(n)}var w={};function A(t,r){w.hasOwnProperty(t)||(w[t]=0);var e=0;"string"==typeof r&&(e=(0,i.Zn)(r)),e>w[t]&&(w[t]=e)}function S(t){return w.hasOwnProperty(t)?1*w[t]:0}function I(t){w.hasOwnProperty(t)&&delete w[t]}},6802(t,r,e){e.d(r,{d:()=>s});var n=e(467),o=e(3153),a=e(6788);function i(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return u(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function s(t){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(t){var r,e=[],n=i([[0,0],[1,0]].map(function(t){return{url:(0,o.y)(t[0],t[1]),e:t}}));try{for(n.s();!(r=n.n()).done;){var u=r.value,s=yield(0,a.Fd)(u.url,t,`getBusData_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,a.ZL)(t,s.EssentialInfo.UpdateTime)}}catch(t){n.e(t)}finally{n.f()}return e})).apply(this,arguments)}},7810(t,r,e){e.d(r,{J:()=>s});var n=e(467),o=e(3153),a=e(6788);function i(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return u(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function u(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function s(t){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(t){var r,e=[],n=i([[0,1],[1,1]].map(function(t){return{url:(0,o.y)(t[0],t[1]),e:t}}));try{for(n.s();!(r=n.n()).done;){var u=r.value,s=yield(0,a.Fd)(u.url,t,`getBusEvent_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,a.ZL)(t,s.EssentialInfo.UpdateTime)}}catch(t){n.e(t)}finally{n.f()}return e})).apply(this,arguments)}}}]);
//# sourceMappingURL=4cd049c7.js.map