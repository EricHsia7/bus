"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[372],{365:(e,t,n)=>{n.d(t,{G:()=>c});var r=n(77),o=n(4778),i=n(7528),a=n(1172);function u(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return s.apply(this,arguments)}function s(){var e;return e=function*(e){if(""===r.M3||""===r.se||void 0===e)return!1;var t=(0,o.F)("cancel",[e]),n=(0,i.b)("cancel",[e]),u=yield(0,a.R)("cancel",t,n);return!1!==u&&200===u.code&&"cancel"===u.method&&(yield(0,r.VJ)(e),!0)},s=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})},s.apply(this,arguments)}},1172:(e,t,n)=>{function r(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function o(e,t,n){return i.apply(this,arguments)}function i(){var e;return e=function*(e,t,n){try{if(!1===t||!1===n)return!1;var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},o=yield fetch(t,r);if(!o.ok)return yield o.text(),!1;try{var i=yield o.text(),a=JSON.parse(i);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return a;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}},i=function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function u(e){r(a,o,i,u,c,"next",e)}function c(e){r(a,o,i,u,c,"throw",e)}u(void 0)})},i.apply(this,arguments)}n.d(t,{R:()=>o})},2757:(e,t,n)=>{n.d(t,{R:()=>M});var r=n(4256),o=n(574),i=n(2945),a=n(5428),u=n(6483),c=n(6802),s=n(7810),l=n(2063),d=n(8011),f=n(4293),v=n(424),h=n(2303),p=n(6788),y=n(3459),m=n(1238);function _(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return w(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n={},r=[];for(var o in e){var i=e[o],a=i.StopID,u=parseInt(i.EstimateTime);u>=0&&t.indexOf(a)>-1&&r.push([a,u])}var c=r.length;r.sort(function(e,t){return e[1]-t[1]});for(var s=1,l=0,d=r;l<d.length;l++){var f=s/c,v=(f-f%.25)/.25;n[`s_${d[l][0]}`]={number:s,text:s.toString(),code:v},s+=1}return n}function M(e,t,n,r){return S.apply(this,arguments)}function S(){var e;return e=function*(e,t,n,_){(0,p.Mf)(_,"getLocation_0",0,!1),(0,p.Mf)(_,"getLocation_1",0,!1),(0,p.Mf)(_,"getRoute_0",0,!1),(0,p.Mf)(_,"getRoute_1",0,!1),(0,p.Mf)(_,"getStop_0",0,!1),(0,p.Mf)(_,"getStop_1",0,!1),(0,p.Mf)(_,"getEstimateTime_0",0,!1),(0,p.Mf)(_,"getEstimateTime_1",0,!1),(0,p.Mf)(_,"getBusEvent_0",0,!1),(0,p.Mf)(_,"getBusEvent_1",0,!1);for(var w=yield(0,l.K)(_),M=yield(0,d.g)(_,1),S=yield(0,f.a)(_,!0),k=yield(0,v.T)(_),P=yield(0,s.J)(_),O=yield(0,c.d)(_),x=yield(0,u.Io)(t,n),$=(0,y.Js)("time_formatting_mode"),I=(0,y.Js)("location_labels"),T=(0,y.Js)("display_user_orientation"),D={},Q={},R={},A=(0,m.Y)(),E=M[`ml_${e}`],F=E.n,J=E.id,C=E.v,L=[],q=[],B=J.length,N=0;N<B;N++)L=L.concat(E.s[N]),q=q.concat(E.r[N]);var j,U=function(e,t){var n,r={},o=g(e);try{for(o.s();!(n=o.n()).done;){var i=n.value;t.indexOf(i.StopID)>-1&&(r[`s_${i.StopID}`]=i)}}catch(e){o.e(e)}finally{o.f()}return r}(w,L),G=(0,h.AS)(P,O,S,L),K=[],V=g(C);try{for(V.s();!(j=V.n()).done;){var Z,Y=j.value,z=0,H=0,W=g(Y);try{for(W.s();!(Z=W.n()).done;){var X=Z.value;z+=X[0],H+=X[1]}}catch(e){W.e(e)}finally{W.f()}var ee=(0,a.hF)([z,H]),te=(0,o.DK)(ee);K.push(te)}}catch(e){V.e(e)}finally{V.f()}var ne=[];switch(I){case"address":ne=(0,r._q)(E.a);break;case"letters":ne=(0,i.V)(B);break;case"directions":ne=(0,i.M)(K)}for(var re=0;re<B;re++){var oe=`g_${re}`;D[oe]=[],Q[oe]=0,R[oe]={name:ne[re],properties:[{key:"address",icon:"personal_places",value:(0,r.pD)(E.a[re])},{key:"exact_position",icon:"location_on",value:`${E.la[re].toFixed(5)}, ${E.lo[re].toFixed(5)}`},{key:"cardinal_direction",icon:K[re].icon,value:`${K[re].name}${T&&-1!==A.cardinalDirection.id&&A.cardinalDirection.id===K[re].id?"（目前指向）":""}`}]};for(var ie=E.s[re],ae=ie.length,ue=b(U,ie),ce=0;ce<ae;ce++){var se={},le=E.s[re][ce],de=`s_${le}`,fe={};if(k.hasOwnProperty(de)){fe=k[de],se.stopId=le;var ve={number:0,text:"--",code:-1};ue.hasOwnProperty(de)&&(ve=ue[de]),se.ranking=ve;var he=E.r[re][ce],pe=`r_${he}`,ye={};if(S.hasOwnProperty(pe)){ye=S[pe],se.route_name=ye.n,se.route_direction=`往${[ye.des,ye.dep,""][parseInt(fe.goBack)]}`,se.routeId=he;var me={};if(U.hasOwnProperty(de)){me=U[de];var _e=(0,h.$Q)(me.EstimateTime,$);se.status=_e;var ge=[];G.hasOwnProperty(de)&&(ge=G[de].map(function(e){return(0,h.s$)(e)})),se.buses=ge;var we=[];x.hasOwnProperty(de)&&(we=x[de]),se.busArrivalTimes=we,D[oe].push(se),Q[oe]+=1}}}}}for(var be in D)D[be].sort(function(e,t){return e.routeId-t.routeId});var Me={groupedItems:D,groups:R,groupQuantity:B,itemQuantity:Q,LocationName:F,hash:e,dataUpdateTime:(0,p.Zt)(_)};return(0,p.LQ)(_),(0,p.gC)(_),Me},S=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){_(i,r,o,a,u,"next",e)}function u(e){_(i,r,o,a,u,"throw",e)}a(void 0)})},S.apply(this,arguments)}},3937:(e,t,n)=>{n.d(t,{e:()=>c});var r=n(77),o=n(4778),i=n(7528),a=n(1172);function u(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return s.apply(this,arguments)}function s(){var e;return e=function*(e){if(!e)return!1;var t=(0,o.F)("register"),n=(0,i.b)("register",[e]),u=yield(0,a.R)("register",t,n);return!1!==u&&200===u.code&&"register"===u.method&&((0,r.gc)(u.client_id),(0,r.uQ)(u.secret),yield(0,r.ms)(),!0)},s=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})},s.apply(this,arguments)}},4778:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(77);function o(e){if(""===r.ph)return!1;var t=new URL(r.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},6983:(e,t,n)=>{n.d(t,{v:()=>c});var r=n(1351),o=n(3041),i=n(8011),a=n(6788);function u(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function c(e,t){return s.apply(this,arguments)}function s(){var e;return e=function*(e,t){var n=yield(0,i.g)(t,1);(0,a.LQ)(t),(0,a.gC)(t);var u=`ml_${e}`;if(!n.hasOwnProperty(u))return{actions:[],actionsQuantity:0,hash:e};n[u];var c=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,o.B)("location",[e])}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,r.k9)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,r.qp)(e)}}];return{actions:c,actionsQuantity:c.length,hash:e}},s=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})},s.apply(this,arguments)}},7053:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(77),o=n(4778),i=n(7528),a=n(1172);function u(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function c(){var e;return e=function*(){if(""===r.M3||""===r.se)return!1;var e=(0,o.F)("rotate"),t=(0,i.b)("rotate",[]),n=yield(0,a.R)("rotate",e,t);return!1!==n&&200===n.code&&"rotate"===n.method&&((0,r.uQ)(n.secret),yield(0,r.ms)(),!0)},c=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})},c.apply(this,arguments)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function d(e,t,n,r,o,i,a,u,c){return f.apply(this,arguments)}function f(){var e;return e=function*(e,t,n,u,l,d,f,v,h){if(""===r.M3||""===r.se||void 0===e||void 0===t||void 0===n||void 0===u||void 0===l||void 0===d||"number"!=typeof f||void 0===h)return!1;var p=new Date;switch(s(h)){case"string":case"number":p=new Date(h);break;default:if(!(h instanceof Date))return!1;p=h}var y=(0,o.F)("schedule"),m=(0,i.b)("schedule",[e,t,n,u,l,d,f,v,p.toISOString()]),_=yield(0,a.R)("schedule",y,m);return!1!==_&&200===_.code&&"schedule"===_.method&&(Math.random()>.8&&(yield function(){return c.apply(this,arguments)}()),yield(0,r.G7)(_.schedule_id,e,t,n,u,l,d,f,v,p.getTime()),_.schedule_id)},f=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,u,"next",e)}function u(e){l(i,r,o,a,u,"throw",e)}a(void 0)})},f.apply(this,arguments)}},7528:(e,t,n)=>{n.d(t,{b:()=>a});var r=n(8024),o=n(7307),i=n(77);function a(e,t){switch(e){case"cancel":return""!==i.M3&&""!==i.se&&1===t.length&&{client_id:i.M3,totp_token:(0,o.O)(i.se),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var n=new Date;return n.setMilliseconds(0),n.setSeconds(0),{hash:(0,r.sc)(`${t[0]}${n.getTime()}`)};case"schedule":return""!==i.M3&&""!==i.se&&9===t.length&&{client_id:i.M3,totp_token:(0,o.O)(i.se),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==i.M3&&""!==i.se&&0===t.length&&{client_id:i.M3,totp_token:(0,o.O)(i.se)};case"reschedule":return""!==i.M3&&""!==i.se&&3===t.length&&{client_id:i.M3,totp_token:(0,o.O)(i.se),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}}}]);
//# sourceMappingURL=b1adf5bd0abce5dfe257.js.map