"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(e,t,i){i.d(t,{eS:()=>ue,s_:()=>X,so:()=>ce});var a=i(467),n=i(5767),r=i(9566),d=i(2757),s=i(3422),o=i(5314),l=i(3459),c=i(8179),u=i(7968),p=i(8024),h=i(5579),v=i(4537),m=i(904),f=i(9119),g=i(3041),b=i(752),A=i(1351),y=(0,c.bv)(".dg"),C=(0,c.aI)(y,".mg"),L=(0,c.aI)(C,".qg"),I=(0,c.aI)(L,"span"),E=(0,c.aI)(C,".pg"),x=(0,c.aI)(y,".ah"),w=(0,c.aI)(C,".sg"),k=(0,c.aI)(w,".tg"),T=(0,c.aI)(C,".wg"),_=(0,c.aI)(T,".xg"),$=(0,c.aI)(C,".yg .zg"),S={},Z=!1,j=!1,M=0,N=0,P=0,D={},Q=0,R=!1,Y=15e3,q=5e3,F=15e3,H=!0,z=0,B=0,J="",O=!1,W=!1,U=!1,K="";function X(){x.addEventListener("touchstart",function(){M=Math.round(x.scrollLeft/Q)},{passive:!0}),x.addEventListener("scroll",function(e){R=!0;var t=e.target.scrollLeft/Q;N=t>M?M+1:M-1;var i=t-M,a=Math.abs(i);a>1&&(i>0?(M=Math.floor(t),N=M+1):(M=Math.ceil(t),N=M-1),a=Math.abs(t-M));var n=D[`g_${M}`]||{width:0,offset:0},r=D[`g_${N}`]||{width:0,offset:0},d=n.width+(r.width-n.width)*a,s=-1*(n.offset+(r.offset-n.offset)*a)+.5*Q-.5*d;G(P,s,d-20,t)},{passive:!0}),x.addEventListener("scrollend",function(e){var t=e.target.scrollLeft/Q;M=Math.round(t),R=!1},{passive:!0})}function G(e,t,i,a){x.style.setProperty("--cg",e.toString()),_.style.setProperty("--gg",i.toString()),k.style.setProperty("--hg",`${t.toString()}px`),k.style.setProperty("--jg",a.toString())}function V(e){var t=e;if(O){var i=t.detail.progress-1;$.style.setProperty("--kg",i.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,V)}function ee(){var e=document.createElement("div");e.classList.add("lh"),e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0");var t=document.createElement("div");t.classList.add("mh");var i=document.createElement("div");i.classList.add("nh");var a=document.createElement("div");a.classList.add("ph"),a.setAttribute("code","-1"),a.setAttribute("displayed","false");var n=document.createElement("div");n.classList.add("qh"),n.setAttribute("code","-1"),n.setAttribute("displayed","true"),i.appendChild(a),i.appendChild(n);var r=document.createElement("div");r.classList.add("_h");var d=document.createElement("div");d.classList.add("ai");var s=document.createElement("div");s.classList.add("bi");var o=document.createElement("div");o.classList.add("ei");var l=document.createElement("div");l.classList.add("tf"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var u=document.createElement("div");u.classList.add("uf"),u.setAttribute("code","0"),u.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(u);var p=document.createElement("div");p.classList.add("di"),p.appendChild((0,v.YC)("keyboard_arrow_down")),p.onclick=function(){!function(e){var t=(0,c.aI)(e,".fi"),i=e.parentElement,a=(0,c.ji)(e,"lh"),n=a.length,r=i.getBoundingClientRect(),d=e.getBoundingClientRect().top-r.top,s="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=s?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--jh",`${d}px`);for(var u=0;u<n;u++){var p=a[u];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<n;t++){var i=a[t];i.setAttribute("push-direction","0"),i.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<n;e++){a[e].setAttribute("push-state","2")}},{once:!0})}s?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(e)};var h=document.createElement("div");h.classList.add("ci"),s.appendChild(o),s.appendChild(p),s.appendChild(h),t.appendChild(i),t.appendChild(r),t.appendChild(d),t.appendChild(s);var m=document.createElement("div");m.classList.add("fi"),m.setAttribute("displayed","false");var f=document.createElement("div");f.classList.add("gi");var g=document.createElement("div");g.classList.add("hi"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var b=document.createElement("div");b.classList.add("ki"),b.appendChild((0,v.YC)("directions_bus")),g.appendChild(b),g.appendChild(document.createTextNode("公車")),g.onclick=function(){pe(e,0)};var A=document.createElement("div");A.classList.add("hi"),A.setAttribute("highlighted","false"),A.setAttribute("type","tab"),A.setAttribute("code","1");var y=document.createElement("div");y.classList.add("ki"),y.appendChild((0,v.YC)("departure_board")),A.appendChild(y),A.appendChild(document.createTextNode("抵達時間")),A.onclick=function(){pe(e,1)};var C=document.createElement("div");C.classList.add("hi"),C.setAttribute("highlighted","false"),C.setAttribute("type","save-to-folder");var L=document.createElement("div");L.classList.add("ki"),L.appendChild((0,v.YC)("folder")),C.appendChild(L),C.appendChild(document.createTextNode("儲存"));var I=document.createElement("div");I.classList.add("hi"),I.setAttribute("highlighted","false"),I.setAttribute("type","schedule-notification"),I.setAttribute("enabled","true");var E=document.createElement("div");E.classList.add("ki"),E.appendChild((0,v.YC)("notifications")),I.appendChild(E),I.appendChild(document.createTextNode("通知")),f.appendChild(g),f.appendChild(A),f.appendChild(C),f.appendChild(I);var x=document.createElement("div");x.classList.add("li"),x.setAttribute("displayed","true");var w=document.createElement("div");return w.classList.add("mi"),w.setAttribute("displayed","false"),m.appendChild(f),m.appendChild(x),m.appendChild(w),e.appendChild(t),e.appendChild(m),e}function te(){var e=document.createElement("div");e.classList.add("bh");var t=document.createElement("div");t.classList.add("ch");var i=document.createElement("div");i.classList.add("dh"),t.appendChild(i);var a=document.createElement("div");return a.classList.add("kh"),e.appendChild(t),e.appendChild(a),e}function ie(){var e=document.createElement("div");e.classList.add("ug");var t=document.createElement("span");return e.appendChild(t),e}function ae(){var e=document.createElement("div");e.classList.add("fh");var t=document.createElement("div");t.classList.add("gh"),t.appendChild((0,v.oC)());var i=document.createElement("div");return i.classList.add("hh"),e.appendChild(t),e.appendChild(i),e}function ne(){var e=document.createElement("div");e.classList.add("ni"),e.setAttribute("on-this-route","false");var t=document.createElement("div");t.classList.add("pi");var i=document.createElement("div");i.classList.add("ri"),i.appendChild((0,v.YC)("directions_bus"));var a=document.createElement("div");a.classList.add("ti");var n=document.createElement("div");n.classList.add("wi");var r=document.createElement("div");r.classList.add("_i");var d=document.createElement("div");d.classList.add("aj");var s=document.createElement("div");return s.classList.add("bj"),t.appendChild(i),t.appendChild(a),e.appendChild(t),n.appendChild(r),n.appendChild(d),n.appendChild(s),e.appendChild(n),e}function re(){var e=document.createElement("div");e.classList.add("oi");var t=document.createElement("div");t.classList.add("qi");var i=document.createElement("div");i.classList.add("si"),i.appendChild((0,v.YC)("calendar_view_day"));var a=document.createElement("div");a.classList.add("ui");var n=document.createElement("div");n.classList.add("vi");var r=document.createElement("div");return r.classList.add("xi"),t.appendChild(i),t.appendChild(a),t.appendChild(n),e.appendChild(t),e.appendChild(r),e}function de(e,t,i){var a,n;function d(e,a,n){function d(e,i,a){var n=(0,c.aI)(e,".mh"),r=(0,c.aI)(n,".ei"),d=(0,c.aI)(r,".tf"),s=(0,c.aI)(r,".uf");if(d.setAttribute("code",i.status.code.toString()),d.innerText=i.status.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,u=o.left,p=o.bottom,h=o.right,v=window.innerWidth,m=window.innerHeight;if(p>0&&l<m&&h>0&&u<v)return s.addEventListener("animationend",function(){s.setAttribute("code",i.status.code.toString()),s.innerText=i.status.text,s.classList.remove("wf"),d.setAttribute("displayed","false")},{once:!0}),d.setAttribute("displayed","true"),void s.classList.add("wf")}s.setAttribute("code",i.status.code.toString()),s.innerText=i.status.text}function o(e,i,a){var n=(0,c.aI)(e,".mh"),r=(0,c.aI)(n,".nh"),d=(0,c.aI)(r,".ph"),s=(0,c.aI)(r,".qh");if(d.setAttribute("code",i.ranking.code.toString()),d.innerText=i.ranking.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,u=o.left,p=o.bottom,h=o.right,v=window.innerWidth,m=window.innerHeight;if(p>0&&l<m&&h>0&&u<v)return s.addEventListener("animationend",function(){s.setAttribute("code",i.ranking.code.toString()),s.innerText=i.ranking.text,s.classList.remove("zh"),d.setAttribute("displayed","false")},{once:!0}),d.setAttribute("displayed","true"),void s.classList.add("zh")}s.setAttribute("code",i.ranking.code.toString()),s.innerText=i.ranking.text}function l(e,t){var i=(0,c.aI)(e,".mh");(0,c.aI)(i,"._h").innerText=t.route_direction}function u(e,t){var i=(0,c.aI)(e,".mh");(0,c.aI)(i,".ai").innerText=t.route_name}function v(e,t){var i=(0,c.aI)(e,".fi"),a=(0,c.aI)(i,".li"),n=Array.from((0,c.jg)(a,".ni")),r=n.length,d=t.buses.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0;l>s;l--){var u=ne();o.appendChild(u),n.push(u)}a.append(o)}else if(s>0)for(var h=r-1,v=r-s-1;h>v;h--)n[h].remove(),n.splice(h,1);for(var m=0;m<d;m++){var f=t.buses[m],g=n[m],b=(0,c.aI)(g,".pi"),A=(0,c.aI)(b,".ti"),y=(0,c.aI)(g,".wi"),C=(0,c.aI)(y,"._i"),L=(0,c.aI)(y,".aj"),I=(0,c.aI)(y,".bj");g.setAttribute("on-this-route",(0,p.xZ)(f.onThisRoute)),A.innerText=f.carNumber,C.innerText=`路線：${f.RouteName}`,L.innerText=`狀態：${f.status.text}`,I.innerText=`類型：${f.type}`}a.setAttribute("empty",(0,p.xZ)(0===d))}function m(e,t){var i=(0,c.aI)(e,".fi"),a=(0,c.aI)(i,".mi"),n=Array.from((0,c.jg)(a,".oi")),r=n.length,d=t.busArrivalTimes.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0;l>s;l--){var u=re();o.appendChild(u),n.push(u)}a.append(o)}else if(s>0)for(var v=r-1,m=r-s-1;v>m;v--)n[v].remove(),n.splice(v,1);for(var f=0;f<d;f++){var g=t.busArrivalTimes[f],b=n[f],A=(0,c.aI)(b,".qi"),y=(0,c.aI)(A,".ui"),C=(0,c.aI)(A,".vi"),L=(0,c.aI)(b,".xi");y.innerText=g.personalSchedule.name,C.innerText=`週${(0,h.kd)(g.day).name} ${(0,h.pn)(g.personalSchedule.period.start)} - ${(0,h.pn)(g.personalSchedule.period.end)}`,L.innerHTML=g.chart}a.setAttribute("empty",(0,p.xZ)(0===d))}function f(e,t){t&&e.setAttribute("stretched","false")}function A(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function y(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}function C(e,t){var i=(0,c.aI)(e,".fi"),a=(0,c.aI)(i,".gi"),n=(0,c.aI)(a,'.hi[type="save-to-folder"]');n.onclick=function(){(0,g.B)("stop",[t.stopId,t.routeId],n)},(0,r.LH)("stop",t.stopId).then(function(e){n.setAttribute("highlighted",(0,p.xZ)(e))})}function L(e,t){var i=(0,c.aI)(e,".fi"),a=(0,c.aI)(i,".gi"),n=(0,c.aI)(a,'.hi[type="schedule-notification"]');n.onclick=function(){(0,b.Ho)(n,t.stopId,t.routeId,t.status.time)};var r=(0,s.Zc)(t.stopId);n.setAttribute("highlighted",(0,p.xZ)(r))}null==n?(d(e,a,i),o(e,a,i),l(e,a),u(e,a),v(e,a),m(e,a),f(e,t),A(e,i),y(e,t),C(e,a),L(e,a)):(a.status.time!==n.status.time&&(d(e,a,i),L(e,a)),n.ranking.number===a.ranking.number&&n.ranking.code===a.ranking.code||o(e,a,i),n.stopId!==a.stopId&&(l(e,a),u(e,a),C(e,a)),(0,p.hw)(n.buses,a.buses)||v(e,a),(0,p.hw)(n.busArrivalTimes,a.busArrivalTimes)||m(e,a),i!==Z&&A(e,i),t!==j&&(f(e,t),y(e,t)))}function o(e,a,n){function r(e,t){var i=(0,c.aI)(e,".gh");(0,v.yD)(i,t.icon)}function d(e,t){(0,c.aI)(e,".hh").innerHTML=t.value}function s(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}null==n?(r(e,a),d(e,a),s(e,i),o(e,t)):((0,p.hw)(n.icon,a.icon)||r(e,a),(0,p.hw)(n.value,a.value)||d(e,a),i!==Z&&s(e,i),t!==j&&o(e,t))}var l=(0,m.gO)("window"),f=l.width,y=l.height,C=e.groupQuantity,_=e.itemQuantity,$=e.groupedItems,N=e.groups;P=C,Q=f;for(var Y=0,q=0;q<C;q++){var F=`g_${q}`,H=(0,u.q_)(N[F].name,500,"17px",'"Noto Sans TC", sans-serif')+20;D[F]={width:H,offset:Y},Y+=H}if(D[`g_${C}`]={width:0,offset:Y},!R){var z=D[`g_${M}`],B=-1*z.offset+.5*Q-.5*z.width,J=z.width-20;G(P,B,J,M)}(null===(a=S)||void 0===a?void 0:a.hash)!==e.hash&&(E.onclick=function(){(0,A.ID)(e.hash)}),(null===(n=S)||void 0===n?void 0:n.LocationName)!==e.LocationName&&(I.innerText=e.LocationName),Z!==i&&(L.setAttribute("animation",(0,p.xZ)(i)),w.setAttribute("animation",(0,p.xZ)(i))),j!==t&&(L.setAttribute("skeleton-screen",(0,p.xZ)(t)),w.setAttribute("skeleton-screen",(0,p.xZ)(t)),T.setAttribute("skeleton-screen",(0,p.xZ)(t)));var O=Array.from((0,c.jg)(x,".bh")),W=Array.from((0,c.jg)(k,".ug")),U=O.length;if(C!==U){var K=U-C;if(K<0){for(var X=new DocumentFragment,V=new DocumentFragment,de=0;de>K;de--){var se=te();X.appendChild(se),O.push(se);var oe=ie();V.appendChild(oe),W.push(oe)}x.append(X),k.append(V)}else if(K>0)for(var le=U-1,ce=U-K-1;le>ce;le--)O[le].remove(),O.splice(le,1),W[le].remove(),W.splice(le,1)}for(var ue=(0,c.jg)(x,".bh"),pe=0;pe<C;pe++){var he=`g_${pe}`,ve=ue[pe],me=(0,c.aI)(ve,".ch"),fe=(0,c.aI)(me,".dh"),ge=Array.from((0,c.jg)(fe,".fh")),be=ge.length,Ae=N[he].properties.length;if(Ae!==be){var ye=be-Ae;if(ye<0){for(var Ce=new DocumentFragment,Le=0;Le>ye;Le--){var Ie=ae();Ce.appendChild(Ie),ge.push(Ie)}fe.append(Ce)}else if(ye>0)for(var Ee=be-1,xe=be-ye-1;Ee>xe;Ee--)ge[Ee].remove(),ge.splice(Ee,1)}var we=(0,c.aI)(ve,".kh"),ke=Array.from((0,c.jg)(we,".lh")),Te=ke.length;if(_[he]!==Te){var _e=Te-_[he];if(_e<0){for(var $e=new DocumentFragment,Se=0;Se>_e;Se--){var Ze=ee();$e.appendChild(Ze),ke.push(Ze)}we.append($e)}else if(_e>0)for(var je=Te-1,Me=Te-_e-1;je>Me;je--)ke[je].remove(),ke.splice(je,1)}var Ne=W[pe];(0,c.aI)(Ne,"span").innerText=N[he].name,Ne.style.setProperty("--eg",`${D[he].offset}px`),Ne.style.setProperty("--fg",`${D[he].width}px`),Ne.style.setProperty("--vg",pe.toString());for(var Pe=0;Pe<Ae;Pe++){var De=N[he].properties[Pe],Qe=ge[Pe];if((0,p.mQ)(S,"groups"))if((0,p.mQ)(S.groups,he))if(S.groups[he].properties[Pe])o(Qe,De,S.groups[he].properties[Pe]);else o(Qe,De,null);else o(Qe,De,null);else o(Qe,De,null)}for(var Re=0;Re<_[he];Re++){var Ye=ke[Re],qe=$[he][Re];if((0,p.mQ)(S,"groupedItems"))if((0,p.mQ)(S.groupedItems,he))if(S.groupedItems[he][Re])d(Ye,qe,S.groupedItems[he][Re]);else d(Ye,qe,null);else d(Ye,qe,null);else d(Ye,qe,null)}}k.style.setProperty("--ig",`${Y}px`),S=e,Z=i,j=t}function se(){return oe.apply(this,arguments)}function oe(){return(oe=(0,a.A)(function*(){var e=(0,l.Js)("playing_animation"),t=(0,l.Js)("refresh_interval"),i=(0,m.gO)("location-bus-arrival-time-chart");H=t.dynamic,Y=t.baseInterval,O=!0,J=(0,p.zx)(),$.setAttribute("refreshing","true"),$.classList.remove("_g"),document.addEventListener(J,V);var a=yield(0,d.R)(K,i.width,i.height,J);de(a,!1,e);var r=0;H&&(r=yield(0,n.wz)()),z=(new Date).getTime(),B=H?Math.max(z+q,a.dataUpdateTime+Y/r):z+Y,F=Math.max(q,B-z),O=!1,$.setAttribute("refreshing","false"),$.style.setProperty("--lg",`${F}ms`),$.classList.add("_g")})).apply(this,arguments)}function le(){se().then(function(){W?setTimeout(function(){le()},Math.max(q,B-(new Date).getTime())):U=!1}).catch(function(e){W?((0,f.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){le()},1e4)):U=!1})}function ce(e){(0,m.WR)("Location"),(0,o.XK)("location",e),K=e,M=0,D={},y.setAttribute("displayed","true"),x.scrollLeft=0,x.focus(),function(e){for(var t=(0,l.Js)("playing_animation"),i=(0,m.gO)("window"),a=(i.width,i.height),n={g_0:Math.floor(a/50)+5,g_1:Math.floor(a/50)+5},r={},d=0;d<2;d++){var s=`g_${d}`;r[s]=[];for(var o=0;o<n[s];o++)r[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}de({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:n,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),W||(W=!0,U?se():(U=!0,le())),(0,m.Z_)()}function ue(){y.setAttribute("displayed","false"),W=!1,(0,m.l$)()}function pe(e,t){var i=(0,c.aI)(e,".fi"),a=(0,c.aI)(i,".gi"),n=(0,c.jg)(a,'.hi[highlighted="true"][type="tab"]');for(var r of n)r.setAttribute("highlighted","false");switch((0,c.aI)(a,`.hi[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,c.aI)(e,".li").setAttribute("displayed","true"),(0,c.aI)(e,".mi").setAttribute("displayed","false");break;case 1:(0,c.aI)(e,".li").setAttribute("displayed","false"),(0,c.aI)(e,".mi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=4a0129cc9b9e147d7e9e.js.map