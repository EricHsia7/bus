"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,i)=>{i.d(e,{Ch:()=>pt,S5:()=>et,SR:()=>vt,U7:()=>ft,aB:()=>it,aU:()=>ht,py:()=>mt});var n=i(7123),s=i(4537),r=i(6788),a=i(3459),o=i(8024),d=i(7968),u=i(3648),l=i(5767),c=i(9566),v=i(904),f=i(9119),p=i(5579),h=i(5314),m=i(4636);function b(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return g(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw r}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function y(t,e,i,n,s,r,a){try{var o=t[r](a),d=o.value}catch(t){return void i(t)}o.done?e(d):Promise.resolve(d).then(n,s)}var A=(0,u.bv)(".gk"),$=(0,u.aI)(A,".xl"),w=(0,u.aI)($,"._l"),I=(0,u.aI)($,".zl"),k=(0,u.aI)($,".gm .hm"),x=(0,u.aI)($,".am"),R=(0,u.aI)(x,".bm"),L=(0,u.aI)($,".em"),P=(0,u.aI)(L,".fm"),T=(0,u.aI)(A,".hk"),_={},S=!0,j=!1,E=0,Z=0,M=0,D={},C=0,B=!1,F=1e4,z=15e3,H=5e3,N=15e3,O=!0,q=!1,U=0,Q=0,J=!1,W="",K=-1,X=-1,G=!1,V=0,Y=[],tt=20;function et(){T.addEventListener("touchstart",(function(){E=Math.round(T.scrollLeft/C)}),{passive:!0}),T.addEventListener("scroll",(function(t){B=!0;var e=t.target.scrollLeft/C;Z=e>E?E+1:E-1;var i=D[`g_${E}`]||{width:0,offset:0},n=D[`g_${Z}`]||{width:0,offset:0},s=i.width+(n.width-i.width)*Math.abs(e-E),r=-1*(i.offset+(n.offset-i.offset)*Math.abs(e-E))+.5*C-.5*s;nt(M,r,s-tt,e),e===Z&&(E=Math.round(T.scrollLeft/C),B=!1)}),{passive:!0})}function it(){var t=(0,v.gO)("window"),e=t.width,i=t.height;A.style.setProperty("--dk",`${e}px`),A.style.setProperty("--ek",`${i}px`)}function nt(t,e,i,n){T.style.setProperty("--fk",t.toString()),P.style.setProperty("--vl",i.toString()),R.style.setProperty("--cm",`${e.toFixed(5)}px`),R.style.setProperty("--tl",n.toFixed(5))}function st(){var t=(new Date).getTime();J?(X=-1+(0,r._M)(W),K+=.1*(X-K)):(X=-1*Math.min(1,Math.max(0,Math.abs(t-U)/N)),K=X),k.style.setProperty("--z",K.toString()),window.requestAnimationFrame((function(){q&&st()}))}function rt(){var t=(0,o.zx)("i"),e=document.createElement("div");return e.classList.add("lm"),e.id=t,e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0"),e.innerHTML='<div class="qm"></div><div class="tm"><div class="ia" code="0"></div><div class="ja" code="0"></div></div>',{element:e,id:t}}function at(t){var e=(0,o.zx)("i"),i=document.createElement("div");return i.classList.add("wm"),i.id=e,i.setAttribute("stretched","false"),i.setAttribute("stretching","false"),i.setAttribute("push-direction","0"),i.setAttribute("push-state","0"),i.innerHTML=`<div class="xm"><div class="ym"></div><div class="zm"><div class="_m"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="an" onclick="bus.route.stretchRouteItem('${e}', '${t}')">${(0,s.Z)("keyboard_arrow_down")}</div><div class="bn"></div></div></div><div class="cn" displayed="false"><div class="dn"><div class="en" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 0)" code="0"><div class="fn">${(0,s.Z)("directions_bus")}</div>公車</div><div class="en" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 1)" code="1"><div class="fn">${(0,s.Z)("departure_board")}</div>抵達時間</div><div class="en" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 2)" code="2"><div class="fn">${(0,s.Z)("route")}</div>路線</div><div class="en" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-route', ['${e}', null, null])"><div class="fn">${(0,s.Z)("folder")}</div>儲存至資料夾</div><div class="en" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-route', ['${e}', null, null, null])" enabled="true"><div class="fn">${(0,s.Z)("notifications")}</div>設定到站通知</div></div><div class="gn" displayed="true"></div><div class="hn" displayed="false"></div><div class="in" displayed="false"></div></div>`,{element:i,id:e}}function ot(){var t=document.createElement("div");t.classList.add("ik");var e=document.createElement("div");e.classList.add("jk");var i=document.createElement("div");i.classList.add("kk");var n=document.createElement("div");n.classList.add("km");var s=document.createElement("div");s.classList.add("lk");var r=document.createElement("div");return r.classList.add("jn"),s.appendChild(r),i.appendChild(n),e.appendChild(i),e.appendChild(s),t.appendChild(e),{element:t,id:""}}function dt(t,e,i){function n(e,i,n,r,a,d){function l(t,e,i,n,s){var r=(0,u.aI)(e,".tm"),a=(0,u.aI)(r,".ja"),o=(0,u.aI)(r,".ia"),d=(0,u.aI)(t,"._m"),l=(0,u.aI)(d,".ja"),c=(0,u.aI)(d,".ia");if(o.setAttribute("code",i.status.code.toString()),c.setAttribute("code",i.status.code.toString()),c.innerText=i.status.text,!n&&s){var v=t.getBoundingClientRect(),f=v.top,p=v.left,h=v.bottom,m=v.right,b=window.innerWidth,g=window.innerHeight;if(h>0&&f<g&&m>0&&p<b)return a.addEventListener("animationend",(function(){a.setAttribute("code",i.status.code.toString()),a.classList.remove("_a")}),{once:!0}),l.addEventListener("animationend",(function(){l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text,l.classList.remove("_a")}),{once:!0}),a.classList.add("_a"),void l.classList.add("_a")}a.setAttribute("code",i.status.code.toString()),l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text}function v(t,e,i){t.setAttribute("segment-buffer",(0,o.xZ)(i.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,o.xZ)(i.segmentBuffer.isSegmentBuffer))}function f(t,e){(0,u.aI)(t,".ym").innerText=e.name}function h(t,e){(0,u.aI)(t,".gn").innerHTML=0===e.buses.length?'<div class="kn">目前沒有公車可顯示</div>':e.buses.map((function(t){return`<div class="ln" on-this-route="${t.onThisRoute}"><div class="mn"><div class="nn">${(0,s.Z)("directions_bus")}</div><div class="on">${t.carNumber}</div></div><div class="pn"><div class="qn">路線：${t.RouteName}</div><div class="rn">狀態：${t.status.text}</div><div class="sn">類型：${t.type}</div></div></div>`})).join("")}function b(t,e){(0,u.aI)(t,".hn").innerHTML=0===e.overlappingRoutes.length?'<div class="tn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return`<div class="un"><div class="vn"><div class="wn">${(0,s.Z)("route")}</div><div class="xn">${t.name}</div></div><div class="yn">${t.RouteEndPoints.html}</div><div class="zn"><div class="_n" onclick="bus.route.switchRoute(${t.RouteID}, [${t.PathAttributeId.join(",")}])">查看路線</div><div class="_n" onclick="bus.folder.openSaveToFolder('route-on-route', [${t.RouteID}])">收藏路線</div></div></div>`})).join("")}function g(t,e){(0,u.aI)(t,".in").innerHTML=0===e.busArrivalTimes.length?'<div class="ao">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return`<div class="bo"><div class="co"><div class="do">${(0,s.Z)("calendar_view_day")}</div><div class="eo">${t.personalSchedule.name}</div><div class="fo">週${(0,p.kd)(t.day).name} ${(0,p.pn)(t.personalSchedule.period.start)} - ${(0,p.pn)(t.personalSchedule.period.end)}</div></div><div class="go">${t.chart}</div></div>`})).join("")}function y(t,e,i){t.setAttribute("nearest",(0,o.xZ)(i.nearest)),e.setAttribute("nearest",(0,o.xZ)(i.nearest))}function A(t,e,i,n,s){var r=(null==i?void 0:i.progress)||0,a=(null==e?void 0:e.progress)||0,o=(0,u.aI)(t,".qm");if(!n&&s&&0!==r&&0===a&&Math.abs(a-r)>0)return o.style.setProperty("--om","100%"),o.style.setProperty("--pm","100%"),void o.addEventListener("transitionend",(function(){o.style.setProperty("--om","0%"),o.style.setProperty("--pm","0%")}),{once:!0});o.style.setProperty("--om","0%"),o.style.setProperty("--pm",100*a+"%")}function $(t,e,i){i&&((0,u.aI)(t,".cn").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function w(t,e,i){t.setAttribute("animation",(0,o.xZ)(i)),e.setAttribute("animation",(0,o.xZ)(i))}function I(t,e,i){t.setAttribute("skeleton-screen",(0,o.xZ)(i)),e.setAttribute("skeleton-screen",(0,o.xZ)(i))}function k(e,i){var n=(0,u.aI)(e,'.cn .dn .en[type="save-to-folder"]');n.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}])`),(0,c.LH)("stop",i.id).then((function(t){n.setAttribute("highlighted",(0,o.xZ)(t))}))}function x(e,i){var n=(0,u.aI)(e,'.cn .dn .en[type="schedule-notification"]');n.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}, ${i.status.time}])`);var s=(0,m.Zc)(i.id);n.setAttribute("highlighted",(0,o.xZ)(s))}null===r?(l(e,i,n,a,d),f(e,n),h(e,n),b(e,n),g(e,n),v(e,i,n),y(e,i,n),A(i,n,r,a,d),$(e,i,a),w(e,i,d),I(e,i,a),k(e,n),x(e,n)):(n.status.time!==r.status.time&&(l(e,i,n,a,d),x(e,n)),(0,o.hw)(r.buses,n.buses)||h(e,n),(0,o.hw)(r.busArrivalTimes,n.busArrivalTimes)||g(e,n),(0,o.hw)(r.segmentBuffer,n.segmentBuffer)||v(e,i,n),r.nearest!==n.nearest&&y(e,i,n),r.progress!==n.progress&&A(i,n,r,a,d),r.id!==n.id&&(f(e,n),b(e,n),k(e,n),x(e,n)),d!==S&&w(e,i,d),a!==j&&($(e,i,a),I(e,i,a)))}var r=(0,v.gO)("window"),a=r.width,l=r.height,f=t.groupQuantity,h=t.itemQuantity,b=t.groupedItems;M=f,C=a;for(var g=0,y=0;y<f;y++){var A=(0,d.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`往${t}`}))[y],500,"17px",'"Noto Sans TC", sans-serif')+tt;D[`g_${y}`]={width:A,offset:g},g+=A}var $=-1*D[`g_${E}`].offset+.5*C-.5*D[`g_${E}`].width;B||nt(M,$,D[`g_${E}`].width-tt,E),w.innerHTML=`<span>${t.RouteName}</span>`,w.setAttribute("animation",(0,o.xZ)(i)),w.setAttribute("skeleton-screen",(0,o.xZ)(e)),x.setAttribute("animation",(0,o.xZ)(i)),x.setAttribute("skeleton-screen",(0,o.xZ)(e)),L.setAttribute("animation",(0,o.xZ)(i)),L.setAttribute("skeleton-screen",(0,o.xZ)(e)),I.setAttribute("onclick",`bus.route.openRouteDetails(${t.RouteID}, [${t.PathAttributeId.join(",")}])`);var k,P,Z=(0,u.jg)(T,".ik").length;if(f!==Z){var F=Z-f;if(F<0){for(var z=new DocumentFragment,H=new DocumentFragment,N=0;N<Math.abs(F);N++){var O=ot();z.appendChild(O.element);var q=(k=void 0,P=void 0,k=(0,o.zx)("t"),(P=document.createElement("div")).classList.add("dm"),P.id=k,{element:P,id:k});H.appendChild(q.element)}T.append(z),R.append(H)}else for(var U=(0,u.jg)(T,".ik"),Q=(0,u.jg)(R,".dm"),J=0;J<Math.abs(F);J++){var W=Z-1-J;U[W].remove(),Q[W].remove()}}for(var K=(0,u.jg)(T,".ik"),X=0;X<f;X++){var G=`g_${X}`,V=K[X],Y=(0,u.aI)(V,".lk"),et=(0,u.aI)(V,".kk"),it=(0,u.jg)(Y,".wm").length;if(h[G]!==it){var st=it-h[G];if(st<0){for(var dt=new DocumentFragment,ut=new DocumentFragment,lt=0;lt<Math.abs(st);lt++){var ct=rt(),vt=at(ct.id);dt.appendChild(vt.element),ut.appendChild(ct.element)}Y.append(dt),et.append(ut)}else for(var ft=(0,u.jg)(Y,".wm"),pt=(0,u.jg)(et,".lm"),ht=0;ht<Math.abs(st);ht++){var mt=it-1-ht;ft[mt].remove(),pt[mt].remove()}}}for(var bt=(0,u.jg)(R,".dm"),gt=0;gt<f;gt++){var yt=`g_${gt}`,At=bt[gt];At.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`<span>往${t}</span>`}))[gt],At.style.setProperty("--wl",`${D[yt].width}px`),At.style.setProperty("--ul",gt.toString());for(var $t=K[gt],wt=(0,u.aI)($t,".lk"),It=(0,u.aI)($t,".kk"),kt=(0,u.jg)(wt,".wm"),xt=(0,u.jg)(It,".lm"),Rt=0;Rt<h[yt];Rt++){var Lt=kt[Rt],Pt=xt[Rt],Tt=b[yt][Rt];if(_.hasOwnProperty("groupedItems"))if(_.groupedItems.hasOwnProperty(yt))if(_.groupedItems[yt][Rt])n(Lt,Pt,Tt,_.groupedItems[yt][Rt],e,i);else n(Lt,Pt,Tt,null,e,i);else n(Lt,Pt,Tt,null,e,i);else n(Lt,Pt,Tt,null,e,i)}}_=t,S=i,j=e}function ut(){return lt.apply(this,arguments)}function lt(){var t;return t=function*(){var t=(0,a.Js)("playing_animation"),e=(0,a.Js)("refresh_interval"),i=(0,v.gO)("route-bus-arrival-time-chart");O=e.dynamic,z=e.baseInterval,J=!0,W=(0,o.zx)("r"),k.setAttribute("refreshing","true");var s=yield(0,n.R)(V,Y,i.width,i.height,W);dt(s,!1,t);var r=0;O&&(r=yield(0,l.wz)()),U=(new Date).getTime(),Q=O?Math.max(U+H,s.dataUpdateTime+z/r):U+z,N=Math.max(H,Q-U),J=!1,k.setAttribute("refreshing","false")},lt=function(){var e=this,i=arguments;return new Promise((function(n,s){var r=t.apply(e,i);function a(t){y(r,n,s,a,o,"next",t)}function o(t){y(r,n,s,a,o,"throw",t)}a(void 0)}))},lt.apply(this,arguments)}function ct(){ut().then((function(){q?setTimeout((function(){ct()}),Math.max(H,Q-(new Date).getTime())):G=!1})).catch((function(t){console.error(t),q?((0,f.a)(`（路線）發生網路錯誤，將在${F/1e3}秒後重試。`,"error"),setTimeout((function(){ct()}),F)):G=!1}))}function vt(t,e){(0,v.WR)("Route"),(0,h.XK)("route",t),V=t,Y=e,E=0,A.setAttribute("displayed","true"),(0,u.aI)(A,".hk").scrollLeft=0,function(){for(var t=(0,a.Js)("playing_animation"),e=(0,v.gO)("window"),i=(e.width,e.height),n=Math.floor(i/50)+5,s={},r=0;r<2;r++){var o=`g_${r}`;s[o]=[];for(var d=0;d<n;d++)s[o].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],sequence:d,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}dt({groupedItems:s,groupQuantity:2,itemQuantity:{g_0:n,g_1:n},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),q||(q=!0,G?ut():(G=!0,ct()),K=-1,X=-1,st()),(0,v.Z_)()}function ft(){A.setAttribute("displayed","false"),q=!1,K=-1,X=-1,(0,v.l$)()}function pt(t,e){q=!1,K=-1,X=-1,vt(t,e)}function ht(t,e){var i=(0,u.bv)(`.gk .hk .ik .jk .lk .wm#${t}`),n=(0,u.aI)(i,".cn"),s=(0,u.bv)(`.gk .hk .ik .jk .kk .lm#${e}`),r=i.parentElement,a=s.parentElement,o=r.parentElement,d=(0,u.ji)(s,"lm"),l=(0,u.ji)(i,"wm"),c=l.length,v=r.getBoundingClientRect(),f=i.getBoundingClientRect(),p=a.getBoundingClientRect(),h=s.getBoundingClientRect(),m=o.scrollLeft,b=o.scrollTop,g=h.left-p.left+m,y=h.top-p.top+b,A=f.left-v.left+m,$=f.top-v.top+b,w="true"===i.getAttribute("stretched"),I="true"===i.getAttribute("animation");if(I){var k=w?"2":"1";s.setAttribute("stretching","true"),s.style.setProperty("--im",`${g}px`),s.style.setProperty("--jm",`${y}px`),i.setAttribute("stretching","true"),i.style.setProperty("--ho",`${A}px`),i.style.setProperty("--io",`${$}px`);for(var x=0;x<c;x++){var R=l[x],L=d[x];L.setAttribute("push-direction",k),L.setAttribute("push-state","1"),R.setAttribute("push-direction",k),R.setAttribute("push-state","1")}i.addEventListener("transitionend",(function(){for(var t=0;t<c;t++){var e=l[t],n=d[t];n.setAttribute("push-direction","0"),n.setAttribute("push-state","0"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0")}i.setAttribute("stretching","false")}),{once:!0}),i.addEventListener("transitionstart",(function(){for(var t=0;t<c;t++){var e=l[t];d[t].setAttribute("push-state","2"),e.setAttribute("push-state","2")}}),{once:!0})}w?(I?n.addEventListener("transitionend",(function(){n.setAttribute("displayed","false")}),{once:!0}):n.setAttribute("displayed","false"),i.setAttribute("stretched","false"),s.setAttribute("stretched","false")):(n.setAttribute("displayed","true"),i.setAttribute("stretched","true"),s.setAttribute("stretched","true"))}function mt(t,e){var i,n=(0,u.aI)(T,`.wm#${t}`),s=(0,u.aI)(n,".dn"),r=b((0,u.jg)(s,'.en[highlighted="true"][type="tab"]'));try{for(r.s();!(i=r.n()).done;){i.value.setAttribute("highlighted","false")}}catch(t){r.e(t)}finally{r.f()}switch((0,u.aI)(s,`.en[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,u.aI)(n,".gn").setAttribute("displayed","true"),(0,u.aI)(n,".hn").setAttribute("displayed","false"),(0,u.aI)(n,".in").setAttribute("displayed","false");break;case 1:(0,u.aI)(n,".gn").setAttribute("displayed","false"),(0,u.aI)(n,".hn").setAttribute("displayed","false"),(0,u.aI)(n,".in").setAttribute("displayed","true");break;case 2:(0,u.aI)(n,".gn").setAttribute("displayed","false"),(0,u.aI)(n,".hn").setAttribute("displayed","true"),(0,u.aI)(n,".in").setAttribute("displayed","false")}}}}]);
//# sourceMappingURL=ba9e7fd1715ffe339f3c.js.map