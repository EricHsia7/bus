"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[767],{5976(t,e,n){n.d(e,{a:()=>s});var r=n(467),i=n(9566),a=n(5352),o=n(5314),u=n(3459);function s(){return f.apply(this,arguments)}function f(){return(f=(0,r.a)(function*(){var t=yield(0,i.i)(),e=(0,u.e)(),n=yield(0,a.d)(),r=yield(0,o.d)(),s={};return s.time=(new Date).toISOString(),s.version=4,s.folders=t,s.settings=e,s.personal_schedules=n,s.recent_views=r,JSON.stringify(s)})).apply(this,arguments)}},9566(t,e,n){n.d(e,{a:()=>$,b:()=>N,c:()=>_,d:()=>q,e:()=>C,f:()=>A,g:()=>I,h:()=>L,i:()=>x,j:()=>J,k:()=>U,l:()=>V,m:()=>K,n:()=>G,o:()=>R,p:()=>X,q:()=>O});var r=n(3453),i=n(2284),a=n(467),o=n(8024),u=n(6483),s=n(5767),f=n(2063),p=n(8011),d=n(9218),l=n(4293),c=n(424),y=n(2303),v=n(6788),m=n(3459),h=n(4311),g={};function _(){return b.apply(this,arguments)}function b(){return(b=(0,a.a)(function*(){var t=yield(0,h.e)(11);for(var e of t){var n=yield(0,h.d)(11,e);if(n){var r=JSON.parse(n);(0,o.f)(g,e)||(g[e]=r)}}})).apply(this,arguments)}function $(t,e){return S.apply(this,arguments)}function S(){return(S=(0,a.a)(function*(t,e){var n=(0,o.c)(),r=yield(0,d.a)(n);if((0,v.a)(n),!(0,o.f)(r.symbols,e))return!1;var i=(0,o.c)(),a=`f_${i}`;if((0,o.f)(g,a))return!1;if(yield(0,h.d)(11,a))return!1;var u={name:t,icon:e,id:i,timestamp:(new Date).getTime()};return g[a]=u,yield(0,h.g)(11,a,JSON.stringify(u)),yield(0,h.g)(12,a,JSON.stringify([])),i})).apply(this,arguments)}function O(t,e,n){return k.apply(this,arguments)}function k(){return(k=(0,a.a)(function*(t,e,n){var r=`f_${t}`,i=yield(0,h.d)(11,r);if(!i)return!1;var a=JSON.parse(i),u=(0,o.c)(),s=yield(0,d.a)(u);if((0,v.a)(u),!(0,o.f)(s.symbols,n))return!1;var f={name:e,icon:n,id:t,timestamp:a.timestamp};return g[r]=f,yield(0,h.g)(11,r,JSON.stringify(f)),!0})).apply(this,arguments)}function N(t){var e=`f_${t}`;return!!(0,o.f)(g,e)&&{name:g[e].name,icon:g[e].icon,id:g[e].id,timestamp:g[e].timestamp}}function J(){var t=[];for(var e in g){var n={name:g[e].name,icon:g[e].icon,id:g[e].id,timestamp:g[e].timestamp};t.push(n)}return t.sort(function(t,e){return t.timestamp-e.timestamp}),t}function I(t){return w.apply(this,arguments)}function w(){return(w=(0,a.a)(function*(t){var e=[],n=`f_${t}`,r=N(t);if("boolean"==typeof r&&!1===r)return e;var i=yield(0,h.d)(12,n);if(!i)return e;var a=JSON.parse(i);if(0===a.length){return e.push({type:"empty",id:0}),e}for(var o of a){var u=yield(0,h.d)(13,o);if(u){var s=JSON.parse(u);e.push(s)}}return e})).apply(this,arguments)}function D(t){return T.apply(this,arguments)}function T(){return(T=(0,a.a)(function*(t){var e=`f_${t}`,n=yield(0,h.d)(12,e);return n?JSON.parse(n).length:0})).apply(this,arguments)}function x(){return E.apply(this,arguments)}function E(){return(E=(0,a.a)(function*(){var t=J(),e=[];for(var n of t){var r=yield I(n.id),i=yield D(n.id);e.push({name:n.name,icon:n.icon,id:n.id,timestamp:n.timestamp,content:r,contentLength:i})}return e})).apply(this,arguments)}function L(){return B.apply(this,arguments)}function B(){return(B=(0,a.a)(function*(){var t=J(),e=[];for(var n of t){var r=yield D(n.id);e.push({name:n.name,icon:n.icon,id:n.id,timestamp:n.timestamp,contentLength:r})}return e})).apply(this,arguments)}function A(t){return P.apply(this,arguments)}function P(){return(P=(0,a.a)(function*(t){var e=!0;"object"===(0,i.a)(t)&&Array.isArray(t)||(e=!1);var n=[],r=yield(0,h.e)(13);for(var a of r){var o=yield(0,h.d)(13,a);if(o){var u=JSON.parse(o);e?t.indexOf(u.type)>-1&&n.push(u):n.push(u)}}return n})).apply(this,arguments)}function q(t){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.a)(function*(t){(0,v.f)(t,"getEstimateTime_0",0,!1),(0,v.f)(t,"getEstimateTime_1",0,!1),(0,v.f)(t,"getRoute_0",0,!1),(0,v.f)(t,"getRoute_1",0,!1);var e=yield Promise.all([x(),(0,l.a)(t,!0),(0,f.a)(t)]),n=(0,r.a)(e,3),i=n[0],a=n[1],p=n[2],d=(0,m.b)("time_formatting_mode"),c=(0,m.b)("power_saving"),h=(0,m.b)("refresh_interval"),g=[];for(var _ of i)for(var b=0,$=_.content.length;b<$;b++)"stop"===_.content[b].type&&g.push(_.content[b].id);var S={};for(var O of p){if(g.indexOf(O.StopID)>-1)S[`s_${O.StopID}`]=O}var k=[];for(var N of i){var J={name:N.name,icon:N.icon,id:N.id,timestamp:N.timestamp,content:[],contentLength:N.contentLength};for(var I of N.content){var w=I;switch(w.type){case"stop":var D=`s_${w.id}`,T={};if(!(0,o.f)(S,D))break;T=S[D],w.status=(0,y.g)(T.EstimateTime,d);var E=a[`r_${w.route.id}`];w.route.pathAttributeId=E.pid;break;case"route":var L=a[`r_${w.id}`];w.pathAttributeId=L.pid}J.content.push(w)}k.push(J)}var B={folders:k,dataUpdateTime:(0,v.e)(t)};return(0,v.a)(t),(0,v.b)(t),c||(h.dynamic&&(yield(0,s.a)(p)),yield(0,u.a)(p)),B})).apply(this,arguments)}function R(t,e){return j.apply(this,arguments)}function j(){return(j=(0,a.a)(function*(t,e){var n=`f_${t}`,r=`${e.type}_${e.id}`,i=N(t);if("boolean"==typeof i&&!1===i)return!1;var a=yield(0,h.d)(12,n);if(!a)return!1;var o=JSON.parse(a);return(0===o.length||o.indexOf(r)<0)&&(o.push(r),yield(0,h.g)(12,n,JSON.stringify(o)),yield(0,h.g)(13,r,JSON.stringify(e)),!0)})).apply(this,arguments)}function C(t,e){return F.apply(this,arguments)}function F(){return(F=(0,a.a)(function*(t,e){var n=`${t}_${e}`,r=yield(0,h.e)(12);for(var i of r){var a=yield(0,h.d)(12,i);if(a)if(JSON.parse(a).indexOf(n)>-1)return!0}return!1})).apply(this,arguments)}function U(t,e,n){return z.apply(this,arguments)}function z(){return(z=(0,a.a)(function*(t,e,n){var r=`f_${t}`,i=`${e}_${n}`,a=N(t);if("boolean"==typeof a&&!1===a)return!1;var o=yield(0,h.d)(12,r);if(!o)return!1;var u=JSON.parse(o),s=u.indexOf(i);return s>-1&&u.length>0&&(u.splice(s,1),yield(0,h.g)(12,r,JSON.stringify(u))),!1===(yield C(e,n))&&(yield(0,h.f)(13,i)),!0})).apply(this,arguments)}function G(t,e,n){return H.apply(this,arguments)}function H(){return(H=(0,a.a)(function*(t,e,n){var r=(0,o.c)(),i=yield(0,c.a)(r),a=yield(0,p.a)(r,0),u=yield(0,l.a)(r,!0),s=i[`s_${e}`],f=parseInt(s.goBack),d=a[`l_${s.stopLocationId}`].n,y=u[`r_${n}`],v=y.n,m=y.dep,h=y.des,g={type:"stop",id:e,timestamp:(new Date).getTime(),name:d,direction:f,route:{name:v,endPoints:{departure:m,destination:h},id:n}};return yield R(t,g)})).apply(this,arguments)}function K(t,e){return M.apply(this,arguments)}function M(){return(M=(0,a.a)(function*(t,e){var n=(0,o.c)(),r=yield(0,l.a)(n,!0);(0,v.a)(n),(0,v.b)(n);var i=`r_${e}`,a={};if(!(0,o.f)(r,i))return!1;a=r[i];var u={type:"route",id:e,timestamp:(new Date).getTime(),name:a.n,endPoints:{departure:a.dep,destination:a.des}};return yield R(t,u)})).apply(this,arguments)}function V(t,e){return W.apply(this,arguments)}function W(){return(W=(0,a.a)(function*(t,e){var n=(0,o.c)(),r=yield(0,p.a)(n,1);(0,v.a)(n),(0,v.b)(n);var i=`ml_${e}`,a={};if(!(0,o.f)(r,i))return!1;a=r[i];var u={type:"location",id:e,timestamp:(new Date).getTime(),name:a.n};return yield R(t,u)})).apply(this,arguments)}function X(t,e,n,r){return Y.apply(this,arguments)}function Y(){return(Y=(0,a.a)(function*(t,e,n,r){var i=`f_${t}`,a=`${e}_${n}`,o=N(t);if("boolean"==typeof o&&!1===o)return!1;var u=yield(0,h.d)(12,i);if(!u)return!1;var s=JSON.parse(u),f=s.indexOf(a);if(f>-1&&s.length>1){var p=0;switch(r){case"up":p=-1;break;case"down":p=1;break;default:p=0}return s.splice(f,1),s.splice(f+p,0,a),yield(0,h.g)(12,i,JSON.stringify(s)),!0}return!1})).apply(this,arguments)}},5427(t,e,n){n.d(e,{a:()=>m});var r=n(467),i=n(9566),a=n(5352),o=n(5314),u=n(3459),s=n(4311);function f(t){return p.apply(this,arguments)}function p(){return(p=(0,r.a)(function*(t){for(var e of t){var n=e,r=!1,a=!1,o=`f_${n.id}`;if((yield(0,s.d)(11,o))?r=yield(0,i.q)(n.id,n.name,n.icon):a=yield(0,i.a)(n.name,n.icon),r)for(var u of e.content)yield(0,i.o)(e.id,u);if(a)for(var f of e.content)yield(0,i.o)(a,f)}})).apply(this,arguments)}function d(t){return l.apply(this,arguments)}function l(){return(l=(0,r.a)(function*(t){for(var e of t){var n=(0,u.c)(e.key);n&&"select"===n.type&&(yield(0,u.a)(e.key,e.option))}return!0})).apply(this,arguments)}function c(t){return y.apply(this,arguments)}function y(){return(y=(0,r.a)(function*(t){for(var e of t){(yield(0,a.b)(e.id))?yield(0,a.e)(e):yield(0,a.a)(e.name,e.period.start.hours,e.period.start.minutes,e.period.end.hours,e.period.end.minutes,e.days)}return!0})).apply(this,arguments)}function v(){return(v=(0,r.a)(function*(t){for(var e of t)switch(e.type){case"route":(yield(0,o.b)("route",e.id))||(yield(0,o.e)(e.type,e.id));break;case"location":(yield(0,o.b)("location",e.hash))||(yield(0,o.e)(e.type,e.hash));break;case"bus":(yield(0,o.b)("bus",e.id))||(yield(0,o.e)(e.type,e.id))}return!0})).apply(this,arguments)}function m(t){return h.apply(this,arguments)}function h(){return h=(0,r.a)(function*(t){var e=JSON.parse(t);switch(e.version){case 1:return yield f(e.folders),!0;case 2:return yield f(e.folders),yield d(e.settings),!0;case 3:return yield f(e.folders),yield d(e.settings),yield c(e.personal_schedules),!0;case 4:return yield f(e.folders),yield d(e.settings),yield c(e.personal_schedules),yield function(t){return v.apply(this,arguments)}(e.recent_views),!0;default:return!1}}),h.apply(this,arguments)}},6983(t,e,n){n.d(e,{a:()=>f});var r=n(467),i=n(1351),a=n(3041),o=n(8024),u=n(8011),s=n(6788);function f(t,e){return p.apply(this,arguments)}function p(){return(p=(0,r.a)(function*(t,e){var n=yield(0,u.a)(e,1);(0,s.a)(e),(0,s.b)(e);var r=`ml_${t}`;if(!(0,o.f)(n,r))return{actions:[],actionsQuantity:0,hash:t};n[r];var f=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,a.c)("location",[t],null)}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,i.d)(t)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,i.f)(t)}}];return{actions:f,actionsQuantity:f.length,hash:t}})).apply(this,arguments)}},2757(t,e,n){n.d(e,{a:()=>S});var r=n(3453),i=n(467),a=n(4256),o=n(574),u=n(8024),s=n(2945),f=n(5428),p=n(6483),d=n(6802),l=n(7810),c=n(2063),y=n(8011),v=n(4293),m=n(424),h=n(2303),g=n(6788),_=n(3459),b=n(1238);function $(t,e){var n={},r=[];for(var i in t){var a=t[i],o=a.StopID,u=parseInt(a.EstimateTime);u>=0&&e.indexOf(o)>-1&&r.push([o,u])}var s=r.length;r.sort(function(t,e){return t[1]-e[1]});var f=1;for(var p of r){var d=f/s,l=(d-d%.25)/.25;n[`s_${p[0]}`]={number:f,text:f.toString(),code:l},f+=1}return n}function S(t,e,n,r){return O.apply(this,arguments)}function O(){return(O=(0,i.a)(function*(t,e,n,i){(0,g.f)(i,"getLocation_0",0,!1),(0,g.f)(i,"getLocation_1",0,!1),(0,g.f)(i,"getRoute_0",0,!1),(0,g.f)(i,"getRoute_1",0,!1),(0,g.f)(i,"getStop_0",0,!1),(0,g.f)(i,"getStop_1",0,!1),(0,g.f)(i,"getEstimateTime_0",0,!1),(0,g.f)(i,"getEstimateTime_1",0,!1),(0,g.f)(i,"getBusEvent_0",0,!1),(0,g.f)(i,"getBusEvent_1",0,!1),(0,g.f)(i,"getBusData_0",0,!1),(0,g.f)(i,"getBusData_1",0,!1);for(var S=yield Promise.all([yield(0,v.a)(i,!0),yield(0,m.a)(i),yield(0,y.a)(i,1)]),O=(0,r.a)(S,3),k=O[0],N=O[1],J=O[2],I=yield Promise.all([(0,c.a)(i),(0,l.a)(i),(0,d.a)(i),(0,p.b)(e,n)]),w=(0,r.a)(I,4),D=w[0],T=w[1],x=w[2],E=w[3],L=(0,_.b)("time_formatting_mode"),B=(0,_.b)("location_labels"),A=(0,_.b)("display_user_orientation"),P={},q={},Q={},R=(0,b.b)(),j=J[`ml_${t}`],C=j.n,F=j.id,U=j.v,z=[],G=[],H=F.length,K=0;K<H;K++)for(var M=0,V=j.s[K].length;M<V;M++)z.push(j.s[K][M]),G.push(j.r[K][M]);var W=function(t,e){var n={};for(var r of t)e.indexOf(r.StopID)>-1&&(n[`s_${r.StopID}`]=r);return n}(D,z),X=(0,h.a)(T,x,k,z),Y=[];for(var Z of U){var tt=0,et=0;for(var nt of Z)tt+=nt[0],et+=nt[1];var rt=(0,f.d)([tt,et]),it=(0,o.b)(rt);Y.push(it)}var at=[];switch(B){case"address":at=(0,a.b)(j.a);break;case"letters":at=(0,s.b)(H);break;case"directions":at=(0,s.a)(Y)}for(var ot=0;ot<H;ot++){var ut=`g_${ot}`;P[ut]=[],q[ut]=0,Q[ut]={name:at[ot],properties:[{key:"address",icon:"personal_places",value:(0,a.a)(j.a[ot])},{key:"exact_position",icon:"location_on",value:`${j.la[ot].toFixed(5)}, ${j.lo[ot].toFixed(5)}`},{key:"cardinal_direction",icon:Y[ot].icon,value:`${Y[ot].name}${A&&-1!==R.cardinalDirection.id&&R.cardinalDirection.id===Y[ot].id?"（目前指向）":""}`}]};for(var st=j.s[ot],ft=st.length,pt=$(W,st),dt=0;dt<ft;dt++){var lt={},ct=j.s[ot][dt],yt=`s_${ct}`,vt={};if((0,u.f)(N,yt)){vt=N[yt],lt.stopId=ct;var mt={number:0,text:"--",code:-1};(0,u.f)(pt,yt)&&(mt=pt[yt]),lt.ranking=mt;var ht=j.r[ot][dt],gt=`r_${ht}`,_t={};if((0,u.f)(k,gt)){_t=k[gt],lt.route_name=_t.n,lt.route_direction=`往${[_t.des,_t.dep,""][parseInt(vt.goBack)]}`,lt.routeId=ht;var bt={};if((0,u.f)(W,yt)){bt=W[yt];var $t=(0,h.g)(bt.EstimateTime,L);lt.status=$t;var St=[];(0,u.f)(X,yt)&&(St=X[yt].map(function(t){return(0,h.c)(t)})),lt.buses=St;var Ot=[];(0,u.f)(E,yt)&&(Ot=E[yt]),lt.busArrivalTimes=Ot,P[ut].push(lt),q[ut]+=1}}}}}for(var kt in P)P[kt].sort(function(t,e){return t.routeId-e.routeId});var Nt={groupedItems:P,groups:Q,groupQuantity:H,itemQuantity:q,LocationName:C,hash:t,dataUpdateTime:(0,g.e)(i)};return(0,g.a)(i),(0,g.b)(i),Nt})).apply(this,arguments)}}}]);
//# sourceMappingURL=d1029fcc0e039e30ec3a.js.map