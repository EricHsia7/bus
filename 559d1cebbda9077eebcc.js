"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[374],{6483(e,t,a){a.d(t,{a:()=>M,b:()=>U,c:()=>J});var r,i=a(467),n=a(3453),s=a(8024),o=a(5428),f=a(9566),p=a(5352),d=a(4311),u="",m=!1,l=[],v={data:{},timestamp:0,id:""},y=0,c={};if("undefined"!=typeof SharedWorker){var g=new SharedWorker(new URL(a.p+a.u(611),a.b));(r=g.port).start()}else{var h=new Worker(new URL(a.p+a.u(611),a.b));r=h}function w(e){return S.apply(this,arguments)}function S(){return(S=(0,i.a)(function*(e){var t=(0,s.c)();return yield new Promise(function(a,i){c[t]=a,r.onerror=function(e){i(e.message)},r.postMessage([e,t])})})).apply(this,arguments)}function _(e,t){for(var a=new Uint32Array(1440),r=1439;r>=0;r--)a[r]=e[r]+t[r];return Array.from(a)}function M(e){return O.apply(this,arguments)}function O(){return(O=(0,i.a)(function*(e){var t=new Date,a=t.getTime(),r=t.getDay(),i=!1;if(!m){m=!0,u=(0,s.c)(),v={id:u,timestamp:a,data:{}},y=0;var n=yield(0,f.f)(["stop"]);l=n.map(function(e){return e.id})}if((0,p.c)(t)){for(var c of e){var g=c.StopID,h=`s_${g}_${r}`;l.indexOf(g)>-1&&((0,s.f)(v.data,h)||(v.data[h]=[]),v.data[h].push([parseInt(c.EstimateTime),a]))}if((y+=1)>32&&(i=!0),(i||y%8==0)&&(yield(0,d.g)(5,u,JSON.stringify(v))),i){for(var S of l){var M=`s_${S}_${r}`,O=v.data[M],J={},N=yield(0,d.d)(6,M);if(N){var b=JSON.parse(N),D=yield w(O),k=_(b.stats,D);J.stats=k;var x=(0,o.a)(k);J.min=x[0],J.max=x[1],J.day=r,J.timestamp=b.timestamp,J.id=S}else{var T=yield w(O);J.stats=T;var U=(0,o.a)(T);J.min=U[0],J.max=U[1],J.day=r,J.timestamp=a,J.id=S}yield(0,d.g)(6,M,JSON.stringify(J)),yield(0,d.f)(5,u)}m=!1}}})).apply(this,arguments)}function J(){return N.apply(this,arguments)}function N(){return(N=(0,i.a)(function*(){var e=yield(0,d.e)(5);for(var t of e){var a=yield(0,d.d)(5,t),r=JSON.parse(a),i=r.id;for(var n in r.data){var s=r.data[n],f={},p=yield(0,d.d)(6,n),u=n.split("_"),m=parseInt(u[1]),l=parseInt(u[2]);if(p){var v=JSON.parse(p),y=yield w(s),c=_(v.stats,y);f.stats=c;var g=(0,o.a)(c);f.min=g[0],f.max=g[1],f.day=v.day,f.timestamp=v.timestamp,f.id=m}else{var h=yield w(s);f.stats=h;var S=(0,o.a)(h);f.min=S[0],f.max=S[1],f.day=l,f.timestamp=r.timestamp,f.id=m}yield(0,d.g)(6,n,JSON.stringify(f))}yield(0,d.f)(5,i)}})).apply(this,arguments)}function b(){return(b=(0,i.a)(function*(){var e=yield(0,d.e)(6),t=[];for(var a of e){var r=yield(0,d.d)(6,a);r&&t.push(JSON.parse(r))}return t})).apply(this,arguments)}r.onmessage=function(e){var t=(0,n.a)(e.data,2),a=t[0],r=t[1];c[r]&&(c[r](a),delete c[r])},r.onerror=function(e){};var D,k={};if("undefined"!=typeof SharedWorker){var x=new SharedWorker(new URL(a.p+a.u(525),a.b));(D=x.port).start()}else{var T=new Worker(new URL(a.p+a.u(525),a.b));D=T}function U(e,t){return W.apply(this,arguments)}function W(){return W=(0,i.a)(function*(e,t){var a=(0,s.c)(),r=yield(0,p.d)(),i=yield function(){return b.apply(this,arguments)}();return yield new Promise(function(n,s){k[a]=n,D.onerror=function(e){s(e.message)},D.postMessage([r,i,e,t,a])})}),W.apply(this,arguments)}D.onmessage=function(e){var t=(0,n.a)(e.data,2),a=t[0],r=t[1];k[r]&&(k[r](a),delete k[r])},D.onerror=function(e){}},8925(e,t,a){a.d(t,{b:()=>p,c:()=>u,d:()=>s});var r=a(467),i=a(5579),n=a(4311);function s(e,t){return o.apply(this,arguments)}function o(){return(o=(0,r.a)(function*(e,t){var a=`d_${(0,i.c)(t,"YYYY_MM_DD")}`,r=60*t.getHours()+t.getMinutes(),s=yield(0,n.d)(2,a);if(s){var o=JSON.parse(s);o.stats.sum+=e,o.data[r]+=e;var f=o.data[r];f>o.stats.max&&(o.stats.max=f),f<o.stats.min&&(o.stats.min=f),yield(0,n.g)(2,a,JSON.stringify(o))}else{var p={},d=new Uint32Array(1440);d[r]+=e,p.data=Array.from(d),p.stats={sum:e,max:e,min:0},p.date=[t.getFullYear(),t.getMonth()+1,t.getDate()],yield(0,n.g)(2,a,JSON.stringify(p))}})).apply(this,arguments)}function f(){return(f=(0,r.a)(function*(){var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);for(var t=(0,i.f)(e,-7,0,0),a=[],r=1;r<=7;r++){var s=(0,i.f)(t,r,0,0),o=`d_${(0,i.c)(s,"YYYY_MM_DD")}`,f=yield(0,n.d)(2,o);if(f){var p=JSON.parse(f);a.push(p)}else{var d={},u=new Uint32Array(1440);d.data=Array.from(u),d.stats={sum:0,max:0,min:0},d.date=[s.getFullYear(),s.getMonth()+1,s.getDate()],a.push(d)}}return a})).apply(this,arguments)}function p(){return d.apply(this,arguments)}function d(){return(d=(0,r.a)(function*(){var e=(new Date).getTime(),t=yield(0,n.e)(2);for(var a of t){var r=yield(0,n.d)(2,a),s=JSON.parse(r);e-(0,i.a)(s.date[0],s.date[1],s.date[2]).getTime()>6048e5&&(yield(0,n.f)(2,a))}})).apply(this,arguments)}function u(e,t,a){return m.apply(this,arguments)}function m(){return m=(0,r.a)(function*(e,t,r){var i=new Worker(new URL(a.p+a.u(778),a.b)),n=yield function(){return f.apply(this,arguments)}();return yield new Promise(function(a,s){i.onmessage=function(e){a(e.data),i.terminate()},i.onerror=function(e){s(e.message),i.terminate()},i.postMessage([n,e,t,r])})}),m.apply(this,arguments)}},4225(e,t,a){a.d(t,{a:()=>p});var r=a(467),i=a(3453),n=a(7183),s=a(8024),o=a(4311);function f(e){var t=[["快取","cache"],["設定","settings"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["分析","analytics"],["個人化行程","personalSchedule"],["最近檢視","recentViews"],["通知","notification"],["通知","notification"],["資料夾","folders"],["資料夾","folders"],["資料夾","folders"]][e]||["其他","others"],a=(0,i.a)(t,2);return{name:a[0],key:a[1]}}function p(){return d.apply(this,arguments)}function d(){return(d=(0,r.a)(function*(){for(var e=0,t={},a=(0,o.b)(),r=0;r<a;r++){var i=yield(0,o.e)(r),p=0;for(var d of i){var u=yield(0,o.d)(r,d),m=String(u).length+d.length;e+=m,p+=m}var l=f(r),v=l.key;(0,s.f)(t,v)||(t[v]={category:l,size:0}),t[l.key].size+=p}var y=(0,n.a)(e),c={};for(var g in t){var h=t[g].category,w=t[g].size;c[g]={category:h,size:(0,n.a)(w)}}return{totalSize:y,categorizedSizes:c}})).apply(this,arguments)}},5767(e,t,a){a.d(t,{a:()=>g,b:()=>O,c:()=>x,d:()=>_,e:()=>w});var r=a(3453),i=a(467),n=a(8024),s=a(5428),o=a(4311),f=[],p="",d=!1,u=0,m={data:{},timestamp:0,id:""},l=[],v={};function y(e){var t=0,a=0,r=0,i=0,n=0;for(var s of e){var o=s[0],f=s[1];n+=1,t+=o,r+=f,a+=Math.pow(o,2),i+=Math.pow(f,2)}var p=t/n,d=r/n,u=a/n-Math.pow(p,2),m=i/n-Math.pow(d,2),l=Math.sqrt(u),v=Math.sqrt(m),y=0;for(var c of e){y+=(c[0]-p)*(c[1]-d)}return{estimate_time:{average:p,stdev:l},timestamp:{average:d,stdev:v},length:n,correlation:(y/=n)/(l*v)}}function c(e,t){var a=e.length+t.length,r=(e.estimate_time.average*e.length+t.estimate_time.average*t.length)/a,i=(e.timestamp.average*e.length+t.timestamp.average*t.length)/a;return{estimate_time:{average:r,stdev:(0,s.c)(e.estimate_time.average,e.estimate_time.stdev,e.length,t.estimate_time.average,t.estimate_time.stdev,t.length)},timestamp:{average:i,stdev:(0,s.c)(e.timestamp.average,e.timestamp.stdev,e.length,t.timestamp.average,t.timestamp.stdev,t.length)},length:a,correlation:(0,s.b)(e.estimate_time.average,e.timestamp.average,e.estimate_time.stdev,e.timestamp.stdev,e.length,e.correlation,t.estimate_time.average,t.timestamp.average,t.estimate_time.stdev,t.timestamp.stdev,t.length,t.correlation)}}function g(e){return h.apply(this,arguments)}function h(){return(h=(0,i.a)(function*(e){var t=(new Date).getTime(),a=!1;if(!d){d=!0,f=[],p=(0,n.c)(),m={data:{},timestamp:t,id:p},u=0;for(var r=e.length-1,i=0;i<32;i++){var s=e[Math.floor(Math.random()*r)];f.push(s.StopID)}}for(var g of e){var h=g.StopID,w=`s_${h}`;f.indexOf(h)>-1&&((0,n.f)(m.data,w)||(m.data[w]=[]),m.data[w].push([parseInt(g.EstimateTime),Math.floor((t-m.timestamp)/1e3)]))}if((u+=1)>45&&(a=!0),u%5==0&&(yield(0,o.g)(4,p,JSON.stringify(m))),a){for(var S of f){var _=`s_${S}`,M=m.data[_],O={},J=yield(0,o.d)(3,_);if(J){var N=JSON.parse(J);O.stats=c(N.stats,y(M)),O.timestamp=N.timestamp,O.id=S}else O.stats=y(M),O.timestamp=t,O.id=S;if(yield(0,o.g)(3,_,JSON.stringify(O)),(0,n.f)(v,_)){var b=v[_];l.splice(b,1,O)}else l[_]=l.length,l.push(O);yield(0,o.f)(4,p)}d=!1}})).apply(this,arguments)}function w(){return S.apply(this,arguments)}function S(){return(S=(0,i.a)(function*(){var e=(new Date).getTime()-252e5,t=yield(0,o.e)(4);for(var a of t){var r=yield(0,o.d)(4,a);if(r){var i=JSON.parse(r),s=i.timestamp,f=i.id;if(s>e)for(var p in i.data){var d=i.data[p],u={},m=yield(0,o.d)(3,p);if(m){var g=JSON.parse(m);u.stats=c(g.stats,y(d)),u.timestamp=g.timestamp,u.id=g.id}else u.stats=y(d),u.timestamp=s,u.id=parseInt(p.split("_")[1]);if(yield(0,o.g)(3,p,JSON.stringify(u)),(0,n.f)(v,p)){var h=v[p];l.splice(h,1,u)}else l[p]=l.length,l.push(u)}yield(0,o.f)(4,f)}}})).apply(this,arguments)}function _(){return M.apply(this,arguments)}function M(){return(M=(0,i.a)(function*(){var e=(new Date).getTime()-252e5,t=yield(0,o.e)(3),a=0;for(var r of t){var i=yield(0,o.d)(3,r);if(i){var n=JSON.parse(i);n.timestamp>e&&(l.push(n),v[r]=a,a+=1)}}})).apply(this,arguments)}function O(){return J.apply(this,arguments)}function J(){return(J=(0,i.a)(function*(){var e=(new Date).getTime()-252e5,t=yield(0,o.e)(3);for(var a of t){var r=yield(0,o.d)(3,a),i=JSON.parse(r);(i.timestamp<=e||"number"!=typeof i.stats.correlation)&&(yield(0,o.f)(3,a))}})).apply(this,arguments)}var N,b={};if("undefined"!=typeof SharedWorker){var D=new SharedWorker(new URL(a.p+a.u(662),a.b));(N=D.port).start()}else{var k=new Worker(new URL(a.p+a.u(662),a.b));N=k}function x(){return T.apply(this,arguments)}function T(){return(T=(0,i.a)(function*(){var e=yield function(){var e=(new Date).getTime()-252e5,t=[];for(var a of l)a.timestamp>e&&"number"==typeof a.stats.correlation&&t.push(a);return t}(),t=(0,n.c)();return yield new Promise(function(a,r){b[t]=a,N.onerror=function(e){r(e.message)},N.postMessage([e,t])})})).apply(this,arguments)}N.onmessage=function(e){var t=(0,r.a)(e.data,2),a=t[0],i=t[1];b[i]&&(b[i](a),delete b[i])},N.onerror=function(e){}}}]);
//# sourceMappingURL=559d1cebbda9077eebcc.js.map