"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(e,t,a){a.d(t,{a:()=>he,b:()=>pe,c:()=>X,d:()=>fe,e:()=>ce});var i=a(467),s=a(5767),r=a(9566),n=a(2757),d=a(3422),o=a(5314),l=a(3459),u=a(8179),c=a(7968),p=a(8024),f=a(5579),h=a(4537),v=a(904),b=a(9119),g=a(3041),m=a(752),A=a(1351),y=(0,u.c)(".vd"),L=(0,u.e)(y,".ug"),C=(0,u.e)(L,".yg"),x=(0,u.e)(C,"span"),w=(0,u.e)(L,".xg"),k=(0,u.e)(y,".wd"),T=(0,u.e)(L,".zg"),_=(0,u.e)(T,"._g"),$=(0,u.e)(L,".ch"),I=(0,u.e)($,".dh"),S=(0,u.e)(L,".fh .gh"),E={},M=!1,N=!1,P=0,D=0,F=0,R={},q=0,z=!1,B=15e3,H=5e3,Q=15e3,j=!0,U=0,W=0,G="",J=!1,K=!1,O=!1,V="";function X(){k.addEventListener("touchstart",function(){P=Math.round(k.scrollLeft/q)},{passive:!0}),k.addEventListener("scroll",function(e){z=!0;var t=e.target.scrollLeft/q;D=t>P?P+1:P-1;var a=t-P,i=Math.abs(a);i>1&&(a>0?(P=Math.floor(t),D=P+1):(P=Math.ceil(t),D=P-1),i=Math.abs(t-P));var s=R[`g_${P}`]||{width:0,offset:0},r=R[`g_${D}`]||{width:0,offset:0},n=s.width+(r.width-s.width)*i,d=-1*(s.offset+(r.offset-s.offset)*i)+.5*q-.5*n;Y(F,d,n-20,t)},{passive:!0}),k.addEventListener("scrollend",function(e){var t=e.target.scrollLeft/q;P=Math.round(t),z=!1},{passive:!0})}function Y(e,t,a,i){k.style.setProperty("--ud",e.toString()),I.style.setProperty("--og",a.toString()),_.style.setProperty("--pg",`${t.toString()}px`),_.style.setProperty("--rg",i.toString())}function Z(e){var t=e;if(J){var a=t.detail.progress-1;S.style.setProperty("--sg",a.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Z)}function ee(){var e=(0,u.a)();e.classList.add("ge"),e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0");var t=(0,u.a)();t.classList.add("he");var a=(0,u.a)();a.classList.add("ie");var i=(0,u.a)();i.classList.add("ke"),i.setAttribute("code","-1"),i.setAttribute("displayed","false");var s=(0,u.a)();s.classList.add("le"),s.setAttribute("code","-1"),s.setAttribute("displayed","true"),a.appendChild(i),a.appendChild(s);var r=(0,u.a)();r.classList.add("ve");var n=(0,u.a)();n.classList.add("xe");var d=(0,u.a)();d.classList.add("ye");var o=(0,u.a)();o.classList.add("af");var l=(0,u.a)();l.classList.add("tb"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var c=(0,u.a)();c.classList.add("ub"),c.setAttribute("code","0"),c.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(c);var p=(0,u.a)();p.classList.add("_e"),p.appendChild((0,h.b)("keyboard_arrow_down")),p.onclick=function(){!function(e){var t=(0,u.e)(e,".bf"),a=e.parentElement,i=(0,u.f)(e,"ge"),s=i.length,r=a.getBoundingClientRect(),n=e.getBoundingClientRect().top-r.top,d="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=d?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--ee",`${n}px`);for(var c=0;c<s;c++){var p=i[c];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<s;t++){var a=i[t];a.setAttribute("push-direction","0"),a.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<s;e++){i[e].setAttribute("push-state","2")}},{once:!0})}d?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(e)};var f=(0,u.a)();f.classList.add("ze"),d.appendChild(o),d.appendChild(p),d.appendChild(f),t.appendChild(a),t.appendChild(r),t.appendChild(n),t.appendChild(d);var v=(0,u.a)();v.classList.add("bf"),v.setAttribute("displayed","false");var b=(0,u.a)();b.classList.add("cf");var g=(0,u.a)();g.classList.add("df"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var m=(0,u.a)();m.classList.add("gf"),m.appendChild((0,h.b)("directions_bus")),g.appendChild(m),g.appendChild(document.createTextNode("公車")),g.onclick=function(){ve(e,0)};var A=(0,u.a)();A.classList.add("df"),A.setAttribute("highlighted","false"),A.setAttribute("type","tab"),A.setAttribute("code","1");var y=(0,u.a)();y.classList.add("gf"),y.appendChild((0,h.b)("departure_board")),A.appendChild(y),A.appendChild(document.createTextNode("抵達時間")),A.onclick=function(){ve(e,1)};var L=(0,u.a)();L.classList.add("df"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var C=(0,u.a)();C.classList.add("gf"),C.appendChild((0,h.b)("folder")),L.appendChild(C),L.appendChild(document.createTextNode("儲存"));var x=(0,u.a)();x.classList.add("df"),x.setAttribute("highlighted","false"),x.setAttribute("type","schedule-notification"),x.setAttribute("enabled","true");var w=(0,u.a)();w.classList.add("gf"),w.appendChild((0,h.b)("notifications")),x.appendChild(w),x.appendChild(document.createTextNode("通知")),b.appendChild(g),b.appendChild(A),b.appendChild(L),b.appendChild(x);var k=(0,u.a)();k.classList.add("hf"),k.setAttribute("displayed","true");var T=(0,u.a)();return T.classList.add("if"),T.setAttribute("displayed","false"),v.appendChild(b),v.appendChild(k),v.appendChild(T),e.appendChild(t),e.appendChild(v),e}function te(){var e=(0,u.a)();e.classList.add("xd");var t=(0,u.a)();t.classList.add("yd");var a=(0,u.a)();a.classList.add("zd"),t.appendChild(a);var i=(0,u.a)();return i.classList.add("fe"),e.appendChild(t),e.appendChild(i),e}function ae(){var e=(0,u.a)();e.classList.add("ah");var t=document.createElement("span");return e.appendChild(t),e}function ie(){var e=(0,u.a)();e.classList.add("ae");var t=(0,u.a)();t.classList.add("be"),t.appendChild((0,h.a)());var a=(0,u.a)();return a.classList.add("ce"),e.appendChild(t),e.appendChild(a),e}function se(){var e=(0,u.a)();e.classList.add("jf"),e.setAttribute("on-this-route","false");var t=(0,u.a)();t.classList.add("lf");var a=(0,u.a)();a.classList.add("nf"),a.appendChild((0,h.b)("directions_bus"));var i=(0,u.a)();i.classList.add("pf");var s=(0,u.a)();s.classList.add("sf");var r=(0,u.a)();r.classList.add("wf");var n=(0,u.a)();n.classList.add("xf");var d=(0,u.a)();return d.classList.add("yf"),t.appendChild(a),t.appendChild(i),e.appendChild(t),s.appendChild(r),s.appendChild(n),s.appendChild(d),e.appendChild(s),e}function re(){var e=(0,u.a)();e.classList.add("kf");var t=(0,u.a)();t.classList.add("mf");var a=(0,u.a)();a.classList.add("of"),a.appendChild((0,h.b)("calendar_view_day"));var i=(0,u.a)();i.classList.add("qf");var s=(0,u.a)();s.classList.add("rf");var r=(0,u.a)();return r.classList.add("tf"),t.appendChild(a),t.appendChild(i),t.appendChild(s),e.appendChild(t),e.appendChild(r),e}function ne(e,t,a){var i,s;function n(e,i,s){function n(e,t,a,i){var s=(0,u.e)(e,".he"),r=(0,u.e)(s,".af"),n=(0,u.e)(r,".tb"),d=(0,u.e)(r,".ub");if(n.setAttribute("code",t.status.code.toString()),n.innerText=t.status.text,!a&&i){var o=e.getBoundingClientRect(),l=o.top,c=o.left,p=o.bottom,f=o.right,h=window.innerWidth,v=window.innerHeight;if(p>0&&l<v&&f>0&&c<h)return d.addEventListener("animationend",function(){d.setAttribute("code",t.status.code.toString()),d.innerText=t.status.text,d.classList.remove("wb"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("wb")}d.setAttribute("code",t.status.code.toString()),d.innerText=t.status.text}function o(e,t,a,i){var s=(0,u.e)(e,".he"),r=(0,u.e)(s,".ie"),n=(0,u.e)(r,".ke"),d=(0,u.e)(r,".le");if(n.setAttribute("code",t.ranking.code.toString()),n.innerText=t.ranking.text,!a&&i){var o=e.getBoundingClientRect(),l=o.top,c=o.left,p=o.bottom,f=o.right,h=window.innerWidth,v=window.innerHeight;if(p>0&&l<v&&f>0&&c<h)return d.addEventListener("animationend",function(){d.setAttribute("code",t.ranking.code.toString()),d.innerText=t.ranking.text,d.classList.remove("ue"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("ue")}d.setAttribute("code",t.ranking.code.toString()),d.innerText=t.ranking.text}function l(e,t){var a=(0,u.e)(e,".he");(0,u.e)(a,".ve").innerText=t.route_direction}function c(e,t){var a=(0,u.e)(e,".he");(0,u.e)(a,".xe").innerText=t.route_name}function h(e,t){var a=(0,u.e)(e,".bf"),i=(0,u.e)(a,".hf"),s=Array.from((0,u.d)(i,".jf")),r=s.length,n=t.buses.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var c=se();o.appendChild(c),s.push(c)}i.append(o)}else if(d>0)for(var f=r-1,h=r-d-1;f>h;f--)s[f].remove(),s.splice(f,1);for(var v=0;v<n;v++){var b=t.buses[v],g=s[v],m=(0,u.e)(g,".lf"),A=(0,u.e)(m,".pf"),y=(0,u.e)(g,".sf"),L=(0,u.e)(y,".wf"),C=(0,u.e)(y,".xf"),x=(0,u.e)(y,".yf");g.setAttribute("on-this-route",(0,p.a)(b.onThisRoute)),A.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,C.innerText=`狀態：${b.status.text}`,x.innerText=`類型：${b.type}`}i.setAttribute("empty",(0,p.a)(0===n))}function v(e,t){var a=(0,u.e)(e,".bf"),i=(0,u.e)(a,".if"),s=Array.from((0,u.d)(i,".kf")),r=s.length,n=t.busArrivalTimes.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var c=re();o.appendChild(c),s.push(c)}i.append(o)}else if(d>0)for(var h=r-1,v=r-d-1;h>v;h--)s[h].remove(),s.splice(h,1);for(var b=0;b<n;b++){var g=t.busArrivalTimes[b],m=s[b],A=(0,u.e)(m,".mf"),y=(0,u.e)(A,".qf"),L=(0,u.e)(A,".rf"),C=(0,u.e)(m,".tf");y.innerText=g.personalSchedule.name,L.innerText=`週${(0,f.g)(g.day).name} ${(0,f.i)(g.personalSchedule.period.start)} - ${(0,f.i)(g.personalSchedule.period.end)}`,C.innerHTML=g.chart}i.setAttribute("empty",(0,p.a)(0===n))}function b(e,t){t&&e.setAttribute("stretched","false")}function A(e,t){e.setAttribute("animation",(0,p.a)(t))}function y(e,t){e.setAttribute("skeleton-screen",(0,p.a)(t))}function L(e,t){var a=(0,u.e)(e,".bf"),i=(0,u.e)(a,".cf"),s=(0,u.e)(i,'.df[type="save-to-folder"]');s.onclick=function(){(0,g.c)("stop",[t.stopId,t.routeId],s)},(0,r.e)("stop",t.stopId).then(function(e){s.setAttribute("highlighted",(0,p.a)(e))})}function C(e,t){var a=(0,u.e)(e,".bf"),i=(0,u.e)(a,".cf"),s=(0,u.e)(i,'.df[type="schedule-notification"]');s.onclick=function(){(0,m.c)(s,t.stopId,t.routeId,t.status.time)};var r=(0,d.r)(t.stopId);s.setAttribute("highlighted",(0,p.a)(r))}null==s?(n(e,i,t,a),o(e,i,t,a),l(e,i),c(e,i),h(e,i),v(e,i),b(e,t),A(e,a),y(e,t),L(e,i),C(e,i)):(i.status.time!==s.status.time&&(n(e,i,t,a),C(e,i)),s.ranking.number===i.ranking.number&&s.ranking.code===i.ranking.code||o(e,i,t,a),s.stopId!==i.stopId&&(l(e,i),c(e,i),L(e,i)),(0,p.b)(s.buses,i.buses)||h(e,i),(0,p.b)(s.busArrivalTimes,i.busArrivalTimes)||v(e,i),a!==M&&A(e,a),t!==N&&(b(e,t),y(e,t)))}function o(e,i,s){function r(e,t){var a=(0,u.e)(e,".be");(0,h.c)(a,t.icon)}function n(e,t){(0,u.e)(e,".ce").innerHTML=t.value}function d(e,t){e.setAttribute("animation",(0,p.a)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.a)(t))}null==s?(r(e,i),n(e,i),d(e,a),o(e,t)):((0,p.b)(s.icon,i.icon)||r(e,i),(0,p.b)(s.value,i.value)||n(e,i),a!==M&&d(e,a),t!==N&&o(e,t))}var l=(0,v.d)("window"),b=l.width,y=l.height,L=e.groupQuantity,I=e.itemQuantity,S=e.groupedItems,D=e.groups;F=L,q=b;for(var B=0,H=0;H<L;H++){var Q=`g_${H}`,j=(0,c.d)(D[Q].name,500,"17px",'"Noto Sans TC", sans-serif')+20;R[Q]={width:j,offset:B},B+=j}if(R[`g_${L}`]={width:0,offset:B},!z){var U=R[`g_${P}`],W=-1*U.offset+.5*q-.5*U.width,G=U.width-20;Y(F,W,G,P)}(null===(i=E)||void 0===i?void 0:i.hash)!==e.hash&&(w.onclick=function(){(0,A.c)(e.hash)}),(null===(s=E)||void 0===s?void 0:s.LocationName)!==e.LocationName&&(x.innerText=e.LocationName),M!==a&&(C.setAttribute("animation",(0,p.a)(a)),T.setAttribute("animation",(0,p.a)(a))),N!==t&&(C.setAttribute("skeleton-screen",(0,p.a)(t)),T.setAttribute("skeleton-screen",(0,p.a)(t)),$.setAttribute("skeleton-screen",(0,p.a)(t)));var J=Array.from((0,u.d)(k,".xd")),K=Array.from((0,u.d)(_,".ah")),O=J.length;if(L!==O){var V=O-L;if(V<0){for(var X=new DocumentFragment,Z=new DocumentFragment,ne=0;ne>V;ne--){var de=te();X.appendChild(de),J.push(de);var oe=ae();Z.appendChild(oe),K.push(oe)}k.append(X),_.append(Z)}else if(V>0)for(var le=O-1,ue=O-V-1;le>ue;le--)J[le].remove(),J.splice(le,1),K[le].remove(),K.splice(le,1)}for(var ce=(0,u.d)(k,".xd"),pe=0;pe<L;pe++){var fe=`g_${pe}`,he=ce[pe],ve=(0,u.e)(he,".yd"),be=(0,u.e)(ve,".zd"),ge=Array.from((0,u.d)(be,".ae")),me=ge.length,Ae=D[fe].properties.length;if(Ae!==me){var ye=me-Ae;if(ye<0){for(var Le=new DocumentFragment,Ce=0;Ce>ye;Ce--){var xe=ie();Le.appendChild(xe),ge.push(xe)}be.append(Le)}else if(ye>0)for(var we=me-1,ke=me-ye-1;we>ke;we--)ge[we].remove(),ge.splice(we,1)}var Te=(0,u.e)(he,".fe"),_e=Array.from((0,u.d)(Te,".ge")),$e=_e.length;if(I[fe]!==$e){var Ie=$e-I[fe];if(Ie<0){for(var Se=new DocumentFragment,Ee=0;Ee>Ie;Ee--){var Me=ee();Se.appendChild(Me),_e.push(Me)}Te.append(Se)}else if(Ie>0)for(var Ne=$e-1,Pe=$e-Ie-1;Ne>Pe;Ne--)_e[Ne].remove(),_e.splice(Ne,1)}var De=K[pe];(0,u.e)(De,"span").innerText=D[fe].name,De.style.setProperty("--mg",`${R[fe].offset}px`),De.style.setProperty("--ng",`${R[fe].width}px`),De.style.setProperty("--bh",pe.toString());for(var Fe=0;Fe<Ae;Fe++){var Re=D[fe].properties[Fe],qe=ge[Fe];if((0,p.e)(E,"groups"))if((0,p.e)(E.groups,fe))if(E.groups[fe].properties[Fe])o(qe,Re,E.groups[fe].properties[Fe]);else o(qe,Re,null);else o(qe,Re,null);else o(qe,Re,null)}for(var ze=0;ze<I[fe];ze++){var Be=_e[ze],He=S[fe][ze];if((0,p.e)(E,"groupedItems"))if((0,p.e)(E.groupedItems,fe))if(E.groupedItems[fe][ze])n(Be,He,E.groupedItems[fe][ze]);else n(Be,He,null);else n(Be,He,null);else n(Be,He,null)}}_.style.setProperty("--qg",`${B}px`),E=e,M=a,N=t}function de(){return oe.apply(this,arguments)}function oe(){return(oe=(0,i.a)(function*(){var e=(0,l.b)("playing_animation"),t=(0,l.b)("refresh_interval"),a=(0,v.d)("location-bus-arrival-time-chart");j=t.dynamic,B=t.baseInterval,J=!0,G=(0,p.c)(),S.setAttribute("refreshing","true"),S.classList.remove("hh"),document.addEventListener(G,Z);var i=yield(0,n.a)(V,a.width,a.height,G);ne(i,!1,e);var r=0;j&&(r=yield(0,s.c)()),U=(new Date).getTime(),W=j?Math.max(U+H,i.dataUpdateTime+B/r):U+B,Q=Math.max(H,W-U),J=!1,S.setAttribute("refreshing","false"),S.style.setProperty("--tg",`${Q}ms`),S.classList.add("hh")})).apply(this,arguments)}function le(){de().then(function(){K?setTimeout(function(){le()},Math.max(H,W-(new Date).getTime())):O=!1}).catch(function(e){K?((0,b.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){le()},1e4)):O=!1})}function ue(e){V=e,P=0,R={},k.scrollLeft=0,k.focus(),function(e){for(var t=(0,l.b)("playing_animation"),a=(0,v.d)("window"),i=(a.width,a.height),s={g_0:Math.floor(i/50)+5,g_1:Math.floor(i/50)+5},r={},n=0;n<2;n++){var d=`g_${n}`;r[d]=[];for(var o=0;o<s[d];o++)r[d].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}ne({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:s,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,O?de():(O=!0,le()))}function ce(e){var t="ltr"===e?"qd":"rd";y.addEventListener("animationend",function(){y.classList.remove(t)},{once:!0}),y.classList.add(t),y.setAttribute("displayed","true")}function pe(e){var t="ltr"===e?"sd":"td";y.addEventListener("animationend",function(){y.setAttribute("displayed","false"),y.classList.remove(t)},{once:!0}),y.classList.add(t)}function fe(e){(0,v.c)("Location"),(0,o.e)("location",e),ce("rtl"),ue(e),(0,v.b)()}function he(){pe("ltr"),K=!1,(0,v.i)(),(0,v.e)("Location")}function ve(e,t){var a=(0,u.e)(e,".bf"),i=(0,u.e)(a,".cf"),s=(0,u.d)(i,'.df[highlighted="true"][type="tab"]');for(var r of s)r.setAttribute("highlighted","false");switch((0,u.e)(i,`.df[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,u.e)(e,".hf").setAttribute("displayed","true"),(0,u.e)(e,".if").setAttribute("displayed","false");break;case 1:(0,u.e)(e,".hf").setAttribute("displayed","false"),(0,u.e)(e,".if").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=8fd4de840934cbf13c06.js.map