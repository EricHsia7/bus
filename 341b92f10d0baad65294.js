"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[133],{77(e,t,r){r.d(t,{C$:()=>x,D7:()=>T,Db:()=>O,FX:()=>G,G7:()=>k,Je:()=>N,M3:()=>m,VJ:()=>Q,Zc:()=>M,cS:()=>I,e3:()=>Z,gc:()=>D,hc:()=>$,mD:()=>X,ms:()=>w,ph:()=>h,se:()=>v,si:()=>U,uQ:()=>J,z9:()=>z});var n=r(467),i=r(8024),a=r(8011),o=r(4293),u=r(424),s=r(6788),l=r(3459),f=r(4311),c=r(5851),d=r(7053);function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var h="",m="",v="",g=[],_={},b={};function w(){return S.apply(this,arguments)}function S(){return(S=(0,n.A)(function*(){var e={provider:h,client_id:m,secret:v};yield(0,f.mL)(9,"n_client",JSON.stringify(e))})).apply(this,arguments)}function O(){return A.apply(this,arguments)}function A(){return(A=(0,n.A)(function*(){var e=yield(0,f.Ct)(9,"n_client");if(e){var t=JSON.parse(e);h=t.provider,m=t.client_id,v=t.secret}})).apply(this,arguments)}function $(){return""!==m&&""!==v}function N(e){if(!(0,i.Gz)(e))throw new Error("The provider is not valid.");var t=new URL(e);h=`${t.protocol}//${t.hostname}`}function T(){return String(h)}function D(e){void 0!==e&&(m=String(e))}function J(e){void 0!==e&&(v=String(e))}function I(){return C.apply(this,arguments)}function C(){return(C=(0,n.A)(function*(){(new Date).getTime();var e,t=0,r=p(yield(0,f.Su)(10));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,f.Ct)(10,n),a=JSON.parse(i),o=a.schedule_id,u=`s_${a.stop_id}`;g.push(a),_[o]=t,b.hasOwnProperty(u)||(b[u]=[]),b[u].push(t),t+=1}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function k(e,t,r,n,i,a,o,u,s,l){return P.apply(this,arguments)}function P(){return(P=(0,n.A)(function*(e,t,r,n,i,a,o,u,s,l){var c={schedule_id:e,stop_id:t,location_name:r,route_id:n,route_name:i,direction:a,estimate_time:o,time_formatting_mode:u,time_offset:s,scheduled_time:l},d=`s_${t}`,p=g.length;g.push(c),_[e]=p,b.hasOwnProperty(d)||(b[d]=[]),b[d].push(p),yield(0,f.mL)(10,e,JSON.stringify(c))})).apply(this,arguments)}function x(e,t,r){return L.apply(this,arguments)}function L(){return(L=(0,n.A)(function*(e,t,r){if(_.hasOwnProperty(e)){var n=_[e],i=g[n],a=Object.assign(i,{estimate_time:t,scheduled_time:r});g.splice(n,1,a),yield(0,f.mL)(10,e,JSON.stringify(a))}})).apply(this,arguments)}function Q(e){return j.apply(this,arguments)}function j(){return(j=(0,n.A)(function*(e){if(_.hasOwnProperty(e)){var t=_[e],r=`s_${g[t].stop_id}`;g.splice(t,1,null),b[r].splice(b[r].indexOf(t),1),delete _[e],yield(0,f.iQ)(10,e)}})).apply(this,arguments)}function M(e){var t=(new Date).getTime(),r=`s_${e}`;if(b.hasOwnProperty(r)){var n,i=p(b[r]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=g[a];if(null!==o)if(o.scheduled_time>t)return!0}}catch(e){i.e(e)}finally{i.f()}}return!1}function U(e,t){return H.apply(this,arguments)}function H(){return(H=(0,n.A)(function*(e,t){console.log(3);var r=(new Date).getTime();console.log(4);var n=function(e){var t=[],r=(new Date).getTime(),n=`s_${e}`;if(b.hasOwnProperty(n)){var i,a=p(b[n]);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=g[o];null!==u&&u.scheduled_time>r&&t.push(u)}}catch(e){a.e(e)}finally{a.f()}}return t}(e);console.log(5);var i,a=p(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(console.log(6),t-o.estimate_time>=10){console.log(7);var u=r+1e3*t+60*o.time_offset*1e3;console.log(8),yield(0,c.e)(o.schedule_id,t,u),console.log(9)}console.log(10)}}catch(e){a.e(e)}finally{a.f()}console.log(11)})).apply(this,arguments)}function z(){return E.apply(this,arguments)}function E(){return(E=(0,n.A)(function*(){var e=(new Date).getTime();for(var t in _){var r=_[t],n=g[r];if(n.scheduled_time<=e){var i=`s_${n.stop_id}`;g.splice(r,1,null),b[i].splice(b[i].indexOf(r),1),delete _[t],yield(0,f.iQ)(10,t)}}})).apply(this,arguments)}function Z(e){return F.apply(this,arguments)}function F(){return(F=(0,n.A)(function*(e){var t,r=yield(0,o.a)(e,!0),n=function(){var e,t=(new Date).getTime(),r=[],n=p(g);try{for(n.s();!(e=n.n()).done;){var i=e.value;null!==i&&i.scheduled_time>t&&r.push(i)}}catch(e){n.e(e)}finally{n.f()}return r}(),i=(new Date).getTime(),a=[],u=p(n);try{for(u.s();!(t=u.n()).done;){var l=t.value,f={},c=l.location_name;f.name=c;var d=l.stop_id;f.stop_id=d;var y=l.estimate_time;f.estimate_time=y;var h=l.schedule_id;f.schedule_id=h;var m=l.scheduled_time;f.scheduled_time=m;var v=new Date(m),_=v.getDate(),b=v.getHours(),w=v.getMinutes();f.date=String(_).padStart(2,"0"),f.hours=String(b).padStart(2,"0"),f.minutes=String(w).padStart(2,"0"),f.route={};var S=l.route_name;f.route.name=S;var O=l.route_id;f.route.id=O;var A=l.direction;f.route.direction=A;var $=`r_${l.route_id}`;if(r.hasOwnProperty($)){var N=r[$].pid;f.route.pathAttributeId=N,a.push(f)}}}catch(e){u.e(e)}finally{u.f()}a.sort(function(e,t){return e.scheduled_time-t.scheduled_time});for(var T=[],D=0,J={},I=0,C=a;I<C.length;I++){var k=C[I],P=`g_${k.date}_${k.hours}`;J.hasOwnProperty(P)?k.is_first=!1:(J[P]=!0,k.is_first=!0),T.push(k),D+=1}var x={items:T,itemQuantity:D,dataUpdateTime:Math.max((0,s.Zt)(e),i)};return(0,s.gC)(e),(0,s.LQ)(e),x})).apply(this,arguments)}var G=[{name:"到站前5分鐘",time_offset:-5,icon:"clock_loader_10",index:0},{name:"到站前10分鐘",time_offset:-10,icon:"clock_loader_20",index:1},{name:"到站前15分鐘",time_offset:-15,icon:"clock_loader_40",index:2},{name:"到站前20分鐘",time_offset:-20,icon:"clock_loader_60",index:3},{name:"到站前25分鐘",time_offset:-25,icon:"clock_loader_80",index:4},{name:"到站前30分鐘",time_offset:-30,icon:"clock_loader_90",index:5}];function X(e,t,r,n){return q.apply(this,arguments)}function q(){return(q=(0,n.A)(function*(e,t,r,n){if($()){var f=(0,l.Js)("time_formatting_mode"),c=(0,i.zx)(),p=yield(0,u.T)(c),y=yield(0,a.g)(c,0),h=yield(0,o.a)(c,!0);(0,s.LQ)(c),(0,s.gC)(c);var m=`s_${e}`,v={};if(!p.hasOwnProperty(m))return 0;var g=(v=p[m]).stopLocationId,_=v.goBack,b=`l_${g}`;if(!y.hasOwnProperty(b))return 0;var w=y[b].n,S=`r_${t}`,O={};if(!h.hasOwnProperty(S))return 0;var A=(O=h[S]).n,N=O.dep,T=[O.des,N,""][_?parseInt(_):0],D=G[n].time_offset,J=(new Date).getTime()+1e3*r+60*D*1e3;return!1===(yield(0,d.Z)(e,w,t,A,T,r,f,D,J))?0:1}return 2})).apply(this,arguments)}},5314(e,t,r){r.d(t,{$i:()=>w,DF:()=>_,FU:()=>h,Qj:()=>p,XK:()=>v});var n=r(467),i=r(8024),a=r(5579),o=r(9734),u=r(8011),s=r(4293),l=r(6788),f=r(4311);function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(){return y.apply(this,arguments)}function y(){return(y=(0,n.A)(function*(){var e,t=[],r=(new Date).getTime(),n=c(yield(0,f.Su)(8));try{for(n.s();!(e=n.n()).done;){var i=e.value,a=yield(0,f.Ct)(8,i),o=JSON.parse(a);r-new Date(o.time).getTime()<=12096e5&&t.push(o)}}catch(e){n.e(e)}finally{n.f()}return 0===t.length&&t.push({type:"empty",time:(new Date).toISOString(),name:"沒有內容",id:0}),t})).apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t=(new Date).getTime(),r=c(yield(0,f.Su)(8));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,f.Ct)(8,n),a=JSON.parse(i);t-new Date(a.time).getTime()>12096e5&&(yield(0,f.iQ)(8,n))}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function v(e,t){return g.apply(this,arguments)}function g(){return(g=(0,n.A)(function*(e,t){var r=(0,i.zx)(),n=`${e}_${t}`,a=(new Date).toISOString(),l=yield(0,f.Ct)(8,n);if(l){var c=JSON.parse(l);c.time=a,yield(0,f.mL)(8,n,JSON.stringify(c))}else switch(e){case"route":var d=yield(0,s.a)(r,!0),p=`r_${t}`;if(d.hasOwnProperty(p)){var y={type:"route",time:a,name:d[p].n,id:t};yield(0,f.mL)(8,n,JSON.stringify(y))}break;case"location":var h=yield(0,u.g)(r,1),m=`ml_${t}`;if(h.hasOwnProperty(m)){var v={type:"location",time:a,name:h[m].n,hash:t};yield(0,f.mL)(8,n,JSON.stringify(v))}break;case"bus":var g=yield(0,o.j)(r,!0),_=`c_${t}`;if(g.hasOwnProperty(_)){var b={type:"bus",time:a,name:g[_].CarNum,id:t};yield(0,f.mL)(8,n,JSON.stringify(b))}}})).apply(this,arguments)}function _(e,t){return b.apply(this,arguments)}function b(){return(b=(0,n.A)(function*(e,t){var r=`${e}_${t}`,n=yield(0,f.Ct)(8,r);return!!n&&JSON.parse(n)})).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=(0,n.A)(function*(e){var t,r=yield p(),n=yield(0,s.a)(e,!0),i=[],o=0,u=c(r);try{for(u.s();!(t=u.n()).done;){var f=t.value,d=f.type,y=new Date(f.time);switch(d){case"route":var h={type:"route"},m=f.name;h.name=m;var v=f.id;h.id=v;var g=n[`r_${v}`].pid;h.pid=g,h.time={absolute:y.getTime(),relative:(0,a.HN)(y)},i.push(h),o+=1;break;case"location":var _={type:"location"},b=f.hash;_.hash=b;var w=f.name;_.name=w,_.time={absolute:y.getTime(),relative:(0,a.HN)(y)},i.push(_),o+=1;break;case"bus":var S={type:"bus"},O=f.id;S.id=O;var A=f.name;S.name=A,S.time={absolute:y.getTime(),relative:(0,a.HN)(y)},i.push(S),o+=1;break;case"empty":var $={type:"empty"},N=f.id;$.id=N;var T=f.name;$.name=T,$.time={absolute:y.getTime(),relative:(0,a.HN)(y)},i.push($),o=1}}}catch(e){u.e(e)}finally{u.f()}i.sort(function(e,t){return t.time.absolute-e.time.absolute});var D={items:i,itemQuantity:o,dataUpdateTime:(new Date).getTime()};return(0,l.LQ)(e),(0,l.gC)(e),D})).apply(this,arguments)}},5352(e,t,r){r.d(t,{Qh:()=>s,nL:()=>d,qZ:()=>f,ty:()=>y,vQ:()=>v});var n=r(467),i=r(8024),a=r(4311);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,i,a){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(e,t,r,n,u,s){var l=(0,i.zx)();if(t<0||t>23||r<0||r>59||n<0||n>23||u<0||u>59)return!1;if(!(Number.isInteger(t)&&Number.isInteger(r)&&Number.isInteger(n)&&Number.isInteger(u)))return!1;if(s.length>7)return!1;var f,c=o(s);try{for(c.s();!(f=c.n()).done;){var d=f.value;if("number"==typeof d&&(d<0||d>6||!Number.isInteger(d)))return!1}}catch(e){c.e(e)}finally{c.f()}var p={name:e,period:{start:{hours:t,minutes:r},end:{hours:n,minutes:u}},days:s,id:l};return yield(0,a.mL)(7,l,JSON.stringify(p)),!0})).apply(this,arguments)}function f(e){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e){var t=yield(0,a.Ct)(7,e);if(t)return JSON.parse(t)})).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=(0,n.A)(function*(e){(yield f(e.id))&&(yield(0,a.mL)(7,e.id,JSON.stringify(e)))})).apply(this,arguments)}function y(){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(){var e,t=[],r=o(yield(0,a.Su)(7));try{for(r.s();!(e=r.n()).done;){var n=e.value,i=yield(0,a.Ct)(7,n);if(i){var u=JSON.parse(i);t.push(u)}}}catch(e){r.e(e)}finally{r.f()}return t.sort(function(e,t){return 60*e.period.end.hours+e.period.end.minutes-(60*t.period.end.hours+t.period.end.minutes)}),t.sort(function(e,t){return 60*e.period.start.hours+e.period.start.minutes-(60*t.period.start.hours+t.period.start.minutes)}),t})).apply(this,arguments)}function m(){return(m=(0,n.A)(function*(){var e,t={},r=o(yield y());try{for(r.s();!(e=r.n()).done;){var n,i=e.value,a=o(i.days);try{for(a.s();!(n=a.n()).done;){var u=`d_${n.value}`;t.hasOwnProperty(u)||(t[u]=[]);var s={start:i.period.start,end:i.period.end};t[u].push(s)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}for(var l in t){for(var f=t[l],c=f.length,d=[],p=0;p<c;p++){var h=f[p-1]||f[p],m=f[p];0===d.length?d.push(m):60*m.start.hours+m.start.minutes>=60*h.start.hours+h.start.minutes&&60*m.start.hours+m.start.minutes<=60*h.end.hours+h.end.minutes?(d[d.length-1].end.hours=m.end.hours,d[d.length-1].end.minutes=m.end.minutes):d.push(m)}t[l]=d}return t})).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return g=(0,n.A)(function*(e){var t=yield function(){return m.apply(this,arguments)}(),r=`d_${e.getDay()}`,n=e.getHours(),i=e.getMinutes();if(t.hasOwnProperty(r)){var a,u=o(t[r]);try{for(u.s();!(a=u.n()).done;){var s=a.value;if(60*n+i>=60*s.start.hours+s.start.minutes&&60*n+i<=60*s.end.hours+s.end.minutes)return!0}}catch(e){u.e(e)}finally{u.f()}}return!1}),g.apply(this,arguments)}}}]);
//# sourceMappingURL=341b92f10d0baad65294.js.map