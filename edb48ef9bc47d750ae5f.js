"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[18],{3030(e,t,i){i.d(t,{a:()=>ue,b:()=>X,c:()=>ce});var a=i(467),d=i(5767),n=i(9566),r=i(2757),s=i(3422),o=i(5314),l=i(3459),c=i(8179),u=i(7968),p=i(8024),h=i(5579),v=i(4537),m=i(904),f=i(9119),g=i(3041),b=i(752),A=i(1351),y=(0,c.b)(".dg"),L=(0,c.d)(y,".mg"),C=(0,c.d)(L,".qg"),E=(0,c.d)(C,"span"),w=(0,c.d)(L,".pg"),k=(0,c.d)(y,".ah"),x=(0,c.d)(L,".sg"),T=(0,c.d)(x,".tg"),_=(0,c.d)(L,".wg"),$=(0,c.d)(_,".xg"),I=(0,c.d)(L,".yg .zg"),S={},M=!1,N=!1,P=0,D=0,j=0,F={},R=0,q=!1,B=15e3,H=5e3,Q=15e3,z=!0,U=0,W=0,G="",J=!1,K=!1,O=!1,V="";function X(){k.addEventListener("touchstart",function(){P=Math.round(k.scrollLeft/R)},{passive:!0}),k.addEventListener("scroll",function(e){q=!0;var t=e.target.scrollLeft/R;D=t>P?P+1:P-1;var i=t-P,a=Math.abs(i);a>1&&(i>0?(P=Math.floor(t),D=P+1):(P=Math.ceil(t),D=P-1),a=Math.abs(t-P));var d=F[`g_${P}`]||{width:0,offset:0},n=F[`g_${D}`]||{width:0,offset:0},r=d.width+(n.width-d.width)*a,s=-1*(d.offset+(n.offset-d.offset)*a)+.5*R-.5*r;Y(j,s,r-20,t)},{passive:!0}),k.addEventListener("scrollend",function(e){var t=e.target.scrollLeft/R;P=Math.round(t),q=!1},{passive:!0})}function Y(e,t,i,a){k.style.setProperty("--cg",e.toString()),$.style.setProperty("--gg",i.toString()),T.style.setProperty("--hg",`${t.toString()}px`),T.style.setProperty("--jg",a.toString())}function Z(e){var t=e;if(J){var i=t.detail.progress-1;I.style.setProperty("--kg",i.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,Z)}function ee(){var e=document.createElement("div");e.classList.add("lh"),e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0");var t=document.createElement("div");t.classList.add("mh");var i=document.createElement("div");i.classList.add("nh");var a=document.createElement("div");a.classList.add("ph"),a.setAttribute("code","-1"),a.setAttribute("displayed","false");var d=document.createElement("div");d.classList.add("qh"),d.setAttribute("code","-1"),d.setAttribute("displayed","true"),i.appendChild(a),i.appendChild(d);var n=document.createElement("div");n.classList.add("_h");var r=document.createElement("div");r.classList.add("ai");var s=document.createElement("div");s.classList.add("bi");var o=document.createElement("div");o.classList.add("ei");var l=document.createElement("div");l.classList.add("tf"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var u=document.createElement("div");u.classList.add("uf"),u.setAttribute("code","0"),u.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(u);var p=document.createElement("div");p.classList.add("di"),p.appendChild((0,v.b)("keyboard_arrow_down")),p.onclick=function(){!function(e){var t=(0,c.d)(e,".fi"),i=e.parentElement,a=(0,c.e)(e,"lh"),d=a.length,n=i.getBoundingClientRect(),r=e.getBoundingClientRect().top-n.top,s="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=s?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--jh",`${r}px`);for(var u=0;u<d;u++){var p=a[u];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<d;t++){var i=a[t];i.setAttribute("push-direction","0"),i.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<d;e++){a[e].setAttribute("push-state","2")}},{once:!0})}s?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(e)};var h=document.createElement("div");h.classList.add("ci"),s.appendChild(o),s.appendChild(p),s.appendChild(h),t.appendChild(i),t.appendChild(n),t.appendChild(r),t.appendChild(s);var m=document.createElement("div");m.classList.add("fi"),m.setAttribute("displayed","false");var f=document.createElement("div");f.classList.add("gi");var g=document.createElement("div");g.classList.add("hi"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var b=document.createElement("div");b.classList.add("ki"),b.appendChild((0,v.b)("directions_bus")),g.appendChild(b),g.appendChild(document.createTextNode("公車")),g.onclick=function(){pe(e,0)};var A=document.createElement("div");A.classList.add("hi"),A.setAttribute("highlighted","false"),A.setAttribute("type","tab"),A.setAttribute("code","1");var y=document.createElement("div");y.classList.add("ki"),y.appendChild((0,v.b)("departure_board")),A.appendChild(y),A.appendChild(document.createTextNode("抵達時間")),A.onclick=function(){pe(e,1)};var L=document.createElement("div");L.classList.add("hi"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var C=document.createElement("div");C.classList.add("ki"),C.appendChild((0,v.b)("folder")),L.appendChild(C),L.appendChild(document.createTextNode("儲存"));var E=document.createElement("div");E.classList.add("hi"),E.setAttribute("highlighted","false"),E.setAttribute("type","schedule-notification"),E.setAttribute("enabled","true");var w=document.createElement("div");w.classList.add("ki"),w.appendChild((0,v.b)("notifications")),E.appendChild(w),E.appendChild(document.createTextNode("通知")),f.appendChild(g),f.appendChild(A),f.appendChild(L),f.appendChild(E);var k=document.createElement("div");k.classList.add("li"),k.setAttribute("displayed","true");var x=document.createElement("div");return x.classList.add("mi"),x.setAttribute("displayed","false"),m.appendChild(f),m.appendChild(k),m.appendChild(x),e.appendChild(t),e.appendChild(m),e}function te(){var e=document.createElement("div");e.classList.add("bh");var t=document.createElement("div");t.classList.add("ch");var i=document.createElement("div");i.classList.add("dh"),t.appendChild(i);var a=document.createElement("div");return a.classList.add("kh"),e.appendChild(t),e.appendChild(a),e}function ie(){var e=document.createElement("div");e.classList.add("ug");var t=document.createElement("span");return e.appendChild(t),e}function ae(){var e=document.createElement("div");e.classList.add("fh");var t=document.createElement("div");t.classList.add("gh"),t.appendChild((0,v.a)());var i=document.createElement("div");return i.classList.add("hh"),e.appendChild(t),e.appendChild(i),e}function de(){var e=document.createElement("div");e.classList.add("ni"),e.setAttribute("on-this-route","false");var t=document.createElement("div");t.classList.add("pi");var i=document.createElement("div");i.classList.add("ri"),i.appendChild((0,v.b)("directions_bus"));var a=document.createElement("div");a.classList.add("ti");var d=document.createElement("div");d.classList.add("wi");var n=document.createElement("div");n.classList.add("_i");var r=document.createElement("div");r.classList.add("aj");var s=document.createElement("div");return s.classList.add("bj"),t.appendChild(i),t.appendChild(a),e.appendChild(t),d.appendChild(n),d.appendChild(r),d.appendChild(s),e.appendChild(d),e}function ne(){var e=document.createElement("div");e.classList.add("oi");var t=document.createElement("div");t.classList.add("qi");var i=document.createElement("div");i.classList.add("si"),i.appendChild((0,v.b)("calendar_view_day"));var a=document.createElement("div");a.classList.add("ui");var d=document.createElement("div");d.classList.add("vi");var n=document.createElement("div");return n.classList.add("xi"),t.appendChild(i),t.appendChild(a),t.appendChild(d),e.appendChild(t),e.appendChild(n),e}function re(e,t,i){var a,d;function r(e,a,d){function r(e,i,a){var d=(0,c.d)(e,".mh"),n=(0,c.d)(d,".ei"),r=(0,c.d)(n,".tf"),s=(0,c.d)(n,".uf");if(r.setAttribute("code",i.status.code.toString()),r.innerText=i.status.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,u=o.left,p=o.bottom,h=o.right,v=window.innerWidth,m=window.innerHeight;if(p>0&&l<m&&h>0&&u<v)return s.addEventListener("animationend",function(){s.setAttribute("code",i.status.code.toString()),s.innerText=i.status.text,s.classList.remove("wf"),r.setAttribute("displayed","false")},{once:!0}),r.setAttribute("displayed","true"),void s.classList.add("wf")}s.setAttribute("code",i.status.code.toString()),s.innerText=i.status.text}function o(e,i,a){var d=(0,c.d)(e,".mh"),n=(0,c.d)(d,".nh"),r=(0,c.d)(n,".ph"),s=(0,c.d)(n,".qh");if(r.setAttribute("code",i.ranking.code.toString()),r.innerText=i.ranking.text,!t&&a){var o=e.getBoundingClientRect(),l=o.top,u=o.left,p=o.bottom,h=o.right,v=window.innerWidth,m=window.innerHeight;if(p>0&&l<m&&h>0&&u<v)return s.addEventListener("animationend",function(){s.setAttribute("code",i.ranking.code.toString()),s.innerText=i.ranking.text,s.classList.remove("zh"),r.setAttribute("displayed","false")},{once:!0}),r.setAttribute("displayed","true"),void s.classList.add("zh")}s.setAttribute("code",i.ranking.code.toString()),s.innerText=i.ranking.text}function l(e,t){var i=(0,c.d)(e,".mh");(0,c.d)(i,"._h").innerText=t.route_direction}function u(e,t){var i=(0,c.d)(e,".mh");(0,c.d)(i,".ai").innerText=t.route_name}function v(e,t){var i=(0,c.d)(e,".fi"),a=(0,c.d)(i,".li"),d=Array.from((0,c.c)(a,".ni")),n=d.length,r=t.buses.length,s=n-r;if(s<0){for(var o=new DocumentFragment,l=0;l>s;l--){var u=de();o.appendChild(u),d.push(u)}a.append(o)}else if(s>0)for(var h=n-1,v=n-s-1;h>v;h--)d[h].remove(),d.splice(h,1);for(var m=0;m<r;m++){var f=t.buses[m],g=d[m],b=(0,c.d)(g,".pi"),A=(0,c.d)(b,".ti"),y=(0,c.d)(g,".wi"),L=(0,c.d)(y,"._i"),C=(0,c.d)(y,".aj"),E=(0,c.d)(y,".bj");g.setAttribute("on-this-route",(0,p.a)(f.onThisRoute)),A.innerText=f.carNumber,L.innerText=`路線：${f.RouteName}`,C.innerText=`狀態：${f.status.text}`,E.innerText=`類型：${f.type}`}a.setAttribute("empty",(0,p.a)(0===r))}function m(e,t){var i=(0,c.d)(e,".fi"),a=(0,c.d)(i,".mi"),d=Array.from((0,c.c)(a,".oi")),n=d.length,r=t.busArrivalTimes.length,s=n-r;if(s<0){for(var o=new DocumentFragment,l=0;l>s;l--){var u=ne();o.appendChild(u),d.push(u)}a.append(o)}else if(s>0)for(var v=n-1,m=n-s-1;v>m;v--)d[v].remove(),d.splice(v,1);for(var f=0;f<r;f++){var g=t.busArrivalTimes[f],b=d[f],A=(0,c.d)(b,".qi"),y=(0,c.d)(A,".ui"),L=(0,c.d)(A,".vi"),C=(0,c.d)(b,".xi");y.innerText=g.personalSchedule.name,L.innerText=`週${(0,h.g)(g.day).name} ${(0,h.i)(g.personalSchedule.period.start)} - ${(0,h.i)(g.personalSchedule.period.end)}`,C.innerHTML=g.chart}a.setAttribute("empty",(0,p.a)(0===r))}function f(e,t){t&&e.setAttribute("stretched","false")}function A(e,t){e.setAttribute("animation",(0,p.a)(t))}function y(e,t){e.setAttribute("skeleton-screen",(0,p.a)(t))}function L(e,t){var i=(0,c.d)(e,".fi"),a=(0,c.d)(i,".gi"),d=(0,c.d)(a,'.hi[type="save-to-folder"]');d.onclick=function(){(0,g.b)("stop",[t.stopId,t.routeId],d)},(0,n.e)("stop",t.stopId).then(function(e){d.setAttribute("highlighted",(0,p.a)(e))})}function C(e,t){var i=(0,c.d)(e,".fi"),a=(0,c.d)(i,".gi"),d=(0,c.d)(a,'.hi[type="schedule-notification"]');d.onclick=function(){(0,b.b)(d,t.stopId,t.routeId,t.status.time)};var n=(0,s.r)(t.stopId);d.setAttribute("highlighted",(0,p.a)(n))}null==d?(r(e,a,i),o(e,a,i),l(e,a),u(e,a),v(e,a),m(e,a),f(e,t),A(e,i),y(e,t),L(e,a),C(e,a)):(a.status.time!==d.status.time&&(r(e,a,i),C(e,a)),d.ranking.number===a.ranking.number&&d.ranking.code===a.ranking.code||o(e,a,i),d.stopId!==a.stopId&&(l(e,a),u(e,a),L(e,a)),(0,p.b)(d.buses,a.buses)||v(e,a),(0,p.b)(d.busArrivalTimes,a.busArrivalTimes)||m(e,a),i!==M&&A(e,i),t!==N&&(f(e,t),y(e,t)))}function o(e,a,d){function n(e,t){var i=(0,c.d)(e,".gh");(0,v.c)(i,t.icon)}function r(e,t){(0,c.d)(e,".hh").innerHTML=t.value}function s(e,t){e.setAttribute("animation",(0,p.a)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.a)(t))}null==d?(n(e,a),r(e,a),s(e,i),o(e,t)):((0,p.b)(d.icon,a.icon)||n(e,a),(0,p.b)(d.value,a.value)||r(e,a),i!==M&&s(e,i),t!==N&&o(e,t))}var l=(0,m.e)("window"),f=l.width,y=l.height,L=e.groupQuantity,$=e.itemQuantity,I=e.groupedItems,D=e.groups;j=L,R=f;for(var B=0,H=0;H<L;H++){var Q=`g_${H}`,z=(0,u.d)(D[Q].name,500,"17px",'"Noto Sans TC", sans-serif')+20;F[Q]={width:z,offset:B},B+=z}if(F[`g_${L}`]={width:0,offset:B},!q){var U=F[`g_${P}`],W=-1*U.offset+.5*R-.5*U.width,G=U.width-20;Y(j,W,G,P)}(null===(a=S)||void 0===a?void 0:a.hash)!==e.hash&&(w.onclick=function(){(0,A.b)(e.hash)}),(null===(d=S)||void 0===d?void 0:d.LocationName)!==e.LocationName&&(E.innerText=e.LocationName),M!==i&&(C.setAttribute("animation",(0,p.a)(i)),x.setAttribute("animation",(0,p.a)(i))),N!==t&&(C.setAttribute("skeleton-screen",(0,p.a)(t)),x.setAttribute("skeleton-screen",(0,p.a)(t)),_.setAttribute("skeleton-screen",(0,p.a)(t)));var J=Array.from((0,c.c)(k,".bh")),K=Array.from((0,c.c)(T,".ug")),O=J.length;if(L!==O){var V=O-L;if(V<0){for(var X=new DocumentFragment,Z=new DocumentFragment,re=0;re>V;re--){var se=te();X.appendChild(se),J.push(se);var oe=ie();Z.appendChild(oe),K.push(oe)}k.append(X),T.append(Z)}else if(V>0)for(var le=O-1,ce=O-V-1;le>ce;le--)J[le].remove(),J.splice(le,1),K[le].remove(),K.splice(le,1)}for(var ue=(0,c.c)(k,".bh"),pe=0;pe<L;pe++){var he=`g_${pe}`,ve=ue[pe],me=(0,c.d)(ve,".ch"),fe=(0,c.d)(me,".dh"),ge=Array.from((0,c.c)(fe,".fh")),be=ge.length,Ae=D[he].properties.length;if(Ae!==be){var ye=be-Ae;if(ye<0){for(var Le=new DocumentFragment,Ce=0;Ce>ye;Ce--){var Ee=ae();Le.appendChild(Ee),ge.push(Ee)}fe.append(Le)}else if(ye>0)for(var we=be-1,ke=be-ye-1;we>ke;we--)ge[we].remove(),ge.splice(we,1)}var xe=(0,c.d)(ve,".kh"),Te=Array.from((0,c.c)(xe,".lh")),_e=Te.length;if($[he]!==_e){var $e=_e-$[he];if($e<0){for(var Ie=new DocumentFragment,Se=0;Se>$e;Se--){var Me=ee();Ie.appendChild(Me),Te.push(Me)}xe.append(Ie)}else if($e>0)for(var Ne=_e-1,Pe=_e-$e-1;Ne>Pe;Ne--)Te[Ne].remove(),Te.splice(Ne,1)}var De=K[pe];(0,c.d)(De,"span").innerText=D[he].name,De.style.setProperty("--eg",`${F[he].offset}px`),De.style.setProperty("--fg",`${F[he].width}px`),De.style.setProperty("--vg",pe.toString());for(var je=0;je<Ae;je++){var Fe=D[he].properties[je],Re=ge[je];if((0,p.e)(S,"groups"))if((0,p.e)(S.groups,he))if(S.groups[he].properties[je])o(Re,Fe,S.groups[he].properties[je]);else o(Re,Fe,null);else o(Re,Fe,null);else o(Re,Fe,null)}for(var qe=0;qe<$[he];qe++){var Be=Te[qe],He=I[he][qe];if((0,p.e)(S,"groupedItems"))if((0,p.e)(S.groupedItems,he))if(S.groupedItems[he][qe])r(Be,He,S.groupedItems[he][qe]);else r(Be,He,null);else r(Be,He,null);else r(Be,He,null)}}T.style.setProperty("--ig",`${B}px`),S=e,M=i,N=t}function se(){return oe.apply(this,arguments)}function oe(){return(oe=(0,a.a)(function*(){var e=(0,l.b)("playing_animation"),t=(0,l.b)("refresh_interval"),i=(0,m.e)("location-bus-arrival-time-chart");z=t.dynamic,B=t.baseInterval,J=!0,G=(0,p.c)(),I.setAttribute("refreshing","true"),I.classList.remove("_g"),document.addEventListener(G,Z);var a=yield(0,r.a)(V,i.width,i.height,G);re(a,!1,e);var n=0;z&&(n=yield(0,d.c)()),U=(new Date).getTime(),W=z?Math.max(U+H,a.dataUpdateTime+B/n):U+B,Q=Math.max(H,W-U),J=!1,I.setAttribute("refreshing","false"),I.style.setProperty("--lg",`${Q}ms`),I.classList.add("_g")})).apply(this,arguments)}function le(){se().then(function(){K?setTimeout(function(){le()},Math.max(H,W-(new Date).getTime())):O=!1}).catch(function(e){K?((0,f.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){le()},1e4)):O=!1})}function ce(e){(0,m.d)("Location"),(0,o.e)("location",e),V=e,P=0,F={},y.setAttribute("displayed","true"),k.scrollLeft=0,k.focus(),function(e){for(var t=(0,l.b)("playing_animation"),i=(0,m.e)("window"),a=(i.width,i.height),d={g_0:Math.floor(a/50)+5,g_1:Math.floor(a/50)+5},n={},r=0;r<2;r++){var s=`g_${r}`;n[s]=[];for(var o=0;o<d[s];o++)n[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}re({groupedItems:n,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:d,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,O?se():(O=!0,le())),(0,m.a)()}function ue(){y.setAttribute("displayed","false"),K=!1,(0,m.c)()}function pe(e,t){var i=(0,c.d)(e,".fi"),a=(0,c.d)(i,".gi"),d=(0,c.c)(a,'.hi[highlighted="true"][type="tab"]');for(var n of d)n.setAttribute("highlighted","false");switch((0,c.d)(a,`.hi[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,c.d)(e,".li").setAttribute("displayed","true"),(0,c.d)(e,".mi").setAttribute("displayed","false");break;case 1:(0,c.d)(e,".li").setAttribute("displayed","false"),(0,c.d)(e,".mi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=edb48ef9bc47d750ae5f.js.map