"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[576],{7123:(e,t,n)=>{n.d(t,{R:()=>_});var r=n(7183),a=n(6483),o=n(6802),i=n(7810),u=n(2063),s=n(8011),d=n(4293),l=n(1932),f=n(424),c=n(2303),y=n(6788),p=n(3459),h=n(1531);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function _(e,t,n,r,a){return S.apply(this,arguments)}function S(){var e;return e=function*(e,t,n,m,g){(0,y.Mf)(g,"getRoute_0",0,!1),(0,y.Mf)(g,"getRoute_1",0,!1),(0,y.Mf)(g,"getStop_0",0,!1),(0,y.Mf)(g,"getStop_1",0,!1),(0,y.Mf)(g,"getLocation_0",0,!1),(0,y.Mf)(g,"getLocation_1",0,!1),(0,y.Mf)(g,"getSegmentBuffers_0",0,!1),(0,y.Mf)(g,"getSegmentBuffers_1",0,!1),(0,y.Mf)(g,"getEstimateTime_0",0,!1),(0,y.Mf)(g,"getEstimateTime_1",0,!1),(0,y.Mf)(g,"getBusEvent_0",0,!1),(0,y.Mf)(g,"getBusEvent_1",0,!1),(0,y.Mf)(g,"getBusData_0",0,!1),(0,y.Mf)(g,"getBusData_1",0,!1);var _=yield(0,d.a)(g,!0),S=yield(0,f.T)(g),w=yield(0,s.g)(g,0),b=yield(0,s.g)(g,1),I=yield(0,s.g)(g,2),D=yield(0,l.L)(g),T=yield(0,u.K)(g),P=yield(0,i.J)(g),k=yield(0,o.d)(g),B=yield(0,a.Io)(n,m),M=(0,c.w_)(P,k,_,e,t),$=!1,E={};D.hasOwnProperty(`r_${e}`)&&($=!0,E=D[`r_${e}`]);var R,O=(0,p.Js)("time_formatting_mode"),U=[],A=[],H=v(T);try{for(H.s();!(R=H.n()).done;){var L=R.value,x={},Q=L.RouteID;if([e,10*e].includes(Q)||t.includes(Q)){x.status=(0,c.$Q)(null==L?void 0:L.EstimateTime,O);var W=`s_${L.StopID}`,G={};if(!S.hasOwnProperty(W))continue;G=S[W],x.id=L.StopID,x.sequence=G.seqNo,x.goBack=G.goBack;var q=`l_${G.stopLocationId}`,C={};if(!w.hasOwnProperty(q))continue;C=w[q],x.name=C.n,x.overlappingRoutes=C.r.filter((function(t){return t!==e})).map((function(e){var t=`r_${e}`;if(_.hasOwnProperty(t)){var n=_[t];return{name:n.n,RouteEndPoints:{RouteDeparture:n.dep,RouteDestination:n.des,text:`${n.dep} ↔ ${n.des}`,html:`<span>${n.dep}</span><span>↔</span><span>${n.des}</span>`},RouteID:n.id,PathAttributeId:n.pid}}return null})).filter((function(e){return null!==e})),x.position={longitude:C.lo,latitude:C.la},A.push({latitude:C.la,longitude:C.lo,id:L.StopID});var j=C.g,F=[];I.hasOwnProperty(j)&&(F=I[j]);var Z,V=[],J=v(F);try{for(J.s();!(Z=J.n()).done;){var N=`ml_${Z.value.hash}`;if(b.hasOwnProperty(N)){var K=b[N],Y={name:K.n,distance:0|(0,r.aV)(K.la[0],K.lo[0],C.la,C.lo),hash:K.hash};V.push(Y)}}}catch(e){J.e(e)}finally{J.f()}V.sort((function(e,t){return e.distance-t.distance})),x.nearbyLocations=V;var z,X=[],ee=v(C.s);try{for(ee.s();!(z=ee.n()).done;){var te=`s_${z.value}`;M.hasOwnProperty(te)&&X.push(M[te].map((function(e){return(0,c.s$)(e)})))}}catch(e){ee.e(e)}finally{ee.f()}x.buses=X.flat().sort((function(e,t){return e.index-t.index}));var ne=[];B.hasOwnProperty(W)&&(ne=B[W]),x.busArrivalTimes=ne;var re=!1,ae=!1,oe=!1,ie=!1;if($){var ue=`g_${x.goBack}`,se=[];E.hasOwnProperty(ue)?se=E[ue]:"1"===x.goBack&&(ie=!0,se=E.g_0);var de,le=v(se);try{for(le.s();!(de=le.n()).done;){var fe=de.value;fe.OriginStopID!==L.StopID&&fe.DestinationStopID!==L.StopID||(re=!0),ie?(fe.OriginStopID===L.StopID&&(oe=!0),fe.DestinationStopID===L.StopID&&(ae=!0)):(fe.OriginStopID===L.StopID&&(ae=!0),fe.DestinationStopID===L.StopID&&(oe=!0))}}catch(e){le.e(e)}finally{le.f()}}x.segmentBuffer={isSegmentBuffer:re,isStartingPoint:ae,isEndingPoint:oe},U.push(x)}}}catch(e){H.e(e)}finally{H.f()}U.sort((function(e,t){return e.sequence-t.sequence}));for(var ce=(0,h.uQ)(A,450),ye=!1,pe=!1,he={},ve=0,me={},ge=U.length,_e=0;_e<ge;_e++){var Se=U[_e],we=U[_e+1]||Se,be=0;if(Se.buses.length>0&&Se.buses[0].onThisRoute){var Ie=[Se.buses[0].position.longitude,Se.buses[0].position.latitude],De=Ie[0],Te=Ie[1],Pe=[Se.position.longitude,Se.position.latitude],ke=Pe[0],Be=Pe[1],Me=[we.position.longitude,we.position.latitude],$e=Me[0],Ee=Me[1];if((De-ke)*($e-De)+(Te-Be)*(Ee-Te)>=0){var Re=Math.hypot(De-ke,Te-Be),Oe=Math.hypot(De-$e,Te-Ee);be=Math.max(0,Math.min(Re/(Re+Oe),1))}}Se.progress=be,Se.segmentBuffer.isStartingPoint&&(ye=!0),Se.segmentBuffer.isEndingPoint&&ye&&(pe=!0),ye&&!pe&&(Se.segmentBuffer.isSegmentBuffer=!0),ye&&pe&&(ye=!1,pe=!1);var Ue=!1;null!==ce&&ce.id===Se.id&&(Ue=!0),Se.nearest=Ue;var Ae=`g_${Se.goBack}`||"g_0";he.hasOwnProperty(Ae)||(he[Ae]=[],me[Ae]=0,ve+=1),he[Ae].push(Se),me[Ae]+=1}var He=_[`r_${e}`],Le={groupedItems:he,groupQuantity:ve,itemQuantity:me,RouteName:He.n,RouteEndPoints:{RouteDeparture:He.dep,RouteDestination:He.des},dataUpdateTime:(0,y.Zt)(g),RouteID:e,PathAttributeId:t};return(0,y.LQ)(g),(0,y.gC)(g),Le},S=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){g(o,r,a,i,u,"next",e)}function u(e){g(o,r,a,i,u,"throw",e)}i(void 0)}))},S.apply(this,arguments)}},8621:(e,t,n)=>{n.d(t,{p:()=>y});var r=n(5579),a=n(313),o=n(4293),i=n(8201),u=n(8671),s=n(2303),d=n(6788);function l(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t,n){return p.apply(this,arguments)}function p(){var e;return e=function*(e,t,n){var l=function(e,t){var n,r={},a=f(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.Id===t){r=o;break}}}catch(e){a.e(e)}finally{a.f()}return r}(yield(0,o.a)(n,!1),e),c=yield(0,i.Y)(n),y=yield(0,u.s)(n),p=yield(0,a.s)(n),h=function(e){var t=(0,s.aU)(e.goFirstBusTime,0),n=(0,s.aU)(e.goLastBusTime,0),r=(0,s.aU)(e.backFirstBusTime,0),a=(0,s.aU)(e.backLastBusTime,0),o=(0,s.aU)(e.holidayGoFirstBusTime,0),i=(0,s.aU)(e.holidayGoLastBusTime,0),u=(0,s.aU)(e.holidayBackFirstBusTime,0),d=(0,s.aU)(e.holidayBackLastBusTime,0),l=(0,s.aU)(e.peakHeadway,1),f=(0,s.aU)(e.offPeakHeadway,1),c=(0,s.aU)(e.holidayPeakHeadway,1),y=(0,s.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:l,offRushHourWindow:f},holiday:{first:o,last:i,rushHourWindow:c,offRushHourWindow:y}},back:{weekday:{first:r,last:a,rushHourWindow:l,offRushHourWindow:f},holiday:{first:u,last:d,rushHourWindow:c,offRushHourWindow:y}},realSequence:e.realSequence}}(l),v=function(e,t,n,a,o){var i,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},d=(0,r.P$)(),l=f(a);try{for(l.s();!(i=l.n()).done;){var c=i.value;if(t.indexOf(c.PathAttributeId)>-1&&"0"===c.DateType)for(var y=(0,r.mr)(c.DateValue),p=(0,r.S1)(d,y.day,0,0),h=(0,s.aU)(c.StartTime,0),v=(0,r.S1)(p,0,h.hours,h.minutes),m=(0,s.aU)(c.EndTime,0),g=(0,r.S1)(p,0,m.hours,m.minutes),_=Math.abs(60*m.hours+m.minutes-(60*h.hours+h.minutes)),S=parseInt(c.LongHeadway),w=parseInt(c.LowHeadway),b=(w+S)/2,I=_/b,D=0;D<I;D++){var T=!1,P=(0,r.S1)(p,0,h.hours,h.minutes+w*D);P.getTime()<v.getTime()&&(T=!0),P.getTime()>g.getTime()&&(T=!0),!1===T&&(u.calendarEventGroups[y.code].push({date:P,dateString:(0,r.$T)(P,"hh:mm"),duration:w,deviation:Math.abs(b-w)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){l.e(e)}finally{l.f()}var k,B=f(o);try{for(B.s();!(k=B.n()).done;){var M=k.value;if(t.indexOf(M.PathAttributeId)>-1&&"0"===M.DateType){var $=(0,r.mr)(M.DateValue),E=(0,r.S1)(d,$.day,0,0),R=(0,s.aU)(M.DepartureTime,0),O=(0,r.S1)(E,0,R.hours,R.minutes);u.calendarEventGroups[$.code].push({date:O,dateString:(0,r.$T)(O,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[$.code]+=1}}}catch(e){B.e(e)}finally{B.f()}for(var U in u.calendarEventGroups)u.calendarEventGroups[U].sort((function(e,t){return e.date.getTime()-t.date.getTime()}));return u}(0,t,0,c,y),m=function(e,t){var n,r={},a=f(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.id===t&&(r=o)}}catch(e){a.e(e)}finally{a.f()}return r}(p,l.providerId),g={timeTableRules:h,calendar:v,properties:[{key:"route_name",icon:"route",value:l.nameZh},{key:"pricing",icon:"attach_money",value:l.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,d.LQ)(n),(0,d.gC)(n),g},p=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){l(o,r,a,i,u,"next",e)}function u(e){l(o,r,a,i,u,"throw",e)}i(void 0)}))},p.apply(this,arguments)}}}]);
//# sourceMappingURL=7d6ca7c058224b1e9d61.js.map