"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[5680],{365(e,t,n){n.d(t,{G:()=>c});var r=n(77),i=n(4778),a=n(2571),o=n(1172);function u(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function c(e){return s.apply(this,arguments)}function s(){var e;return e=function*(e){if(""===r.M3||""===r.se||void 0===e)return!1;var t=(0,i.F)("cancel",[e]),n=(0,a.b)("cancel",[e]),u=yield(0,o.R)("cancel",t,n);return!1!==u&&200===u.code&&"cancel"===u.method&&(yield(0,r.VJ)(e),!0)},s=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,c,"next",e)}function c(e){u(a,r,i,o,c,"throw",e)}o(void 0)})},s.apply(this,arguments)}},1172(e,t,n){function r(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function i(e,t,n){return a.apply(this,arguments)}function a(){var e;return e=function*(e,t,n){try{if(!1===t||!1===n)return!1;var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"omit"},i=yield fetch(t,r);if(!i.ok)return yield i.text(),!1;try{var a=yield i.text(),o=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}},a=function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function u(e){r(o,i,a,u,c,"next",e)}function c(e){r(o,i,a,u,c,"throw",e)}u(void 0)})},a.apply(this,arguments)}n.d(t,{R:()=>i})},2571(e,t,n){n.d(t,{b:()=>o});var r=n(8024),i=n(77);function a(e,t,n){var i=(new Date).getTime(),a=(i-i%5e3)/5e3;return(0,r.Zf)((0,r.Zf)(`${e}\n${t}\n${a}\n${(0,r.Zf)(`${e}\n${t}\n${(0,r.Zf)(JSON.stringify(n))}`)}`))}function o(e,t){switch(e){case"cancel":return""!==i.M3&&""!==i.se&&1===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var n=new Date;return n.setMilliseconds(0),n.setSeconds(0),{hash:(0,r.Zf)(`${(0,r.Zf)(t[0])}${n.getTime()}`)};case"schedule":return""!==i.M3&&""!==i.se&&9===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==i.M3&&""!==i.se&&0===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{})};case"reschedule":return""!==i.M3&&""!==i.se&&3===t.length&&{client_id:i.M3,token:a(i.M3,i.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3447(e,t,n){n.d(t,{Z:()=>l});var r=n(77),i=n(4778),a=n(2571),o=n(1172);function u(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function c(){var e;return e=function*(){if(""===r.M3||""===r.se)return!1;var e=(0,i.F)("rotate"),t=(0,a.b)("rotate",[]),n=yield(0,o.R)("rotate",e,t);return!1!==n&&200===n.code&&"rotate"===n.method&&((0,r.uQ)(n.secret),yield(0,r.ms)(),!0)},c=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,c,"next",e)}function c(e){u(a,r,i,o,c,"throw",e)}o(void 0)})},c.apply(this,arguments)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function d(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function l(e,t,n,r,i,a,o,u,c){return f.apply(this,arguments)}function f(){var e;return e=function*(e,t,n,u,d,l,f,y,h){if(""===r.M3||""===r.se||void 0===e||void 0===t||void 0===n||void 0===u||void 0===d||void 0===l||"number"!=typeof f||void 0===h)return!1;var v=new Date;switch(s(h)){case"string":case"number":v=new Date(h);break;default:if(!(h instanceof Date))return!1;v=h}var p=(0,i.F)("schedule"),m=(0,a.b)("schedule",[e,t,n,u,d,l,f,y,v.toISOString()]),g=yield(0,o.R)("schedule",p,m);return!1!==g&&200===g.code&&"schedule"===g.method&&(Math.random()>.8&&(yield function(){return c.apply(this,arguments)}()),yield(0,r.G7)(g.schedule_id,e,t,n,u,d,l,f,y,v.getTime()),g.schedule_id)},f=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){d(a,r,i,o,u,"next",e)}function u(e){d(a,r,i,o,u,"throw",e)}o(void 0)})},f.apply(this,arguments)}},4311(e,t,n){function r(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function u(e){r(o,i,a,u,c,"next",e)}function c(e){r(o,i,a,u,c,"throw",e)}u(void 0)})}}n.d(t,{Ct:()=>d,Su:()=>h,VC:()=>_,iQ:()=>f,le:()=>p,mL:()=>c,tH:()=>m});var a=n(3790),o={cacheStore:!1,settingsStore:!1,dataUsageStatsStore:!1,updateRateDataStore:!1,updateRateDataWriteAheadLogStore:!1,busArrivalTimeDataWriteAheadLogStore:!1,busArrivalTimeDataStore:!1,personalScheduleStore:!1,recentViewsStore:!1,notificationStore:!1,notificationScheduleStore:!1,folderListStore:!1,folderContentIndexStore:!1,folderContentStore:!1},u=["cacheStore","settingsStore","dataUsageStatsStore","updateRateDataStore","updateRateDataWriteAheadLogStore","busArrivalTimeDataWriteAheadLogStore","busArrivalTimeDataStore","personalScheduleStore","recentViewsStore","notificationStore","notificationScheduleStore","folderListStore","folderContentIndexStore","folderContentStore"];function c(e,t,n){return s.apply(this,arguments)}function s(){return(s=i(function*(e,t,n){try{var r=u[e];return!1===o[r]&&(o[r]=yield a.createInstance({name:r})),yield o[r].setItem(t,n)}catch(e){return null}})).apply(this,arguments)}function d(e,t){return l.apply(this,arguments)}function l(){return(l=i(function*(e,t){try{var n=u[e];return!1===o[n]&&(o[n]=yield a.createInstance({name:n})),yield o[n].getItem(t)}catch(e){return null}})).apply(this,arguments)}function f(e,t){return y.apply(this,arguments)}function y(){return(y=i(function*(e,t){try{var n=u[e];return!1===o[n]&&(o[n]=yield a.createInstance({name:n})),yield o[n].removeItem(t)}catch(e){return null}})).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=i(function*(e){try{var t=u[e];return!1===o[t]&&(o[t]=yield a.createInstance({name:t})),yield o[t].keys()}catch(e){return[]}})).apply(this,arguments)}function p(){return u.length}function m(){return g.apply(this,arguments)}function g(){return(g=i(function*(){if(navigator.storage&&navigator.storage.persist)return yield navigator.storage.persisted();return!1})).apply(this,arguments)}function _(){return S.apply(this,arguments)}function S(){return(S=i(function*(){if(navigator.storage&&navigator.storage.persist)return(yield navigator.storage.persist())?"granted":"denied";return"unsupported"})).apply(this,arguments)}},4778(e,t,n){n.d(t,{F:()=>i});var r=n(77);function i(e){if(""===r.ph)return!1;var t=new URL(r.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5427(e,t,n){n.d(t,{Qx:()=>_});var r=n(9566),i=n(5352),a=n(5314),o=n(3459),u=n(4311);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){d(a,r,i,o,u,"next",e)}function u(e){d(a,r,i,o,u,"throw",e)}o(void 0)})}}function f(e){return y.apply(this,arguments)}function y(){return(y=l(function*(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=i,o=!1,s=!1,d=`f_${a.id}`;if((yield(0,u.Ct)(11,d))?o=yield(0,r.g$)(a.id,a.name,a.icon):s=yield(0,r.vV)(a.name,a.icon),o){var l,f=c(i.content);try{for(f.s();!(l=f.n()).done;){var y=l.value;yield(0,r.z$)(i.id,y)}}catch(e){f.e(e)}finally{f.f()}}if(s){var h,v=c(i.content);try{for(v.s();!(h=v.n()).done;){var p=h.value;yield(0,r.z$)(s,p)}}catch(e){v.e(e)}finally{v.f()}}}}catch(e){n.e(e)}finally{n.f()}})).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=l(function*(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=(0,o.PL)(r.key);i&&"select"===i.type&&(yield(0,o.aN)(r.key,r.option))}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=l(function*(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;(yield(0,i.qZ)(r.id))?yield(0,i.nL)(r):yield(0,i.Qh)(r.name,r.period.start.hours,r.period.start.minutes,r.period.end.hours,r.period.end.minutes,r.days)}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function g(){return(g=l(function*(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;switch(r.type){case"route":(yield(0,a.DF)("route",r.id))||(yield(0,a.XK)(r.type,r.id));break;case"location":(yield(0,a.DF)("location",r.hash))||(yield(0,a.XK)(r.type,r.hash));break;case"bus":(yield(0,a.DF)("bus",r.id))||(yield(0,a.XK)(r.type,r.id))}}}catch(e){n.e(e)}finally{n.f()}return!0})).apply(this,arguments)}function _(e){return S.apply(this,arguments)}function S(){return S=l(function*(e){var t=JSON.parse(e);switch(t.version){case 1:return yield f(t.folders),!0;case 2:return yield f(t.folders),yield h(t.settings),!0;case 3:return yield f(t.folders),yield h(t.settings),yield p(t.personal_schedules),!0;case 4:return yield f(t.folders),yield h(t.settings),yield p(t.personal_schedules),yield function(e){return g.apply(this,arguments)}(t.recent_views),!0;default:return!1}}),S.apply(this,arguments)}},5976(e,t,n){n.d(t,{R:()=>c});var r=n(9566),i=n(5352),a=n(5314),o=n(3459);function u(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function c(){return s.apply(this,arguments)}function s(){var e;return e=function*(){var e=yield(0,r.Xi)(),t=(0,o.Gn)(),n=yield(0,i.ty)(),u=yield(0,a.Qj)(),c={};return c.time=(new Date).toISOString(),c.version=4,c.folders=e,c.settings=t,c.personal_schedules=n,c.recent_views=u,JSON.stringify(c)},s=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,c,"next",e)}function c(e){u(a,r,i,o,c,"throw",e)}o(void 0)})},s.apply(this,arguments)}},6983(e,t,n){n.d(t,{v:()=>c});var r=n(1351),i=n(3041),a=n(8011),o=n(6788);function u(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function c(e,t){return s.apply(this,arguments)}function s(){var e;return e=function*(e,t){var n=yield(0,a.g)(t,1);(0,o.LQ)(t),(0,o.gC)(t);var u=`ml_${e}`;if(!n.hasOwnProperty(u))return{actions:[],actionsQuantity:0,hash:e};n[u];var c=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,i.B)("location",[e])}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,r.k9)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,r.qp)(e)}}];return{actions:c,actionsQuantity:c.length,hash:e}},s=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,c,"next",e)}function c(e){u(a,r,i,o,c,"throw",e)}o(void 0)})},s.apply(this,arguments)}},8621(e,t,n){n.d(t,{p:()=>y});var r=n(5579),i=n(313),a=n(4293),o=n(8201),u=n(8671),c=n(2303),s=n(6788);function d(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t,n){return h.apply(this,arguments)}function h(){var e;return e=function*(e,t,n){var d=function(e,t){var n,r={},i=l(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.Id===t){r=a;break}}}catch(e){i.e(e)}finally{i.f()}return r}(yield(0,a.a)(n,!1),e),f=yield(0,o.Y)(n),y=yield(0,u.s)(n),h=yield(0,i.s)(n),v=function(e){var t=(0,c.aU)(e.goFirstBusTime,0),n=(0,c.aU)(e.goLastBusTime,0),r=(0,c.aU)(e.backFirstBusTime,0),i=(0,c.aU)(e.backLastBusTime,0),a=(0,c.aU)(e.holidayGoFirstBusTime,0),o=(0,c.aU)(e.holidayGoLastBusTime,0),u=(0,c.aU)(e.holidayBackFirstBusTime,0),s=(0,c.aU)(e.holidayBackLastBusTime,0),d=(0,c.aU)(e.peakHeadway,1),l=(0,c.aU)(e.offPeakHeadway,1),f=(0,c.aU)(e.holidayPeakHeadway,1),y=(0,c.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:d,offRushHourWindow:l},holiday:{first:a,last:o,rushHourWindow:f,offRushHourWindow:y}},back:{weekday:{first:r,last:i,rushHourWindow:d,offRushHourWindow:l},holiday:{first:u,last:s,rushHourWindow:f,offRushHourWindow:y}},realSequence:e.realSequence}}(d),p=function(e,t,n,i,a){var o,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,r.P$)(),d=l(i);try{for(d.s();!(o=d.n()).done;){var f=o.value;if(t.indexOf(f.PathAttributeId)>-1&&"0"===f.DateType)for(var y=(0,r.mr)(f.DateValue),h=(0,r.S1)(s,y.day,0,0),v=(0,c.aU)(f.StartTime,0),p=(0,r.S1)(h,0,v.hours,v.minutes),m=(0,c.aU)(f.EndTime,0),g=(0,r.S1)(h,0,m.hours,m.minutes),_=Math.abs(60*m.hours+m.minutes-(60*v.hours+v.minutes)),S=parseInt(f.LongHeadway),w=parseInt(f.LowHeadway),b=(w+S)/2,k=_/b,T=0;T<k;T++){var P=!1,D=(0,r.S1)(h,0,v.hours,v.minutes+w*T);D.getTime()<p.getTime()&&(P=!0),D.getTime()>g.getTime()&&(P=!0),!1===P&&(u.calendarEventGroups[y.code].push({date:D,dateString:(0,r.$T)(D,"hh:mm"),duration:w,deviation:Math.abs(b-w)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){d.e(e)}finally{d.f()}var I,A=l(a);try{for(A.s();!(I=A.n()).done;){var M=I.value;if(t.indexOf(M.PathAttributeId)>-1&&"0"===M.DateType){var U=(0,r.mr)(M.DateValue),x=(0,r.S1)(s,U.day,0,0),$=(0,c.aU)(M.DepartureTime,0),L=(0,r.S1)(x,0,$.hours,$.minutes);u.calendarEventGroups[U.code].push({date:L,dateString:(0,r.$T)(L,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[U.code]+=1}}}catch(e){A.e(e)}finally{A.f()}for(var O in u.calendarEventGroups)u.calendarEventGroups[O].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return u}(0,t,0,f,y),m=function(e,t){var n,r={},i=l(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.id===t&&(r=a)}}catch(e){i.e(e)}finally{i.f()}return r}(h,d.providerId),g={timeTableRules:v,calendar:p,properties:[{key:"route_name",icon:"route",value:d.nameZh},{key:"pricing",icon:"attach_money",value:d.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,s.LQ)(n),(0,s.gC)(n),g},h=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){d(a,r,i,o,u,"next",e)}function u(e){d(a,r,i,o,u,"throw",e)}o(void 0)})},h.apply(this,arguments)}}}]);
//# sourceMappingURL=b16219f007ebb1f3d113.js.map