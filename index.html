<!DOCTYPE html>
<html lang="zh-tw">

<head>
  <meta charset="UTF-8">
  <title>Bus</title>
  <meta name="description" content="Bus">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" kji="light">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#101010" kji="dark">
  <link href="https://erichsia7.github.io/bus/pwaicon2/512x512.png" sizes="512x512" rel="apple-touch-icon-precomposed" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="defualt" />
  <link type="image/x-icon" href="https://erichsia7.github.io/bus/pwaicon2/256x256_corner_radius.ico" rel="icon" />
  <link type="image/x-icon" href="https://erichsia7.github.io/bus/pwaicon2/256x256_corner_radius.ico" rel="bookmark" />
  <link type="image/x-icon" href="https://erichsia7.github.io/bus/pwaicon2/256x256_corner_radius.ico" rel="shortcut icon" />
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/12.9__ipad_pro_@2x.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/11__ipad_pro_@2x.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/10.5__ipad_pro_@2x.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/9.7__ipad_pro_@2x.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/7.9__ipad_mini_@2x.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/10.5__ipad_air_@2x.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/9.7__ipad_air_@2x.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/10.2__ipad_@2x.png" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/9.7__ipad_@2x.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_14_pro_max_@3x.png" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_14_pro_@3x.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_14_plus_@3x.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_14_@3x.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_13_pro_max_@3x.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_13_pro_@3x.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_13_@3x.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_13_mini_@3x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_12_pro_max_@3x.png" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_12_pro_@3x.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_12_@3x.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_12_mini_@3x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_11_pro_max_@3x.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_11_pro_@3x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_11_@2x.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_xs_max_@3x.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_xs_@3x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_xr_@2x.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_x_@3x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_8_plus_@3x.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_8_@2x.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_7_plus_@3x.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_7_@2x.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_6s_plus_@3x.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_6s_@2x.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_6_plus_@3x.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/iphone_6_@2x.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/4.7__iphone_se_@2x.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/4__iphone_se_@2x.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="https://erichsia7.github.io/bus/splash_screen/ipod_touch_5th_generation_and_later_@2x.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">

  <link rel="manifest" href="https://erichsia7.github.io/bus/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style id="routes_animation_css"></style>
  <style id="safe-area-size-o">
    :root {
      --o-safe-area-top: 0px;
      --o-safe-area-right: 0px;
      --o-safe-area-bottom: 0px;
      --o-safe-area-left: 0px;
    }

    @media all and (display-mode: standalone) {
      @media only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {
        :root {
          --o-safe-area-top: env(safe-area-inset-top);
          --o-safe-area-right: env(safe-area-inset-right);
          --o-safe-area-bottom: 24px;
          --o-safe-area-left: env(safe-area-inset-left);
        }
      }

      @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
        :root {
          --o-safe-area-top: env(safe-area-inset-top);
          --o-safe-area-right: env(safe-area-inset-right);
          --o-safe-area-bottom: 24px;
          --o-safe-area-left: env(safe-area-inset-left);
        }
      }

      @media only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {
        :root {
          --o-safe-area-top: env(safe-area-inset-top);
          --o-safe-area-right: env(safe-area-inset-right);
          --o-safe-area-bottom: 24px;
          --o-safe-area-left: env(safe-area-inset-left);
        }
      }

      @media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {
        :root {
          --o-safe-area-top: env(safe-area-inset-top);
          --o-safe-area-right: env(safe-area-inset-right);
          --o-safe-area-bottom: 24px;
          --o-safe-area-left: env(safe-area-inset-left);
        }
      }
    }
  </style>
  <style>
    :root {
      --g-333333: #333333;
      --g-333333-r: 51;
      --g-333333-g: 51;
      --g-333333-b: 51;
      --g-f5f5f5: #f5f5f5;
      --g-14b1ff: #14b1ff;
      --g-c7ecff: #c7ecff;
      --g-ffffff: #ffffff;
      --g-888888: #888888;
      --g-888888-r: 136;
      --g-888888-g: 136;
      --g-888888-b: 136;
      --g-c7c7c7: #c7c7c7;
      --g-e3e3e3: #e3e3e3;
      --g-e3e3e3-r: 227;
      --g-e3e3e3-g: 227;
      --g-e3e3e3-b: 227;
      --options-switch-border-color: #888888;
      --options-switch-transition-duration: 450ms;
      --options-switch-checked-color: #14b1ff;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --g-333333: #ffffff;
        --g-333333-r: 255;
        --g-333333-g: 255;
        --g-333333-b: 255;
        --g-f5f5f5: #1f1f1f;
        --g-14b1ff: #2f92cc;
        --g-c7ecff: #2e4a59;
        --g-ffffff: #101010;
        --g-888888: #888888;
        --g-888888-r: 136;
        --g-888888-g: 136;
        --g-888888-b: 136;
        --g-c7c7c7: #383838;
        --g-e3e3e3: #262626;
        --g-e3e3e3-r: 38;
        --g-e3e3e3-g: 38;
        --g-e3e3e3-b: 38;
        --options-switch-checked-color: #2f92cc;
      }
    }

    * {
      font-family: 'Noto Sans', sans-serif;
      -webkit-appearance: none;
      appearance: none;
      outline: none;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    button {
      -webkit-appearance: none;
      appearance: none;
      border: none;
      margin: 0px;
      padding: 0px;
      box-sizing: border-box;
      background: transparent;
      display: block;
      border-radius: 0px;
      font-size: unset;
      font-weight: unset;
    }

    body {
      margin: 0px;
      padding: 0px;
      background: var(--g-ffffff);
    }

    .back_btn,
    .info_btn,
    .search_back_btn,
    .options_btn {
      position: absolute;
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
      border-radius: 35px;
    }

    .back_btn,
    .search_back_btn {
      top: 7.5px;
      left: 7.5px;
    }

    .info_btn,
    .options_btn {
      top: 7.5px;
      right: 7.5px;
    }

    .back_btn svg,
    .info_btn svg,
    .search_back_btn svg,
    .options_btn svg {
      width: 22px;
      height: 22px;
      user-select: none;
      -webkit-user-select: none;
    }

    .refresh_progress_box {
      position: fixed;
      top: 95px;
      left: 0px;
      height: 1.2px;
      width: 100%;
      overflow: hidden;
      background: var(--g-e3e3e3);
      transition: 0.35s;
      transform: translateX(0px) translateY(0px);
    }

    .refresh_progress {
      position: absolute;
      top: 0px;
      left: 0px;
      background: var(--g-c7c7c7);
      height: 1.2px;
      width: 100%;
      transform: translateX(var(--o-refresh-progress));
    }

    .route_container {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      margin: 0px;
      padding: 0px;
      overflow: hidden;
      background: var(--g-ffffff);
      display: none;
    }

    .title {
      width: 100%;
      height: 55px;
      position: absolute;
      top: 0px;
      left: 0px;
      background: var(--g-ffffff);
    }

    .title .routename {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 55px;
      color: var(--g-333333);
      font-weight: 700;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .title .routename[l="0"] {
      color: rgba(0, 0, 0, 0);
    }

    .title .routename[l="0"]::after {
      content: '';
      background: var(--g-f5f5f5);
      position: absolute;
      top: 12.5px;
      left: 50%;
      transform: translateX(-50%);
      width: 65px;
      height: 25px;
      border-radius: 30px;
    }

    .tabs {
      width: 100%;
      height: 40px;
      position: absolute;
      top: 55px;
      left: 0px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 0px;
      background: var(--g-ffffff);
      user-select: none;
      -webkit-user-select: none;
    }

    .tab {
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-user-select: none;
      user-select: none;
      font-size: 16px;
      position: relative;
      transition: none;
    }

    .tabs[slide="0"] .tab[g="0"],
    .tabs[slide="-1"] .tab[g="0"] {
      color: var(--g-333333);
      -webkit-text-stroke: 0.3px var(--g-333333);
    }

    .tabs[slide="0"] .tab[g="1"],
    .tabs[slide="-1"] .tab[g="1"] {
      color: var(--g-888888);
      -webkit-text-stroke: 0px var(--g-ffffff);
    }

    .tabs[slide="1"] .tab {
      transition: none;
      color: var(--j-slide-scale-c-p);
      -webkit-text-stroke: var(--j-slide-scale-ts-p) var(--j-slide-scale-c-p);
    }

    .tabs[slide="0"] .tab {
      transition: var(--j-transition-a-p);
    }

    .tab-line-box {
      position: absolute;
      left: 0px;
      bottom: 0px;
      width: 100%;
      height: 2px;
      user-select: none;
      -webkit-user-select: none;
    }

    .tab-line-box2 {
      position: absolute;
      top: 0px;
      left: 0px;
      height: 2px;
      width: calc(100% / 2);
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .tabs[l="1"] .tab-line-box2[slide="0"] {
      transition: var(--j-transition-p);
    }

    .tabs[l="1"] .tab-line-box2.departure[slide="-1"],
    .tabs[l="1"] .tab-line-box2.departure[slide="0"] {
      transform: translateX(0%);
    }

    .tabs[l="1"] .tab-line-box2.destination[slide="-1"],
    .tabs[l="1"] .tab-line-box2.destination[slide="0"] {
      transform: translateX(100%);
    }

    .tabs[l="1"] .tab-line-box2[slide="1"] {
      transition: none;
      transform: translateX(var(--j-slide-scale-rf-p));
    }

    .tab-line {
      width: 30px;
      height: 2px;
      background: var(--g-333333);
      border-radius: 15px 15px 0px 0px;
      user-select: none;
      -webkit-user-select: none;
    }

    .tabs[l="1"] .tab-line-box2[slide="-1"] .tab-line.departure,
    .tabs[l="1"] .tab-line-box2[slide="0"] .tab-line.departure {
      width: var(--tab-line-depature-width);
    }

    .tabs[l="1"] .tab-line-box2[slide="-1"] .tab-line.destination,
    .tabs[l="1"] .tab-line-box2[slide="0"] .tab-line.destination {
      width: var(--tab-line-destination-width);
    }

    .tab-line-box2[slide="-1"] .tab-line.initialization,
    .tab-line-box2[slide="0"] .tab-line.initialization {
      width: var(--j-initialization-width);
    }

    .tabs[l="1"] .tab-line-box2[slide="1"] .tab-line {
      transition: none;
      width: var(--j-slide-scale-yu-p);
    }

    .tabs[l="1"] .tab-line-box2[slide="0"] .tab-line {
      transition: var(--j-transition-w-p);
    }

    .tabs[l="0"] .tab-line {
      background: rgba(0, 0, 0, 0);
      display: none;
      transition: none;
    }

    .tabs[l="0"] .tab span {
      opacity: 0;
    }

    .tabs[l="0"] .tab::after {
      content: '';
      background: var(--g-f5f5f5);
      position: absolute;
      top: 7.5px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 25px;
      border-radius: 30px;
    }

    .routes {
      width: 200%;
      height: calc(100% - 95px);
      position: absolute;
      top: 95px;
      left: 0px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 0px;
      -webkit-user-select: none;
      user-select: none;
      background: var(--g-ffffff);
    }

    .routes.departure[slide="0"],
    .routes.departure[slide="-1"] {
      transform: translateX(0%);
    }

    .routes.destination[slide="0"],
    .routes.destination[slide="-1"] {
      transform: translateX(-50%);
    }

    .routes[slide="0"] {
      transition: var(--j-transition-p);
    }

    .routes[slide="1"] {
      transition: none;
      transform: translateX(var(--j-translateX-p));
    }

    .routes[slide="2"] {
      transition: transform 450ms;
    }

    .route {
      height: 100%;
      background: var(--g-ffffff);
      overflow: hidden;
    }

    .route::-webkit-scrollbar {
      display: none;
    }

    .routes[slide="-1"] .route,
    .routes[slide="0"] .route {
      overflow-y: scroll;
      overflow-x: hidden;
    }

    .routes[slide="1"] .route {
      overflow: hidden;
    }

    .route li.stop {
      list-style: none;
      display: block;
      height: 50px;
      width: 100%;
      position: relative;
      margin: 0px;
      padding: 0px;
      border-top: solid 1px var(--g-f5f5f5);
      background: var(--g-ffffff);
      -webkit-user-select: none;
      user-select: none;
    }

    .route li.stop:first-child {
      border: none;
    }

    .route li.stop:last-child {
      margin-bottom: var(--o-safe-area-bottom);
    }

    .route li.stop .name {
      position: absolute;
      top: 5px;
      left: 10px;
      height: 40px;
      width: calc(100% - 20px - 70px - 35px);
      white-space: nowrap;
      word-break: keep-all;
      overflow: hidden;
      display: flex;
      align-items: center;
      color: var(--g-333333);
      font-size: 20px;
      font-weight: 400;
      -webkit-user-select: none;
      user-select: none;
    }

    .route li.stop .position {
      position: absolute;
      top: 0px;
      right: 77.5px;
      width: 50px;
      height: 50px;
      box-sizing: border-box;
      display: none;
    }

    .position .position-white {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 20px;
    }

    .position .position-signal {
      position: absolute;
      left: 15px;
      top: 15px;
      width: 20px;
      height: 20px;
      background: var(--g-14b1ff);
      animation-name: position;
      animation-duration: 1.3s;
      animation-timing-function: ease-out;
      animation-iteration-count: infinite;
      border-radius: 30px;
    }

    .position .position-blue {
      position: absolute;
      left: 15px;
      top: 15px;
      width: 20px;
      height: 20px;
      background: var(--g-14b1ff);
      border-radius: 20px;
      box-sizing: border-box;
      transform: scale(0.5);
      animation-name: position_d;
      animation-duration: 2.5s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }

    .route li.stop .position[d="true"] {
      display: block;
    }

    .route li.stop[bus="true"] .position .position-signal {
      animation: none;
      transform: scale(1.75);
      background: rgba(0, 0, 0, 0);
      box-shadow: 0px 0px 7px -2px var(--g-14b1ff);
      opacity: 1;
    }

    @keyframes position {
      0% {
        transform: scale(1) translateZ(-1px);
        opacity: 0.5;
      }

      100% {
        transform: scale(2.5) translateZ(-1px);
        opacity: 0;
      }
    }


    @keyframes position_d {
      0% {
        transform: scale(0.65);
      }

      50% {
        transform: scale(0.8);
      }

      70% {
        transform: scale(0.8);
      }

      95% {
        transform: scale(0.65);
      }

      100% {
        transform: scale(0.65);
      }
    }

    .route .buffer-group {
      position: relative;
      width: 100%;
      height: auto;
      display: inline-block;
    }

    .route .buffer-group li.stop:first-child {
      border-top: dashed 1.2px var(--g-e3e3e3);
    }

    .route .buffer-group li.stop:last-child {
      border-bottom: dashed 1.2px var(--g-e3e3e3);
      margin: 0px;
    }

    .route .buffer-group li.stop:first-child::after {
      content: '緩衝區 開始';
      position: absolute;
      height: 15px;
      width: auto;
      left: 50%;
      transform: translateX(-50%);
      top: -7.5px;
      background: var(--g-ffffff);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      color: var(--g-888888);
      font-size: 15px;
    }

    .route .buffer-group li.stop:last-child::after {
      content: '緩衝區 結束';
      position: absolute;
      height: 15px;
      width: auto;
      left: 50%;
      transform: translateX(-50%);
      top: 42.5px;
      background: var(--g-ffffff);
      display: inline-flex;
      justify-content: center;
      align-items: center;
      color: var(--g-888888);
      font-size: 15px;
      z-index: 1;
    }

    .route .buffer-group+li.stop {
      border: none;
    }

    .route li.stop .bus {
      display: block;
      position: absolute;
      top: 7.5px;
      right: 85px;
      height: 35px;
      width: 35px;
      padding: 0px;
      box-sizing: border-box;
      background: var(--g-f5f5f5);
      border-radius: 20px;
      overflow: hidden;
      white-space: nowrap;
      word-break: keep-all;
      margin-left: 5px;
    }

    .route li.stop[l="false"] .bus[d="true"] svg {
      transition: opacity 0.3s;
    }

    .route li.stop .bus[l="1"] svg {
      opacity: 1;
    }

    .route li.stop .bus[l="0"] svg {
      opacity: 0.5;
    }

    .route li.stop .bus[d="false"] {
      display: none;
    }

    .route li.stop .bus .busicon {
      width: 35px;
      height: 35px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      top: 0px;
      left: 0px;
    }

    .route li.stop .bus .busicon svg {
      width: 18px;
      height: 18px;
    }

    .route li.stop .bus .busid {
      display: inline-flex;
      height: 25px;
      font-size: 13px;
      color: var(--g-333333);
      box-sizing: border-box;
      align-items: center;
      margin-right: 5px;
    }

    .route li.stop .bus .fl {
      float: left;
    }

    .route li.stop[l="true"] .name::after {
      content: '';
      background: var(--g-f5f5f5);
      position: absolute;
      top: 2.5px;
      left: 0px;
      width: calc(100% - 10px);
      height: 35px;
      border-radius: 30px;
    }

    .route li.stop .status {
      position: absolute;
      top: 7.5px;
      right: 10px;
      width: 70px;
      height: 35px;
      white-space: nowrap;
      word-break: keep-all;
      overflow: hidden;
      background: var(--g-f5f5f5);
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      color: var(--g-333333);
      -webkit-user-select: none;
      user-select: none;
    }

    .route li.stop .status[status="0"] {
      font-weight: 500;
    }

    .route li.stop .status[status="1"] {
      background: var(--g-c7ecff);
      color: var(--g-14b1ff);
      font-weight: 700;
    }

    .route li.stop .status[status="2"] {
      background: var(--g-14b1ff);
      color: var(--g-ffffff);
      font-weight: 700;
    }

    .route li.stop .status[status="3"] {
      color: var(--g-888888);
    }

    .route li.stop .status[status="4"] {
      color: var(--g-888888);
      font-weight: 500;
    }

    .route li.stop .status[status="5"] {
      color: var(--g-888888);
      font-weight: 500;
    }

    .route li.stop .status[status="6"] {
      color: var(--g-888888);
      font-weight: 500;
    }

    .routes[slide="-1"] .route li.stop .status[tr="true"] {
      transition: 0.3s;
    }

    .search {
      position: absolute;
      top: 28%;
      left: 50%;
      transform: translateX(-50%);
      height: 45px;
      width: clamp(150px, 80%, 300px);
      background: var(--g-f5f5f5);
      border-radius: 50px;
      transform-origin: top left;
      border-bottom: 1px solid rgba(0, 0, 0, 0);
      user-select: none;
      -webkit-user-select: none;
    }

    .search[p="1"] {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 55px;
      border-radius: 0px;
      transform: translateX(0px);
      background: var(--g-ffffff);
      border-bottom: 1px solid var(--g-f5f5f5);
    }

    .search[p="1"]::after {
      content: '';
      position: absolute;
      top: 15px;
      left: 55px;
      height: 25px;
      width: 1.5px;
      background: var(--g-333333);
      border-radius: 5px;
      animation-name: cursor;
      animation-duration: 0.9s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      transform-origin: top left;
      display: block;
      transform: translateX(var(--cursor-offset));
    }

    @keyframes cursor {
      0% {
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0;
      }
    }

    .input_placeholder {
      position: absolute;
      top: 0px;
      left: 10px;
      width: calc(100% - 20px);
      height: 45px;
      display: flex;
      align-items: center;
      font-size: 18px;
      color: var(--g-888888);
      margin: 0px;
      padding: 0px;
      box-sizing: border-box;
      opacity: 1;
      user-select: none;
      -webkit-user-select: none;
    }

    .search[p="1"] .input_placeholder {
      opacity: 0;
    }

    #search_routes {
      position: absolute;
      top: 5px;
      left: 10px;
      -webkit-appearance: none;
      appearance: none;
      border: none;
      background: rgba(0, 0, 0, 0);
      margin: 0px;
      padding: 0px;
      box-sizing: border-box;
      border-radius: 0px;
      font-size: 18px;
      width: calc(100% - 20px);
      height: 35px;
      font-weight: 500;
      opacity: 0;
      user-select: text;
      -webkit-user-select: text;
      color: var(--g-333333);
    }

    .search[p="1"] #search_routes {
      width: calc(100% - 55px - 10px);
      opacity: 1;
      top: 10px;
      left: 55px;
    }

    .search_routes_result {
      position: fixed;
      top: 55px;
      left: 0px;
      width: 100%;
      height: calc(100% - 55px - clamp(200px, 36%, 270px));
      overflow: scroll;
      display: none;
      user-select: none;
      -webkit-user-select: none;
      transition: 0.35s;
      transform: translateX(0px) translateY(calc(var(--k-search-top) + 45px));
    }

    .search_routes_result[p="1"] {
      display: block;
    }

    .search_routes_result li.search_result_r {
      list-style: none;
      margin: 0px;
      padding: 0px;
      width: 100%;
      height: 60px;
      box-sizing: border-box;
      position: relative;
      border-bottom: 1px solid var(--g-f5f5f5);
      user-select: none;
      -webkit-user-select: none;
    }

    .search_routes_result li.search_result_r button {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
    }

    .search_routes_result li.search_result_r:last-child {
      border: none;
    }

    .search_result_r_dep_to_des {
      position: absolute;
      top: 32.5px;
      left: 10px;
      width: calc(100% - 10px - 60px);
      font-size: 16px;
      color: var(--g-888888);
      height: 23px;
      text-align: left;
      display: flex;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
      white-space: nowrap;
      word-break: keep-all;
    }

    .search_result_r_name {
      position: absolute;
      top: 2.5px;
      left: 10px;
      width: calc(100% - 10px - 60px);
      height: 30px;
      display: flex;
      font-size: 21px;
      align-items: center;
      color: var(--g-333333);
      user-select: none;
      -webkit-user-select: none;
      white-space: nowrap;
      word-break: keep-all;
    }

    .search_routes_result::-webkit-scrollbar {
      display: none;
    }

    .search_back_btn {
      display: none;
    }

    .search[p="1"] .search_back_btn {
      display: flex;
    }

    .routes_keyboard {
      position: fixed;
      left: 0px;
      bottom: var(--o-safe-area-bottom);
      width: 100%;
      height: calc(clamp(200px, 36%, 270px) - var(--o-safe-area-bottom));
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-gap: 0px;
      grid-template-rows: auto;
      padding: 5px;
      box-sizing: border-box;
      background: var(--g-ffffff);
      box-shadow: 0px 0px 12px -5px rgba(0, 0, 0, 0.15);
      transform: translateY(calc(100% + var(--o-safe-area-bottom)));
      transition: 0.3s;
      user-select: none;
      -webkit-user-select: none;
    }

    .routes_keyboard[p="1"]::after {
      content: '';
      position: absolute;
      left: 0px;
      top: 100%;
      width: 100%;
      height: var(--o-safe-area-bottom);
      background: var(--g-ffffff);
    }

    .routes_keyboard[p="1"] {
      transform: translateY(0px);
    }

    .routes_keyboard_key {
      position: relative;
    }

    .routes_keyboard_key .routes_keyboard_key_block {
      position: absolute;
      top: 5px;
      left: 5px;
      width: calc(100% - 10px);
      height: calc(100% - 10px);
      background: var(--g-f5f5f5);
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 15px;
      font-size: 20px;
      color: var(--g-333333);
    }



    .bus_info_mask,
    .route_info_mask {
      position: fixed;
      top: 0px;
      left: 0px;
      background: rgba(0, 0, 0, 0.5);
      width: 100%;
      height: 100%;
      display: none;
      opacity: 0;
      transition: 0.45s;
    }

    .bus_info_box,
    .route_info_box {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      overflow: scroll;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) calc(100% - 130px), var(--g-ffffff) calc(100% - 130px), var(--g-ffffff) 100%);
      user-select: none;
      -webkit-user-select: none;
      transform: translateY(100%);
      opacity: 0;
      transition: 0.45s;
    }

    .bus_info_box::-webkit-scrollbar,
    .route_info_box::-webkit-scrollbar {
      display: none;
    }

    .bus_info_box[p="1"],
    .route_info_box[p="1"] {
      transform: translateY(0%);
      opacity: 1;
    }

    .bus_info,
    .route_info {
      display: inline-block;
      position: absolute;
      top: calc(100% - clamp(180px, 36%, 300px) + 50px);
      left: 0px;
      width: 100%;
      min-height: clamp(180px, 36%, 300px);
      height: auto;
      background: var(--g-ffffff);
      border-radius: 20px 20px 0px 0px;
      user-select: none;
      -webkit-user-select: none;
      box-sizing: border-box;
    }

    .bus_info_title,
    .route_info_title {
      width: 100%;
      height: 55px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-bottom: 1px solid var(--g-f5f5f5);
      color: var(--g-333333);
      user-select: none;
      -webkit-user-select: none;
      font-size: 18px;
      box-sizing: border-box;
      position: sticky;
      top: 0px;
      left: 0px;
    }
    

    .bus_info_title[sticky="1"],
    .route_info_title[sticky="1"] {
      z-index: 10;
      background: var(--g-ffffff);
    }
    
    .route_info_title {
      height:18px;
      border-bottom:none;
      }
      .route_info_bar {
        height:5px;
        width:47px;
        background:var(--g-888888);
        border-radius:7px;
        }
        .route_info_title[sticky="1"] .route_info_bar {
          opacity:0;
          }

    .bus_info_list,
    .route_info_list {
      position: relative;
      display: inline-block;
      width: 100%;
      padding-bottom: 50px;
      user-select: none;
      -webkit-user-select: none;
      box-sizing: border-box;
    }

    .bus_info_list li,
    .route_info_list li {
      width: calc(100% - 10px);
      padding-top: 30px;
      padding-left: 10px;
      list-style: none;
      font-size: 20px;
      font-weight: 500;
      position: relative;
      box-sizing: border-box;
      color: var(--g-333333);
      user-select: none;
      -webkit-user-select: none;
      min-height: 58px;
      word-break: break-all;
      white-space: pre-line;
    }

    .bus_info_list li::after,
    .route_info_list li::after {
      content: var(--li-name);
      position: absolute;
      top: 5px;
      left: 10px;
      width: calc(100% - 20px);
      height: 25px;
      font-size: 15px;
      display: flex;
      align-items: center;
      color: var(--g-888888);
      user-select: none;
      -webkit-user-select: none;
    }

    .route_info_list li[d="0"] {
      display: none;
    }

    .route_info_box[l="0"] .route_info_list li {
      color: rgba(0, 0, 0, 0);
    }

    .route_info_box[l="0"] .route_info_list li::before {
      content: '';
      position: absolute;
      top: 30px;
      left: 10px;
      width: calc(100% - 10px);
      height: 25px;
      border-radius: 30px;
      background: var(--g-f5f5f5);
    }

    .options_content li.option label.options_switch {
      position: relative;
      -webkit-appearance: none;
      appearance: none;
      margin: 0px;
      padding: 0px;
      display: block;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
    }

    .options_content li.option label.options_switch input[type="checkbox"] {
      position: absolute;
      top: 7.5px;
      left: 7.5px;
      border-radius: 0px;
      -webkit-appearance: none;
      appearance: none;
      margin: 0px;
      padding: 0px;
      display: block;
      width: 25px;
      height: 25px;
    }

    .options_switch_box {
      position: absolute;
      top: 7.5px;
      left: 7.5px;
      width: 25px;
      height: 25px;
      border-radius: 5px;
      background: var(--options-switch-border-color);
      transition: var(--options-switch-transition-duration);
    }

    .options_content li.option label.options_switch input[type="checkbox"]:checked~.options_switch_box {
      background: var(--options-switch-checked-color);
    }

    .options_switch_internal_box {
      position: absolute;
      top: 9.5px;
      left: 9.5px;
      width: 21px;
      height: 21px;
      border-radius: 4px;
      background: var(--g-ffffff);
      transition: calc(var(--options-switch-transition-duration) / 3);
    }

    .options_content li.option label.options_switch input[type="checkbox"]:checked~.options_switch_internal_box {
      transform: scale(0);
      border-radius: 15px;
    }

    .options_switch_internal_checkmark {
      position: absolute;
      height: 3px;
      background: var(--g-ffffff);

    }

    .options_switch_internal_checkmark.a {
      transform: rotate(45deg);
      left: 9.55px;
      top: 20.62px;
      width: 11px;
      background: linear-gradient(90deg, var(--g-ffffff) 50%, var(--g-ffffff) 50%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) 100%);
      background-size: 200% 100%;
      background-position-x: 100%;
      background-repeat: no-repeat;
      transition: calc(var(--options-switch-transition-duration) / 6);
      transition-delay: calc(var(--options-switch-transition-duration) / 3);
      transition-timing-function: ease-in;
    }

    .options_content li.option label.options_switch input[type="checkbox"]:checked~.options_switch_internal_checkmark.a {
      background-position-x: 0%;
    }

    .options_switch_internal_checkmark.b {
      transform: rotate(135deg);
      left: 14.33px;
      top: 18.5px;
      width: 17px;
      background: linear-gradient(270deg, var(--g-ffffff) 50%, var(--g-ffffff) 50%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) 100%);
      background-size: 200% 100%;
      background-position-x: 0%;
      background-repeat: no-repeat;
      transition: calc(var(--options-switch-transition-duration) / 6);
      transition-delay: calc(var(--options-switch-transition-duration) / 3 + var(--options-switch-transition-duration) / 6);
      transition-timing-function: ease-out;
    }

    .options_content li.option label.options_switch input[type="checkbox"]:checked~.options_switch_internal_checkmark.b {
      background-position-x: 100%;
    }

    .options_container,
    .network_stats_container {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      background: var(--g-ffffff);
      overflow: scroll;
      -webkit-user-select: none;
      user-select: none;
      display: none;
    }

    .options_title,
    .network_stats_title {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 55px;
      background: var(--g-ffffff);
      border-bottom: 1px solid var(--g-e3e3e3);
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: 700;
      color: var(--g-333333);
      -webkit-user-select: none;
      user-select: none;
      overflow: hidden;
    }

    .options_content,
    .network_stats_content {
      position: absolute;
      top: 55px;
      left: 0px;
      width: 100%;
      height: calc(100% - 55px);
      overflow: scroll;
    }

    .options_content .options_group_title,
    .network_stats_content .network_stats_title {
      color: var(--g-888888);
      user-select: none;
      -webkit-user-select: none;
      word-break: break-all;
      overflow: hidden;
      white-space: pre-line;
      font-weight: 400;
      font-size: 16px;
      display: inline-block;
      width: calc(100% - 20px);
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 5px;
      padding: 5px;
      box-sizing: border-box;
    }

    .options_content li.option {
      list-style: none;
      display: block;
      width: calc(100% - 20px);
      height: 50px;
      background: var(--g-ffffff);
      border: 1px solid var(--g-f5f5f5);
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
      position: relative;
      margin-top: 10px;
      border-radius: 15px;
      overflow: hidden;
      left: 50%;
      transform: translateX(-50%);
    }

    .options_content li.option[b="0"] {
      margin-top: 0px;
    }

    .options_content li.option .option_title {
      position: absolute;
      top: 5px;
      left: 10px;
      width: calc(100% - 15px - 40px);
      height: calc(100% - 10px);
      color: var(--g-333333);
      font-size: 16px;
      display: flex;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .options_content li.option .option_icon {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .options_content li.option .option_icon svg {
      width: 20px;
      height: 20px;
    }

    .options_content li.option label.options_switch {
      position: absolute;
      top: 5px;
      right: 5px;
    }

    .promptcenter {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--g-333333);
      font-size: 15px;
      user-select: none;
      -webkit-user-select: none;
    }

    .promptcenter * {
      color: var(--g-333333);
      font-size: 15px;
    }

    .prompt {
      width: clamp(180px, calc(100% - 20px), 450px);
      height: 60px;
      border-radius: 15px;
      position: fixed;
      left: 50%;
      bottom: 0px;
      opacity: 0;
      transform: translateX(-50%) translateY(0px) scale(1);
      background: rgba(var(--g-e3e3e3-r), var(--g-e3e3e3-g), var(--g-e3e3e3-b), 0.6);
      will-change: transform, opacity;
      -webkit-user-select: none;
      user-select: none;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
    }

    .chart {
      position: relative;
      top: 10px;
      left: 5px;
      width: calc(100% - 10px);
      height: 250px;
    }

    .chart .chart_contents {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(var(--chart-datas-length), 1fr);
    }

    .chart .chart_contents .chart_bar {
      position: relative;
    }

    .chart .chart_contents .chart_bar .block {
      position: absolute;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--g-c7ecff);
      width: clamp(5px, 80%, 45px);
      height: calc((100% - 25px) * var(--chart-bar-height));
      border-radius: 5px;
      transition: 0.35s;
    }

    .chart .chart_contents[select="1"] .chart_bar .block {
      background: var(--g-e3e3e3);
    }

    .chart .chart_contents .chart_bar .label {
      position: absolute;
      bottom: 0px;
      left: 0px;
      width: 100%;
      height: 25px;
      font-size: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--g-333333);
    }

    .chart .chart_contents[select="1"] .chart_bar[select="1"] .block {
      background: var(--g-14b1ff);
    }
  </style>
  <style>
    .fade-display-none {
      display: none;
    }

    .fade-display-flex {
      display: flex;
    }

    .fade-display-inline {
      display: inline;
    }

    .fade-display-block {
      display: block;
    }

    .fade-display-inline-flex {
      display: inline-flex;
    }

    .fade-display-inline-block {
      display: inline-block;
    }
  </style>
  <style id="dynamic-color"></style>
  <style>
    .dynamic-color {
      background: var(--dynamic-color-s1);
      animation-duration: 7s;
      animation-name: turn;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      animation-direction: alternate;
      background-size: 1400% 100%;
      background-position: 0% 0%;
      background-repeat: no-repeat;
    }

    @keyframes turn {
      0% {
        background-position: 0% 0%;
      }

      100% {
        background-position: 100% 0%;
      }
    }

    #dynamic_color_canvas {
      display: none;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6XX5QF4D2J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-6XX5QF4D2J');
  </script>
</head>

<body>
  <canvas id="dynamic_color_canvas"></canvas>
  <button class="options_btn" onclick="openoptions()">
    <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M24.64 64L23.04 53.92C22.0267 53.5467 20.96 53.04 19.84 52.4C18.72 51.76 17.7333 51.0933 16.88 50.4L7.44 54.72L1.77636e-15 41.6L8.64 35.28C8.53333 34.8 8.46667 34.2533 8.44 33.64C8.41333 33.0267 8.4 32.48 8.4 32C8.4 31.52 8.41333 30.9733 8.44 30.36C8.46667 29.7467 8.53333 29.2 8.64 28.72L1.77636e-15 22.4L7.44 9.28L16.88 13.6C17.7333 12.9067 18.72 12.24 19.84 11.6C20.96 10.96 22.0267 10.48 23.04 10.16L24.64 1.77636e-15L39.36 1.77636e-15L40.96 10.08C41.9733 10.4533 43.0533 10.9467 44.2 11.56C45.3467 12.1733 46.32 12.8533 47.12 13.6L56.56 9.28L64 22.4L55.36 28.56C55.4667 29.0933 55.5333 29.6667 55.56 30.28C55.5867 30.8933 55.6 31.4667 55.6 32C55.6 32.5333 55.5867 33.0933 55.56 33.68C55.5333 34.2667 55.4667 34.8267 55.36 35.36L64 41.6L56.56 54.72L47.12 50.4C46.2667 51.0933 45.2933 51.7733 44.2 52.44C43.1067 53.1067 42.0267 53.6 40.96 53.92L39.36 64L24.64 64ZM32 42.4C34.88 42.4 37.3333 41.3867 39.36 39.36C41.3867 37.3333 42.4 34.88 42.4 32C42.4 29.12 41.3867 26.6667 39.36 24.64C37.3333 22.6133 34.88 21.6 32 21.6C29.12 21.6 26.6667 22.6133 24.64 24.64C22.6133 26.6667 21.6 29.12 21.6 32C21.6 34.88 22.6133 37.3333 24.64 39.36C26.6667 41.3867 29.12 42.4 32 42.4ZM32 37.6C30.4533 37.6 29.1333 37.0533 28.04 35.96C26.9467 34.8667 26.4 33.5467 26.4 32C26.4 30.4533 26.9467 29.1333 28.04 28.04C29.1333 26.9467 30.4533 26.4 32 26.4C33.5467 26.4 34.8667 26.9467 35.96 28.04C37.0533 29.1333 37.6 30.4533 37.6 32C37.6 33.5467 37.0533 34.8667 35.96 35.96C34.8667 37.0533 33.5467 37.6 32 37.6ZM28.48 59.2L35.52 59.2L36.64 50.24C38.4 49.8133 40.0667 49.1467 41.64 48.24C43.2133 47.3333 44.64 46.24 45.92 44.96L54.4 48.64L57.6 42.88L50.08 37.36C50.2933 36.4533 50.4667 35.56 50.6 34.68C50.7333 33.8 50.8 32.9067 50.8 32C50.8 31.0933 50.7467 30.2 50.64 29.32C50.5333 28.44 50.3467 27.5467 50.08 26.64L57.6 21.12L54.4 15.36L45.92 19.04C44.6933 17.6533 43.3067 16.4933 41.76 15.56C40.2133 14.6267 38.5067 14.0267 36.64 13.76L35.52 4.8L28.48 4.8L27.36 13.76C25.5467 14.1333 23.8533 14.7733 22.28 15.68C20.7067 16.5867 19.3067 17.7067 18.08 19.04L9.6 15.36L6.4 21.12L13.92 26.64C13.7067 27.5467 13.5333 28.44 13.4 29.32C13.2667 30.2 13.2 31.0933 13.2 32C13.2 32.9067 13.2667 33.8 13.4 34.68C13.5333 35.56 13.7067 36.4533 13.92 37.36L6.4 42.88L9.6 48.64L18.08 44.96C19.36 46.24 20.7867 47.3333 22.36 48.24C23.9333 49.1467 25.6 49.8133 27.36 50.24L28.48 59.2Z" fill="var(--g-333333)" fill-rule="nonzero" opacity="1" stroke="none" />
    </svg>
  </button>

  <div class="search" p="0">
    <div class="input_placeholder">搜尋路線</div>
    <input type="text" placeholder="搜尋路線" id="search_routes" readonly="readonly">
    <button class="search_back_btn" ripple-evt="closeopensearch()">
      <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--g-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </button>
  </div>

  <div class="search_routes_result"></div>
  <div class="routes_keyboard"></div>

  <div class="route_container">
    <div class="routes" display="departure" slide="-1">
      <div class="route" direction="departure"></div>
      <div class="route" direction="destination"></div>
    </div>
    <div class="title">
      <div class="routename" l="0"></div>
      <button class="back_btn" onclick="closeRoute()">
        <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--g-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
        </svg>
      </button>
      <button class="info_btn" onclick="displayRouteInfo()">
        <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M29.84 48L34.64 48L34.64 28.8L29.84 28.8L29.84 48ZM32 22.88C32.7467 22.88 33.3733 22.64 33.88 22.16C34.3867 21.68 34.64 21.0667 34.64 20.32C34.64 19.5733 34.3867 18.9333 33.88 18.4C33.3733 17.8667 32.7467 17.6 32 17.6C31.2533 17.6 30.6267 17.8667 30.12 18.4C29.6133 18.9333 29.36 19.5733 29.36 20.32C29.36 21.0667 29.6133 21.68 30.12 22.16C30.6267 22.64 31.2533 22.88 32 22.88ZM32 64C27.6267 64 23.4933 63.16 19.6 61.48C15.7067 59.8 12.3067 57.5067 9.4 54.6C6.49333 51.6933 4.2 48.2933 2.52 44.4C0.84 40.5067 1.77636e-15 36.3467 1.77636e-15 31.92C1.77636e-15 27.5467 0.84 23.4133 2.52 19.52C4.2 15.6267 6.49333 12.24 9.4 9.36C12.3067 6.48 15.7067 4.2 19.6 2.52C23.4933 0.84 27.6533 1.77636e-15 32.08 1.77636e-15C36.4533 1.77636e-15 40.5867 0.84 44.48 2.52C48.3733 4.2 51.76 6.48 54.64 9.36C57.52 12.24 59.8 15.6267 61.48 19.52C63.16 23.4133 64 27.5733 64 32C64 36.3733 63.16 40.5067 61.48 44.4C59.8 48.2933 57.52 51.6933 54.64 54.6C51.76 57.5067 48.3733 59.8 44.48 61.48C40.5867 63.16 36.4267 64 32 64ZM32.08 59.2C39.6 59.2 46 56.5467 51.28 51.24C56.56 45.9333 59.2 39.4933 59.2 31.92C59.2 24.4 56.56 18 51.28 12.72C46 7.44 39.5733 4.8 32 4.8C24.48 4.8 18.0667 7.44 12.76 12.72C7.45333 18 4.8 24.4267 4.8 32C4.8 39.52 7.45333 45.9333 12.76 51.24C18.0667 56.5467 24.5067 59.2 32.08 59.2Z" fill="var(--g-333333)" fill-rule="nonzero" opacity="1" stroke="none" />
        </svg>
      </button>
    </div>
    <div class="tabs" l="0" slide="-1">
      <button class="tab" direction="departure" onclick="switchDirection('departure',event)" g="0"><span></span></button>
      <button class="tab" direction="destination" onclick="switchDirection('destination',event)" g="1"><span></span></button>
      <div class="tab-line-box">
        <div class="tab-line-box2" slide="-1">
          <div class="tab-line"></div>
        </div>
      </div>
    </div>
    <div class="refresh_progress_box" l="0" status="0">
      <div class="refresh_progress" style="--o-refresh-progress:0;">
      </div>
    </div>
  </div>

  <div class="bus_info_mask"></div>
  <div class="bus_info_box">
    <div class="bus_info">
      <div class="bus_info_title">
        關於這輛公車
      </div>
      <div class="bus_info_list">
        <li f="bus_id" style="--li-name:'車牌號碼'"></li>
        <li f="bus_onstopstatus" style="--li-name:'到離站狀態'"></li>
        <li f="bus_type" style="--li-name:'車輛類型'"></li>
        <li f="bus_status" style="--li-name:'行車狀態'"></li>
        <li f="bus_update" style="--li-name:'更新時間'"></li>
      </div>
    </div>
  </div>
  <div class="route_info_mask"></div>
  <div class="route_info_box" l="0">
    <div class="route_info">
      <div class="route_info_title">
        <div class="route_info_bar"></div>
      </div>
      <div class="route_info_list">
        <li f="route_name" style="--li-name:'路線名稱'"></li>
        <li f="route_departure" style="--li-name:'起點'"></li>
        <li f="route_destination" style="--li-name:'訖點'"></li>
        <li f="route_weekday_first" style="--li-name:'平日首班車'"></li>
        <li f="route_weekday_last" style="--li-name:'平日末班車'"></li>
        <li f="route_weekday" style="--li-name:'平日班距'"></li>
        <li f="route_weekday_timetable" style="--li-name:'平日班表'"></li>
        <li f="route_holiday_first" style="--li-name:'假日首班車'"></li>
        <li f="route_holiday_last" style="--li-name:'假日末班車'"></li>
        <li f="route_holiday" style="--li-name:'假日班距'"></li>
        <li f="route_holiday_timetable" style="--li-name:'假日班表'"></li>
        <li f="route_price" style="--li-name:'票價'"></li>
        <li f="route_buffer" style="--li-name:'緩衝區'"></li>
        <li f="route_provider" style="--li-name:'業者名稱'"></li>
        <li f="route_tel" style="--li-name:'電話'"></li>
        <li f="route_email" style="--li-name:'電子郵件'"></li>
      </div>
    </div>
  </div>

  <div class="options_container">
    <div class="options_content">
      <div class="options_group_title">顯示</div>
      <li class="option" b="0">
        <div class="option_title">顯示到站時間的秒數</div>
        <label for="options_reveal_estimate_time_exact_seconds" class="options_switch" onclick="saveOptions()">
          <input type="checkbox" id="options_reveal_estimate_time_exact_seconds" name="options_reveal_estimate_time_exact_seconds">
          <div class="options_switch_box"></div>
          <div class="options_switch_internal_box"></div>
          <div class="options_switch_internal_checkmark a"></div>
          <div class="options_switch_internal_checkmark b"></div>
        </label>
      </li>
      <li class="option">
        <div class="option_title">顯示目前位置</div>
        <label for="options_display_user_current_position" class="options_switch" onclick="saveOptions()">
          <input type="checkbox" id="options_display_user_current_position" name="options_display_user_current_position">
          <div class="options_switch_box"></div>
          <div class="options_switch_internal_box"></div>
          <div class="options_switch_internal_checkmark a"></div>
          <div class="options_switch_internal_checkmark b"></div>
        </label>
      </li>
      <div class="options_group_title">資料</div>
      <li class="option" b="0" onclick="getRoutes(true)">
        <div class="option_title">立即更新路線資料</div>
        <div class="option_icon"></div>
      </li>
      <div class="options_group_title">網路</div>
      <li class="option" b="0" onclick="opennetworkstats()">
        <div class="option_title">查看統計</div>
        <div class="option_icon"></div>
      </li>
      <div class="options_group_title">版本</div>
      <li class="option" b="0">
        <div class="option_title">自動更新</div>
        <label for="options_automatic_refresh" class="options_switch" onclick="saveOptions()">
          <input type="checkbox" id="options_automatic_refresh" name="options_automatic_refresh">
          <div class="options_switch_box"></div>
          <div class="options_switch_internal_box"></div>
          <div class="options_switch_internal_checkmark a"></div>
          <div class="options_switch_internal_checkmark b"></div>
        </label>
      </li>
      <li class="option" onclick="refreshPage()">
        <div class="option_title">重新整理</div>
        <div class="option_icon"></div>
      </li>

    </div>
    <div class="options_title">
      選項
      <button class="back_btn" onclick="closeoptions()">
        <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--g-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
        </svg>
      </button>
    </div>
  </div>


  <div class="network_stats_container">
    <div class="network_stats_content">
      <div class="chart"></div>
    </div>
    <div class="network_stats_title">
      網路用量統計
      <button class="back_btn" onclick="closenetworkstats()">
        <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--g-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
        </svg>
      </button>
    </div>
  </div>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ifvisible/1.0.6/ifvisible.min.js"></script>
<script>
  function NetworkStats_add(o) {
    var dd = new Date()
    var dd_suffix = `${dd.getFullYear()}_${(dd.getMonth() + 1)}_${dd.getDate()}`
    var ls_key = `bus_network_stats_${dd_suffix}`
    if (!(localStorage.hasOwnProperty(ls_key))) {
      localStorage.setItem(ls_key, '0')
    }
    var n = parseFloat(parseFloat(String(localStorage.getItem(ls_key))).toFixed(3))
    var g = parseFloat((o / 1024).toFixed(3))
    n += g
    localStorage.setItem(ls_key, n)
  }
  var ajax_event = { 'sent': {}, 'successful': {} }
  $(document).ajaxSend(function (event, jqxhr, settings) {
    var u = settings.url
    if (!(u.indexOf('google-analytics') > -1)) {
      var time = event.timeStamp
      var uid = btoa(encodeURIComponent(String(settings.url))).replaceAll('=', '')
      ajax_event.sent['ajax_' + uid] = { 'time': time }
    }
  });

  $(document).ajaxSuccess(function (event, xhr, settings) {
    var u = settings.url
    var uid = btoa(encodeURIComponent(String(settings.url))).replaceAll('=', '')
    if (ajax_event.sent.hasOwnProperty('ajax_' + uid)) {
      delete ajax_event.sent['ajax_' + uid]
      NetworkStats_add(xhr.getResponseHeader('Content-Length'))
    }
  });
</script>

<script>
  var getUrlString = location.href;
  var url = new URL(getUrlString);
  function urlparams(p) {
    return url.searchParams.get(p)
  }

  function customurlprams(str, p) {
    var url = new URL(str);
    return url.searchParams.get(p)
  }

  const LS = window.localStorage
  const SS = window.sessionStorage
  let options_list = ['options_reveal_estimate_time_exact_seconds', 'options_automatic_refresh', 'options_display_user_current_position']
  var options = {
    'options_reveal_estimate_time_exact_seconds': false,
    'options_automatic_refresh': true,
    'options_display_user_current_position': false
  }
  var options_pulled = 0
  let cities = ['blobbus', 'ntpcbus']
  var city = 0
  var routes_data_city = 0
  var stops_data_city = 0

  let realtime_api = function () { return 'https://tcgbusfs.blob.core.windows.net/' + cities[city] + '/GetEstimateTime.gz' }
  let stops_api = function () { return 'https://tcgbusfs.blob.core.windows.net/' + cities[stops_data_city] + '/GetStop.gz' }
  let routes_api = function (c) { return 'https://tcgbusfs.blob.core.windows.net/' + cities[c] + '/GetRoute.gz' }
  let busevent_api = function () { return 'https://tcgbusfs.blob.core.windows.net/' + cities[city] + '/GetBusEvent.gz' }
  let provider_api = function () { return 'https://tcgbusfs.blob.core.windows.net/' + cities[city] + '/GetProvider.gz' }
  let timetable_api = function () { return 'https://tcgbusfs.blob.core.windows.net/' + cities[city] + '/GetTimeTable.gz' }

  let routes_keyboard_keys = [['紅', '藍', '1', '2', '3'],
  ['綠', '棕', '4', '5', '6'],
  ['橘', '小', '7', '8', '9'],
  ['更多', '幹線', '清空', '0', '刪除']]
  let icon_bus = '<svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.5474 64C11.8175 64 11.1719 63.7895 10.6105 63.3684C10.0491 62.9474 9.76842 62.4 9.76842 61.7263L9.76842 54.6526C8.14035 53.7544 6.94737 52.4632 6.18947 50.7789C5.43158 49.0947 5.05263 47.2982 5.05263 45.3895L5.05263 11.9579C5.05263 7.80351 7.2 4.77193 11.4947 2.86316C15.7895 0.954386 22.6526 0 32.0842 0C41.4035 0 48.2105 0.954386 52.5053 2.86316C56.8 4.77193 58.9474 7.80351 58.9474 11.9579L58.9474 45.3895C58.9474 47.2982 58.5684 49.0947 57.8105 50.7789C57.0526 52.4632 55.8596 53.7544 54.2316 54.6526L54.2316 61.7263C54.2316 62.4 53.9509 62.9474 53.3895 63.3684C52.8281 63.7895 52.1825 64 51.4526 64L49.8526 64C49.0667 64 48.393 63.7895 47.8316 63.3684C47.2702 62.9474 46.9895 62.4 46.9895 61.7263L46.9895 57.0947L17.0105 57.0947L17.0105 61.7263C17.0105 62.4 16.7298 62.9474 16.1684 63.3684C15.607 63.7895 14.9333 64 14.1474 64L12.5474 64ZM10.1053 29.3895L53.8947 29.3895L53.8947 14.8211L10.1053 14.8211L10.1053 29.3895ZM19.0316 47.8316C20.3228 47.8316 21.4175 47.3825 22.3158 46.4842C23.214 45.586 23.6632 44.4912 23.6632 43.2C23.6632 41.9088 23.214 40.814 22.3158 39.9158C21.4175 39.0175 20.3228 38.5684 19.0316 38.5684C17.7404 38.5684 16.6456 39.0175 15.7474 39.9158C14.8491 40.814 14.4 41.9088 14.4 43.2C14.4 44.4912 14.8491 45.586 15.7474 46.4842C16.6456 47.3825 17.7404 47.8316 19.0316 47.8316ZM44.9684 47.8316C46.2596 47.8316 47.3544 47.3825 48.2526 46.4842C49.1509 45.586 49.6 44.4912 49.6 43.2C49.6 41.9088 49.1509 40.814 48.2526 39.9158C47.3544 39.0175 46.2596 38.5684 44.9684 38.5684C43.6772 38.5684 42.5825 39.0175 41.6842 39.9158C40.786 40.814 40.3368 41.9088 40.3368 43.2C40.3368 44.4912 40.786 45.586 41.6842 46.4842C42.5825 47.3825 43.6772 47.8316 44.9684 47.8316Z" fill="var(--g-333333)" fill-rule="nonzero" opacity="1" stroke="none"/></svg>'
  var realtime_json = {}
  var busevent_json = { 'loaded': false, 'c': {} }
  var stops_json = { 'loaded': false, 'c': {} }
  var routes_json = { 'loaded': false, 'c': {} }
  var search_index = { 'loaded': false, 'c': {} }
  var route_container_content = { 'h_0': {}, 'h_1': {} }
  var current_route_stops = []
  var c_routeid = 0
  var c_routeid_p = 0
  var o_routeid
  var realtime_lo = 0
  var realtime_last_update = new Date().getTime()
  var refresh_progress_l = 0
  var businfo_scroll = 0
  var routeinfo_scroll = 0
  var businfo_scroll_1 = 0
  var routeinfo_scroll_1 = 0
  var businfo_close = 0
  var routeinfo_close = 0
  var routeinfo_loaded = 0
  var refreshProgresPause = 0
  var search_page_is_open = 0
  var route_page_is_open = 0
  var route_dep_auto_scroll = 0
  var route_des_auto_scroll = 0
  var skeletonScreenStatus = 0
  var watch_position
  var watch_position_permission_requested = 0
  var route_container_scrolled = 0
  var route_container_scroll_stop = 0
  var pos_lat = 0
  var pos_lon = 0
  var route_direction = 'departure'
  var route_container = document.querySelector('.route_container')
  var route_container_s = document.querySelectorAll('.routes')[0]
  var route_x1 = 0
  var route_y1 = 0
  var route_x2 = 0
  var route_y2 = 0
  var route_min_X = 0
  var route_min_Y = 0
  var route_max_X = 0
  var route_max_Y = 0
  var animation_speed = 0
  var offsetX = 0
  var start_offsetX = 0
  var de = document.documentElement
  var horizontal_slide = false
  var vertical_slide = false
  var route_tab_dep_width = 0
  var route_tab_des_width = 0
  var route_tab_color_333333_r = 0
  var route_tab_color_333333_g = 0
  var route_tab_color_333333_b = 0
  var route_tab_color_888888_r = 0
  var route_tab_color_888888_g = 0
  var route_tab_color_888888_b = 0
  let routesDataShortName = [
    { 'source': 'providerId', 'short': false },
    { 'source': 'providerName', 'short': false },
    { 'source': 'nameZh', 'short': 'n' },
    { 'source': 'nameEn', 'short': false },
    { 'source': 'aliasName', 'short': false },
    { 'source': 'pathAttributeId', 'short': 'pid' },
    { 'source': 'pathAttributeNId', 'short': false },
    { 'source': 'pathAttributeName', 'short': false },
    { 'source': 'pathAttributeEname', 'short': false },
    { 'source': 'buildPeriod', 'short': false },
    { 'source': 'departureZh', 'short': 'dep' },
    { 'source': 'destinationZh', 'short': 'des' },
    { 'source': 'departureEn', 'short': false },
    { 'source': 'destinationEn', 'short': false },
    { 'source': 'goFirstBusTime', 'short': false },
    { 'source': 'goLastBusTime', 'short': false },
    { 'source': 'backFirstBusTime', 'short': false },
    { 'source': 'backLastBusTime', 'short': false },
    { 'source': 'offPeakHeadway', 'short': false },
    { 'source': 'roadMapUrl', 'short': false },
    { 'source': 'headwayDesc', 'short': false },
    { 'source': 'holidayGoFirstBusTime', 'short': false },
    { 'source': 'holidayBackFirstBusTime', 'short': false },
    { 'source': 'holidayBackLastBusTime', 'short': false },
    { 'source': 'holidayGoLastBusTime', 'short': false },
    { 'source': 'holidayBusTimeDesc', 'short': false },
    { 'source': 'realSequence', 'short': false },
    { 'source': 'holidayHeadwayDesc', 'short': false },
    { 'source': 'holidayOffPeakHeadway', 'short': false },
    { 'source': 'holidayPeakHeadway', 'short': false },
    { 'source': 'segmentBufferEn', 'short': false },
    { 'source': 'ticketPriceDescriptionZh', 'short': false },
    { 'source': 'ticketPriceDescriptionEn', 'short': false },
    { 'source': 'peakHeadway', 'short': false },
    { 'source': 'ttiaPathId', 'short': false },
    { 'source': 'segmentBufferZh', 'short': 's' },
    { 'source': 'busTimeDesc', 'short': false },
    { 'source': 'distance', 'short': false },
    { 'source': 'NId', 'short': false },
    { 'source': 'genus', 'short': false },
    { 'source': 'Id', 'short': false }
  ]
  var stats_chart
  let rdsn_len = routesDataShortName.length
  var update_interval = 10000
  var update_status = 0

  function isRunningStandalone() {
    return (window.matchMedia('(display-mode: standalone)').matches);
  }
  function supportTouch() {
    if ('ontouchstart' in document.documentElement) {
      return true
    }
    else {
      return false
    }
  }
  function gid(n) {
    var genidchars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";
    var genid = "";
    for (var i = 0; i < 16; i++) {
      var genrandomNumber = Math.floor(Math.random() * genidchars.length);
      genid += genidchars.substring(genrandomNumber, genrandomNumber + 1);
    }
    var time = parseInt(new Date().getTime())
    var time_str = time.toString(36)
    if (!(n === undefined)) {
      n = n.replaceAll('_', '-')
      return n + '-' + genid + '-' + time_str;
    }
    return 'id-' + genid + '-' + time_str;
  }
  function ripple(Allelement, color, duration) {
    if (Allelement.length === undefined) {
      Allelement = [Allelement]
    }
    for (var k = 0; k < Allelement.length; k++) {
      rp(Allelement[k], color, duration)
    }
  }
  function rp(element, color, duration) {
    var eventlistener = 'mousedown'
    if (supportTouch()) {
      eventlistener = 'touchstart'
    }
    element.addEventListener(eventlistener, function (event) {
      var idchars = "0123456789abcdefghijklmnopqrstuvwxyz";
      var ripple_id = "";
      for (var i = 0; i < 8; i++) {
        var idrandomNumber = Math.floor(Math.random() * idchars.length);
        ripple_id += idchars.substring(idrandomNumber, idrandomNumber + 1);
      }
      var scroll_x = document.documentElement.scrollLeft
      var scroll_y = document.documentElement.scrollTop
      var x = event.pageX
      var y = event.pageY
      var element_rect = element.getBoundingClientRect()
      var element_x = element_rect.x
      var element_y = element_rect.y
      var element_width = element.clientWidth
      var element_height = element.clientHeight
      var relative_x = x - element_x
      var relative_y = y - element_y
      var ripple_size = Math.max(element_width, element_height)
      var element_position = getComputedStyle(element).getPropertyValue('position')
      if (!(element_position === 'absolute') && !(element_position === 'fixed')) {
        element_position = 'relative'
      }
      var css = `.ripple-element-${ripple_id} {position:${element_position};overflow:hidden;width:${element_width}px;height:${element_height}px; outline:none; -webkit-tap-highlight-color:rgba(0,0,0,0); -webkit-mask-image: -webkit-radial-gradient(white, black);mask-image: -webkit-radial-gradient(white, black);}.ripple-element-ripple-${ripple_id} {background:${color};width:${ripple_size}px; height:${ripple_size}px;border-radius:50%;position:absolute; top:${relative_y - 0.5 * ripple_size}px; left:${relative_x - 0.5 * ripple_size}px;transform:scale(0); opacity:0;animation-duration: ${duration}ms;animation-name: ripple-animation-opacity-${ripple_id},ripple-animation-zoom-${ripple_id};animation-iteration-count: forward;animation-timing-function:linear;}@keyframes ripple-animation-opacity-${ripple_id} {0% {opacity:0.15;}60% {opacity:0.15;}100% { opacity:0;} } @keyframes ripple-animation-zoom-${ripple_id} {0% {transform:scale(0.1)}65% {  transform:scale(2)}100% {transform:scale(2)}}`
      element.classList.add(`ripple-element-${ripple_id}`)
      var css_style_element = document.createElement("style")
      css_style_element.innerHTML = css
      css_style_element.id = `ripple-css-${ripple_id}`
      element.appendChild(css_style_element)
      var ripple_element_ripple = document.createElement("div")
      ripple_element_ripple.id = `ripple-element-ripple-${ripple_id}`
      ripple_element_ripple.classList.add(`ripple-element-ripple-${ripple_id}`)
      element.appendChild(ripple_element_ripple)
      var ripple_evt = element.getAttribute('ripple-evt');
      if (!(ripple_evt === '')) {
        document.getElementById(`ripple-element-ripple-${ripple_id}`).addEventListener('animationstart', function (e) {
          setTimeout(function () {
            eval(ripple_evt)
            if (!(document.getElementById(`ripple-element-ripple-${ripple_id}`) === null)) {
              element.classList.remove(`ripple-element-${ripple_id}`)
              document.getElementById(`ripple-element-ripple-${ripple_id}`).remove()
              document.getElementById(`ripple-css-${ripple_id}`).remove()
            }
          }, duration * 0.75)
        }, { once: true });
      }
      else {
        document.getElementById(`ripple-element-ripple-${ripple_id}`).addEventListener('animationend', function (e) {
          if (!(document.getElementById(`ripple-element-ripple-${ripple_id}`) === null)) {
            element.classList.remove(`ripple-element-${ripple_id}`)
            document.getElementById(`ripple-element-ripple-${ripple_id}`).remove()
            document.getElementById(`ripple-css-${ripple_id}`).remove()
          }
        }, { once: true })
        setTimeout(function () {
          if (!(document.getElementById(`ripple-element-ripple-${ripple_id}`) === null)) {
            element.classList.remove(`ripple-element-${ripple_id}`)
            document.getElementById(`ripple-element-ripple-${ripple_id}`).remove()
            document.getElementById(`ripple-css-${ripple_id}`).remove()
          }
        }, duration + 50);
      }
    })
  }
  function fade(element, type, display, callback) {
    var idchars = "0123456789abcdefghijklmnopqrstuvwxyz";
    var fade_id = "";
    for (var i = 0; i < 8; i++) {
      var idrandomNumber = Math.floor(Math.random() * idchars.length);
      fade_id += idchars.substring(idrandomNumber, idrandomNumber + 1);
    }
    var element_display = getComputedStyle(element).getPropertyValue('display')
    if (element_display === 'none') {
      element_display = 'block'
    }
    var duration = 300
    var class_str = element.getAttribute('class')
    element.setAttribute('class', class_str.replaceAll(/fade-display-[a-z-]*[^\s]/gm, ''))
    var style_str = element.getAttribute('style')
    element.setAttribute('style', String(style_str).replaceAll(/display[\s]*:{1,1}[\sa-z-]*;{1,1}[^\s]*/gm, ''))
    element.classList.add(`fade${type}-${fade_id}`)
    var css = `.fadeIn-${fade_id} {display:${element_display};opacity:0} .fadeIn-${fade_id}-start{transition:${duration}ms;opacity:1;transition-timing-function:ease-out;} .fadeOut-${fade_id} {display:${element_display};opacity:1} .fadeOut-${fade_id}-start{transition:${duration}ms;opacity:0;transition-timing-function:ease-out;}`
    var css_style_element = document.createElement("style")
    css_style_element.innerHTML = css
    css_style_element.id = `fade-css-${fade_id}`
    element.appendChild(css_style_element)
    setTimeout(function () {
      element.classList.add(`fade${type}-${fade_id}-start`)
    }, 1)
    element.addEventListener('transitionend', function () {
      if (!(callback === undefined)) {
        if (typeof callback === "function") {
          callback()
        }
      }
      element.classList.remove(`fade${type}-${fade_id}-start`)
      element.classList.remove(`fade${type}-${fade_id}`)
      element.classList.add(`fade-display-${display}`)
      if (!(document.getElementById(`fade-css-${fade_id}`) === null)) {
        document.getElementById(`fade-css-${fade_id}`).remove()
      }
    }, { once: true })
  }
  function prompt_message(message, duration) {
    if (isNaN(duration)) {
      duration = 1200
    }
    message = String(message)
    var all_prompt = document.querySelectorAll('.prompt')
    if (!(all_prompt === null)) {
      var all_prompt_len = all_prompt.length
      for (var e = 0; e < all_prompt_len; e++) {
        all_prompt[e].remove()
      }
    }
    var at = 270
    translateY = -10
    var idchars = "0123456789abcdefghijklmnopqrstuvwxyz";
    var prompt_id = "";
    for (var i = 0; i < 8; i++) {
      var idrandomNumber = Math.floor(Math.random() * idchars.length);
      prompt_id += idchars.substring(idrandomNumber, idrandomNumber + 1);
    }
    var prompt_element = document.createElement('div')
    prompt_element.id = prompt_id
    prompt_element.classList.add('prompt')
    prompt_element.classList.add('prompt_animation' + prompt_id)
    var prompt_center_element = document.createElement('div')
    prompt_center_element.classList.add('promptcenter')
    prompt_center_element.innerText = message
    prompt_element.appendChild(prompt_center_element)
    var prompt_css = `.prompt_animation${prompt_id}{animation-name:prompt${prompt_id};animation-duration:${(duration + at * 2)}ms;animation-fill-mode:forwards;animation-timing-function:ease-in-out}@keyframes prompt${prompt_id}{0%{opacity:0;transform:translateX(-50%) translateY(${60}px) scale(1);}${Math.floor((at) / (duration + at + 150) * 100)}%{opacity:1;transform:translateX(-50%) translateY(calc(${translateY}px - var(--o-safe-area-bottom))) scale(1);}${Math.floor((at + duration) / (duration + at + 150) * 100)}%{opacity:1;transform:translateX(-50%) translateY(calc(${translateY}px - var(--o-safe-area-bottom))) scale(1);}100%{opacity:0;transform:translateX(-50%) translateY(${60}px) scale(1);}}`
    var prompt_css_element = document.createElement('style')
    prompt_css_element.innerHTML = prompt_css
    prompt_element.appendChild(prompt_css_element)
    document.body.appendChild(prompt_element)
    document.getElementById(prompt_id).addEventListener('animationend', function () {
      if (!(document.getElementById(prompt_id) === null)) {
        document.getElementById(prompt_id).remove()
      }
    }, { once: true })
  }
  function searchItemsbyname(name) {
    var gh = []
    for (var t in LS) {
      if (String(t).indexOf(name) > -1) {
        gh.push(t)
      }
    }
    return gh
  }
  function api_url_parameter(cahce_time) {
    var t = new Date().getTime()
    var g = (t / cahce_time).toFixed(0) * cahce_time
    var str = g.toString(36)
    return str
  }

  function sendError(err) {
    var position = 'L' + err.line + ',C' + err.column
    gtag('event', 'error_feedback', {
      'event_category': position,
      'event_label': position + ' | ' + err.message,
    });
  }

  function unicode_arr(str) {
    var str_len = str.length
    var unicode_arr = []
    for (var t = 0; t < str_len; t++) {
      var unicode = str.charCodeAt(t)
      if (!(unicode_arr.indexOf(unicode) > -1)) {
        unicode_arr.push(unicode)
      }
    }
    return unicode_arr
  }

  function getDistance(lat1, lon1, lat2, lon2) {
    var R = 6378.137;
    var dLat = lat2 * Math.PI / 180 - lat1 * Math.PI / 180
    var dLon = lon2 * Math.PI / 180 - lon1 * Math.PI / 180
    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon / 2) * Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d * 1000;
  }
  function StopName2ID(str, ccc) {
    if (stops_json.loaded) {
      var arr = stops_json['c_' + ccc + '_arr']
      var arr_len = arr.length
      for (var o = 0; o < arr_len; o++) {
        if (str === arr[o].nameZh) {
          return arr[o].Id
        }
      }
    }
  }
  function getPathBuffer(str) {
    var t_match = str.match(/[\(（][往返程][\)|）]/gm)
    if (!(t_match === null)) {
      for (var w = 0; w < t_match.length; w++) {
        str = str.replaceAll(t_match[w], t_match[w] + ' ')
      }
    }
    var match = str.match(/[\u4E00-\u9FFF\(\)（）]*/gm)
    if (!(match === null)) {
      var match_len = match.length
      var current_direction = 'all'
      var start_stop = 0
      var pervious_stop = ''
      var buffers = { 'o_0': [], 'o_1': [] }
      for (var t = 0; t < match_len; t++) {
        if (match[t].length < 1) {
          continue;
        }
        if (match[t].indexOf('往') > -1) {
          current_direction = 'o_0'
        }
        else {
          if (match[t].indexOf('返') > -1) {
            current_direction = 'o_1'
          }
          else {
            start_stop += 1
            if (start_stop >= 2) {
              start_stop = 0
              if (current_direction === 'all') {
                buffers['o_0'].push({ n: pervious_stop, d: 0 })
                buffers['o_0'].push({ n: match[t], d: 1 })
                buffers['o_1'].push({ n: match[t], d: 0 })
                buffers['o_1'].push({ n: pervious_stop, d: 1 })
              }
              else {
                buffers[current_direction].push({ n: pervious_stop, d: 0 })
                buffers[current_direction].push({ n: match[t], d: 1 })
              }
              current_direction = 'all'
            }
            pervious_stop = match[t]
          }
        }

      }
    }
    return buffers
  }
  function updateRefreshProgress() {
    var t = new Date().getTime()
    var p = Math.abs(t - realtime_last_update) / update_interval
    if (p < 0) {
      p = 0
    }
    if (p > 1) {
      p = 1
    }
    $('.refresh_progress').css({ '--o-refresh-progress': (1 - p) * -100 + '%' })
    if (refreshProgresPause === 0) {
      window.requestAnimationFrame(updateRefreshProgress)
    }
    else {
      refreshProgresPause = 0
    }
  }
  function getTextWidth(text, font) {
    const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
    const context = canvas.getContext("2d");
    context.font = font;
    const metrics = context.measureText(text);
    return metrics.width;
  }

  function skeletonScreen() {
    var j = []
    var ll = Math.floor(window.innerHeight / 45) + 5
    for (var y = 0; y < ll; y++) {
      j.push({ 'sk': true, 'goBack': 0 })
    }
    for (var y = 0; y < ll; y++) {
      j.push({ 'sk': true, 'goBack': 1 })
    }
    printStops(j, 'skeleton')
    skeletonScreenStatus = 1
  }

  function setRouteD() {
    if (routes_json.loaded) {
      var this_route = routes_json.c['b_' + c_routeid]
      if (!routes_json.c.hasOwnProperty('b_' + c_routeid)) {
        return ''
      }
      var dep = '往' + this_route.dep
      var des = '往' + this_route.des
      var name = this_route.n
      var w = []
      var font = "500 16px 'Noto Sans', sans-serif"
      route_tab_dep_width = getTextWidth(des, font)
      route_tab_des_width = getTextWidth(dep, font)
      w.push(`--tab-line-depature-width:${route_tab_dep_width}px`)
      w.push(`--tab-line-destination-width:${route_tab_des_width}px`)

      $('#routes_animation_css').html(':root{' + w.join(';') + '}')
      $('.route_container .tabs .tab[direction="departure"] span').text(des)
      $('.route_container .tabs .tab[direction="destination"] span').text(dep)
      $('.route_container .title .routename').text(name)
      $('.route_container .tabs').attr('l', '1')
      $('.route_container .title .routename').attr('l', '1')
      $(".tab-line").attr('class', 'tab-line initialization').css({ '--j-initialization-width': route_tab_dep_width + 'px' })
    }
  }

  function scrollToY(element, source, aim, startTime, endTime, t) {
    var f = function (x) {
      return -15.4 + 9.11 * x - 0.0285 * x * x
    }
    var x_min = 1.7
    var x_max = 163.02
    var y_min = f(x_min)
    var y_max = f(x_max)
    var s = function (time) {
      var x = x_min + (time - startTime) / (endTime - startTime) * (x_max - x_min)
      var y = f(x)
      return source + (y_min + y) / (y_max - y_min) * (aim - source)
    }

    if (t < endTime) {
      var k = s(t)
      element.scrollTop = k


      t = new Date().getTime()
      window.requestAnimationFrame(function () {
        scrollToY(element, source, aim, startTime, endTime, t)
      })

    }
  }
  function scrollTo(element, aim, duration) {
    var t = new Date().getTime()
    scrollToY(element, element.scrollTop, aim, t, t + duration, t)
  }
  function scrollToStop(seqNo, direction) {
    var selector = '.route_container .route[direction="' + direction + '"]'
    var stop_height = 50
    var route_container_height = $(selector).height()
    var stop_offset_top = seqNo * stop_height
    var route_content_height = document.querySelector(selector).scrollHeight
    var scrolltop = 0
    if (stop_offset_top > (route_container_height - stop_height) / 2 && (route_content_height - stop_offset_top - stop_height) > (route_container_height - stop_height) / 2) {
      scrolltop = ((route_container_height - stop_height) / 2 - stop_offset_top) * (-1)
    }
    else {
      if (stop_offset_top > (route_content_height - stop_offset_top - stop_height)) {
        scrolltop = route_content_height - route_container_height
      }
    }
    scrollTo(document.querySelector(selector), scrolltop, 555)
  }

  function scrollToNearestStop(direction) {
    if (route_container_scrolled === 0) {
      var selector = '.route_container .route[direction="' + direction + '"]'
      var ff = $(selector + ' .stop[nh="true"]')
      var len = ff.length
      if (len > 0) {
        var uu = parseInt($(selector + ' .stop').eq(0).attr('no'))
        route_container_scrolled = 1
        scrollToStop(Math.abs(parseInt(ff.eq(0).attr('no')) - uu), direction)
      }
    }
  }
  function bString(h, u) {
    var e = '"'
    if (u === 1) {
      e = "'"
    }
    return e + h + e
  }
  var realtime_last_update_a = 0;
  function printStops(k, c, bp, api_update_time_ms, now_time_ms) {
    if (realtime_last_update_a === 0) {
      realtime_last_update_a = api_update_time_ms
    }
    try {
      var pos_checkStops = function (h) {
        if (h.length <= 0) {
          return {}
        }
        else {
          if (h[0].distance <= 500) {
            return h[0]
          }
        }
      }
      var fg = function (b) {
        s = { 'goBack': b }
        displayName = ''
        bv.h = true
      }
      var isBuffer = function (bu, str, direction) {
        if (!(bu.hasOwnProperty('o_' + direction))) {
          return { 'g': false, 'j': {} }
        }
        bu = bu['o_' + direction]
        var bu_len = bu.length
        for (var p = 0; p < bu_len; p++) {
          if (String(bu[p].n).indexOf(str) > -1 && String(str).indexOf(bu[p].n) > -1) {
            return { 'g': true, 'j': bu[p] }
          }
        }
        return { 'g': false, 'j': {} }
      }
      if (skeletonScreenStatus === 1) {
        skeletonScreenStatus = 0
        $('.route_container .route[direction="departure"]').html('')
        $('.route_container .route[direction="destination"]').html('')
      }
      var htm = {}
      var l = k.length
      var g = false
      var nearest_stops_list = { 'o_0': [], 'o_1': [] }
      var nearest_stops_d = { 'o_0': {}, 'o_1': {} }
      var buffers = {}
      var buffer_closed = 0
      if (c === 'skeleton') {
        g = true
      }
      if (!g) {
        nearest_stops_list = getNearestStops(pos_lat, pos_lon)
        nearest_stops_d['o_0'] = pos_checkStops(nearest_stops_list.o_0)
        nearest_stops_d['o_1'] = pos_checkStops(nearest_stops_list.o_1)
        if (routes_json.loaded && stops_json.loaded) {
          buffers = getPathBuffer(routes_json.c['b_' + c_routeid].s)
        }
      }
      var ripple_selector_list = []
      for (var w = 0; w < l; w++) {
        if (!k[w].hasOwnProperty('StopID') || !k[w].hasOwnProperty('EstimateTime')) {
          if (!g) {
            continue;
          }
        }
        var selector = ''
        var displayName = k[w].StopID
        var s = {}
        var bv = { 'h': false, 'n': '', 'icon': '', 'l': '', 'ty': '', 'time': '', 'status': '' }
        var nh = false
        var buffer_start_html = ``
        var buffer_end_html = ``
        if (g) {
          fg(k[w].goBack)
        }
        else {
          if (stops_json.loaded) {
            if (stops_json.c.hasOwnProperty('b_' + k[w].StopID)) {
              s = stops_json.c['b_' + k[w].StopID]
              displayName = s.nameZh
              if (nearest_stops_d.hasOwnProperty('o_' + s.goBack)) {
                if (!(nearest_stops_d['o_' + s.goBack] === undefined)) {
                  if (nearest_stops_d['o_' + s.goBack].StopID === k[w].StopID) {
                    nh = true
                  }
                }
              }
            }
            else {
              continue;
            }
          }
          if (busevent_json.loaded) {
            if (bp.hasOwnProperty('s_' + k[w].StopID)) {
              var thisbv = bp['s_' + k[w].StopID]
              bv.h = true
              bv.n = thisbv.BusID
              bv.icon = icon_bus
              bv.l = thisbv.CarOnStop
              bv.ty = thisbv.CarType
              bv.time = thisbv.DataTime
              bv.status = thisbv.BusStatus
            }
          }
        }

        if (!(htm.hasOwnProperty('h_' + s.goBack))) {
          htm['h_' + s.goBack] = []
        }
        if (g) {
          var status_time_g = 0
          var status = { 'status': 10, 'text': '', 'tr': false }
        }
        else {
          var status_time_p = false
          var status_time_change = 0
          if (route_container_content['h_' + s.goBack].hasOwnProperty('b_' + k[w].StopID)) {
            if (route_container_content['h_' + s.goBack]['b_' + k[w].StopID].hasOwnProperty('status_time_g')) {
              status_time_p = route_container_content['h_' + s.goBack]['b_' + k[w].StopID]['status_time_g']
              status_time_change = route_container_content['h_' + s.goBack]['b_' + k[w].StopID]['status_time_change']
            }
          }

          var status_time_g = parseInt(k[w].EstimateTime)
          var status = timeStatus(status_time_g)
        }
        if (!g) {
          var bf_c = isBuffer(buffers, displayName, s.goBack)
          if (bf_c.g) {
            if (buffer_closed === 0) {
              buffer_start_html = `<div class="buffer-group">`
              buffer_closed = 1
            }
            else {
              if (buffer_closed === 1) {
                buffer_end_html = `</div>`
                buffer_closed = 0
              }
            }
          }
        }
        var jn = { 'id': k[w].StopID, 'name': displayName, 'bv': bv, 'status': status, 'nh': nh }
        var hash = md5(JSON.stringify(jn))
        var bvhash = md5(JSON.stringify(bv))
        var statushash = md5(JSON.stringify(status))

        if (!(route_container_content['h_' + s.goBack].hasOwnProperty('b_' + k[w].StopID)) || g === true) {
          route_container_content['h_' + s.goBack]['b_' + k[w].StopID] = {}
          var bus_element_id = gid('bus')
          ripple_selector_list.push(`#${bus_element_id}`)
          htm['h_' + s.goBack].push(`${buffer_start_html}<li class="stop" l="${g}" stop-id="${k[w].StopID}" bus="${bv.h}" nh="${nh}" no="${s.seqNo}"><div class="name">${displayName}</div><div class="position" d="${nh}"><div class="position-signal"></div><div class="position-white"></div><div class="position-blue"></div></div><button class="bus" d="${bv.h}" l="${bv.l}" id="${bus_element_id}" onclick="displayBus('${bv.n}','${bv.l}','${bv.ty}','${bv.status}','${bv.time}')"><div class="busicon">${bv.icon}</div></button><div class="status" status="${status.status}" tr="${status.tr}">${status.text}</div></li>${buffer_end_html}`)
        }

        if (!(route_container_content['h_' + s.goBack]['b_' + k[w].StopID]['hash'] === hash) && !(g === true)) {
          if (s.goBack === 0) {
            selector = '.route_container .route[direction="departure"]'
          }
          if (s.goBack === 1) {
            selector = '.route_container .route[direction="destination"]'
          }
          selector += ' .stop[stop-id="' + k[w].StopID + '"]'
          var thiscontent = route_container_content['h_' + s.goBack]['b_' + k[w].StopID]
          if (!(thiscontent.bvhash === bvhash)) {
            $(selector).attr('bus', bv.h)
            $(selector + ' .bus').attr('d', bv.h).attr('l', bv.l).attr('onclick', 'displayBus(' + bString(bv.n, 1) + ',' + bString(bv.l, 1) + ',' + bString(bv.ty, 1) + ',' + bString(bv.status, 1) + ',' + bString(bv.time, 1) + ')')
            $(selector + ' .bus .busicon').html(bv.icon)
          }
          if (!(thiscontent.statushash === statushash)) {
            var status_s = status.tr
            if (thiscontent.status <= 3 && status.status === 0 || 3) {
              status_s = true
            }
            $(selector + ' .status').attr('tr', status_s).attr('status', status.status).text(status.text)
          }
          if (!(thiscontent.nh === nh)) {
            $(selector + ' .position').attr('d', nh)
            $(selector).attr('nh', nh)
          }
          if (Math.abs(status_time_p - status_time_g) > 0) {
            status_time_change = new Date().getTime()
          }
          route_container_content['h_' + s.goBack]['b_' + k[w].StopID] = { 'hash': hash, 'bvhash': bvhash, 'statushash': statushash, 'status': status, 'status_time_g': status_time_g, 'status_time_change': (status_time_change) }
        }
      }
      if (!htm.hasOwnProperty('h_0')) {
        htm['h_0'] = ['']
      }
      if (!htm.hasOwnProperty('h_1')) {
        htm['h_1'] = ['']
      }

      $('.route_container .route[direction="departure"]').append(htm['h_0'].join(''))
      $('.route_container .route[direction="destination"]').append(htm['h_1'].join(''))
      if (ripple_selector_list.length > 0) {
        ripple(document.querySelectorAll(ripple_selector_list.join(',')), 'var(--g-333333)', 450)
      }
      if (route_dep_auto_scroll === 0 && !g) {
        route_dep_auto_scroll = 1
        scrollToNearestStop('departure')
      }
      if (route_des_auto_scroll === 0 && !g) {
        route_des_auto_scroll = 1
        scrollToNearestStop('destination')
      }
    }
    catch (e) {
      console.log(e)
    }
  }

  function timeStatus(t) {
    var padding = function (j) {
      if (j < 10) {
        return '0' + j
      }
      else {
        return j
      }
    }
    t = parseInt(t)
    var opt = getOption('options_reveal_estimate_time_exact_seconds')
    if (opt) {
      var time = padding((t - (t % 60)) / 60) + ':' + padding(t % 60)
    }
    else {
      var time = Math.round(t / 60) + '分'
    }
    if (t === -3) {
      return { status: 6, text: '末班駛離', tr: false }
    }
    if (t === -4) {
      return { status: 5, text: '今日停駛', tr: false }
    }
    if (t === -2) {
      return { status: 4, text: '交通管制', tr: false }
    }
    if (t === -1) {
      return { status: 3, text: '未發車', tr: false }
    }
    if (t <= 180) {
      if (t <= 100) {
        if (opt) {
          if (t <= 10) {
            return { status: 2, text: '進站中', tr: true }
          }
          else {
            return { status: 2, text: time, tr: true }
          }
        }
        else {
          return { status: 2, text: '進站中', tr: true }
        }
      }
      else {
        return { status: 1, text: time, tr: true }
      }
    }
    else {
      return { status: 0, text: time, tr: false }
    }
  }
  function findStop(j, id, pid) {
    var res = []
    if (!stops_json.loaded) {
      return res
    }
    var o = j.BusInfo
    var l = o.length
    for (var w = 0; w < l; w++) {
      var this_id = parseInt(o[w].RouteID)
      if (this_id === id || pid.indexOf(String(this_id)) > -1 || this_id === id * 10) {
        res.push(o[w])
      }
    }

    res.sort(function (a, b) {
      var c = -1
      var d = 0
      if (stops_json.c.hasOwnProperty('b_' + a.StopID)) {
        c = stops_json.c['b_' + a.StopID].seqNo
      }
      if (stops_json.c.hasOwnProperty('b_' + b.StopID)) {
        d = stops_json.c['b_' + b.StopID].seqNo
      }
      return c - d
    });
    return res
  }
  function findBus(j, id, pid) {
    if (!j.loaded || !routes_json.loaded) {
      return {}
    }
    var res = {}
    var o = j.c
    var l = o.length
    for (var w = 0; w < l; w++) {
      var ro = parseInt(o[w].RouteID)
      if (ro === id || pid.indexOf(String(ro)) > -1 || ro === id * 10) {
        res['s_' + o[w].StopID] = o[w]
      }
    }
    return res
  }

  function updateRealtimeJson(immediate_update) {
    if (update_status === 0) {
      updateBusEventJson()
      $.ajax({
        type: 'GET', url: realtime_api() + '?_=' + api_url_parameter(5 * 1000), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data, statusText, xhr) {
          var b = new Blob([data.slice(0, data.size)], { type: 'application/gzip' });
          b.arrayBuffer().then(bf => {
            var z = pako.inflate(bf, { to: 'string' })
            realtime_json = JSON.parse(z)
            var last_modified = new Date(String(xhr.getResponseHeader('last-modified')))
            var now = new Date()
            var jn = 10000
            update_interval = Math.min(Math.max(5000, Math.abs(last_modified.getTime() + jn - now.getTime())), 15000)
            if (isNaN(update_interval)) {
              update_interval = 10000
            }
            if (stops_json.loaded) {
              var s = findStop(realtime_json, c_routeid, c_routeid_p)
              var bb = findBus(busevent_json, c_routeid, c_routeid_p)
              current_route_stops = s
              printStops(s, '', bb, new Date(realtime_json.EssentialInfo.UpdateTime).getTime(), now.getTime())
              realtime_last_update = new Date().getTime()
              if (refresh_progress_l === 0) {
                refresh_progress_l = 1
                $('.refresh_progress_box').attr('l', '1')
              }
            }
            if (!(immediate_update === true)) {
              setTimeout(function () { updateRealtimeJson(false) }, update_interval);
            }
          });
        }, error: function () {
          setTimeout(function () { updateRealtimeJson(false) }, 1000);
        }
      });
    }
    else {
      if (!(immediate_update === true)) {
        setTimeout(function () { updateRealtimeJson(false) }, 1000);
      }
    }
  }
  function updateBusEventJson() {
    $.ajax({
      type: 'GET', url: busevent_api() + '?_=' + api_url_parameter(5 * 1000), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data) {
        var b = new Blob([data.slice(0, data.size)], { type: 'application/gzip' });
        b.arrayBuffer().then(bf => {
          var z = pako.inflate(bf, { to: 'string' })
          var o = JSON.parse(z).BusInfo
          busevent_json.c = o
          busevent_json.loaded = true
        });
      }, error: function () {

      }
    });
  }

  function getStops() {
    var t = new Date().getTime()
    if (!stops_json['c_' + stops_data_city + '_loaded']) {
      $.ajax({
        type: 'GET', url: stops_api() + '?_=' + api_url_parameter(60 * 60 * 24 * 1000), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data) {
          var b = new Blob([data.slice(0, data.size)], { type: 'application/gzip' });
          b.arrayBuffer().then(bf => {
            var z = pako.inflate(bf, { to: 'string' })
            var o = JSON.parse(z).BusInfo
            var json_processed = {}
            var pl = o.length
            for (var j = 0; j < pl; j++) {
              var this_json_k = o[j]
              var id = o[j].Id
              json_processed['b_' + id] = o[j]
            }
            stops_json['c_' + stops_data_city] = json_processed
            stops_json['c_' + stops_data_city + '_loaded'] = true
            stops_json['c_' + stops_data_city + '_arr'] = o
            if (stops_data_city === 0) {
              stops_json.c = stops_json['c_0']
              stops_data_city = 1
              getStops()
            }
            if (stops_data_city === 1) {
              stops_json.c = Object.assign(stops_json['c_0'], stops_json['c_1']);
              stops_json.loaded = true
              stops_json['c_arr'] = stops_json['c_' + 0 + '_arr'].concat(stops_json['c_' + 1 + '_arr'])
              if (realtime_lo === 0) {
                realtime_lo = 1
                updateRealtimeJson(false)
              }
              else {
                updateRealtimeJson(true)
              }
            }
          });
        }
      });
    }
  }

  function getRoutes(immediate_update) {
    var t = new Date().getTime()
    var g = 60 * 60 * 24 * 1 * 1000
    if (immediate_update) {
      routes_json.loaded = false
    }
    if (LS.hasOwnProperty('bus_routes_t_' + 0) && LS.hasOwnProperty('bus_routes_t_' + 1)) {
      if (!immediate_update) {
        if (t - parseInt(String(LS.getItem('bus_routes_t_' + 0))) < g && t - parseInt(String(LS.getItem('bus_routes_t_' + 1))) < g && !(routes_json.loaded === true)) {
          var cc0 = JSON.parse(String(LS.getItem('bus_routes_' + 0)))
          var cc1 = JSON.parse(String(LS.getItem('bus_routes_' + 1)))
          routes_json['c_0'] = cc0
          routes_json['c_1'] = cc1
          routes_json.c = Object.assign(cc0, cc1);
          routes_json.loaded = true
        }
      }
    }

    if (routes_json.loaded) {
      createSearchIndex(routes_json)
      if (routes_json.c.hasOwnProperty('b_' + c_routeid)) {
        c_routeid_p = String(routes_json.c['b_' + c_routeid].pid).split(',')
      }
      setRouteD()
    }
    else {
      if (immediate_update) {
        prompt_message('更新路線資料中')
      }
      $.ajax({
        type: 'GET', url: routes_api(routes_data_city), async: true, cache: false, xhrFields: { responseType: 'blob' }, success: function (data) {
          var b = new Blob([data.slice(0, data.size)], { type: 'application/gzip' });
          b.arrayBuffer().then(bf => {
            var z = pako.inflate(bf, { to: 'string' })
            var o = JSON.parse(z).BusInfo
            var json_processed = {}
            var pl = o.length
            for (var j = 0; j < pl; j++) {
              var this_json_k = o[j]
              var id = o[j].Id
              for (var g = 0; g < rdsn_len; g++) {
                var thsS = routesDataShortName[g]
                if (this_json_k.hasOwnProperty(thsS.source)) {
                  if (!(thsS.short === false)) {
                    this_json_k[thsS.short] = this_json_k[thsS.source]
                  }
                  delete this_json_k[thsS.source]
                }
              }
              if (!json_processed.hasOwnProperty('b_' + id)) {
                json_processed['b_' + id] = this_json_k
              }
              else {
                if (!(this_json_k.pid === json_processed['b_' + id]['pid']) || !(String(json_processed['b_' + id]['pid']).indexOf(',' + this_json_k.pid) > -1)) {
                  json_processed['b_' + id]['pid'] = json_processed['b_' + id]['pid'] + ',' + this_json_k.pid
                }
              }
            }

            routes_json['c_' + routes_data_city] = json_processed
            LS.setItem('bus_routes_' + routes_data_city, JSON.stringify(json_processed))
            LS.setItem('bus_routes_t_' + routes_data_city, new Date().getTime())
            if (routes_data_city === 0) {
              routes_data_city = 1
              getRoutes(immediate_update)
            }
            if (routes_data_city === 1) {
              routes_json.loaded = true
              routes_json['c_1'] = json_processed
              routes_json.c = Object.assign(routes_json['c_0'], json_processed);
              createSearchIndex(routes_json)
              if (routes_json.c.hasOwnProperty('b_' + c_routeid)) {
                c_routeid_p = String(routes_json.c['b_' + c_routeid].pid).split(',')
              }
              if (immediate_update) {
                prompt_message('路線資料更新成功')
              }
              setRouteD()
            }
          });
        }
      });
    }
  }

  function showRoute(id) {
    route_container_content = { 'h_0': {}, 'h_1': {} }
    skeletonScreen(false)
    c_routeid = id
    getRoutes(false)
  }

  function switchDirection(d, event) {
    if (!(event === undefined) && !(event === null)) {
      if (event.type === 'click') {
        $('.routes,.tab-line-box2,.tabs').attr('slide', '0').css({ '--j-transition-p': 'transform 450ms', '--j-transition-w-p': 'width 450ms', '--j-transition-a-p': `all 450ms` })
      }
    }
    var a = 0
    var b = 1
    offsetX = (route_max_X - route_min_X) * (0)
    if (d === 'destination') {
      a = 1
      b = 0
      offsetX = (route_max_X - route_min_X) * (-1)
    }
    route_direction = d
    route_container_scrolled = 0
    $('.route_container .routes').attr('class', 'routes ' + d)
    $('.route_container .tabs .tab[direction="departure"]').attr('g', a)
    $('.route_container .tabs .tab[direction="destination"]').attr('g', b)
    $(".tab-line-box2").attr('class', 'tab-line-box2 ' + d)
    $(".tab-line").attr('class', 'tab-line ' + d)
    document.querySelector('.routes').addEventListener('transitionend', function () {
      $('.route_container .routes').attr('slide', '-1')
      $('.tab-line-box2,.tabs').attr('slide', '-1')
    }, { once: true })
    if (!(event === undefined) && !(event === null)) {
      if (event.type === 'click') {
        scrollToNearestStop(d)
      }
    }
  }

  function standaloneStatusBarColor(a) {
    var c = '#ffffff'
    var d = '#101010'
    if (a === 1) {
      c = '#7f7f7f'
      d = '#080808'
    }
    $('head meta[kji="light"]').attr('content', c)
    $('head meta[kji="dark"]').attr('content', d)
  }

  function closeBus() {
    if (businfo_close === 0) {
      businfo_close = 1
      $('.bus_info_box').attr('p', '0')
      $('.bus_info_mask').css({ 'opacity': '0' })
      standaloneStatusBarColor(0)
      setTimeout(() => {
        $('.bus_info_mask').css({ 'display': 'none' })
        businfo_close = 0
      }, 480);
    }
  }
  function displayBus(id, onstop, type, status, update) {
    gtag('event', 'display_bus_info', {
      'event_category': onstop,
      'event_label': id,
      'event_callback': function () {
      }
    });
    businfo_scroll = 0
    businfo_scroll_1 = 0
    let sel = '.bus_info_box .bus_info .bus_info_list li'
    if (onstop === '0') {
      onstop = '離站'
    }
    if (onstop === '1') {
      onstop = '進站'
    }
    if (type === '0') {
      type = '一般'
    }
    if (type === '1') {
      type = '低底盤'
    }
    if (type === '2') {
      type = '大復康巴士'
    }
    if (type === '3') {
      type = '狗狗友善專車'
    }
    if (status === '0') {
      status = '正常'
    }
    if (status === '1') {
      status = '車禍'
    }
    if (status === '2') {
      status = '故障'
    }
    if (status === '3') {
      status = '塞車'
    }
    if (status === '4') {
      status = '緊急求援'
    }
    if (status === '5') {
      status = '加油'
    }
    if (status === '99') {
      status = '非營運狀態'
    }
    $(sel + '[f="bus_id"]').text(id)
    $(sel + '[f="bus_onstopstatus"]').text(onstop)
    $(sel + '[f="bus_type"]').text(type)
    $(sel + '[f="bus_status"]').text(status)
    $(sel + '[f="bus_update"]').text(update)
    $('.bus_info_box').scrollTop(50).attr('p', '1')
    $('.bus_info_title').attr('sticky', '0')
    $('.bus_info_mask').css({ 'display': 'block' })
    setTimeout(() => {
      $('.bus_info_mask').css({ 'opacity': '1' })
      standaloneStatusBarColor(1)
    }, 1);
  }

  function closeRouteInfo() {
    if (routeinfo_close === 0) {
      routeinfo_close = 1
      $('.route_info_box').attr('p', '0')
      $('.route_info_mask').css({ 'opacity': '0' })
      standaloneStatusBarColor(0)
      setTimeout(() => {
        $('.route_info_mask').css({ 'display': 'none' })
        routeinfo_close = 0
      }, 480);
    }
  }
  function displayRouteInfo() {
    var ct = 60 * 60 * 24 * 1000
    routeinfo_scroll = 0
    routeinfo_scroll_1 = 0
    let sel = '.route_info_box .route_info .route_info_list li'
    $('.route_info_box').scrollTop(50).attr('p', '1')
    $('.route_info_title').attr('sticky', '0')
    $('.route_info_mask').css({ 'display': 'block' })
    setTimeout(() => {
      $('.route_info_mask').css({ 'opacity': '1' })
      standaloneStatusBarColor(1)
    }, 1);

    var setF = function (f, v) {
      if (v === null || v === undefined || v === '' || v === ' ') {
        v = ''
      }
      var l = String(v).length
      if (l <= 0) {
        $(sel + '[f="' + f + '"]').attr('d', '0')
      }
      else {
        $(sel + '[f="' + f + '"]').attr('d', '1').text(v)
      }
    }
    var minute = function (s) {
      return parseInt(s) + '分'
    }
    var hw = function (str) {
      str = String(str)
      var l = str.length
      if (l === 4) {
        var min = minute(str.substring(0, 2))
        var max = minute(str.substring(2, 4))
        return min + '-' + max
      }
      if (l === 2) {
        return minute(str)
      }
      return str
    }
    var time24h = function (str) {
      str = String(str)
      var l = str.length
      if (l === 4) {
        var hh = str.substring(0, 2)
        var mm = str.substring(2, 4)
        return hh + ':' + mm
      }
      return str
    }

    if (routeinfo_loaded === 0) {
      routeinfoloadtime_t1 = new Date().getTime()
      $('.route_info_box').attr('l', '0')
      $(sel).attr('d', '1')
      $.ajax({
        type: 'GET', url: routes_api(city) + '?_=' + api_url_parameter(ct), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data) {
          var b = new Blob([data.slice(0, data.size)], { type: 'application/gzip' });
          b.arrayBuffer().then(bf => {
            var z = pako.inflate(bf, { to: 'string' })
            var o = JSON.parse(z).BusInfo
            var l = o.length
            var u
            for (var i = 0; i < l; i++) {
              var this_route = o[i]
              if (this_route.Id === c_routeid) {
                u = this_route
                break;
              }
              else {
                continue;
              }
            }

            $.ajax({
              type: 'GET', url: provider_api() + '?_=' + api_url_parameter(ct), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data2) {
                var b2 = new Blob([data2.slice(0, data2.size)], { type: 'application/gzip' });
                b2.arrayBuffer().then(bf2 => {
                  var z2 = pako.inflate(bf2, { to: 'string' })
                  var o2 = JSON.parse(z2).BusInfo
                  var l2 = o.length
                  var u2
                  for (var i = 0; i < l; i++) {
                    var this_provider = o2[i]
                    if (this_provider.id === u.providerId) {
                      u2 = this_provider
                      break;
                    }
                    else {
                      continue;
                    }
                  }

                  $.ajax({
                    type: 'GET', url: timetable_api() + '?_=' + api_url_parameter(ct), async: true, cache: true, xhrFields: { responseType: 'blob' }, success: function (data3) {
                      var b3 = new Blob([data3.slice(0, data3.size)], { type: 'application/gzip' });
                      b3.arrayBuffer().then(bf3 => {
                        var z3 = pako.inflate(bf3, { to: 'string' })
                        var o3 = JSON.parse(z3).BusInfo
                        var l3 = o3.length
                        var u3 = { 'u_weekday': {}, 'u_specialday': {}, 'u_holiday': {} }
                        var u3_l_w = 0
                        var u3_l_h = 0

                        for (var i = 0; i < l3; i++) {
                          var this_timetable = o3[i]
                          var this_pid = this_timetable.PathAttributeId
                          if (this_pid === c_routeid_p || this_pid === c_routeid || this_pid === c_routeid * 10) {
                            var dateval = this_timetable.DateValue
                            var depTime = this_timetable.DepartureTime
                            if (this_timetable.DateType === '0') {
                              if (dateval === '1' || dateval === '7') {
                                u3['u_holiday']['t_' + depTime] = this_timetable
                                u3_l_h += 1
                              }
                              else {
                                u3['u_weekday']['t_' + depTime] = this_timetable
                                u3_l_w += 1
                              }
                            }
                            else {
                              u3['u_specialday']['t_' + depTime] = this_timetable
                            }
                          }
                          else {
                            continue;
                          }
                        }
                        var weekday_timetable = []
                        var holiday_timetable = []
                        var specialday_timetable = []
                        var weekday_timetable_str = ''
                        var holiday_timetable_str = ''

                        if (u3_l_w >= 1) {
                          for (var f in u3['u_weekday']) {
                            var this_f = u3['u_weekday'][f]
                            weekday_timetable.push(time24h(this_f.DepartureTime))
                          }
                          weekday_timetable.sort(function (a, b) {
                            var c = a.split(':')
                            var d = b.split(':')
                            var e = parseInt(c[0]) * 60 + parseInt(c[1])
                            var f = parseInt(d[0]) * 60 + parseInt(d[1])
                            return e - f
                          })
                          weekday_timetable_str = weekday_timetable.join('|')
                        }
                        if (u3_l_h >= 1) {
                          for (var f in u3['u_holiday']) {
                            var this_f = u3['u_holiday'][f]
                            holiday_timetable.push(time24h(this_f.DepartureTime))
                          }
                          holiday_timetable.sort(function (a, b) {
                            var c = a.split(':')
                            var d = b.split(':')
                            var e = parseInt(c[0]) * 60 + parseInt(c[1])
                            var f = parseInt(d[0]) * 60 + parseInt(d[1])
                            return e - f
                          })
                          holiday_timetable_str = holiday_timetable.join('|')
                        }
                        var r_weekday = '尖峰:' + hw(u.peakHeadway) + '|離峰:' + hw(u.offPeakHeadway)
                        if ((u.peakHeadway).length <= 0) {
                          r_weekday = undefined
                        }
                        var r_holiday = '尖峰:' + hw(u.holidayPeakHeadway) + '|離峰:' + hw(u.holidayOffPeakHeadway)
                        if ((u.holidayPeakHeadway).length <= 0) {
                          r_holiday = undefined
                        }
                        setF("route_name", u.nameZh)
                        setF("route_departure", u.departureZh)
                        setF("route_destination", u.destinationZh)
                        setF("route_weekday_first", time24h(u.goFirstBusTime))
                        setF("route_weekday_last", time24h(u.goLastBusTime))
                        setF("route_weekday", r_weekday)
                        setF("route_weekday_timetable", weekday_timetable_str)
                        setF("route_holiday_timetable", holiday_timetable_str)
                        setF("route_holiday_first", time24h(u.holidayGoFirstBusTime))
                        setF("route_holiday_last", time24h(u.holidayGoLastBusTime))
                        setF("route_holiday", r_holiday)
                        setF("route_price", u.ticketPriceDescriptionZh)
                        setF("route_buffer", u.segmentBufferZh)
                        setF("route_provider", u.providerName)
                        setF("route_tel", u2.phoneInfo)
                        setF("route_email", u2.email)
                        $('.route_info_box').attr('l', '1')
                        routeinfo_loaded = 1
                        routeinfoloadtime_t2 = new Date().getTime()
                        routeinfoloadtime = routeinfoloadtime_t2 - routeinfoloadtime_t1
                        gtag('event', 'display_route_info', {
                          'event_category': c_routeid,
                          'complete_time': routeinfoloadtime,
                          'event_callback': function () {
                          }
                        });
                      })
                    }
                  });
                })
              }
            });

          })
        }
      });
    }

  }
  function closeRoute() {
    refreshProgresPause = 1
    gtag('event', 'back_to_previous_page', {
      'event_category': 'close_route',
      'event_label': c_routeid,
      'event_callback': function () {
        //$('.route_container').css({ 'display': 'none' })
        fade(document.querySelector('.route_container'), 'Out', 'none', function () {
          route_page_is_open = 0
          $('.route_container .route[direction="departure"]').scrollTop(0).html('')
          $('.route_container .route[direction="destination"]').scrollTop(0).html('')
        })
      }
    });
  }

  function getUkey(str) {
    var regex = /[A-Za-z0-9\-\_\.\!\~\*\'\(\)]*/gm
    var s = str.match(regex) || []
    s = s.join('').replaceAll(/[\-\.\!\~\*\'\(\)]/gm, "_")
    var r = str.replaceAll(regex, '') || ""
    var e = String(encodeURIComponent(r)).split('%')
    var t = 0
    var e_len = e.length
    for (var w = 0; w < e_len; w++) {
      t += parseInt(e[w], 16) || 0
    }
    t = parseInt(t).toString(36)
    return (s + '' + t).toLowerCase()
  }

  function createSearchIndex(j) {
    if (j.loaded) {
      j = j.c
      var arr = []
      for (var p in j) {
        var this_p = j[p]
        var id = String(p).replace('b_', '')
        var ct = undefined
        this_p['id'] = id
        this_p['unicode'] = unicode_arr(this_p.n + this_p.dep + this_p.des)
        this_p['mark_id'] = getUkey(this_p['n'])
        if (routes_json['c_0'].hasOwnProperty(p)) {
          ct = 0
        }
        if (routes_json['c_1'].hasOwnProperty(p)) {
          ct = 1
        }
        this_p['city'] = ct
        arr.push(this_p)
      }
      search_index.c = arr
      search_index.loaded = true
    }
  }

  function search_result(q, search_index) {
    if (!(String(q).length > 0)) {
      return []
    }
    var res_1 = []
    var q_u = unicode_arr(q)
    var q_u_len = q_u.length
    var search_index_len = search_index.length
    for (var s = 0; s < search_index_len; s++) {
      var this_s = search_index[s]
      var this_s_u = this_s.unicode
      var res_t = false
      for (var f = 0; f < q_u_len; f++) {
        if (this_s_u.indexOf(q_u[f]) > -1) {
          res_t = true
          break;
        }
      }
      if (!(res_t)) {
        continue;
      }
      else {
        if (String(this_s.n).indexOf(q) > -1) {
          res_1.push(this_s)
          continue;
        }
        else {
          if (String(this_s.dep).indexOf(q) > -1) {
            res_1.push(this_s)
            continue;
          }
          else {
            if (String(this_s.des).indexOf(q) > -1) {
              res_1.push(this_s)
              continue;
            }
          }
        }
      }
    }
    return res_1
  }

  function openRoute(c, i) {
    gtag('event', 'open_route', {
      'event_category': c,
      'event_label': i,
      'event_callback': function () {
        city = c
        routeinfo_loaded = 0
        route_container_scrolled = 0
        route_page_is_open = 1
        route_dep_auto_scroll = 0
        route_des_auto_scroll = 0
        fade(document.querySelector('.route_container'), 'In', 'block')
        $('.route_container .tabs').attr('l', '0')
        $('.route_container .title .routename').attr('l', '0')
        switchDirection('departure')
        getStops()
        showRoute(parseInt(i))
        setUpDynamicColor()
        if (stops_json.loaded) {
          updateRealtimeJson(true)
        }
        if (refreshProgresPause === 0) {
          updateRefreshProgress()
        }
      }
    });
  }

  function printSearchResult(result) {
    var result_len = result.length
    var f = []
    var search_result_id = gid('search_result')
    for (var e = 0; e < result_len; e++) {
      var thisres = result[e]
      var htm = `<li class="search_result_r" s-id="${search_result_id}"><button onclick="openRoute(${thisres.city},${thisres.id})"><div class="search_result_r_name">${thisres.n}</div><div class="search_result_r_dep_to_des">${thisres.des} - ${thisres.dep}</div></a></li>`
      f.push(htm)
    }
    return [f.join(''), search_result_id]
  }

  function update_search_result() {
    var q = $('#search_routes').val()
    var res = search_result(q, search_index.c)
    var reshtml = printSearchResult(res)
    $('.search_routes_result').html(reshtml[0])
    ripple(document.querySelectorAll(`.search_routes_result .search_result_r[s-id="${reshtml[1]}"] button`), 'var(--g-333333)', 450)
    var font = 500 + " " + 18 + "px 'Noto Sans', sans-serif"
    var text_width = getTextWidth(q, font)
    $('.search').css({ '--cursor-offset': text_width + 'px' })
  }

  function opensearch() {
    if (search_page_is_open === 0) {
      search_page_is_open = 1
      $('.search,.search_routes_result,.routes_keyboard').attr('p', '1')
      n_watchPosition()
    }

  }

  function closeopensearch() {
    if (search_page_is_open === 1) {
      search_page_is_open = 0
      $('.search,.search_routes_result,.routes_keyboard').attr('p', '0')
    }
  }
  function openoptions() {
    fade(document.querySelector('.options_container'), 'In', 'block')
    if (options_pulled === 0) {
      options_pulled = 1
      pullOptionsFromLS()
    }
  }
  function closeoptions() {
    fade(document.querySelector('.options_container'), 'Out', 'none')
  }

  function opennetworkstats() {
    fade(document.querySelector('.network_stats_container'), 'In', 'block')
    createNetworkStatsChart()
  }
  function closenetworkstats() {
    fade(document.querySelector('.network_stats_container'), 'Out', 'none', function () {
      if (!(document.querySelector('.chart .chart_contents') === null)) {
        document.querySelector('.chart_contents').remove()
      }
    })
  }
  function initializeKeyboard() {
    var htm = []
    var row_len = routes_keyboard_keys.length
    for (var o = 0; o < row_len; o++) {
      var this_row = routes_keyboard_keys[o]
      var this_row_len = this_row.length
      for (var w = 0; w < this_row_len; w++) {
        var this_key = this_row[w]
        var onclick = "keyboard_add('" + this_key + "')"
        if (this_key === '刪除') {
          onclick = "keyboard_delete()"
        }
        if (this_key === '清空') {
          onclick = "keyboard_clear()"
        }
        var onclick_event = 'onmousedown'
        if (supportTouch()) {
          onclick_event = 'ontouchstart'
        }
        htm.push(`<button class="routes_keyboard_key" ${onclick_event}="${onclick}"><div class="routes_keyboard_key_block">${this_key}</div></button>`)
      }
    }
    $('.routes_keyboard').html(htm.join(''))
    ripple(document.querySelectorAll('.routes_keyboard .routes_keyboard_key .routes_keyboard_key_block'), 'var(--g-333333)', 450)
  }

  function keyboard_add(k) {
    var v = $('#search_routes').val()
    v += k
    $('#search_routes').val(v)
    if (search_page_is_open === 1) {
      update_search_result()
    }
  }

  function keyboard_delete() {
    var v = $('#search_routes').val()
    v = v.substring(0, v.length - 1)
    $('#search_routes').val(v)
    if (search_page_is_open === 1) {
      update_search_result()
    }
  }

  function keyboard_clear() {
    $('#search_routes').val('')
    if (search_page_is_open === 1) {
      update_search_result()
    }
  }

  function setRouteSlideSize() {
    route_min_X = 0
    route_min_Y = 95
    route_max_X = window.innerWidth + route_min_X
    route_max_Y = window.innerHeight - 95 + route_min_Y
    animation_speed = (route_max_X - route_min_X) / 700
  }
  function getNearestStops(lat, lon) {
    var snapshot = current_route_stops.slice(0)
    var len = snapshot.length
    var len2 = 5
    var res = { 'o_0': [], 'o_1': [] }
    if (len < 5) {
      len2 = 3
    }

    if (len <= 0 || !(stops_json.loaded === true)) {
      return res
    }

    for (var u = 0; u < len; u++) {
      var this_stop = snapshot[u]
      var lon_d, lat_d
      if (stops_json.c.hasOwnProperty('b_' + this_stop.StopID)) {
        var s = stops_json.c['b_' + this_stop.StopID]
        lon_s = parseFloat(s.longitude)
        lat_s = parseFloat(s.latitude)
        this_stop.lon = lon_s
        this_stop.lat = lat_s
        this_stop.goBack_s = s.goBack
        lon_d = Math.abs(lon_s - lon)
        lat_d = Math.abs(lat_s - lat)
      }
      else {
        lon_d = 0
        lat_d = 0
      }
      this_stop.rd = lon_d + lat_d
    }

    snapshot = snapshot.sort(function (a, b) {
      var c = a.rd
      var d = b.rd
      return c - d
    })

    for (var w = 0; w < len2; w++) {
      var this_stop = snapshot[w]
      var gb = this_stop.goBack_s
      var distance = getDistance(this_stop.lat, this_stop.lon, lat, lon)
      this_stop.distance = distance
      if (!(res.hasOwnProperty('o_' + gb))) {
        res['o_' + gb] = []
      }
      res['o_' + gb].push(this_stop)
    }
    return res
  }

  function n_watchPosition() {
    if (watch_position_permission_requested === 0 && getOption('options_display_user_current_position')) {
      watch_position_permission_requested = 1
      watch_position = navigator.geolocation.watchPosition(function (position) {
        pos_lat = position.coords.latitude
        pos_lon = position.coords.longitude
      });
    }
  }

  function checkSlideCoordinate(route_min, p, route_max) {
    if (p < route_min) {
      return route_min - route_min
    }
    if (p > route_max) {
      return route_max - route_min
    }
    return p - route_min
  }

  function calcSlideScale() {
    var p1 = Math.abs(route_max_X - route_min_X) / 2
    var f = route_x2 - route_x1
    var s = f / p1
    if (s < 0) {
      //route_container_s slide to right
      var w = s / ((route_x1) / p1)
    }
    if (s > 0) {
      //route_container_s slide to left
      var w = s / ((route_max_X - route_min_X - route_x1) / p1)
    }
    if (w < -1) {
      w = -1
    }
    if (w > 1) {
      w = 1
    }
    return w
  }


  function touchMove(e) {
    if (route_page_is_open === 1) {
      route_x2 = checkSlideCoordinate(route_min_X, e.pageX + de.scrollLeft, route_max_X)
      route_y2 = checkSlideCoordinate(route_min_Y, e.pageY + de.scrollTop, route_max_Y)
      if (horizontal_slide && !vertical_slide) {
        var w = calcSlideScale()
        var rf = w * 1
        var yw = route_tab_des_width * 1
        var wy = route_tab_dep_width * 1
        var dep_e = 0.3
        var des_e = 0
        var dep_color_r = 0
        var dep_color_g = 0
        var dep_color_b = 0
        var des_color_r = 0
        var des_color_g = 0
        var des_color_b = 0
        if (w < 0) {
          rf = w * -1
          yw = route_tab_dep_width * 1
          wy = route_tab_des_width * 1
          dep_color_r = mixA(route_tab_color_888888_r, route_tab_color_333333_r, Math.abs(w))
          dep_color_g = mixA(route_tab_color_888888_g, route_tab_color_333333_g, Math.abs(w))
          dep_color_b = mixA(route_tab_color_888888_b, route_tab_color_333333_b, Math.abs(w))
          des_color_r = mixA(route_tab_color_333333_r, route_tab_color_888888_r, Math.abs(w))
          des_color_g = mixA(route_tab_color_333333_g, route_tab_color_888888_g, Math.abs(w))
          des_color_b = mixA(route_tab_color_333333_b, route_tab_color_888888_b, Math.abs(w))
          dep_e = 0.3 * (1 - Math.abs(w))
          des_e = 0.3 * (Math.abs(w))
        }
        else {
          rf = (1 - w)
          yw = route_tab_des_width * 1
          wy = route_tab_dep_width * 1
          des_color_r = mixA(route_tab_color_888888_r, route_tab_color_333333_r, Math.abs(w))
          des_color_g = mixA(route_tab_color_888888_g, route_tab_color_333333_g, Math.abs(w))
          des_color_b = mixA(route_tab_color_888888_b, route_tab_color_333333_b, Math.abs(w))
          dep_color_r = mixA(route_tab_color_333333_r, route_tab_color_888888_r, Math.abs(w))
          dep_color_g = mixA(route_tab_color_333333_g, route_tab_color_888888_g, Math.abs(w))
          dep_color_b = mixA(route_tab_color_333333_b, route_tab_color_888888_b, Math.abs(w))
          dep_e = 0.3 * (Math.abs(w))
          des_e = 0.3 * (1 - Math.abs(w))
        }
        $('.routes').css({ '--j-translateX-p': `${((route_max_X) * w + offsetX)}px` }).attr('slide', '1')
        $('.tab-line-box2').css({ '--j-slide-scale-rf-p': `${rf * 100}%`, '--j-slide-scale-yu-p': `${yw + (wy - yw) * Math.abs(w)}px` }).attr('slide', '1')
        $('.tabs').attr('slide', '1')
        $('.tabs .tab[direction="departure"]').css({ '--j-slide-scale-c-p': `rgba(${dep_color_r},${dep_color_g},${dep_color_b},1)`, '--j-slide-scale-ts-p': dep_e + 'px' })
        $('.tabs .tab[direction="destination"]').css({ '--j-slide-scale-c-p': `rgba(${des_color_r},${des_color_g},${des_color_b},1)`, '--j-slide-scale-ts-p': des_e + 'px' })
      }
      else {
        var a = Math.abs(Math.atan((route_y2 - route_y1) / (route_x2 - route_x1)) * 180 / Math.PI)
        if (a <= 30) {
          horizontal_slide = true
        }
        else {
          vertical_slide = true
        }
      }
    }
  }

  function mixA(a, b, l) {
    return Math.floor(a * l + b * (1 - l))
  }

  function saveOptions() {
    var options = $('.options_container input[type="checkbox"]')
    var options_len = options.length
    for (var h = 0; h < options_len; h++) {
      var checked = options.eq(h).prop('checked')
      LS.setItem('bus_opt_' + options.eq(h).attr('name'), checked)
    }
    prompt_message('已儲存變更')
    initializeAllOptions()
  }

  function pullOptionsFromLS() {
    var options_element = $('.options_container input[type="checkbox"]')
    var options_element_len = options_element.length

    for (var h = 0; h < options_element_len; h++) {
      var checked = LS.getItem('bus_opt_' + options_element.eq(h).attr('name'))
      if (isNaN(parseFloat(checked))) {
        if (checked === 'true') {
          checked = true
        }
        else {
          if (checked === 'false') {
            checked = false
          }
        }
      }
      options_element.eq(h).prop('checked', checked)
    }
  }

  function getOption(name) {
    return options[name]
  }

  function initializeAllOptions() {
    var initializeOption = function (name) {
      var key = 'bus_opt_' + name
      var option = false
      if (options_list.indexOf(name) > -1) {
        if (options.hasOwnProperty(name)) {
          option = options[name]
          if (LS.hasOwnProperty(key)) {
            option = String(LS.getItem(key))
            if (isNaN(parseFloat(option))) {
              if (option === 'true') {
                option = true
              }
              if (option === 'false') {
                option = false
              }
            }
            else {
              option = parseFloat(option)
            }
          }
          else {
            LS.setItem(key, option)
          }
          options[name] = option
        }
      }
    }
    var list_len = options_list.length
    for (var i = 0; i < list_len; i++) {
      initializeOption(options_list[i])
    }
  }
  function refreshPage() {
    var current_url = new URL(location.href)
    current_url.searchParams.set('v', String(LS.getItem('bus_version')))
    location.replace(current_url.toString())
  }

  function checkVersion() {
    if (getOption('options_automatic_refresh')) {
      var version_identification_feed_url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTFLTdqR4_v6EtiuDBtVqsvErHwfhJ0oVd9jSZn-3ByKTzkM31DXZiTYG2Jw5RK8HBu5T5_PGoPyk8I/pub?gid=0&single=true&output=csv'
      $.ajax({
        type: 'GET', url: version_identification_feed_url + '&_=' + api_url_parameter(5000), async: true, cache: true, xhrFields: { responseType: 'text' }, success: function (data) {
          data = data.trim()
          if (LS.hasOwnProperty('bus_version')) {
            if (!(String(LS.getItem('bus_version')) === data)) {
              refreshPage()
            }
          }
          LS.setItem('bus_version', data)
        }
      });
    }
  }
  function formatDataSize(sizeInKB) {
    const units = ["KB", "MB", "GB", "TB"];
    let formattedSize = sizeInKB;
    let unitIndex = 0;

    while (formattedSize > 1024 && unitIndex < units.length - 1) {
      formattedSize /= 1024;
      unitIndex++;
    }

    return `${formattedSize.toFixed(1)}${units[unitIndex]}`;
  }
  var network_stats_datas_json = {}
  function createNetworkStatsChart() {
    network_stats_datas_json = {}
    var original_datas = []
    var labels = []
    var values = []
    var keys = []

    var stats_datas = searchItemsbyname('bus_network_stats_')
    for (var o = 0; o < stats_datas.length; o++) {
      if (LS.hasOwnProperty(stats_datas[o])) {
        var data = parseFloat(String(LS.getItem(stats_datas[o])))
        var date = String(stats_datas[o]).replaceAll('bus_network_stats_', '').split('_')
        date = new Date(parseInt(date[0]), (parseInt(date[1]) - 1), parseInt(date[2]), 0, 0, 0)
        var j = { 'd': date, 'v': data, 'k': stats_datas[o] }
        original_datas.push(j)
        network_stats_datas_json[o] = j
      }
    }
    original_datas = original_datas.sort(function (a, b) {
      return a.d.getTime() - b.d.getTime()
    });

    for (var o = 0; o < original_datas.length; o++) {
      labels.push(`${(original_datas[o].d.getMonth() + 1)}/${(original_datas[o].d.getDate())}`)
      values.push(original_datas[o].v)
      keys.push(original_datas[o].k)
    }
    var manufactureBars = function (labels, values, max, min) {
      var html = []
      var identifies = []
      var ripple_selectors = []
      var data_length = labels.length // labels.length === values.length

      for (var f = 0; f < data_length; f++) {
        var bar_id = gid('chart-bar')
        var bar_html = `<div class="chart_bar" original-value="${values[f]}" id="${bar_id}" onclick="displaySpecificDayNetworkStats('${bar_id}','${keys[f]}')"><div class="block" style="--chart-bar-height:${values[f] / (max)};"></div><div class="label">${labels[f]}</div></div>`
        html.push(bar_html)
        identifies.push('#' + bar_id)
        ripple_selectors.push('#' + bar_id + ' .block')
      }
      return [html.join(''), ripple_selectors]
    }
    if (!(document.querySelector('.chart .chart_contents') === null)) {
      document.querySelector('.chart_contents').remove()
    }
    var chart_contents_html = manufactureBars(labels, values, Math.max(...values))
    var chart_contents = document.createElement('div')
    chart_contents.classList.add('chart_contents')
    chart_contents.style.setProperty('--chart-datas-length', chart_contents_html[1].length)
    chart_contents.innerHTML = chart_contents_html[0]
    document.querySelector('.chart').appendChild(chart_contents)
    var ripple_selectors = chart_contents_html[1]
    ripple(document.querySelectorAll(ripple_selectors.join(',')), 'var(--g-14b1ff)', 450)
  }
  function displaySpecificDayNetworkStats(element_id, data_key) {
    var element = $('#' + element_id)
    var select = String(element.attr('select'))
    var allBars = $('.chart .chart_contents .chart_bar')
    var chart_contents = $('.chart_contents')
    allBars.attr('select', '0')
    if (select === '1') {
      element.attr('select', '0')
      chart_contents.attr('select', '0')
    }
    else {
      element.attr('select', '1')
      chart_contents.attr('select', '1')
    }
  }
  /* initialize */

  initializeAllOptions()
  initializeKeyboard()
  $('.bus_info_box').scroll(function () {
    var scrolltop = $('.bus_info_box').scrollTop()
    if ($('.bus_info').offset().top < 0) {
      if (businfo_scroll_1 === 0) {
        $('.bus_info_title').attr('sticky', '1')
        standaloneStatusBarColor(0)
        businfo_scroll_1 = 1
      }
    }
    else {
      if (businfo_scroll_1 === 1) {
        $('.bus_info_title').attr('sticky', '0')
        standaloneStatusBarColor(1)
        businfo_scroll_1 = 0
      }
    }
    if (scrolltop < 5) {
      if (businfo_scroll === 0) {
        closeBus()
        businfo_scroll = 1
      }
    }
  })
  $('.bus_info_box').click(function (e) {
    e.stopPropagation()
    if (businfo_scroll === 0) {
      closeBus()
      businfo_scroll = 1
    }
  });
  $('.bus_info').click(function (e) {
    e.stopPropagation()
  })
  $('.route_info_box').scroll(function () {
    var scrolltop = $('.route_info_box').scrollTop()

    if ($('.route_info').offset().top < 0) {
      if (routeinfo_scroll_1 === 0) {
        $('.route_info_title').attr('sticky', '1')
        standaloneStatusBarColor(0)
        routeinfo_scroll_1 = 1
      }
    }
    else {
      if (routeinfo_scroll_1 === 1) {
        $('.route_info_title').attr('sticky', '0')
        standaloneStatusBarColor(1)
        routeinfo_scroll_1 = 0
      }
    }
    if (scrolltop < 5) {
      if (routeinfo_scroll === 0) {
        closeRouteInfo()
        routeinfo_scroll = 1
      }
    }
  });
  $('.route_info_box').click(function (e) {
    e.stopPropagation()
    if (routeinfo_scroll === 0) {
      closeRouteInfo()
      routeinfo_scroll = 1
    }
  });

  $('.route_info').click(function (e) {
    e.stopPropagation()
  })

  $('#search_routes').click(function (e) {
    e.stopPropagation()
    if (!($('.search').attr('p') === '1')) {
      var n = new Date().getTime()
      opensearch()
    }
  });


  $(window).resize(function () {
    setRouteSlideSize()
  })

  document.querySelector('#search_routes').addEventListener("paste", function (e) {
    if (search_page_is_open === 1) {
      update_search_result()
    }
  });
  document.querySelector('#search_routes').addEventListener("cut", function (e) {
    if (search_page_is_open === 1) {
      update_search_result()
    }
  });
  document.querySelector('#search_routes').addEventListener("selectionchange", function (e) {
    if (search_page_is_open === 1) {
      update_search_result()
    }
  });
  document.addEventListener("selectionchange", function (e) {
    if (search_page_is_open === 1) {
      update_search_result()
    }
  });
  document.querySelector('#search_routes').addEventListener("keyup", function (e) {
    if (search_page_is_open === 1) {
      update_search_result()
    }
  });
  setRouteSlideSize()
  getRoutes(false)
  document.querySelector('.routes').addEventListener('touchstart', function (e) {
    if (route_page_is_open === 1) {
      horizontal_slide = false
      vertical_slide = false
      route_x1 = checkSlideCoordinate(route_min_X, e.pageX + de.scrollLeft, route_max_X)
      route_y1 = checkSlideCoordinate(route_min_Y, e.pageY + de.scrollTop, route_max_Y)
      start_offsetX = offsetX
      route_tab_color_333333_r = parseInt(getComputedStyle(de).getPropertyValue('--g-333333-r'))
      route_tab_color_333333_g = parseInt(getComputedStyle(de).getPropertyValue('--g-333333-g'))
      route_tab_color_333333_b = parseInt(getComputedStyle(de).getPropertyValue('--g-333333-b'))
      route_tab_color_888888_r = parseInt(getComputedStyle(de).getPropertyValue('--g-888888-r'))
      route_tab_color_888888_g = parseInt(getComputedStyle(de).getPropertyValue('--g-888888-g'))
      route_tab_color_888888_b = parseInt(getComputedStyle(de).getPropertyValue('--g-888888-b'))
      document.querySelector('.routes').addEventListener('touchmove', touchMove, { passive: false });
    }
  }, { passive: false });

  document.querySelector('.routes').addEventListener('touchend', function (e) {
    if (route_page_is_open === 1) {
      if (horizontal_slide && !vertical_slide) {
        var w = calcSlideScale()
        var d = (1 - Math.abs(calcSlideScale())) * (route_max_X - route_min_X)
        var q = ((1 + calcSlideScale()) / 2)
        var direction = route_direction
        if (w < -0.35 || w > 0.35) {
          if (w < -0.35) {
            w = -1
            offsetX = (route_max_X - route_min_X) * (-1)
            direction = 'destination'
          }
          if (w > 0.35) {
            w = 0
            offsetX = (route_max_X - route_min_X) * (0)
            direction = 'departure'
          }
          $('.routes').css({ '--j-translateX-p': `${((route_max_X - route_min_X) * w)}px)` });
        }
        else {
          $('.routes').css({ '--j-translateX-p': `${start_offsetX}px)` });
        }
        $('.routes,.tab-line-box2,.tabs').attr('slide', '0').css({ '--j-transition-p': `transform ${d / animation_speed}ms`, '--j-transition-w-p': `width ${d / animation_speed}ms`, '--j-transition-a-p': `all ${d / animation_speed}ms` });
        switchDirection(direction, e)
        horizontal_slide = false
        vertical_slide = false
      }
      document.querySelector('.routes').addEventListener('touchmove', touchMove)
    }
  }, { passive: false });

  ripple(document.querySelectorAll('.tabs .tab,.back_btn,.search_back_btn,.route_container .title .info_btn,.options_btn'), 'var(--g-333333)', 450)
  ripple(document.querySelectorAll('.options_content label.options_switch'), 'var(--g-14b1ff)', 450)

  ifvisible.idle(function () {
    update_status = 3
  });

  ifvisible.wakeup(function () {
    update_status = 0
    updateRealtimeJson(true)
  });
  checkVersion()

  function rgb2hex(a, r, t) {
    var c2h = function (a) {
      var r = a.toString(16);
      return 1 == r.length ? "0" + r : r;
    }
    return "#" + c2h(a) + c2h(r) + c2h(t);
  }

  function hex2rgb(a) {
    var r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
    return r
      ? { r: parseInt(r[1], 16), g: parseInt(r[2], 16), b: parseInt(r[3], 16) }
      : null;
  }

  function rgb2hsv(a, r, t) {
    let o, h, n, M, e, s, u, m, d, f, l, c;
    return (
      (o = a / 255),
      (h = r / 255),
      (n = t / 255),
      (d = Math.max(o, h, n)),
      (l = (a) => (d - a) / 6 / f + 0.5),
      (c = (a) => Math.round(100 * a) / 100),
      0 == (f = d - Math.min(o, h, n))
        ? (u = m = 0)
        : ((m = f / d),
          (M = l(o)),
          (e = l(h)),
          (s = l(n)),
          o === d
            ? (u = s - e)
            : h === d
              ? (u = 1 / 3 + M - s)
              : n === d && (u = 2 / 3 + e - M),
          u < 0 ? (u += 1) : u > 1 && (u -= 1)),
      {
        h: Math.round(360 * u),
        s: c(100 * m),
        v: c(100 * d)
      }
    );
  }

  function hsv2rgb(a, r, t) {
    var o, h, n, M, e, s, u, m;
    if (
      ((a = Math.max(0, Math.min(360, a))),
        (r = Math.max(0, Math.min(100, r))),
        (t = Math.max(0, Math.min(100, t))),
        (t /= 100),
        0 == (r /= 100))
    )
      return (
        (o = h = n = t),
        [Math.round(255 * o), Math.round(255 * h), Math.round(255 * n)]
      );
    switch (
    ((s = t * (1 - r)),
      (u = t * (1 - r * (e = (a /= 60) - (M = fl(a))))),
      (m = t * (1 - r * (1 - e))),
      M)
    ) {
      case 0:
        (o = t), (h = m), (n = s);
        break;
      case 1:
        (o = u), (h = t), (n = s);
        break;
      case 2:
        (o = s), (h = t), (n = m);
        break;
      case 3:
        (o = s), (h = u), (n = t);
        break;
      case 4:
        (o = m), (h = s), (n = t);
        break;
      default:
        (o = t), (h = s), (n = u);
    }
    return [Math.round(255 * o), Math.round(255 * h), Math.round(255 * n)];
  }
  function fl(n) {
    return Math.floor(n)
  }
  function rd() {
    return Math.random()
  }
  function similarColor(hex, similarity) {
    var source_color_rgb = hex2rgb(hex)
    var source_color_hsv = rgb2hsv(source_color_rgb.r, source_color_rgb.g, source_color_rgb.b)
    var color_a_h, color_a_s, color_a_v = 0
    var color_b_h, color_b_s, color_b_v = 0
    if (source_color_hsv.h < similarity) {
      color_a_h = source_color_hsv.h + fl(rd() * similarity)
      color_b_h = source_color_hsv.h + fl(rd() * similarity)
    }
    if (source_color_hsv.h > similarity && source_color_hsv.h < (360 - similarity)) {
      color_a_h = source_color_hsv.h + fl((0 - similarity) + rd() * (similarity * 2))
      color_b_h = source_color_hsv.h + fl((0 - similarity) + rd() * (similarity * 2))
    }
    if (source_color_hsv.h > (360 - similarity)) {
      color_a_h = source_color_hsv.h - fl(rd() * similarity)
      color_b_h = source_color_hsv.h - fl(rd() * similarity)
    }
    if (source_color_hsv.s < similarity) {
      color_a_s = source_color_hsv.s + fl(rd() * similarity)
      color_b_s = source_color_hsv.s + fl(rd() * similarity)
    }
    if (source_color_hsv.s > similarity && source_color_hsv.s < (100 - similarity)) {
      color_a_s = source_color_hsv.s + fl((0 - similarity) + rd() * (similarity * 2))
      color_b_s = source_color_hsv.s + fl((0 - similarity) + rd() * (similarity * 2))
    }
    if (source_color_hsv.s > (100 - similarity)) {
      color_a_s = source_color_hsv.s - fl(rd() * similarity)
      color_b_s = source_color_hsv.s - fl(rd() * similarity)
    }

    if (source_color_hsv.v < similarity) {
      color_a_v = source_color_hsv.v + fl(rd() * similarity)
      color_b_v = source_color_hsv.v + fl(rd() * similarity)
    }
    if (source_color_hsv.v > similarity && source_color_hsv.v < (100 - similarity)) {
      color_a_v = source_color_hsv.v + fl((0 - similarity) + rd() * (similarity * 2))
      color_b_v = source_color_hsv.v + fl((0 - similarity) + rd() * (similarity * 2))
    }
    if (source_color_hsv.v > (100 - similarity)) {
      color_a_v = source_color_hsv.v - fl(rd() * similarity)
      color_b_v = source_color_hsv.v - fl(rd() * similarity)
    }
    var color_a_rgb = hsv2rgb(color_a_h, color_a_s, color_a_v)
    var color_b_rgb = hsv2rgb(color_b_h, color_b_s, color_b_v)

    var color_a_hex = rgb2hex(color_a_rgb[0], color_a_rgb[1], color_a_rgb[2])
    var color_b_hex = rgb2hex(color_b_rgb[0], color_b_rgb[1], color_b_rgb[2])
    return [color_a_hex, color_b_hex]
  }

  function colorScale(hex, amount, similarity) {
    var amount_n = amount
    if (amount <= 0) {
      amount_n = 2
    }
    if (!(amount % 2 === 0)) {
      amount_n = amount + 1
    }
    var l = amount_n / 2
    var list = []
    for (var i = 0; i < l; i++) {
      var source_color
      if (i === 0) {
        source_color = hex
      }
      else {
        source_color = list[fl((list.length - 1) * rd())]
      }
      list = list.concat(similarColor(source_color, similarity))
    }
    if (amount_n - amount > 0) {
      list = list.slice(0, amount)
    }
    list = list.sort(function (a, b) {
      var a_rgb = hex2rgb(a)
      var b_rgb = hex2rgb(b)
      var a_hsv = rgb2hsv(a_rgb.r, a_rgb.g, a_rgb.b)
      var b_hsv = rgb2hsv(b_rgb.r, b_rgb.g, b_rgb.b)

      return a_hsv.h - b_hsv.h
    })
    return list
  }

  function textcol(r, g, b) {
    var textcolrgbfy = (r * 0.299 + g * 0.587 + b * 0.114)
    if (textcolrgbfy > 186) {
      return "#000000";
    } else {
      return "#ffffff";
    }
  }

  function setUpDynamicColor() {
    var colorC = []
    var c = colorScale('#14b1ff', 10, 15)
    for (var o = 0; o < c.length; o++) {
      colorC.push(`${c[o]} ${100 * (o / (c.length - 1))}%`)
    }
    var bg = `linear-gradient(${45}deg, ${colorC.join(',')})`
    var css = `:root {--dynamic-color-s1:${bg};}`
    document.querySelector('#dynamic-color').innerHTML = css
  }
</script>

</html>