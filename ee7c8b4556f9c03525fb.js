"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[794],{540:(e,t,n)=>{n.d(t,{F:()=>$,a:()=>J});var i=n(5767),a=n(9566),r=n(3459),s=n(8024),o=n(3648),c=n(4537),u=n(904),d=n(9119),l=n(4690);function f(e,t,n,i,a,r,s){try{var o=e[r](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){f(r,i,a,s,o,"next",e)}function o(e){f(r,i,a,s,o,"throw",e)}s(void 0)}))}}var h=(0,o.bv)(".yf"),p=(0,o.aI)(h,".cg"),m=(0,o.aI)(h,".lg"),g=(0,o.aI)(m,".yg"),b=(0,o.aI)(p,".hg .ig"),y={},w=!1,k=!0,I=15e3,x=5e3,M=15e3,T=!0,L=0,_=0,P="",A=!1,j=!1,z=!1;function Z(){var e=document.createElement("div");return e.classList.add("dh"),e.setAttribute("type","stop"),e.innerHTML=`<div class="eh"></div><div class="fh"></div><div class="gh"></div><div class="hh"><div class="kh"><div class="ja" code="0" displayed="false"></div><div class="ka" code="0" displayed="true"></div></div><div class="ih">${(0,c.Z)("keyboard_arrow_right")}</div><div class="jh"></div></div>`,{element:e,id:""}}function D(e){var t=e;if(A){var n=t.detail.progress-1;b.style.setProperty("--ag",n.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,D)}function $(){for(var e=(0,r.Js)("playing_animation"),t=(0,u.gO)("window"),n=(t.width,t.height),i=Math.floor(n/50/3)+2,a=[],s=0;s<3;s++){for(var o={name:"",icon:"",id:"",timestamp:0,content:[],contentLength:i},c=0;c<i;c++){o.content.push({type:"stop",id:0,timestamp:0,name:"",status:{code:8,text:"",time:-6},direction:0,route:{name:"",endPoints:{departure:"",destination:""},id:0,pathAttributeId:[]}})}a.push(o)}C({folders:a,dataUpdateTime:0},!0,e)}function C(e,t,n){function i(e,i,a){function r(e,t){e.setAttribute("type",t.type)}function u(e,t){var n=(0,o.aI)(e,".eh"),i="";switch(t.type){case"stop":i="location_on";break;case"route":i="route";break;case"bus":i="directions_bus";break;case"empty":i="lightbulb";break;default:i=""}n.innerHTML=(0,c.Z)(i)}function d(e,t,n){if("stop"===t.type){var i=e.getBoundingClientRect(),a=i.top,r=i.left,s=i.bottom,c=i.right,u=window.innerWidth,d=window.innerHeight,l=(0,o.aI)(e,".hh .kh"),f=(0,o.aI)(l,".ja"),v=(0,o.aI)(l,".ka");f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,n&&s>0&&a<d&&c>0&&r<u?(v.addEventListener("animationend",(function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("ab"),f.setAttribute("displayed","false")}),{once:!0}),f.setAttribute("displayed","true"),v.classList.add("ab")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}}function f(e,t){var n="";switch(t.type){case"stop":case"route":n=t.name;break;case"bus":n=t.busID;break;case"empty":n="沒有內容";break;default:n="null"}(0,o.aI)(e,".gh").innerText=n}function v(e,t){var n="";switch(t.type){case"stop":n=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`;break;case"route":n=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`;break;case"bus":break;case"empty":n="提示";break;default:n="null"}(0,o.aI)(e,".fh").innerText=n}function h(e,t){var n=(0,o.aI)(e,".hh .ih");switch(t.type){case"stop":n.onclick=function(){(0,l.SR)(t.route.id,t.route.pathAttributeId)};break;case"route":n.onclick=function(){(0,l.SR)(t.id,t.pathAttributeId)}}}function p(e,t){e.setAttribute("animation",(0,s.xZ)(t))}function m(e,t){e.setAttribute("skeleton-screen",(0,s.xZ)(t))}if(null===a)r(e,i),u(e,i),d(e,i,n),f(e,i),v(e,i),h(e,i),p(e,n),m(e,t);else if(i.type!==a.type)r(e,i),u(e,i),d(e,i,n),f(e,i),v(e,i),h(e,i),p(e,n),m(e,t);else{switch(i.type){case"stop":(0,s.hw)(a.route,i.route)||(v(e,i),h(e,i)),(0,s.hw)(a.name,i.name)||f(e,i),i.status.code===a.status.code&&(0,s.hw)(a.status.text,i.status.text)||d(e,i,n);break;case"route":(0,s.hw)(a.id,i.id)||h(e,i),(0,s.hw)(a.endPoints,i.endPoints)||v(e,i),(0,s.hw)(a.name,i.name)||f(e,i);break;case"bus":(0,s.hw)(a.currentRoute,i.currentRoute)||v(e,i),(0,s.hw)(a.busID,i.busID)||f(e,i);break;case"empty":i.type!==a.type&&(v(e,i),f(e,i))}t!==w&&m(e,t),n!==k&&p(e,n)}}function a(e,i,a){function r(e,t){var n=(0,o.aI)(e,"._g");(0,o.aI)(n,".bh").innerText=t.name}function u(e,t){var n=(0,o.aI)(e,"._g");(0,o.aI)(n,".ah").innerHTML=(0,c.Z)(t.icon)}function d(e,t){e.setAttribute("animation",(0,s.xZ)(t))}function l(e,t){e.setAttribute("skeleton-screen",(0,s.xZ)(t))}null===a?(r(e,i),u(e,i),d(e,n),l(e,t)):(i.name!==a.name&&r(e,i),i.icon!==a.icon&&u(e,i),n!==k&&d(e,n),t!==w&&l(e,t))}var r,u=e.folders,d=u.length,f=(0,o.jg)(g,".zg").length;if(d!==f){var v=f-d;if(v<0){for(var h=new DocumentFragment,p=0;p<Math.abs(v);p++){var m=(r=void 0,(r=document.createElement("div")).classList.add("zg"),r.innerHTML='<div class="_g"><div class="ah"></div><div class="bh"></div></div><div class="ch"></div>',{element:r,id:""});h.appendChild(m.element)}g.append(h)}else for(var b=(0,o.jg)(g,".zg"),I=0;I<Math.abs(v);I++){b[f-1-I].remove()}}for(var x=(0,o.jg)(g,".zg"),M=0;M<d;M++){var T=u[M].content.length,L=x[M],_=(0,o.aI)(L,".ch"),P=(0,o.jg)(_,".dh").length;if(T!==P){var A=P-T;if(A<0)for(var j=0;j<Math.abs(A);j++){var z=Z();_.appendChild(z.element)}else for(var D=(0,o.jg)(_,".dh"),$=0;$<Math.abs(A);$++){D[P-1-$].remove()}}}for(var C=(0,o.jg)(g,".zg"),E=0;E<d;E++){var H=u[E],R=H.content,S=R.length,J=C[E],O=(0,o.aI)(J,".ch");if(y.hasOwnProperty("folders"))if(y.folders[E])a(J,H,y.folders[E]);else a(J,H,null);else a(J,H,null);for(var Q=(0,o.jg)(O,".dh"),U=0;U<S;U++){var F=Q[U],B=R[U];if(y.hasOwnProperty("folders"))if(y.folders[E])if(y.folders[E].content[U])i(F,B,y.folders[E].content[U]);else i(F,B,null);else i(F,B,null);else i(F,B,null)}}y=e,k=n,w=t}function E(){return H.apply(this,arguments)}function H(){return(H=v((function*(){var e=(0,r.Js)("playing_animation"),t=(0,r.Js)("refresh_interval");T=t.dynamic,I=t.baseInterval,A=!0,P=(0,s.zx)(),b.setAttribute("refreshing","true"),b.classList.remove("kg"),document.addEventListener(P,D);var n=yield(0,a.R_)(P);C(n,!1,e);var o=0;T&&(o=yield(0,i.wz)()),L=(new Date).getTime(),_=T?Math.max(L+x,n.dataUpdateTime+I/o):L+I,M=Math.max(x,_-L),A=!1,b.setAttribute("refreshing","false"),b.style.setProperty("--bg",`${M}ms`),b.classList.add("kg")}))).apply(this,arguments)}function R(){return S.apply(this,arguments)}function S(){return(S=v((function*(){E().then((function(){j?setTimeout((function(){R()}),Math.max(x,_-(new Date).getTime())):z=!1})).catch((function(e){j?((0,d.a)("資料夾網路連線中斷，將在10秒後重試。","error"),setTimeout((function(){R()}),1e4)):z=!1}))}))).apply(this,arguments)}function J(){$(),j||(j=!0,z?E():(z=!0,R()))}},4537:(e,t,n)=>{function i(e){return`<span class="ie">${e}</span>`}n.d(t,{Z:()=>i})},6082:(e,t,n)=>{n.d(t,{X:()=>g,m:()=>l});var i=n(9734),a=n(8011),r=n(9930),s=n(4293),o=n(6788),c=n(3648);function u(e,t,n,i,a,r,s){try{var o=e[r](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,a)}var d="downloadData",l=!1,f=(0,c.bv)(".yf"),v=(0,c.aI)(f,".cg"),h=(0,c.aI)(v,".fg"),p=(0,c.aI)(h,'svg#download-svg path[progress="progress"]');function m(e){var t=e,n=189*(1-(0,o._M)(d));p.style.setProperty("--zf",`${n}px`),"end"===t.detail.stage&&(document.removeEventListener(t.detail.target,m),p.addEventListener("transitionend",(function(){h.setAttribute("complete","true")}),{once:!0}),p.style.setProperty("--zf","0px"),l=!0)}function g(){return b.apply(this,arguments)}function b(){var e;return e=function*(){(0,o.Mf)(d,"getLocation_0",0,!1),(0,o.Mf)(d,"getLocation_1",0,!1),(0,o.Mf)(d,"getCarInfo_0",0,!1),(0,o.Mf)(d,"getCarInfo_1",0,!1),(0,o.Mf)(d,"getMaterialSymbols",0,!1),document.addEventListener(d,m),yield(0,s.a)(d,!0),yield(0,a.g)(d,1),yield(0,i.j)(d,!0),yield(0,r.z)(d),(0,o.LQ)(d),(0,o.gC)(d)},b=function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){u(r,i,a,s,o,"next",e)}function o(e){u(r,i,a,s,o,"throw",e)}s(void 0)}))},b.apply(this,arguments)}},6091:(e,t,n)=>{n.d(t,{Q:()=>A,u:()=>$});var i=n(5767),a=n(5314),r=n(3459),s=n(8024),o=n(3648),c=n(4927),u=n(4537),d=n(904);function l(e,t,n,i,a,r,s){try{var o=e[r](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){l(r,i,a,s,o,"next",e)}function o(e){l(r,i,a,s,o,"throw",e)}s(void 0)}))}}var v=(0,o.bv)(".yf"),h=(0,o.aI)(v,".lg"),p=(0,o.aI)(h,".mg"),m=(0,o.aI)(p,".rg"),g={},b=!0,y=!1,w=15e3,k=5e3,I=!0,x=!1,M=0,T=0,L="",_=!1;function P(e,t,n){function i(e,i,a){function r(e,t){var n=(0,o.aI)(e,".tg .ug"),i="";switch(t.type){case"route":i="route";break;case"location":i="location_on";break;case"bus":i="directions_bus";break;case"empty":i="lightbulb"}n.innerHTML=(0,u.Z)(i)}function d(e,t){var n=(0,o.aI)(e,".tg .vg"),i="";switch(t.type){case"route":i="路線";break;case"location":i="地點";break;case"bus":i="公車";break;case"empty":i="提示"}n.innerText=i}function l(e,t){(0,o.aI)(e,".tg .wg").innerText=t.time.relative}function f(e,t){(0,o.aI)(e,".xg").innerText=t.name}function v(e,t){switch(t.type){case"route":e.onclick=function(){openRoute(t.id,t.pid)};break;case"location":e.onclick=function(){openLocation(t.hash)};break;case"bus":e.onclick=function(){(0,c.$)(t.id)};break;case"empty":e.onclick=null}}function h(e,t){e.setAttribute("animation",(0,s.xZ)(t))}function p(e,t){e.setAttribute("skeleton-screen",(0,s.xZ)(t))}if(null===a)r(e,i),d(e,i),l(e,i),f(e,i),v(e,i),h(e,n),p(e,t);else if(i.type!==a.type)r(e,i),d(e,i),l(e,i),f(e,i),v(e,i),h(e,n),p(e,t);else{switch(i.type){case"location":(0,s.hw)(a.name,i.name)||f(e,i),a.time!==i.time&&l(e,i),(0,s.hw)(a.hash,i.hash)||v(e,i);break;case"route":(0,s.hw)(a.name,i.name)||f(e,i),a.time!==i.time&&l(e,i),(0,s.hw)(a.id,i.id)&&(0,s.hw)(a.pid,i.pid)||v(e,i);break;case"bus":(0,s.hw)(a.name,i.name)||f(e,i),a.time!==i.time&&l(e,i),(0,s.hw)(a.id,i.id)||v(e,i);break;case"empty":a.time!==i.time&&l(e,i)}n!==b&&h(e,n),t!==y&&p(e,t)}}var a,r=e.itemQuantity,d=(0,o.jg)(m,".sg").length;if(r!==d){var l=d-r;if(l<0){for(var f=new DocumentFragment,v=0;v<Math.abs(l);v++){var h=(a=void 0,(a=document.createElement("div")).classList.add("sg"),a.innerHTML='<div class="tg"><div class="ug"></div><div class="vg"></div><div class="wg"></div></div><div class="xg"></div>',{element:a,id:""});f.appendChild(h.element)}m.append(f)}else for(var p=(0,o.jg)(m,".sg"),w=0;w<Math.abs(l);w++){p[d-1-w].remove()}}for(var k=(0,o.jg)(m,".sg"),I=0;I<r;I++){var x=k[I],M=e.items[I];if(g.hasOwnProperty("items"))if(g.items[I])i(x,M,g.items[I]);else i(x,M,null);else i(x,M,null)}g=e,b=n,y=t}function A(){for(var e=(0,r.Js)("playing_animation"),t=(0,d.gO)("window"),n=Math.floor(t.height/70/3)+2,i=[],a=0;a<n;a++)i.push({type:"route",id:0,pid:[],time:{absolute:0,relative:""},name:""});P({items:i,itemQuantity:i.length,dataUpdateTime:0},!0,e)}function j(){return z.apply(this,arguments)}function z(){return(z=f((function*(){var e=(0,r.Js)("playing_animation"),t=(0,r.Js)("refresh_interval");I=t.dynamic,w=t.baseInterval,L=(0,s.zx)();var n=yield(0,a.$i)(L);P(n,!1,e);var o=0;I&&(o=yield(0,i.wz)()),M=(new Date).getTime(),T=I?Math.max(M+k,n.dataUpdateTime+w/o):M+w,Math.max(k,T-M)}))).apply(this,arguments)}function Z(){return D.apply(this,arguments)}function D(){return(D=f((function*(){j().then((function(){x?setTimeout((function(){Z()}),Math.max(k,T-(new Date).getTime())):_=!1})).catch((function(e){x?setTimeout((function(){Z()}),1e4):_=!1}))}))).apply(this,arguments)}function $(){A(),x||(x=!0,_?j():(_=!0,Z()))}}}]);
//# sourceMappingURL=ee7c8b4556f9c03525fb.js.map