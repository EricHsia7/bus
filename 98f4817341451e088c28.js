"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[794],{540:(e,t,n)=>{n.d(t,{F:()=>z,a:()=>O});var i=n(9566),a=n(904),r=n(4537),o=n(3459),s=n(5767),u=n(3648),c=n(8024),d=n(6788),l=n(9119);function v(e,t,n,i,a,r,o){try{var s=e[r](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){v(r,i,a,o,s,"next",e)}function s(e){v(r,i,a,o,s,"throw",e)}o(void 0)}))}}var h=(0,u.bv)(".bd"),p=(0,u.aI)(h,".ag"),m=(0,u.aI)(h,".cd"),g=(0,u.aI)(m,".ed"),b=(0,u.aI)(p,".hg .ig"),y={},w=!1,k=!0,x=15e3,I=5e3,M=15e3,T=!0,A=!1,L=0,_=0,P=!1,j="",$=-1,Z=!1;function D(){var e=document.createElement("div");return e.classList.add("qg"),e.setAttribute("type","stop"),e.innerHTML=`<div class="rg"></div><div class="sg"></div><div class="tg"></div><div class="ug"><div class="xg"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="vg">${(0,r.Z)("keyboard_arrow_right")}</div><div class="wg"></div></div>`,{element:e,id:""}}function C(){var e=(new Date).getTime();$=-1*Math.min(1,Math.max(0,Math.abs(e-L)/M)),b.style.setProperty("--z",$.toString()),window.requestAnimationFrame((function(){A&&!P&&C()}))}function E(e){var t=e;P&&($=-1+(0,d._M)(j),b.style.setProperty("--z",$.toString())),"end"===t.detail.stage&&document.removeEventListener(t.detail.target,E),console.log(t.detail)}function z(){for(var e=(0,o.Js)("playing_animation"),t=(0,a.gO)("window"),n=(t.width,t.height),i=Math.floor(n/50/3)+2,r=[],s=0;s<3;s++){for(var u={name:"",icon:"",id:"",timestamp:0,content:[],contentLength:i},c=0;c<i;c++){u.content.push({type:"stop",id:0,timestamp:0,name:"",status:{code:8,text:"",time:-6},direction:0,route:{name:"",endPoints:{departure:"",destination:""},id:0,pathAttributeId:[]}})}r.push(u)}H({folders:r,dataUpdateTime:0},!0,e)}function H(e,t,n){function i(e,i,a){function o(e,t){e.setAttribute("type",t.type)}function s(e,t){var n=(0,u.aI)(e,".rg"),i="";switch(t.type){case"stop":i="location_on";break;case"route":i="route";break;case"bus":i="directions_bus";break;case"empty":i="lightbulb";break;default:i=""}n.innerHTML=(0,r.Z)(i)}function d(e,t,n){if("stop"===t.type){var i=e.getBoundingClientRect(),a=i.top,r=i.left,o=i.bottom,s=i.right,c=window.innerWidth,d=window.innerHeight,l=(0,u.aI)(e,".ug .xg"),v=(0,u.aI)(l,".ia"),f=(0,u.aI)(l,".ja");v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,n&&o>0&&a<d&&s>0&&r<c?(f.addEventListener("animationend",(function(){f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,f.classList.remove("_a")}),{once:!0}),f.classList.add("_a")):(f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text)}}function l(e,t){var n="";switch(t.type){case"stop":case"route":n=t.name;break;case"bus":n=t.busID;break;case"empty":n="沒有內容";break;default:n="null"}(0,u.aI)(e,".tg").innerText=n}function v(e,t){var n="";switch(t.type){case"stop":n=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`;break;case"route":n=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`;break;case"bus":break;case"empty":n="提示";break;default:n="null"}(0,u.aI)(e,".sg").innerText=n}function f(e,t){var n=(0,u.aI)(e,".ug .vg"),i="";switch(t.type){case"stop":i=`bus.route.openRoute(${t.route.id}, [${t.route.pathAttributeId.join(",")}])`;break;case"route":i=`bus.route.openRoute(${t.id}, [${t.pathAttributeId.join(",")}])`}n.setAttribute("onclick",i)}function h(e,t){e.setAttribute("animation",(0,c.xZ)(t))}function p(e,t){e.setAttribute("skeleton-screen",(0,c.xZ)(t))}if(null===a)o(e,i),s(e,i),d(e,i,n),l(e,i),v(e,i),f(e,i),h(e,n),p(e,t);else if(i.type!==a.type)o(e,i),s(e,i),d(e,i,n),l(e,i),v(e,i),f(e,i),h(e,n),p(e,t);else{switch(i.type){case"stop":(0,c.hw)(a.route,i.route)||(v(e,i),f(e,i)),(0,c.hw)(a.name,i.name)||l(e,i),i.status.code===a.status.code&&(0,c.hw)(a.status.text,i.status.text)||d(e,i,n);break;case"route":(0,c.hw)(a.id,i.id)||f(e,i),(0,c.hw)(a.endPoints,i.endPoints)||v(e,i),(0,c.hw)(a.name,i.name)||l(e,i);break;case"bus":(0,c.hw)(a.currentRoute,i.currentRoute)||v(e,i),(0,c.hw)(a.busID,i.busID)||l(e,i);break;case"empty":i.type!==a.type&&(v(e,i),l(e,i))}t!==w&&p(e,t),n!==k&&h(e,n)}}function a(e,i,a){function o(e,t){var n=(0,u.aI)(e,".lg");(0,u.aI)(n,".og").innerText=t.name}function s(e,t){var n=(0,u.aI)(e,".lg");(0,u.aI)(n,".mg").innerHTML=(0,r.Z)(t.icon)}function d(e,t){e.setAttribute("animation",(0,c.xZ)(t))}function l(e,t){e.setAttribute("skeleton-screen",(0,c.xZ)(t))}null===a?(o(e,i),s(e,i),d(e,n),l(e,t)):(i.name!==a.name&&o(e,i),i.icon!==a.icon&&s(e,i),n!==k&&d(e,n),t!==w&&l(e,t))}var o,s=e.folders,d=s.length,l=(0,u.jg)(g,".kg").length;if(d!==l){var v=l-d;if(v<0){for(var f=new DocumentFragment,h=0;h<Math.abs(v);h++){var p=(o=void 0,(o=document.createElement("div")).classList.add("kg"),o.innerHTML='<div class="lg"><div class="mg"></div><div class="og"></div></div><div class="pg"></div>',{element:o,id:""});f.appendChild(p.element)}g.append(f)}else for(var m=(0,u.jg)(g,".kg"),b=0;b<Math.abs(v);b++){m[l-1-b].remove()}}for(var x=(0,u.jg)(g,".kg"),I=0;I<d;I++){var M=s[I].content.length,T=x[I],A=(0,u.aI)(T,".pg"),L=(0,u.jg)(A,".qg").length;if(M!==L){var _=L-M;if(_<0)for(var P=0;P<Math.abs(_);P++){var j=D();A.appendChild(j.element)}else for(var $=(0,u.jg)(A,".qg"),Z=0;Z<Math.abs(_);Z++){$[L-1-Z].remove()}}}for(var C=(0,u.jg)(g,".kg"),E=0;E<d;E++){var z=s[E],H=z.content,R=H.length,q=C[E],J=(0,u.aI)(q,".pg");if(y.hasOwnProperty("folders"))if(y.folders[E])a(q,z,y.folders[E]);else a(q,z,null);else a(q,z,null);for(var S=(0,u.jg)(J,".qg"),O=0;O<R;O++){var F=S[O],Q=H[O];if(y.hasOwnProperty("folders"))if(y.folders[E])if(y.folders[E].content[O])i(F,Q,y.folders[E].content[O]);else i(F,Q,null);else i(F,Q,null);else i(F,Q,null)}}y=e,k=n,w=t}function R(){return q.apply(this,arguments)}function q(){return(q=f((function*(){var e=(0,o.Js)("playing_animation"),t=(0,o.Js)("refresh_interval");T=t.dynamic,x=t.baseInterval,P=!0,j=(0,c.zx)("r"),b.setAttribute("refreshing","true"),document.addEventListener(j,E);var n=yield(0,i.R_)(j);H(n,!1,e);var a=0;T&&(a=yield(0,s.wz)()),L=(new Date).getTime(),_=T?Math.max(L+I,n.dataUpdateTime+x/a):L+x,M=Math.max(I,_-L),P=!1,b.setAttribute("refreshing","false"),C()}))).apply(this,arguments)}function J(){return S.apply(this,arguments)}function S(){return(S=f((function*(){R().then((function(){A?setTimeout((function(){J()}),Math.max(I,_-(new Date).getTime())):Z=!1})).catch((function(e){console.error(e),A?((0,l.a)("資料夾網路連線中斷，將在10秒後重試。","error"),setTimeout((function(){J()}),1e4)):Z=!1}))}))).apply(this,arguments)}function O(){z(),A||(A=!0,Z?R():(Z=!0,J()),$=-1,C())}},4537:(e,t,n)=>{function i(e){return`<span class="le">${e}</span>`}n.d(t,{Z:()=>i})},6082:(e,t,n)=>{n.d(t,{X:()=>p,m:()=>l});var i=n(4293),a=n(8011),r=n(6788),o=n(3648),s=n(9930),u=n(9734);function c(e,t,n,i,a,r,o){try{var s=e[r](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,a)}var d="downloadData",l=!1,v=(0,o.bv)('.dg svg#download-svg path[progress="progress"]');function f(){var e=189*(1-(0,r._M)(d));v.style.setProperty("--eg",`${e}px`),window.requestAnimationFrame((function(){!1===l&&f()}))}function h(){l&&(v.style.setProperty("--eg","0px"),(0,o.bv)(".dg").setAttribute("complete","true"),v.removeEventListener("transitioncancel",h))}function p(){return m.apply(this,arguments)}function m(){var e;return e=function*(){(0,r.Mf)(d,"getLocation_0",0,!1),(0,r.Mf)(d,"getLocation_1",0,!1),(0,r.Mf)(d,"getCarInfo_0",0,!1),(0,r.Mf)(d,"getCarInfo_1",0,!1),(0,r.Mf)(d,"getMaterialSymbols",0,!1),f(),v.addEventListener("transitioncancel",h),yield(0,i.a)(d,!0),yield(0,a.g)(d,1),yield(0,u.j)(d,!0),yield(0,s.z)(d),l=!0,h(),(0,r.LQ)(d),(0,r.gC)(d)},m=function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){c(r,i,a,o,s,"next",e)}function s(e){c(r,i,a,o,s,"throw",e)}o(void 0)}))},m.apply(this,arguments)}},6091:(e,t,n)=>{n.d(t,{Q:()=>L,u:()=>Z});var i=n(5767),a=n(5314),r=n(3459),o=n(8024),s=n(3648),u=n(4537),c=n(904);function d(e,t,n,i,a,r,o){try{var s=e[r](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){d(r,i,a,o,s,"next",e)}function s(e){d(r,i,a,o,s,"throw",e)}o(void 0)}))}}var v=(0,s.bv)(".bd"),f=(0,s.aI)(v,".cd"),h=(0,s.aI)(f,".dd"),p={},m=!0,g=!1,b=15e3,y=5e3,w=!0,k=!1,x=0,I=0,M="",T=!1;function A(e,t,n,i){function a(e,t,a){function r(e,t){var n=(0,s.aI)(e,".dh .eh"),i="";switch(t.type){case"route":i="route";break;case"location":i="location_on";break;case"bus":i="directions_bus";break;case"empty":i="lightbulb"}n.innerHTML=(0,u.Z)(i)}function c(e,t){var n=(0,s.aI)(e,".dh .fh"),i="";switch(t.type){case"route":i="路線";break;case"location":i="地點";break;case"bus":i="公車";break;case"empty":i="提示"}n.innerText=i}function d(e,t){(0,s.aI)(e,".dh .gh").innerText=t.time.relative}function l(e,t){(0,s.aI)(e,".hh").innerText=t.name}function v(e,t){var n="";switch(t.type){case"route":n=`bus.route.openRoute(${t.id}, [${t.pid.join(",")}])`;break;case"location":n=`bus.location.openLocation('${t.hash}')`;break;case"bus":n=`bus.bus.openBus(${t.id})`;break;case"empty":n=""}e.setAttribute("onclick",n)}function f(e,t){e.setAttribute("animation",(0,o.xZ)(t))}function h(e,t){e.setAttribute("skeleton-screen",(0,o.xZ)(t))}if(null===a)r(e,t),c(e,t),d(e,t),l(e,t),v(e,t),f(e,i),h(e,n);else if(t.type!==a.type)r(e,t),c(e,t),d(e,t),l(e,t),v(e,t),f(e,i),h(e,n);else{switch(t.type){case"location":(0,o.hw)(a.name,t.name)||l(e,t),a.time!==t.time&&d(e,t),(0,o.hw)(a.hash,t.hash)||v(e,t);break;case"route":(0,o.hw)(a.name,t.name)||l(e,t),a.time!==t.time&&d(e,t),(0,o.hw)(a.id,t.id)&&(0,o.hw)(a.pid,t.pid)||v(e,t);break;case"bus":(0,o.hw)(a.name,t.name)||l(e,t),a.time!==t.time&&d(e,t),(0,o.hw)(a.id,t.id)||v(e,t);break;case"empty":a.time!==t.time&&d(e,t)}i!==m&&f(e,i),n!==g&&h(e,n)}}var r,c=t.itemQuantity,d=(0,s.jg)(e,".bh .ch").length;if(c!==d){var l=d-c;if(l<0)for(var v=(0,s.aI)(e,".bh"),f=0;f<Math.abs(l);f++){var h=(r=void 0,(r=document.createElement("div")).classList.add("ch"),r.innerHTML='<div class="dh"><div class="eh"></div><div class="fh"></div><div class="gh"></div></div><div class="hh"></div>',{element:r,id:""});v.appendChild(h.element)}else for(var b=(0,s.aI)(e,".bh"),y=(0,s.jg)(b,".ch"),w=0;w<Math.abs(l);w++){y[d-1-w].remove()}}for(var k=0;k<c;k++){var x=(0,s.jg)(e,".bh .ch")[k];x.setAttribute("skeleton-screen",(0,o.xZ)(n));var I=t.items[k];if(p.hasOwnProperty("items"))if(p.items[k])a(x,I,p.items[k]);else a(x,I,null);else a(x,I,null)}p=t,m=i,g=n}function L(e){for(var t=(0,r.Js)("playing_animation"),n=(0,c.gO)("window"),i=Math.floor(n.height/70/3)+2,a=[],o=0;o<i;o++)a.push({type:"route",id:0,pid:[],time:{absolute:0,relative:""},name:""});A(e,{items:a,itemQuantity:a.length,dataUpdateTime:0},!0,t)}function _(){return P.apply(this,arguments)}function P(){return(P=l((function*(){var e=(0,r.Js)("playing_animation"),t=(0,r.Js)("refresh_interval");w=t.dynamic,b=t.baseInterval,M=(0,o.zx)("r");var n=yield(0,a.$i)(M);A(h,n,!1,e);var s=0;w&&(s=yield(0,i.wz)()),x=(new Date).getTime(),I=w?Math.max(x+y,n.dataUpdateTime+b/s):x+b,Math.max(y,I-x)}))).apply(this,arguments)}function j(){return $.apply(this,arguments)}function $(){return($=l((function*(){_().then((function(){k?setTimeout((function(){j()}),Math.max(y,I-(new Date).getTime())):T=!1})).catch((function(e){console.error(e),k?setTimeout((function(){j()}),1e4):T=!1}))}))).apply(this,arguments)}function Z(){L(h),k||(k=!0,T?_():(T=!0,j()))}}}]);
//# sourceMappingURL=98f4817341451e088c28.js.map