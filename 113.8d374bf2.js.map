{"version":3,"file":"113.8d374bf2.js","mappings":"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","sources":["webpack://bus/webpack/universalModuleDefinition","webpack://bus/./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://bus/./node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack://bus/./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack://bus/./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack://bus/./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://bus/./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack://bus/./src/data/analytics/bus-arrival-time/getBusArrivalTimes-worker.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"bus\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"bus\"] = factory();\n\telse\n\t\troot[\"bus\"] = factory();\n})(self, () => {\nreturn ","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nexport { _arrayLikeToArray as default };","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nfunction _slicedToArray(r, e) {\n  return arrayWithHoles(r) || iterableToArrayLimit(r, e) || unsupportedIterableToArray(r, e) || nonIterableRest();\n}\nexport { _slicedToArray as default };","function _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nexport { _arrayWithHoles as default };","function _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = !0,\n      o = !1;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) {\n        if (Object(t) !== t) return;\n        f = !1;\n      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = !0, n = r;\n    } finally {\n      try {\n        if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nexport { _iterableToArrayLimit as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nexport { _unsupportedIterableToArray as default };","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _nonIterableRest as default };","import { PersonalScheduleArray } from '../../personal-schedule/index';\nimport { BusArrivalTimeDataGroupArray, BusArrivalTimes } from './index';\n\ninterface task {\n  personalSchedules: PersonalScheduleArray;\n  busArrivalTimeDataGroups: BusArrivalTimeDataGroupArray;\n  chartWidth: number;\n  chartHeight: number;\n  taskID: string;\n  port: any;\n}\n\nconst taskQueue: Array<task> = [];\nlet isProcessing: boolean = false;\n\n// Setup message handling (works for dedicated or shared workers)\nif ('onconnect' in self) {\n  self.onconnect = function (e) {\n    const port = e.ports[0];\n    port.onmessage = function (event) {\n      const [personalSchedules, busArrivalTimeDataGroups, chartWidth, chartHeight, taskID] = event.data;\n      taskQueue.push({ personalSchedules, busArrivalTimeDataGroups, chartWidth, chartHeight, taskID, port });\n      processWorkerTask();\n    };\n  };\n} else {\n  const port = self;\n  self.onmessage = function (event) {\n    const [personalSchedules, busArrivalTimeDataGroups, chartWidth, chartHeight, taskID] = event.data;\n    taskQueue.push({ personalSchedules, busArrivalTimeDataGroups, chartWidth, chartHeight, taskID, port });\n    processWorkerTask();\n  };\n}\n\nconst fontWeight = 400;\nconst fontSize = 10;\nconst fontFamily: string = \"'Noto Sans TC', sans-serif\";\n\nlet canvas;\nlet ctx;\nlet supportOffscreenCanvas: boolean = false;\nif (typeof OffscreenCanvas !== 'undefined') {\n  canvas = new OffscreenCanvas(64, 64);\n  ctx = canvas.getContext('2d') as OffscreenCanvasRenderingContext2D;\n  ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;\n  ctx.textBaseline = 'top';\n  supportOffscreenCanvas = true;\n}\n\n// Main processing function\nfunction processWorkerTask(): void {\n  if (isProcessing || taskQueue.length === 0) return;\n  isProcessing = true;\n\n  // Dequeue the next task\n  const { personalSchedules, busArrivalTimeDataGroups, chartWidth, chartHeight, taskID, port }: task = taskQueue.shift();\n\n  const result: BusArrivalTimes = {};\n\n  // For each personalSchedule, build an SVG graph\n  for (const personalSchedule of personalSchedules) {\n    const startIndex = personalSchedule.period.start.hours * 60 + personalSchedule.period.start.minutes;\n    const endIndex = personalSchedule.period.end.hours * 60 + personalSchedule.period.end.minutes;\n    const barWidth = chartWidth / (endIndex - startIndex);\n    for (const busArrivalTimeDataGroup of busArrivalTimeDataGroups) {\n      if (personalSchedule.days.indexOf(busArrivalTimeDataGroup.day) < 0) {\n        continue;\n      }\n      const statsMax = busArrivalTimeDataGroup.max;\n      const statsArray = busArrivalTimeDataGroup.stats.slice(startIndex, endIndex);\n      const statsArrayLength = statsArray.length;\n\n      // Gridline and labels\n      let verticalGridlineLabels = '';\n      let verticalGridlinePathCommand = '';\n      let verticalGridlineInterval = 0; // minutes\n      if (statsArrayLength / 30 <= 3) {\n        verticalGridlineInterval = 10;\n      } else {\n        verticalGridlineInterval = 30;\n      }\n      const verticalGridlineQuantity = Math.floor(statsArrayLength / verticalGridlineInterval);\n      const verticalGridlineGap = chartWidth / verticalGridlineQuantity;\n      for (let i = verticalGridlineQuantity - 1; i >= 0; i--) {\n        const x = 0.35 / 2 + i * verticalGridlineGap;\n        verticalGridlinePathCommand += ` M${x} 0`;\n        verticalGridlinePathCommand += ` L${x} ${chartHeight}`;\n        // the stroke alignment is \"center\"\n        const labelTime = startIndex + i * verticalGridlineInterval;\n        const labelMinutes = labelTime % 60;\n        const labelHours = (labelTime - labelMinutes) / 60;\n        const label = `${labelHours.toString().padStart(2, '0')}:${labelMinutes.toString().padStart(2, '0')}`;\n        let labelWidth = 30;\n        let labelHeight = 12;\n        if (supportOffscreenCanvas) {\n          const textMeasurement = ctx.measureText(label) as TextMetrics;\n          labelWidth = textMeasurement.width;\n          labelHeight = textMeasurement.actualBoundingBoxDescent;\n        }\n        const y = (chartHeight - labelHeight) / 2;\n        verticalGridlineLabels += `<text x=\"${x + 3}\" y=\"${y}\" transform=\"rotate(-90 ${(x + 3 + x + 3 + labelWidth) / 2} ${(y + y + labelHeight) / 2})\" font-weight=\"${fontWeight}\" font-size=\"${fontSize}\" font-family=\"${fontFamily}\" component=\"label\">${label}</text>`;\n        // rotate(degree x y) x: absolute x of the origin, y: absolute y of the origin, origin: a point around which an element rotates\n      }\n      const verticalGridline = `<path d=\"${verticalGridlinePathCommand}\" fill=\"none\" stroke-width=\"0.35\" component=\"vertical-gridline\"/>`;\n\n      // Bottom line\n      const bottomLinePathCommand = `M0 ${chartHeight} L${chartWidth} ${chartHeight - 0.35 / 2}`;\n      const bottomLine = `<path d=\"${bottomLinePathCommand}\" fill=\"none\" stroke-width=\"0.35\" component=\"bottom-line\"/>`;\n\n      // Bars\n      let barsPathCommand = '';\n      barsPathCommand += `M${chartWidth} ${chartHeight}`;\n      for (let j = statsArrayLength - 1; j >= 0; j--) {\n        const x = ((j + 1) / statsArrayLength) * chartWidth; // Shift right for correct alignment\n        const y = (1 - statsArray[j] / statsMax) * chartHeight;\n        barsPathCommand += ` L${x} ${y}`;\n        barsPathCommand += ` L${x - barWidth} ${y}`;\n        barsPathCommand += ` L${x - barWidth} ${chartHeight}`;\n      }\n      barsPathCommand += ' Z';\n      const bars = `<path d=\"${barsPathCommand}\" stroke=\"none\" stroke-width=\"0\" component=\"bars\"/>`;\n\n      const svg = `<svg width=\"${chartWidth}\" height=\"${chartHeight}\" viewBox=\"0 0 ${chartWidth} ${chartHeight}\" xmlns=\"http://www.w3.org/2000/svg\">${verticalGridline}${verticalGridlineLabels}${bottomLine}${bars}</svg>`;\n      const stopKey = `s_${busArrivalTimeDataGroup.id}`;\n      if (!result.hasOwnProperty(stopKey)) {\n        result[stopKey] = [];\n      }\n      result[stopKey].push({\n        personalSchedule: personalSchedule,\n        chart: svg,\n        day: busArrivalTimeDataGroup.day\n      });\n    }\n  }\n\n  // Send the complete HTML back to the main thread\n  port.postMessage([result, taskID]);\n\n  isProcessing = false;\n  processWorkerTask(); // Process next task in the queue if any\n}\n"],"names":["root","factory","exports","module","define","amd","self","_arrayLikeToArray","r","a","length","e","n","Array","_slicedToArray","isArray","l","t","Symbol","iterator","i","u","f","o","call","next","Object","done","push","value","toString","slice","constructor","name","from","test","TypeError","taskQueue","isProcessing","onconnect","port","ports","onmessage","event","_event$data","data","personalSchedules","busArrivalTimeDataGroups","chartWidth","chartHeight","taskID","processWorkerTask","_event$data2","canvas","ctx","fontWeight","fontSize","fontFamily","supportOffscreenCanvas","_step","_taskQueue$shift","shift","result","_iterator","_createForOfIteratorHelper","s","_step2","personalSchedule","startIndex","period","start","hours","minutes","endIndex","end","barWidth","_iterator2","busArrivalTimeDataGroup","days","indexOf","day","statsMax","max","statsArray","stats","statsArrayLength","verticalGridlineLabels","verticalGridlinePathCommand","verticalGridlineInterval","verticalGridlineQuantity","Math","floor","verticalGridlineGap","x","labelTime","labelMinutes","label","padStart","labelWidth","labelHeight","textMeasurement","measureText","width","actualBoundingBoxDescent","y","verticalGridline","bottomLine","barsPathCommand","j","svg","stopKey","id","hasOwnProperty","chart","err","postMessage","OffscreenCanvas","getContext","font","textBaseline"],"ignoreList":[],"sourceRoot":""}