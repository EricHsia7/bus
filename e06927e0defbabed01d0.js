!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("bus",[],e):"object"==typeof exports?exports.bus=e():t.bus=e()}(self,(()=>(()=>{"use strict";var t={};function e(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=n(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw i}}}}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,s=[],l=!0,f=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(t){f=!0,o=t}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(f)throw o}}return s}}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return o(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var a=[],i=!1;if("onconnect"in self)self.onconnect=function(t){var e=t.ports[0];e.onmessage=function(t){var n=r(t.data,5),o=n[0],i=n[1],s=n[2],l=n[3],f=n[4];a.push({personalSchedules:o,busArrivalTimeDataGroups:i,chartWidth:s,chartHeight:l,taskID:f,port:e}),p()}};else{var s=self;self.onmessage=function(t){var e=r(t.data,5),n=e[0],o=e[1],i=e[2],l=e[3],f=e[4];a.push({personalSchedules:n,busArrivalTimeDataGroups:o,chartWidth:i,chartHeight:l,taskID:f,port:s}),p()}}var l,f,u=400,c=10,d="'Noto Sans TC', sans-serif",h=!1;function p(){if(!i&&0!==a.length){i=!0;var t,r=a.shift(),n=r.personalSchedules,o=r.busArrivalTimeDataGroups,s=r.chartWidth,l=r.chartHeight,v=r.taskID,y=r.port,$={},m=e(n);try{for(m.s();!(t=m.n()).done;){var b,g=t.value,w=60*g.period.start.hours+g.period.start.minutes,x=60*g.period.end.hours+g.period.end.minutes,S=s/(x-w),A=e(o);try{for(A.s();!(b=A.n()).done;){var j=b.value;if(!(g.days.indexOf(j.day)<0)){var I=j.max,k=j.stats.slice(w,x),D=k.length,O="",T="",M=0;M=D/30<=3?10:30;for(var C=Math.floor(D/M),L=s/C,B=C-1;B>=0;B--){var G=.175+B*L;T+=` M${G} 0`,T+=` L${G} ${l}`;var H=w+B*M,W=H%60,E=`${((H-W)/60).toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`,z=30,N=12;if(h){var P=f.measureText(E);z=P.width,N=P.actualBoundingBoxDescent}var U=(l-N)/2;O+=`<text x="${G+3}" y="${U}" transform="rotate(-90 ${(G+3+G+3+z)/2} ${(U+U+N)/2})" font-weight="${u}" font-size="${c}" font-family="${d}" component="label">${E}</text>`}var Z=`<path d="${T}" fill="none" stroke-width="0.35" component="vertical-gridline"/>`,_=`<path d="${`M0 ${l} L${s} ${l-.175}`}" fill="none" stroke-width="0.35" component="bottom-line"/>`,q="";q+=`M${s} ${l}`;for(var F=D-1;F>=0;F--){var J=(F+1)/D*s,K=(1-k[F]/I)*l;q+=` L${J} ${K}`,q+=` L${J-S} ${K}`,q+=` L${J-S} ${l}`}var Q=`<svg width="${s}" height="${l}" viewBox="0 0 ${s} ${l}" xmlns="http://www.w3.org/2000/svg">${Z}${O}${_}${`<path d="${q+=" Z"}" stroke="none" stroke-width="0" component="bars"/>`}</svg>`,R=`s_${j.id}`;$.hasOwnProperty(R)||($[R]=[]),$[R].push({personalSchedule:g,chart:Q,day:j.day})}}}catch(t){A.e(t)}finally{A.f()}}}catch(t){m.e(t)}finally{m.f()}y.postMessage([$,v]),i=!1,p()}}return"undefined"!=typeof OffscreenCanvas&&(l=new OffscreenCanvas(64,64),(f=l.getContext("2d")).font=`${u} ${c}px ${d}`,f.textBaseline="top",h=!0),t=t.default})()));
//# sourceMappingURL=e06927e0defbabed01d0.js.map