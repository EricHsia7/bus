"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[323],{7123(e,t,n){n.d(t,{R:()=>S});var a=n(467),r=n(7183),i=n(8024),o=n(6483),u=n(6802),s=n(7810),d=n(2063),f=n(8011),l=n(4293),c=n(1932),y=n(424),p=n(2303),m=n(6788),v=n(3459),h=n(1531);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("E0")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw i}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function S(e,t,n,a,r){return D.apply(this,arguments)}function D(){return(D=(0,a.A)(function*(e,t,n,a,_){(0,m.Mf)(_,"getRoute_0",0,!1),(0,m.Mf)(_,"getRoute_1",0,!1),(0,m.Mf)(_,"getStop_0",0,!1),(0,m.Mf)(_,"getStop_1",0,!1),(0,m.Mf)(_,"getLocation_0",0,!1),(0,m.Mf)(_,"getLocation_1",0,!1),(0,m.Mf)(_,"getSegmentBuffers_0",0,!1),(0,m.Mf)(_,"getSegmentBuffers_1",0,!1),(0,m.Mf)(_,"getEstimateTime_0",0,!1),(0,m.Mf)(_,"getEstimateTime_1",0,!1),(0,m.Mf)(_,"getBusEvent_0",0,!1),(0,m.Mf)(_,"getBusEvent_1",0,!1),(0,m.Mf)(_,"getBusData_0",0,!1),(0,m.Mf)(_,"getBusData_1",0,!1);var S=yield(0,l.a)(_,!0),D=yield(0,y.T)(_),b=yield(0,f.g)(_,0),I=yield(0,f.g)(_,1),T=yield(0,f.g)(_,2),w=yield(0,c.L)(_),k=yield(0,d.K)(_),B=yield(0,s.J)(_),$=yield(0,u.d)(_),E=yield(0,o.Io)(n,a),M=(0,p.w_)(B,$,S,e,t),R=!1,Q={};(0,i.mQ)(w,`r_${e}`)&&(R=!0,Q=w[`r_${e}`]);var A,U=(0,v.Js)("time_formatting_mode"),L=[],P=[],H=g(k);try{for(H.s();!(A=H.n()).done;){var x=A.value,O={},W=x.RouteID;if([e,10*e].includes(W)||t.includes(W)){O.status=(0,p.$Q)(null==x?void 0:x.EstimateTime,U);var G=`s_${x.StopID}`,q={};if(!(0,i.mQ)(D,G))continue;q=D[G],O.id=x.StopID,O.sequence=q.seqNo,O.goBack=q.goBack;var C=`l_${q.stopLocationId}`,F={};if(!(0,i.mQ)(b,C))continue;F=b[C],O.name=F.n;var Z=F.r.length;O.overlappingRoutes=[];for(var N=0;N<Z;N++){var V=F.r[N];if(V!==e){var j=`r_${V}`;if((0,i.mQ)(S,j)){var J=S[j],K={name:J.n,RouteEndPoints:{RouteDeparture:J.dep,RouteDestination:J.des,text:`${J.dep} ↔ ${J.des}`,html:`<span>${J.dep}</span><span>↔</span><span>${J.des}</span>`},RouteID:J.id,PathAttributeId:J.pid};O.overlappingRoutes.push(K)}}}O.position={longitude:F.lo,latitude:F.la},P.push({latitude:F.la,longitude:F.lo,id:x.StopID});var Y=F.g,z=[];(0,i.mQ)(T,Y)&&(z=T[Y]),O.nearbyLocations=[];var X,ee=g(z);try{for(ee.s();!(X=ee.n()).done;){var te=`ml_${X.value.hash}`;if((0,i.mQ)(I,te)){var ne=I[te],ae={name:ne.n,distance:0|(0,r.aV)(ne.la[0],ne.lo[0],F.la,F.lo),hash:ne.hash};O.nearbyLocations.push(ae)}}}catch(e){ee.e(e)}finally{ee.f()}O.nearbyLocations.sort(function(e,t){return e.distance-t.distance}),O.buses=[];var re,ie=g(F.s);try{for(ie.s();!(re=ie.n()).done;){var oe=`s_${re.value}`;if((0,i.mQ)(M,oe))for(var ue=M[oe].length-1;ue>=0;ue--)O.buses.push((0,p.s$)(M[oe][ue]))}}catch(e){ie.e(e)}finally{ie.f()}O.buses.sort(function(e,t){return e.index-t.index});var se=[];(0,i.mQ)(E,G)&&(se=E[G]),O.busArrivalTimes=se;var de=!1,fe=!1,le=!1,ce=!1;if(R){var ye=`g_${O.goBack}`,pe=[];(0,i.mQ)(Q,ye)?pe=Q[ye]:"1"===O.goBack&&(ce=!0,pe=Q.g_0);var me,ve=g(pe);try{for(ve.s();!(me=ve.n()).done;){var he=me.value;he.OriginStopID!==x.StopID&&he.DestinationStopID!==x.StopID||(de=!0),ce?(he.OriginStopID===x.StopID&&(le=!0),he.DestinationStopID===x.StopID&&(fe=!0)):(he.OriginStopID===x.StopID&&(fe=!0),he.DestinationStopID===x.StopID&&(le=!0))}}catch(e){ve.e(e)}finally{ve.f()}}O.segmentBuffer={isSegmentBuffer:de,isStartingPoint:fe,isEndingPoint:le},L.push(O)}}}catch(e){H.e(e)}finally{H.f()}L.sort(function(e,t){return e.sequence-t.sequence});for(var ge=(0,h.uQ)(P,450),_e=!1,Se=!1,De={},be=0,Ie={},Te=L.length,we=0;we<Te;we++){var ke=L[we],Be=L[we+1]||ke,$e=0;if(ke.buses.length>0&&ke.buses[0].onThisRoute){var Ee=[ke.buses[0].position.longitude,ke.buses[0].position.latitude],Me=Ee[0],Re=Ee[1],Qe=[ke.position.longitude,ke.position.latitude],Ae=Qe[0],Ue=Qe[1],Le=[Be.position.longitude,Be.position.latitude],Pe=Le[0],He=Le[1];if((Me-Ae)*(Pe-Me)+(Re-Ue)*(He-Re)>=0){var xe=Math.hypot(Me-Ae,Re-Ue),Oe=Math.hypot(Me-Pe,Re-He);$e=Math.max(0,Math.min(xe/(xe+Oe),1))}}ke.progress=$e,ke.segmentBuffer.isStartingPoint&&(_e=!0),ke.segmentBuffer.isEndingPoint&&_e&&(Se=!0),_e&&!Se&&(ke.segmentBuffer.isSegmentBuffer=!0),_e&&Se&&(_e=!1,Se=!1);var We=!1;null!==ge&&ge.id===ke.id&&(We=!0),ke.nearest=We;var Ge=`g_${ke.goBack}`||"g_0";(0,i.mQ)(De,Ge)||(De[Ge]=[],Ie[Ge]=0,be+=1),De[Ge].push(ke),Ie[Ge]+=1}var qe=S[`r_${e}`],Ce=qe.n,Fe=qe.dep,Ze=qe.des,Ne={groupNames:[`往${Ze}`,`往${Fe}`],groupedItems:De,groupQuantity:be,itemQuantity:Ie,RouteName:Ce,RouteEndPoints:{RouteDeparture:Fe,RouteDestination:Ze},dataUpdateTime:(0,m.Zt)(_),RouteID:e,PathAttributeId:t};return(0,m.LQ)(_),(0,m.gC)(_),Ne})).apply(this,arguments)}},8621(e,t,n){n.d(t,{p:()=>y});var a=n(467),r=n(5579),i=n(313),o=n(4293),u=n(8201),s=n(8671),d=n(2303),f=n(6788);function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("E0")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function y(e,t,n){return p.apply(this,arguments)}function p(){return(p=(0,a.A)(function*(e,t,n){var a=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.Id===t){a=i;break}}}catch(e){r.e(e)}finally{r.f()}return a}(yield(0,o.a)(n,!1),e),c=yield(0,u.Y)(n),y=yield(0,s.s)(n),p=yield(0,i.s)(n),m=function(e){var t=(0,d.aU)(e.goFirstBusTime,0),n=(0,d.aU)(e.goLastBusTime,0),a=(0,d.aU)(e.backFirstBusTime,0),r=(0,d.aU)(e.backLastBusTime,0),i=(0,d.aU)(e.holidayGoFirstBusTime,0),o=(0,d.aU)(e.holidayGoLastBusTime,0),u=(0,d.aU)(e.holidayBackFirstBusTime,0),s=(0,d.aU)(e.holidayBackLastBusTime,0),f=(0,d.aU)(e.peakHeadway,1),l=(0,d.aU)(e.offPeakHeadway,1),c=(0,d.aU)(e.holidayPeakHeadway,1),y=(0,d.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:f,offRushHourWindow:l},holiday:{first:i,last:o,rushHourWindow:c,offRushHourWindow:y}},back:{weekday:{first:a,last:r,rushHourWindow:f,offRushHourWindow:l},holiday:{first:u,last:s,rushHourWindow:c,offRushHourWindow:y}},realSequence:e.realSequence}}(a),v=function(e,t,n,a,i){var o,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,r.P$)(),f=l(a);try{for(f.s();!(o=f.n()).done;){var c=o.value;if(t.indexOf(c.PathAttributeId)>-1&&"0"===c.DateType)for(var y=(0,r.mr)(c.DateValue),p=(0,r.S1)(s,y.day,0,0),m=(0,d.aU)(c.StartTime,0),v=(0,r.S1)(p,0,m.hours,m.minutes),h=(0,d.aU)(c.EndTime,0),g=(0,r.S1)(p,0,h.hours,h.minutes),_=Math.abs(60*h.hours+h.minutes-(60*m.hours+m.minutes)),S=parseInt(c.LongHeadway),D=parseInt(c.LowHeadway),b=(D+S)/2,I=_/b,T=0;T<I;T++){var w=!1,k=(0,r.S1)(p,0,m.hours,m.minutes+D*T);k.getTime()<v.getTime()&&(w=!0),k.getTime()>g.getTime()&&(w=!0),!1===w&&(u.calendarEventGroups[y.code].push({date:k,dateString:(0,r.$T)(k,"hh:mm"),duration:D,deviation:Math.abs(b-D)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){f.e(e)}finally{f.f()}var B,$=l(i);try{for($.s();!(B=$.n()).done;){var E=B.value;if(t.indexOf(E.PathAttributeId)>-1&&"0"===E.DateType){var M=(0,r.mr)(E.DateValue),R=(0,r.S1)(s,M.day,0,0),Q=(0,d.aU)(E.DepartureTime,0),A=(0,r.S1)(R,0,Q.hours,Q.minutes);u.calendarEventGroups[M.code].push({date:A,dateString:(0,r.$T)(A,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[M.code]+=1}}}catch(e){$.e(e)}finally{$.f()}for(var U in u.calendarEventGroups)u.calendarEventGroups[U].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return u}(0,t,0,c,y),h=function(e,t){var n,a={},r=l(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.id===t&&(a=i)}}catch(e){r.e(e)}finally{r.f()}return a}(p,a.providerId),g={timeTableRules:m,calendar:v,properties:[{key:"route_name",icon:"route",value:a.nameZh},{key:"pricing",icon:"attach_money",value:a.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:h.nameZn},{key:"provider_phone",icon:"call",value:h.phoneInfo},{key:"provider_email",icon:"alternate_email",value:h.email}]};return(0,f.LQ)(n),(0,f.gC)(n),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=80f52fa6a3a597e179ae.js.map