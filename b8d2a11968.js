"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{7123(e,a,t){t.d(a,{a:()=>g});var r=t(467),n=t(7183),i=t(8024),o=t(6483),u=t(6802),s=t(7810),d=t(2063),f=t(8011),p=t(4293),h=t(1932),l=t(424),c=t(2303),v=t(6788),y=t(3459),m=t(1531);function g(e,a,t,r,n){return _.apply(this,arguments)}function _(){return(_=(0,r.a)(function*(e,a,t,r,g){(0,v.f)(g,"getRoute_0",0,!1),(0,v.f)(g,"getRoute_1",0,!1),(0,v.f)(g,"getStop_0",0,!1),(0,v.f)(g,"getStop_1",0,!1),(0,v.f)(g,"getLocation_0",0,!1),(0,v.f)(g,"getLocation_1",0,!1),(0,v.f)(g,"getSegmentBuffers_0",0,!1),(0,v.f)(g,"getSegmentBuffers_1",0,!1),(0,v.f)(g,"getEstimateTime_0",0,!1),(0,v.f)(g,"getEstimateTime_1",0,!1),(0,v.f)(g,"getBusEvent_0",0,!1),(0,v.f)(g,"getBusEvent_1",0,!1),(0,v.f)(g,"getBusData_0",0,!1),(0,v.f)(g,"getBusData_1",0,!1);var _=yield(0,p.a)(g,!0),b=yield(0,l.a)(g),D=yield(0,f.a)(g,0),S=yield(0,f.a)(g,1),I=yield(0,f.a)(g,2),k=yield(0,h.a)(g),B=yield(0,d.a)(g),w=yield(0,s.a)(g),T=yield(0,u.a)(g),$=yield(0,o.b)(t,r),E=(0,c.b)(w,T,_,e,a),L=!1,R={};(0,i.e)(k,`r_${e}`)&&(L=!0,R=k[`r_${e}`]);var H=(0,y.b)("time_formatting_mode"),P=[],x=[];for(var C of B){var O={},W=C.RouteID;if([e,10*e].includes(W)||a.includes(W)){O.status=(0,c.g)(null==C?void 0:C.EstimateTime,H);var G=`s_${C.StopID}`,M={};if(!(0,i.e)(b,G))continue;M=b[G],O.id=C.StopID,O.sequence=M.seqNo,O.goBack=M.goBack;var q=`l_${M.stopLocationId}`,Q={};if(!(0,i.e)(D,q))continue;Q=D[q],O.name=Q.n;var A=Q.r.length;O.overlappingRoutes=[];for(var F=0;F<A;F++){var N=Q.r[F];if(N!==e){var Z=`r_${N}`;if((0,i.e)(_,Z)){var V=_[Z],U={name:V.n,RouteEndPoints:{RouteDeparture:V.dep,RouteDestination:V.des,text:`${V.dep} ↔ ${V.des}`,html:`<span>${V.dep}</span><span>↔</span><span>${V.des}</span>`},RouteID:V.id,PathAttributeId:V.pid};O.overlappingRoutes.push(U)}}}O.position={longitude:Q.lo,latitude:Q.la},x.push({latitude:Q.la,longitude:Q.lo,id:C.StopID});var j=Q.g,z=[];for(var J of((0,i.e)(I,j)&&(z=I[j]),O.nearbyLocations=[],z)){var K=`ml_${J.hash}`;if((0,i.e)(S,K)){var X=S[K],Y={name:X.n,distance:0|(0,n.c)(X.la[0],X.lo[0],Q.la,Q.lo),hash:X.hash};O.nearbyLocations.push(Y)}}for(var ee of(O.nearbyLocations.sort(function(e,a){return e.distance-a.distance}),O.buses=[],Q.s)){var ae=`s_${ee}`;if((0,i.e)(E,ae))for(var te=E[ae].length-1;te>=0;te--)O.buses.push((0,c.c)(E[ae][te]))}O.buses.sort(function(e,a){return e.index-a.index});var re=[];(0,i.e)($,G)&&(re=$[G]),O.busArrivalTimes=re;var ne=!1,ie=!1,oe=!1,ue=!1;if(L){var se=`g_${O.goBack}`,de=[];for(var fe of((0,i.e)(R,se)?de=R[se]:"1"===O.goBack&&(ue=!0,de=R.g_0),de))fe.OriginStopID!==C.StopID&&fe.DestinationStopID!==C.StopID||(ne=!0),ue?(fe.OriginStopID===C.StopID&&(oe=!0),fe.DestinationStopID===C.StopID&&(ie=!0)):(fe.OriginStopID===C.StopID&&(ie=!0),fe.DestinationStopID===C.StopID&&(oe=!0))}O.segmentBuffer={isSegmentBuffer:ne,isStartingPoint:ie,isEndingPoint:oe},P.push(O)}}P.sort(function(e,a){return e.sequence-a.sequence});for(var pe=(0,m.b)(x,450),he=!1,le=!1,ce={},ve=0,ye={},me=P.length,ge=0;ge<me;ge++){var _e=P[ge],be=P[ge+1]||_e,De=0;if(_e.buses.length>0&&_e.buses[0].onThisRoute){var Se=[_e.buses[0].position.longitude,_e.buses[0].position.latitude],Ie=Se[0],ke=Se[1],Be=[_e.position.longitude,_e.position.latitude],we=Be[0],Te=Be[1],$e=[be.position.longitude,be.position.latitude],Ee=$e[0],Le=$e[1];if((Ie-we)*(Ee-Ie)+(ke-Te)*(Le-ke)>=0){var Re=Math.hypot(Ie-we,ke-Te),He=Math.hypot(Ie-Ee,ke-Le);De=Math.max(0,Math.min(Re/(Re+He),1))}}_e.progress=De,_e.segmentBuffer.isStartingPoint&&(he=!0),_e.segmentBuffer.isEndingPoint&&he&&(le=!0),he&&!le&&(_e.segmentBuffer.isSegmentBuffer=!0),he&&le&&(he=!1,le=!1);var Pe=!1;null!==pe&&pe.id===_e.id&&(Pe=!0),_e.nearest=Pe;var xe=`g_${_e.goBack}`||"g_0";(0,i.e)(ce,xe)||(ce[xe]=[],ye[xe]=0,ve+=1),ce[xe].push(_e),ye[xe]+=1}var Ce=_[`r_${e}`],Oe=Ce.n,We=Ce.dep,Ge=Ce.des,Me={groupNames:[`往${Ge}`,`往${We}`],groupedItems:ce,groupQuantity:ve,itemQuantity:ye,RouteName:Oe,RouteEndPoints:[We,Ge],dataUpdateTime:(0,v.e)(g),RouteID:e,PathAttributeId:a};return(0,v.a)(g),(0,v.b)(g),Me})).apply(this,arguments)}},8134(e,a,t){t.d(a,{a:()=>b,b:()=>I,c:()=>p,d:()=>v,e:()=>l});var r=t(467),n=t(2129),i=t(8024),o=t(4781),u=t(9734),s=t(8011),d=t(4293),f=t(6788);function p(e){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return(c=(0,r.a)(function*(e){var a,t=(0,i.c)(),r=yield(0,d.a)(t,!0),n=`r_${e}`;return!!(0,i.e)(r,n)&&(a=r[n],(0,f.a)(t),(0,f.b)(t),a)})).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=(0,r.a)(function*(e){var a=(0,i.c)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,f.a)(a),(0,f.b)(a),r})).apply(this,arguments)}var m={},g=[],_=!1;function b(){return D.apply(this,arguments)}function D(){return(D=(0,r.a)(function*(){if(!_){var e=(0,i.c)(),a=yield(0,d.a)(e,!0),t=yield(0,s.a)(e,1),r=yield(0,u.a)(e,!0);(0,f.a)(e),(0,f.b)(e);var n={},p=[],h=0;for(var l in a){var c=a[l],v={id:c.id,pid:c.pid,dep:c.dep,des:c.des,n:c.n,hash:"",lo:"",la:"",r:"",s:"",type:0};p.push(v);var y=(0,o.b)(`${v.n.toLowerCase()}${v.dep.toLowerCase()}${v.des.toLowerCase()}`,!0);for(var b of y){var D=`u_${b}`;(0,i.e)(n,D)||(n[D]=[]),n[D].push(h)}h+=1}for(var S in t){var I=t[S],k={id:I.id,n:I.n,lo:I.lo,la:I.la,r:I.r,s:I.s,hash:I.hash,dep:"",des:"",pid:[],type:1};p.push(k);var B=(0,o.b)(k.n.toLowerCase(),!0);for(var w of B){var T=`u_${w}`;(0,i.e)(n,T)||(n[T]=[]),n[T].push(h)}h+=1}for(var $ in r){var E=r[$],L={id:E.BusId,pid:[],dep:"",des:"",n:E.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};p.push(L);var R=(0,o.b)(L.n.toLowerCase(),!0);for(var H of R){var P=`u_${H}`;(0,i.e)(n,P)||(n[P]=[]),n[P].push(h)}h+=1}m=n,g=p,_=!0}})).apply(this,arguments)}function S(e,a){var t=0,r=0;for(var n of a){t+=e.indexOf(n,r)-r,r+=1}return e===a&&(t=10*Math.abs(t)),t}function I(e,a,t){if(!_)return[];var r=e.toLowerCase(),u=(0,o.b)(r,!0),s=(0,o.b)(r,!1),d=[];for(var f of u){var p=`u_${f}`;(0,i.e)(m,p)&&d.push(m[p])}d.sort(function(e,a){return e.length-a.length});var h=d.length-1,l=[];if(0===h&&(l=d[0]),h>0)for(var c=0;c<h;c++){var v=d[c],y=d[c+1];l=0===c?(0,n.b)(v,y):(0,n.b)(l,y)}var b=[],D=0,I=new Set;if(-1===a||2===a){var k=g.filter(function(e){return e.n===r&&2===e.type});for(var B of k)if(b.push({item:B,score:1/0}),I.add(B.id),(D+=1)>=t)break}if(D<t)for(var w of l){var T=g[w];if((-1===a||a===T.type)&&!I.has(T.id)){var $=S(s,(0,o.b)(T.n,!1));if(!(D<t))break;b.push({item:T,score:$}),D+=1}}return b.sort(function(e,a){return a.score-e.score}),b}},8621(e,a,t){t.d(a,{a:()=>p});var r=t(467),n=t(5579),i=t(313),o=t(4293),u=t(8201),s=t(8671),d=t(2303),f=t(6788);function p(e,a,t){return h.apply(this,arguments)}function h(){return(h=(0,r.a)(function*(e,a,t){var r=function(e,a){var t={};for(var r of e)if(r.Id===a){t=r;break}return t}(yield(0,o.a)(t,!1),e),p=yield(0,u.a)(t),h=yield(0,s.a)(t),l=yield(0,i.a)(t),c=function(e){var a=(0,d.h)(e.goFirstBusTime,0),t=(0,d.h)(e.goLastBusTime,0),r=(0,d.h)(e.backFirstBusTime,0),n=(0,d.h)(e.backLastBusTime,0),i=(0,d.h)(e.holidayGoFirstBusTime,0),o=(0,d.h)(e.holidayGoLastBusTime,0),u=(0,d.h)(e.holidayBackFirstBusTime,0),s=(0,d.h)(e.holidayBackLastBusTime,0),f=(0,d.h)(e.peakHeadway,1),p=(0,d.h)(e.offPeakHeadway,1),h=(0,d.h)(e.holidayPeakHeadway,1),l=(0,d.h)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:a,last:t,rushHourWindow:f,offRushHourWindow:p},holiday:{first:i,last:o,rushHourWindow:h,offRushHourWindow:l}},back:{weekday:{first:r,last:n,rushHourWindow:f,offRushHourWindow:p},holiday:{first:u,last:s,rushHourWindow:h,offRushHourWindow:l}},realSequence:e.realSequence}}(r),v=function(e,a,t,r,i){var o={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},u=(0,n.f)();for(var s of r)if(a.indexOf(s.PathAttributeId)>-1&&"0"===s.DateType)for(var f=(0,n.d)(s.DateValue),p=(0,n.h)(u,f.day,0,0),h=(0,d.h)(s.StartTime,0),l=(0,n.h)(p,0,h.hours,h.minutes),c=(0,d.h)(s.EndTime,0),v=(0,n.h)(p,0,c.hours,c.minutes),y=Math.abs(60*c.hours+c.minutes-(60*h.hours+h.minutes)),m=parseInt(s.LongHeadway),g=parseInt(s.LowHeadway),_=(g+m)/2,b=y/_,D=0;D<b;D++){var S=!1,I=(0,n.h)(p,0,h.hours,h.minutes+g*D);I.getTime()<l.getTime()&&(S=!0),I.getTime()>v.getTime()&&(S=!0),!1===S&&(o.calendarEventGroups[f.code].push({date:I,dateString:(0,n.c)(I,"hh:mm"),duration:g,deviation:Math.abs(_-g)}),o.calendarEventQuantity[f.code]+=1)}for(var k of i)if(a.indexOf(k.PathAttributeId)>-1&&"0"===k.DateType){var B=(0,n.d)(k.DateValue),w=(0,n.h)(u,B.day,0,0),T=(0,d.h)(k.DepartureTime,0),$=(0,n.h)(w,0,T.hours,T.minutes);o.calendarEventGroups[B.code].push({date:$,dateString:(0,n.c)($,"hh:mm"),duration:15,deviation:0}),o.calendarEventQuantity[B.code]+=1}for(var E in o.calendarEventGroups)o.calendarEventGroups[E].sort(function(e,a){return e.date.getTime()-a.date.getTime()});return o}(0,a,0,p,h),y=function(e,a){var t={};for(var r of e)r.id===a&&(t=r);return t}(l,r.providerId),m={timeTableRules:c,calendar:v,properties:[{key:"route_name",icon:"route",value:r.nameZh},{key:"pricing",icon:"attach_money",value:r.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:y.nameZn},{key:"provider_phone",icon:"call",value:y.phoneInfo},{key:"provider_email",icon:"alternate_email",value:y.email}]};return(0,f.a)(t),(0,f.b)(t),m})).apply(this,arguments)}}}]);
//# sourceMappingURL=b8d2a11968.js.map