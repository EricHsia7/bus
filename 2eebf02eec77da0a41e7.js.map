{"version":3,"file":"2eebf02eec77da0a41e7.js","mappings":"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","sources":["webpack://bus/./src/data/apis/getStop/index.ts","webpack://bus/./src/data/apis/index.ts","webpack://bus/./src/data/apis/getSemiTimeTable/index.ts","webpack://bus/./src/data/apis/getTimeTable/index.ts"],"sourcesContent":["import { lfGetItem, lfSetItem } from '../../storage/index';\nimport { getAPIURL } from '../getAPIURL/index';\nimport { fetchData, setDataReceivingProgress, setDataUpdateTime } from '../loader';\n\nexport interface StopItem {\n  Id: number; // StopID\n  routeId: number; // RouteID\n  nameZh: string; // name in Chinese\n  nameEn: string; // name in English\n  seqNo: number; // sequence on the route\n  pgp: string; // pgp (-1: get off, 0: get on and off, 1: get on)\n  goBack: '0' | '1' | '2'; // GoBack (0: go, 1: back, 2: unknown)\n  longitude: string; // number in string\n  latitude: string; // number in string\n  address: string;\n  stopLocationId: number; // LocationID\n  showLon: string; // number in string\n  showLat: string; // number in string\n  vector: string;\n}\n\nexport type Stop = Array<StopItem>;\n\nexport interface SimplifiedStopItem {\n  seqNo: number;\n  goBack: '0' | '1' | '2'; // GoBack (0: go, 1: back, 2: unknown)\n  stopLocationId: number;\n}\n\nexport type SimplifiedStop = { [key: string]: SimplifiedStopItem };\n\nlet StopAPIVariableCache_available: boolean = false;\nlet StopAPIVariableCache_data: SimplifiedStop = {};\n\nasync function simplifyStop(array: Stop): Promise<SimplifiedStop> {\n  const worker = new Worker(new URL('./simplifyStop-worker.ts', import.meta.url));\n\n  // Wrap worker communication in a promise\n  const result = await new Promise((resolve, reject) => {\n    worker.onmessage = function (e) {\n      resolve(e.data); // Resolve the promise with the worker's result\n      worker.terminate(); // Terminate the worker when done\n    };\n\n    worker.onerror = function (e) {\n      reject(e.message); // Reject the promise on error\n      worker.terminate(); // Terminate the worker if an error occurs\n    };\n\n    worker.postMessage(array); // Send data to the worker\n  });\n\n  return result;\n}\n\nexport async function getStop(requestID: string): Promise<SimplifiedStop> {\n  async function getData() {\n    const apis = [\n      [0, 11],\n      [1, 11]\n    ].map((e) => ({ url: getAPIURL(e[0], e[1]), e: e }));\n    let result = [];\n    for (const api of apis) {\n      const data = await fetchData(api.url, requestID, `getStop_${api.e[0]}`, 'json');\n      result = result.concat(data.BusInfo);\n      setDataUpdateTime(requestID, data.EssentialInfo.UpdateTime);\n    }\n    return result;\n  }\n\n  const cacheTimeToLive = 60 * 60 * 24 * 45 * 1000;\n  const cacheKey = 'bus_stop_cache';\n  const cacheTimestamp = await lfGetItem(0, `${cacheKey}_timestamp`);\n  if (cacheTimestamp === null) {\n    const result = await getData();\n    const simplified_result = await simplifyStop(result);\n    await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n    await lfSetItem(0, cacheKey, JSON.stringify(simplified_result));\n    if (!StopAPIVariableCache_available) {\n      StopAPIVariableCache_available = true;\n      StopAPIVariableCache_data = simplified_result;\n    }\n    return simplified_result;\n  } else {\n    if (new Date().getTime() - parseInt(cacheTimestamp) > cacheTimeToLive) {\n      const result = await getData();\n      const simplified_result = await simplifyStop(result);\n      await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n      await lfSetItem(0, cacheKey, JSON.stringify(simplified_result));\n      return simplified_result;\n    } else {\n      if (!StopAPIVariableCache_available) {\n        const cache = await lfGetItem(0, cacheKey);\n        StopAPIVariableCache_available = true;\n        StopAPIVariableCache_data = JSON.parse(cache);\n      }\n      setDataReceivingProgress(requestID, 'getStop_0', 0, true);\n      setDataReceivingProgress(requestID, 'getStop_1', 0, true);\n      setDataUpdateTime(requestID, -1);\n      return StopAPIVariableCache_data;\n    }\n  }\n}\n","import { formatTime } from '../../tools/time';\nimport { BusData, BusDataItem } from './getBusData/index';\nimport { BusEvent, BusEventItem } from './getBusEvent/index';\nimport { SimplifiedRoute } from './getRoute/index';\n\nexport interface EstimateTimeStatus {\n  code: 0 | 0.5 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8; // 8: loading\n  text: string;\n  time: number;\n}\n\nexport function parseEstimateTime(EstimateTime: string, mode: number): EstimateTimeStatus {\n  if (typeof EstimateTime === 'string') {\n    const time = parseInt(EstimateTime);\n    if (time === -3) {\n      return { code: 6, text: '末班駛離', time };\n    }\n    if (time === -4) {\n      return { code: 5, text: '今日停駛', time };\n    }\n    if (time === -2) {\n      return { code: 4, text: '交通管制', time };\n    }\n    if (time === -1) {\n      return { code: 3, text: '未發車', time };\n    }\n    if (0 <= time && time <= 10) {\n      return { code: 2, text: '進站中', time };\n    }\n    if (10 < time && time <= 180) {\n      return { code: 1, text: formatTime(time, mode), time };\n    }\n    if (180 < time && time <= 250) {\n      return { code: 0.5, text: formatTime(time, mode), time };\n    }\n    if (250 < time) {\n      return { code: 0, text: formatTime(time, mode), time };\n    }\n  }\n  return { code: 7, text: '發生錯誤', time: -5 };\n}\n\nexport interface TimeMoment {\n  type: 'moment';\n  hours: number;\n  minutes: number;\n}\n\nexport interface TimeRange {\n  type: 'range';\n  min: number;\n  max: number;\n}\n\n/**\n * parseTimeCode\n * @param code 0: hhmm/mm, 1: mmMM/mm\n * @param mode 0: moment, 1: range\n * @returns 0: TimeMoment, 1: TimeRange\n */\n\nexport function parseTimeCode(code: string, mode: 0 | 1): TimeMoment | TimeRange {\n  const codeLength = code.length;\n  if (mode === 0) {\n    let hours = 0;\n    let minutes = 0;\n    if (codeLength === 4) {\n      hours = parseInt(code.substring(0, 2));\n      minutes = parseInt(code.substring(2, 4));\n    }\n    if (codeLength === 2) {\n      minutes = parseInt(code);\n    }\n    return {\n      type: 'moment',\n      hours: hours,\n      minutes: minutes\n    };\n  }\n  if (mode === 1) {\n    let min = 0;\n    let max = 0;\n    if (codeLength === 4) {\n      const number1 = parseInt(code.substring(0, 2));\n      const number2 = parseInt(code.substring(2, 4));\n      min = Math.min(number1, number2);\n      max = Math.max(number1, number2);\n    }\n    if (codeLength === 2) {\n      const number = parseInt(code);\n      min = number;\n      max = number;\n    }\n    return {\n      type: 'range',\n      min: min,\n      max: max\n    };\n  }\n}\n\nexport interface BatchFoundBusPosition {\n  longitude: number;\n  latitude: number;\n}\n\nexport interface BatchFoundBus {\n  CarType: BusEventItem['CarType'];\n  BusStatus: BusEventItem['BusStatus'];\n  BusID: string;\n  CarOnStop: BusEventItem['CarOnStop'];\n  onThisRoute: boolean;\n  position: BatchFoundBusPosition;\n  RouteName: string;\n  RouteID: number;\n  index: number;\n}\n\nexport type BatchFoundBuses = { [key: string]: Array<BatchFoundBus> };\n\nexport function batchFindBusesForRoute(BusEvent: BusEvent, BusData: BusData, Route: SimplifiedRoute, RouteID: number, PathAttributeId: Array<number>): BatchFoundBuses {\n  const result = {} as BatchFoundBuses;\n  const BusDataObj: {\n    [key: string]: BusDataItem;\n  } = {};\n  for (const BusDataItem of BusData) {\n    const thisBusID = BusDataItem.BusID;\n    BusDataObj[thisBusID] = BusDataItem;\n  }\n\n  for (const BusEventItem of BusEvent) {\n    const processedItem = {} as BatchFoundBus;\n\n    // collect data from 'BusEvent'\n    processedItem.CarType = BusEventItem.CarType;\n    processedItem.BusStatus = BusEventItem.BusStatus;\n    processedItem.BusID = BusEventItem.BusID;\n    processedItem.CarOnStop = BusEventItem.CarOnStop;\n\n    // check whether this bus is on the route\n    const thisRouteID = parseInt(BusEventItem.RouteID);\n    const thisBusID = String(BusEventItem.BusID);\n    let isOnThisRoute: boolean = false;\n    let index: number = 0;\n    if (thisRouteID === RouteID || PathAttributeId.indexOf(thisRouteID) > -1 || thisRouteID === RouteID * 10) {\n      isOnThisRoute = true;\n      index = thisBusID.charCodeAt(0) * Math.pow(10, -5);\n    } else {\n      isOnThisRoute = false;\n      index = thisBusID.charCodeAt(0);\n    }\n    processedItem.onThisRoute = isOnThisRoute;\n    processedItem.index = index;\n\n    // collect data from 'BusData'\n    let thisBusData = {} as BusDataItem;\n    if (BusDataObj.hasOwnProperty(thisBusID)) {\n      thisBusData = BusDataObj[thisBusID];\n    } else {\n      continue;\n    }\n    processedItem.position = {\n      latitude: parseFloat(thisBusData.Latitude),\n      longitude: parseFloat(thisBusData.Longitude)\n    };\n\n    // search data from 'Route'\n    let searchedRoute = {};\n    let isRouteSearched = false;\n    for (const key in Route) {\n      const thisRouteItem = Route[key];\n      const pid = thisRouteItem.pid;\n      if (pid.indexOf(thisRouteID) > -1) {\n        searchedRoute = thisRouteItem;\n        isRouteSearched = true;\n        break;\n      }\n    }\n    processedItem.RouteName = isRouteSearched ? searchedRoute.n : '未知路線';\n    processedItem.RouteID = isRouteSearched ? searchedRoute.id : null;\n\n    const StopKey = `s_${BusEventItem.StopID}`;\n    if (!result.hasOwnProperty(StopKey)) {\n      result[StopKey] = [];\n    }\n    result[StopKey].push(processedItem);\n    // Handle multiple buses (of the same route) on a stop\n  }\n  return result;\n}\n\nexport function batchFindBusesForLocation(BusEvent: BusEvent, BusData: BusData, Route: SimplifiedRoute, StopIDList: Array<number>): BatchFoundBuses {\n  const result = {} as BatchFoundBuses;\n  const BusDataObj: {\n    [BusID: string]: BusDataItem;\n  } = {};\n  for (const BusDataItem of BusData) {\n    const thisBusID = BusDataItem.BusID;\n    BusDataObj[thisBusID] = BusDataItem;\n  }\n\n  for (const BusEventItem of BusEvent) {\n    const processedItem = {} as BatchFoundBus;\n\n    const thisStopID = parseInt(BusEventItem.StopID);\n    const thisRouteID = parseInt(BusEventItem.RouteID);\n    const thisBusID = String(BusEventItem.BusID);\n\n    // Check whether this bus is on one of the specified stops\n    if (StopIDList.indexOf(thisStopID) < 0) {\n      continue;\n    }\n\n    processedItem.index = thisBusID.charCodeAt(0);\n    processedItem.onThisRoute = true; // Every entry in Location is stop-route pair\n\n    // Collect data from 'BusEvent'\n    processedItem.CarType = BusEventItem.CarType;\n    processedItem.BusStatus = BusEventItem.BusStatus;\n    processedItem.BusID = BusEventItem.BusID;\n    processedItem.CarOnStop = BusEventItem.CarOnStop;\n\n    // Collect data from 'BusData'\n    let thisBusData = {} as BusDataItem;\n    if (BusDataObj.hasOwnProperty(thisBusID)) {\n      thisBusData = BusDataObj[thisBusID];\n    } else {\n      continue;\n    }\n    processedItem.position = {\n      latitude: parseFloat(thisBusData.Latitude),\n      longitude: parseFloat(thisBusData.Longitude)\n    };\n\n    // Search data from 'Route'\n    let searchedRoute = {};\n    let isRouteSearched = false;\n    for (const key in Route) {\n      const thisRouteItem = Route[key];\n      const pid = thisRouteItem.pid;\n      if (pid.indexOf(thisRouteID) > -1) {\n        searchedRoute = thisRouteItem;\n        isRouteSearched = true;\n        break;\n      }\n    }\n    processedItem.RouteName = isRouteSearched ? searchedRoute.n : '未知路線';\n    processedItem.RouteID = isRouteSearched ? searchedRoute.id : null;\n\n    const StopKey = `s_${thisStopID}`;\n    if (!result.hasOwnProperty(StopKey)) {\n      result[StopKey] = [];\n    }\n    result[StopKey].push(processedItem);\n  }\n  return result;\n}\n\ninterface FormattedBusStatus {\n  onStop: boolean;\n  situation: string;\n  text: string;\n}\n\ninterface FormattedBusPosition {\n  longitude: number;\n  latitude: number;\n}\n\nexport function parseCarType(CarType: '0' | '1' | '2' | '3'): '一般' | '低底盤' | '大復康巴士' | '狗狗友善專車' | '未知類型' {\n  let type = '';\n  switch (CarType) {\n    case '0':\n      type = '一般';\n      break;\n    case '1':\n      type = '低底盤';\n      break;\n    case '2':\n      type = '大復康巴士';\n      break;\n    case '3':\n      type = '狗狗友善專車';\n      break;\n    default:\n      type = '未知類型';\n  }\n  return type;\n}\n\nexport function parseCarOnStop(CarOnStop: '0' | '1'): string {\n  let onStop = '';\n  switch (CarOnStop) {\n    case '0':\n      onStop = '離站';\n      break;\n    case '1':\n      onStop = '進站';\n      break;\n    default:\n      onStop = '未知狀態'; // Handle unexpected values if necessary\n  }\n  return onStop;\n}\n\nexport function parseBusStatus(BusStatus: '0' | '1' | '2' | '3' | '4' | '5' | '99'): string {\n  let situation = '';\n  switch (BusStatus) {\n    case '0':\n      situation = '正常';\n      break;\n    case '1':\n      situation = '車禍';\n      break;\n    case '2':\n      situation = '故障';\n      break;\n    case '3':\n      situation = '塞車';\n      break;\n    case '4':\n      situation = '緊急求援';\n      break;\n    case '5':\n      situation = '加油';\n      break;\n    case '99':\n      situation = '非營運狀態';\n      break;\n    default:\n      situation = '未知狀態'; // Handle unexpected values if necessary\n  }\n  return situation;\n}\n\nexport interface FormattedBus {\n  type: '一般' | '低底盤' | '大復康巴士' | '狗狗友善專車' | '未知類型';\n  carNumber: string;\n  status: FormattedBusStatus;\n  RouteName: string;\n  onThisRoute: boolean;\n  index: number;\n  position: FormattedBusPosition;\n}\n\nexport function formatBus(batchFoundBus: BatchFoundBus): FormattedBus {\n  const result = {} as FormattedBus;\n\n  const CarType = batchFoundBus.CarType;\n  const type = parseCarType(CarType);\n  result.type = type;\n\n  const CarOnStop = batchFoundBus.CarOnStop;\n  const onStop = parseCarOnStop(CarOnStop);\n\n  const BusStatus = batchFoundBus.BusStatus;\n  const situation = parseBusStatus(BusStatus);\n\n  result.carNumber = batchFoundBus.BusID;\n  result.status = {\n    onStop: onStop,\n    situation: situation,\n    text: `${onStop} | ${situation}`\n  };\n  result.RouteName = batchFoundBus.RouteName;\n  result.onThisRoute = batchFoundBus.onThisRoute;\n  result.index = batchFoundBus.index;\n  result.position = batchFoundBus.position;\n  return result;\n}\n","import { lfGetItem, lfSetItem } from '../../storage/index';\nimport { getAPIURL } from '../getAPIURL/index';\nimport { fetchData, setDataReceivingProgress, setDataUpdateTime } from '../loader';\n\nlet SemiTimetableAPIVariableCache_available: boolean = false;\nlet SemiTimetableAPIVariableCache_data: object = {};\n\nexport async function getSemiTimeTable(requestID: string): Promise<object> {\n  async function getData() {\n    const apis = [\n      [0, 12],\n      [1, 12]\n    ].map((e) => ({ url: getAPIURL(e[0], e[1]), e: e }));\n    let result = [];\n    for (const api of apis) {\n      const data = await fetchData(api.url, requestID, `getSemiTimeTable_${api.e[0]}`, 'json');\n      result = result.concat(data.BusInfo);\n      setDataUpdateTime(requestID, data.EssentialInfo.UpdateTime);\n    }\n    return result;\n  }\n\n  const cacheTimeToLive = 60 * 60 * 24 * 14 * 1000;\n  const cacheKey = 'bus_semi_timetable_cache';\n  const cacheTimestamp = await lfGetItem(0, `${cacheKey}_timestamp`);\n  if (cacheTimestamp === null) {\n    const result = await getData();\n    await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n    await lfSetItem(0, cacheKey, JSON.stringify(result));\n    if (!SemiTimetableAPIVariableCache_available) {\n      SemiTimetableAPIVariableCache_available = true;\n      SemiTimetableAPIVariableCache_data = result;\n    }\n    return result;\n  } else {\n    if (new Date().getTime() - parseInt(cacheTimestamp) > cacheTimeToLive) {\n      const result = await getData();\n      await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n      await lfSetItem(0, cacheKey, JSON.stringify(result));\n      return result;\n    } else {\n      if (!SemiTimetableAPIVariableCache_available) {\n        const cache = await lfGetItem(0, cacheKey);\n        SemiTimetableAPIVariableCache_available = true;\n        SemiTimetableAPIVariableCache_data = JSON.parse(cache);\n      }\n      setDataReceivingProgress(requestID, 'getSemiTimeTable_0', 0, true);\n      setDataReceivingProgress(requestID, 'getSemiTimeTable_1', 0, true);\n      setDataUpdateTime(requestID, -1);\n      return SemiTimetableAPIVariableCache_data;\n    }\n  }\n}\n","import { lfGetItem, lfSetItem } from '../../storage/index';\nimport { getAPIURL } from '../getAPIURL/index';\nimport { fetchData, setDataReceivingProgress, setDataUpdateTime } from '../loader';\n\nlet TimetableAPIVariableCache_available: boolean = false;\nlet TimetableAPIVariableCache_data: object = {};\n\nexport async function getTimeTable(requestID: string): Promise<object> {\n  async function getData() {\n    const apis = [\n      [0, 14],\n      [1, 14]\n    ].map((e) => ({ url: getAPIURL(e[0], e[1]), e: e }));\n    let result = [];\n    for (const api of apis) {\n      const data = await fetchData(api.url, requestID, `getTimeTable_${api.e[0]}`, 'json');\n      result = result.concat(data.BusInfo);\n      setDataUpdateTime(requestID, data.EssentialInfo.UpdateTime);\n    }\n    return result;\n  }\n\n  const cacheTimeToLive = 60 * 60 * 24 * 14 * 1000;\n  const cacheKey = 'bus_timetable_cache';\n  const cacheTimestamp = await lfGetItem(0, `${cacheKey}_timestamp`);\n  if (cacheTimestamp === null) {\n    const result = await getData();\n    await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n    await lfSetItem(0, cacheKey, JSON.stringify(result));\n    if (!TimetableAPIVariableCache_available) {\n      TimetableAPIVariableCache_available = true;\n      TimetableAPIVariableCache_data = result;\n    }\n    return result;\n  } else {\n    if (new Date().getTime() - parseInt(cacheTimestamp) > cacheTimeToLive) {\n      const result = await getData();\n      await lfSetItem(0, `${cacheKey}_timestamp`, new Date().getTime());\n      await lfSetItem(0, cacheKey, JSON.stringify(result));\n      return result;\n    } else {\n      if (!TimetableAPIVariableCache_available) {\n        const cache = await lfGetItem(0, cacheKey);\n        TimetableAPIVariableCache_available = true;\n        TimetableAPIVariableCache_data = JSON.parse(cache);\n      }\n      setDataReceivingProgress(requestID, 'getTimeTable_0', 0, true);\n      setDataReceivingProgress(requestID, 'getTimeTable_1', 0, true);\n      setDataUpdateTime(requestID, -1);\n      return TimetableAPIVariableCache_data;\n    }\n  }\n}\n"],"names":["StopAPIVariableCache_available","StopAPIVariableCache_data","simplifyStop","_x","_simplifyStop","apply","arguments","_asyncToGenerator","array","worker","Worker","URL","Promise","resolve","reject","onmessage","e","data","terminate","onerror","message","postMessage","getStop","_x2","_getStop","requestID","getData","_getData","_step","result","_iterator","_createForOfIteratorHelper","map","url","getAPIURL","s","n","done","api","value","fetchData","concat","BusInfo","setDataUpdateTime","EssentialInfo","UpdateTime","err","f","cacheKey","cacheTimestamp","lfGetItem","simplified_result","lfSetItem","Date","getTime","JSON","stringify","parseInt","cache","parse","setDataReceivingProgress","parseEstimateTime","EstimateTime","mode","time","code","text","formatTime","parseTimeCode","codeLength","length","hours","minutes","substring","type","min","max","number1","number2","Math","number","batchFindBusesForRoute","BusEvent","BusData","Route","RouteID","PathAttributeId","BusDataObj","BusDataItem","BusID","_step2","_iterator2","BusEventItem","processedItem","CarType","BusStatus","CarOnStop","thisRouteID","thisBusID","String","isOnThisRoute","index","indexOf","charCodeAt","pow","onThisRoute","thisBusData","hasOwnProperty","position","latitude","parseFloat","Latitude","longitude","Longitude","searchedRoute","isRouteSearched","key","thisRouteItem","pid","RouteName","id","StopKey","StopID","push","batchFindBusesForLocation","StopIDList","_step3","_iterator3","_step4","_iterator4","thisStopID","parseCarType","parseCarOnStop","onStop","parseBusStatus","situation","formatBus","batchFoundBus","carNumber","status","SemiTimetableAPIVariableCache_available","SemiTimetableAPIVariableCache_data","getSemiTimeTable","_getSemiTimeTable","TimetableAPIVariableCache_available","TimetableAPIVariableCache_data","getTimeTable","_getTimeTable"],"ignoreList":[],"sourceRoot":""}