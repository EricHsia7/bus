"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(t,e,a){a.d(e,{a:()=>pt,b:()=>X,c:()=>ut});var i=a(467),s=a(5767),r=a(9566),n=a(2757),d=a(3422),o=a(5314),l=a(3459),u=a(8179),p=a(7968),c=a(8024),h=a(5579),f=a(4537),v=a(904),b=a(9119),g=a(3041),m=a(752),A=a(1351),y=(0,u.c)(".kh"),L=(0,u.e)(y,".th"),C=(0,u.e)(L,".yh"),j=(0,u.e)(C,"span"),k=(0,u.e)(L,".xh"),x=(0,u.e)(y,".ji"),w=(0,u.e)(L,".zh"),T=(0,u.e)(w,"._h"),_=(0,u.e)(L,".ci"),$=(0,u.e)(_,".di"),I=(0,u.e)(L,".fi .gi"),S={},M=!1,E=!1,N=0,P=0,D=0,F={},R=0,q=!1,B=15e3,H=5e3,Q=15e3,z=!0,U=0,W=0,G="",J=!1,K=!1,O=!1,V="";function X(){x.addEventListener("touchstart",function(){N=Math.round(x.scrollLeft/R)},{passive:!0}),x.addEventListener("scroll",function(t){q=!0;var e=t.target.scrollLeft/R;P=e>N?N+1:N-1;var a=e-N,i=Math.abs(a);i>1&&(a>0?(N=Math.floor(e),P=N+1):(N=Math.ceil(e),P=N-1),i=Math.abs(e-N));var s=F[`g_${N}`]||{width:0,offset:0},r=F[`g_${P}`]||{width:0,offset:0},n=s.width+(r.width-s.width)*i,d=-1*(s.offset+(r.offset-s.offset)*i)+.5*R-.5*n;Y(D,d,n-20,e)},{passive:!0}),x.addEventListener("scrollend",function(t){var e=t.target.scrollLeft/R;N=Math.round(e),q=!1},{passive:!0})}function Y(t,e,a,i){x.style.setProperty("--jh",t.toString()),$.style.setProperty("--nh",a.toString()),T.style.setProperty("--oh",`${e.toString()}px`),T.style.setProperty("--qh",i.toString())}function Z(t){var e=t;if(J){var a=e.detail.progress-1;I.style.setProperty("--rh",a.toString())}"end"===e.detail.stage&&document.removeEventListener(e.detail.target,Z)}function tt(){var t=(0,u.a)();t.classList.add("ti"),t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var e=(0,u.a)();e.classList.add("ui");var a=(0,u.a)();a.classList.add("vi");var i=(0,u.a)();i.classList.add("xi"),i.setAttribute("code","-1"),i.setAttribute("displayed","false");var s=(0,u.a)();s.classList.add("yi"),s.setAttribute("code","-1"),s.setAttribute("displayed","true"),a.appendChild(i),a.appendChild(s);var r=(0,u.a)();r.classList.add("hj");var n=(0,u.a)();n.classList.add("ij");var d=(0,u.a)();d.classList.add("jj");var o=(0,u.a)();o.classList.add("mj");var l=(0,u.a)();l.classList.add("cb"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var p=(0,u.a)();p.classList.add("db"),p.setAttribute("code","0"),p.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(p);var c=(0,u.a)();c.classList.add("lj"),c.appendChild((0,f.b)("keyboard_arrow_down")),c.onclick=function(){!function(t){var e=(0,u.e)(t,".nj"),a=t.parentElement,i=(0,u.f)(t,"ti"),s=i.length,r=a.getBoundingClientRect(),n=t.getBoundingClientRect().top-r.top,d="true"===t.getAttribute("stretched"),o="true"===t.getAttribute("animation");if(o){var l=d?"2":"1";t.setAttribute("stretching","true"),t.style.setProperty("--ri",`${n}px`);for(var p=0;p<s;p++){var c=i[p];c.setAttribute("push-direction",l),c.setAttribute("push-state","1")}t.addEventListener("transitionend",function(){for(var e=0;e<s;e++){var a=i[e];a.setAttribute("push-direction","0"),a.setAttribute("push-state","0")}t.setAttribute("stretching","false")},{once:!0}),t.addEventListener("transitionstart",function(){for(var t=0;t<s;t++){i[t].setAttribute("push-state","2")}},{once:!0})}d?(o?e.addEventListener("transitionend",function(){e.setAttribute("displayed","false")},{once:!0}):e.setAttribute("displayed","false"),t.setAttribute("stretched","false")):(e.setAttribute("displayed","true"),t.setAttribute("stretched","true"))}(t)};var h=(0,u.a)();h.classList.add("kj"),d.appendChild(o),d.appendChild(c),d.appendChild(h),e.appendChild(a),e.appendChild(r),e.appendChild(n),e.appendChild(d);var v=(0,u.a)();v.classList.add("nj"),v.setAttribute("displayed","false");var b=(0,u.a)();b.classList.add("oj");var g=(0,u.a)();g.classList.add("pj"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var m=(0,u.a)();m.classList.add("qj"),m.appendChild((0,f.b)("directions_bus")),g.appendChild(m),g.appendChild(document.createTextNode("公車")),g.onclick=function(){ct(t,0)};var A=(0,u.a)();A.classList.add("pj"),A.setAttribute("highlighted","false"),A.setAttribute("type","tab"),A.setAttribute("code","1");var y=(0,u.a)();y.classList.add("qj"),y.appendChild((0,f.b)("departure_board")),A.appendChild(y),A.appendChild(document.createTextNode("抵達時間")),A.onclick=function(){ct(t,1)};var L=(0,u.a)();L.classList.add("pj"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var C=(0,u.a)();C.classList.add("qj"),C.appendChild((0,f.b)("folder")),L.appendChild(C),L.appendChild(document.createTextNode("儲存"));var j=(0,u.a)();j.classList.add("pj"),j.setAttribute("highlighted","false"),j.setAttribute("type","schedule-notification"),j.setAttribute("enabled","true");var k=(0,u.a)();k.classList.add("qj"),k.appendChild((0,f.b)("notifications")),j.appendChild(k),j.appendChild(document.createTextNode("通知")),b.appendChild(g),b.appendChild(A),b.appendChild(L),b.appendChild(j);var x=(0,u.a)();x.classList.add("rj"),x.setAttribute("displayed","true");var w=(0,u.a)();return w.classList.add("sj"),w.setAttribute("displayed","false"),v.appendChild(b),v.appendChild(x),v.appendChild(w),t.appendChild(e),t.appendChild(v),t}function et(){var t=(0,u.a)();t.classList.add("ki");var e=(0,u.a)();e.classList.add("li");var a=(0,u.a)();a.classList.add("mi"),e.appendChild(a);var i=(0,u.a)();return i.classList.add("si"),t.appendChild(e),t.appendChild(i),t}function at(){var t=(0,u.a)();t.classList.add("ai");var e=document.createElement("span");return t.appendChild(e),t}function it(){var t=(0,u.a)();t.classList.add("ni");var e=(0,u.a)();e.classList.add("oi"),e.appendChild((0,f.a)());var a=(0,u.a)();return a.classList.add("pi"),t.appendChild(e),t.appendChild(a),t}function st(){var t=(0,u.a)();t.classList.add("tj"),t.setAttribute("on-this-route","false");var e=(0,u.a)();e.classList.add("vj");var a=(0,u.a)();a.classList.add("xj"),a.appendChild((0,f.b)("directions_bus"));var i=(0,u.a)();i.classList.add("zj");var s=(0,u.a)();s.classList.add("bk");var r=(0,u.a)();r.classList.add("dk");var n=(0,u.a)();n.classList.add("ek");var d=(0,u.a)();return d.classList.add("fk"),e.appendChild(a),e.appendChild(i),t.appendChild(e),s.appendChild(r),s.appendChild(n),s.appendChild(d),t.appendChild(s),t}function rt(){var t=(0,u.a)();t.classList.add("uj");var e=(0,u.a)();e.classList.add("wj");var a=(0,u.a)();a.classList.add("yj"),a.appendChild((0,f.b)("calendar_view_day"));var i=(0,u.a)();i.classList.add("_j");var s=(0,u.a)();s.classList.add("ak");var r=(0,u.a)();return r.classList.add("ck"),e.appendChild(a),e.appendChild(i),e.appendChild(s),t.appendChild(e),t.appendChild(r),t}function nt(t,e,a){var i,s;function n(t,i,s){function n(t,a,i){var s=(0,u.e)(t,".ui"),r=(0,u.e)(s,".mj"),n=(0,u.e)(r,".cb"),d=(0,u.e)(r,".db");if(n.setAttribute("code",a.status.code.toString()),n.innerText=a.status.text,!e&&i){var o=t.getBoundingClientRect(),l=o.top,p=o.left,c=o.bottom,h=o.right,f=window.innerWidth,v=window.innerHeight;if(c>0&&l<v&&h>0&&p<f)return d.addEventListener("animationend",function(){d.setAttribute("code",a.status.code.toString()),d.innerText=a.status.text,d.classList.remove("nb"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("nb")}d.setAttribute("code",a.status.code.toString()),d.innerText=a.status.text}function o(t,a,i){var s=(0,u.e)(t,".ui"),r=(0,u.e)(s,".vi"),n=(0,u.e)(r,".xi"),d=(0,u.e)(r,".yi");if(n.setAttribute("code",a.ranking.code.toString()),n.innerText=a.ranking.text,!e&&i){var o=t.getBoundingClientRect(),l=o.top,p=o.left,c=o.bottom,h=o.right,f=window.innerWidth,v=window.innerHeight;if(c>0&&l<v&&h>0&&p<f)return d.addEventListener("animationend",function(){d.setAttribute("code",a.ranking.code.toString()),d.innerText=a.ranking.text,d.classList.remove("gj"),n.setAttribute("displayed","false")},{once:!0}),n.setAttribute("displayed","true"),void d.classList.add("gj")}d.setAttribute("code",a.ranking.code.toString()),d.innerText=a.ranking.text}function l(t,e){var a=(0,u.e)(t,".ui");(0,u.e)(a,".hj").innerText=e.route_direction}function p(t,e){var a=(0,u.e)(t,".ui");(0,u.e)(a,".ij").innerText=e.route_name}function f(t,e){var a=(0,u.e)(t,".nj"),i=(0,u.e)(a,".rj"),s=Array.from((0,u.d)(i,".tj")),r=s.length,n=e.buses.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var p=st();o.appendChild(p),s.push(p)}i.append(o)}else if(d>0)for(var h=r-1,f=r-d-1;h>f;h--)s[h].remove(),s.splice(h,1);for(var v=0;v<n;v++){var b=e.buses[v],g=s[v],m=(0,u.e)(g,".vj"),A=(0,u.e)(m,".zj"),y=(0,u.e)(g,".bk"),L=(0,u.e)(y,".dk"),C=(0,u.e)(y,".ek"),j=(0,u.e)(y,".fk");g.setAttribute("on-this-route",(0,c.a)(b.onThisRoute)),A.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,C.innerText=`狀態：${b.status.text}`,j.innerText=`類型：${b.type}`}i.setAttribute("empty",(0,c.a)(0===n))}function v(t,e){var a=(0,u.e)(t,".nj"),i=(0,u.e)(a,".sj"),s=Array.from((0,u.d)(i,".uj")),r=s.length,n=e.busArrivalTimes.length,d=r-n;if(d<0){for(var o=new DocumentFragment,l=0;l>d;l--){var p=rt();o.appendChild(p),s.push(p)}i.append(o)}else if(d>0)for(var f=r-1,v=r-d-1;f>v;f--)s[f].remove(),s.splice(f,1);for(var b=0;b<n;b++){var g=e.busArrivalTimes[b],m=s[b],A=(0,u.e)(m,".wj"),y=(0,u.e)(A,"._j"),L=(0,u.e)(A,".ak"),C=(0,u.e)(m,".ck");y.innerText=g.personalSchedule.name,L.innerText=`週${(0,h.g)(g.day).name} ${(0,h.i)(g.personalSchedule.period.start)} - ${(0,h.i)(g.personalSchedule.period.end)}`,C.innerHTML=g.chart}i.setAttribute("empty",(0,c.a)(0===n))}function b(t,e){e&&t.setAttribute("stretched","false")}function A(t,e){t.setAttribute("animation",(0,c.a)(e))}function y(t,e){t.setAttribute("skeleton-screen",(0,c.a)(e))}function L(t,e){var a=(0,u.e)(t,".nj"),i=(0,u.e)(a,".oj"),s=(0,u.e)(i,'.pj[type="save-to-folder"]');s.onclick=function(){(0,g.b)("stop",[e.stopId,e.routeId],s)},(0,r.e)("stop",e.stopId).then(function(t){s.setAttribute("highlighted",(0,c.a)(t))})}function C(t,e){var a=(0,u.e)(t,".nj"),i=(0,u.e)(a,".oj"),s=(0,u.e)(i,'.pj[type="schedule-notification"]');s.onclick=function(){(0,m.b)(s,e.stopId,e.routeId,e.status.time)};var r=(0,d.r)(e.stopId);s.setAttribute("highlighted",(0,c.a)(r))}null==s?(n(t,i,a),o(t,i,a),l(t,i),p(t,i),f(t,i),v(t,i),b(t,e),A(t,a),y(t,e),L(t,i),C(t,i)):(i.status.time!==s.status.time&&(n(t,i,a),C(t,i)),s.ranking.number===i.ranking.number&&s.ranking.code===i.ranking.code||o(t,i,a),s.stopId!==i.stopId&&(l(t,i),p(t,i),L(t,i)),(0,c.b)(s.buses,i.buses)||f(t,i),(0,c.b)(s.busArrivalTimes,i.busArrivalTimes)||v(t,i),a!==M&&A(t,a),e!==E&&(b(t,e),y(t,e)))}function o(t,i,s){function r(t,e){var a=(0,u.e)(t,".oi");(0,f.c)(a,e.icon)}function n(t,e){(0,u.e)(t,".pi").innerHTML=e.value}function d(t,e){t.setAttribute("animation",(0,c.a)(e))}function o(t,e){t.setAttribute("skeleton-screen",(0,c.a)(e))}null==s?(r(t,i),n(t,i),d(t,a),o(t,e)):((0,c.b)(s.icon,i.icon)||r(t,i),(0,c.b)(s.value,i.value)||n(t,i),a!==M&&d(t,a),e!==E&&o(t,e))}var l=(0,v.e)("window"),b=l.width,y=l.height,L=t.groupQuantity,$=t.itemQuantity,I=t.groupedItems,P=t.groups;D=L,R=b;for(var B=0,H=0;H<L;H++){var Q=`g_${H}`,z=(0,p.d)(P[Q].name,500,"17px",'"Noto Sans TC", sans-serif')+20;F[Q]={width:z,offset:B},B+=z}if(F[`g_${L}`]={width:0,offset:B},!q){var U=F[`g_${N}`],W=-1*U.offset+.5*R-.5*U.width,G=U.width-20;Y(D,W,G,N)}(null===(i=S)||void 0===i?void 0:i.hash)!==t.hash&&(k.onclick=function(){(0,A.b)(t.hash)}),(null===(s=S)||void 0===s?void 0:s.LocationName)!==t.LocationName&&(j.innerText=t.LocationName),M!==a&&(C.setAttribute("animation",(0,c.a)(a)),w.setAttribute("animation",(0,c.a)(a))),E!==e&&(C.setAttribute("skeleton-screen",(0,c.a)(e)),w.setAttribute("skeleton-screen",(0,c.a)(e)),_.setAttribute("skeleton-screen",(0,c.a)(e)));var J=Array.from((0,u.d)(x,".ki")),K=Array.from((0,u.d)(T,".ai")),O=J.length;if(L!==O){var V=O-L;if(V<0){for(var X=new DocumentFragment,Z=new DocumentFragment,nt=0;nt>V;nt--){var dt=et();X.appendChild(dt),J.push(dt);var ot=at();Z.appendChild(ot),K.push(ot)}x.append(X),T.append(Z)}else if(V>0)for(var lt=O-1,ut=O-V-1;lt>ut;lt--)J[lt].remove(),J.splice(lt,1),K[lt].remove(),K.splice(lt,1)}for(var pt=(0,u.d)(x,".ki"),ct=0;ct<L;ct++){var ht=`g_${ct}`,ft=pt[ct],vt=(0,u.e)(ft,".li"),bt=(0,u.e)(vt,".mi"),gt=Array.from((0,u.d)(bt,".ni")),mt=gt.length,At=P[ht].properties.length;if(At!==mt){var yt=mt-At;if(yt<0){for(var Lt=new DocumentFragment,Ct=0;Ct>yt;Ct--){var jt=it();Lt.appendChild(jt),gt.push(jt)}bt.append(Lt)}else if(yt>0)for(var kt=mt-1,xt=mt-yt-1;kt>xt;kt--)gt[kt].remove(),gt.splice(kt,1)}var wt=(0,u.e)(ft,".si"),Tt=Array.from((0,u.d)(wt,".ti")),_t=Tt.length;if($[ht]!==_t){var $t=_t-$[ht];if($t<0){for(var It=new DocumentFragment,St=0;St>$t;St--){var Mt=tt();It.appendChild(Mt),Tt.push(Mt)}wt.append(It)}else if($t>0)for(var Et=_t-1,Nt=_t-$t-1;Et>Nt;Et--)Tt[Et].remove(),Tt.splice(Et,1)}var Pt=K[ct];(0,u.e)(Pt,"span").innerText=P[ht].name,Pt.style.setProperty("--lh",`${F[ht].offset}px`),Pt.style.setProperty("--mh",`${F[ht].width}px`),Pt.style.setProperty("--bi",ct.toString());for(var Dt=0;Dt<At;Dt++){var Ft=P[ht].properties[Dt],Rt=gt[Dt];if((0,c.e)(S,"groups"))if((0,c.e)(S.groups,ht))if(S.groups[ht].properties[Dt])o(Rt,Ft,S.groups[ht].properties[Dt]);else o(Rt,Ft,null);else o(Rt,Ft,null);else o(Rt,Ft,null)}for(var qt=0;qt<$[ht];qt++){var Bt=Tt[qt],Ht=I[ht][qt];if((0,c.e)(S,"groupedItems"))if((0,c.e)(S.groupedItems,ht))if(S.groupedItems[ht][qt])n(Bt,Ht,S.groupedItems[ht][qt]);else n(Bt,Ht,null);else n(Bt,Ht,null);else n(Bt,Ht,null)}}T.style.setProperty("--ph",`${B}px`),S=t,M=a,E=e}function dt(){return ot.apply(this,arguments)}function ot(){return(ot=(0,i.a)(function*(){var t=(0,l.b)("playing_animation"),e=(0,l.b)("refresh_interval"),a=(0,v.e)("location-bus-arrival-time-chart");z=e.dynamic,B=e.baseInterval,J=!0,G=(0,c.c)(),I.setAttribute("refreshing","true"),I.classList.remove("ii"),document.addEventListener(G,Z);var i=yield(0,n.a)(V,a.width,a.height,G);nt(i,!1,t);var r=0;z&&(r=yield(0,s.c)()),U=(new Date).getTime(),W=z?Math.max(U+H,i.dataUpdateTime+B/r):U+B,Q=Math.max(H,W-U),J=!1,I.setAttribute("refreshing","false"),I.style.setProperty("--sh",`${Q}ms`),I.classList.add("ii")})).apply(this,arguments)}function lt(){dt().then(function(){K?setTimeout(function(){lt()},Math.max(H,W-(new Date).getTime())):O=!1}).catch(function(t){K?((0,b.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){lt()},1e4)):O=!1})}function ut(t){(0,v.d)("Location"),(0,o.e)("location",t),V=t,N=0,F={},y.setAttribute("displayed","true"),x.scrollLeft=0,x.focus(),function(t){for(var e=(0,l.b)("playing_animation"),a=(0,v.e)("window"),i=(a.width,a.height),s={g_0:Math.floor(i/50)+5,g_1:Math.floor(i/50)+5},r={},n=0;n<2;n++){var d=`g_${n}`;r[d]=[];for(var o=0;o<s[d];o++)r[d].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}nt({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:s,LocationName:"載入中",hash:t,dataUpdateTime:0},!0,e)}(t),K||(K=!0,O?dt():(O=!0,lt())),(0,v.a)()}function pt(){y.setAttribute("displayed","false"),K=!1,(0,v.c)()}function ct(t,e){var a=(0,u.e)(t,".nj"),i=(0,u.e)(a,".oj"),s=(0,u.d)(i,'.pj[highlighted="true"][type="tab"]');for(var r of s)r.setAttribute("highlighted","false");switch((0,u.e)(i,`.pj[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,u.e)(t,".rj").setAttribute("displayed","true"),(0,u.e)(t,".sj").setAttribute("displayed","false");break;case 1:(0,u.e)(t,".rj").setAttribute("displayed","false"),(0,u.e)(t,".sj").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=5ee9394ff5f5ed76b4f8.js.map