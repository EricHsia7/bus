(self.webpackChunkbus=self.webpackChunkbus||[]).push([[3305],{3305(r,t,e){"use strict";var n=e(5241).encode;function o(r,t,e){return n(r,t,e)}function u(r){var t=Math.hypot(r),e=r.length,n=new Float32Array(e);if(t>0){for(var o=1/t,u=e;u>0;u--)n[u]=r[u]*o;return Array.from(n)}return r}function a(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return i(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,o=function(){};return{s:o,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,d=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return a=r.done,r},e:function(r){d=!0,u=r},f:function(){try{a||null==e.return||e.return()}finally{if(d)throw u}}}}function i(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}self.onmessage=function(r){var t=function(r){var t,e={},n=a(r);try{for(n.s();!(t=n.n()).done;){var i=t.value,d=`r_${i.routeId}`;e.hasOwnProperty(d)||(e[d]=[]),e[d].push(i)}}catch(r){n.e(r)}finally{n.f()}for(var l in e)e[l].sort(function(r,t){return r.seqNo-t.seqNo});var f,s={},c=a(r);try{for(c.s();!(f=c.n()).done;){for(var v=f.value,h=`r_${v.routeId}`,g=parseFloat(v.longitude),p=parseFloat(v.latitude),b=[0,0],y=e[h],m=y.length,_=null,I=0;I<m;I++)if(y[I].Id===v.Id){var w=0;I<m-1&&(w=I+1),_=y[w]}if(_)b=u([parseFloat(_.longitude)-g,parseFloat(_.latitude)-p]);var x=`l_${v.stopLocationId}`;if(s.hasOwnProperty(x))s[x].r.indexOf(v.routeId)<0&&s[x].r.push(v.routeId),s[x].s.indexOf(v.Id)<0&&(s[x].s.push(v.Id),s[x].v.push(b)),s[x].a.push(v.address);else{var A={};A.n=v.nameZh,A.lo=g,A.la=p,A.g=o(p,g,6),A.r=[v.routeId],A.s=[v.Id],A.v=[b],A.a=[v.address],A.id=v.stopLocationId,s[x]=A}}}catch(r){c.e(r)}finally{c.f()}return s}(r.data);self.postMessage(t)}},5241(r){for(var t="0123456789bcdefghjkmnpqrstuvwxyz",e={},n=0;n<32;n++)e[t.charAt(n)]=n;var o="auto",u=-90,a=90,i=-180,d=180,l=[0,5,7,8,11,12,13,15,16,17,18],f=function(r,e,n){if(n===o){if("number"==typeof r||"number"==typeof e)throw new Error("string notation required for auto precision.");var f=r.split(".")[1].length,s=e.split(".")[1].length,c=Math.max(f,s);n=l[c]}else void 0===n&&(n=9);for(var v,h=[],g=0,p=0,b=0,y=a,m=u,_=d,I=i;h.length<n;)if(p%2==0?e>(v=(_+I)/2)?(b=1+(b<<1),I=v):(b=0+(b<<1),_=v):r>(v=(y+m)/2)?(b=1+(b<<1),m=v):(b=0+(b<<1),y=v),p++,5===++g){var w=t[b];h.push(w),g=0,b=0}return h.join("")},s=function(r,t,e){e=e||52;for(var n,o=0,l=a,f=u,s=d,c=i,v=0;o<e;)v*=2,o%2==0?t>(n=(s+c)/2)?(v+=1,c=n):s=n:r>(n=(l+f)/2)?(v+=1,f=n):l=n,o++;return v},c=function(r){for(var t,n=!0,o=a,l=u,f=d,s=i,c=0,v=0,h=r.length;v<h;v++){var g=r[v].toLowerCase();c=e[g];for(var p=4;p>=0;p--){var b=c>>p&1;n?(t=(f+s)/2,1===b?s=t:f=t):(t=(o+l)/2,1===b?l=t:o=t),n=!n}}return[l,s,o,f]},v=function(r,t){for(var e=a,n=u,o=d,l=i,f=0,s=(t=t||52)/2,c=0;c<s;c++)f=h(r,2*(s-c)-1),0===h(r,2*(s-c)-2)?e=(e+n)/2:n=(e+n)/2,0===f?o=(o+l)/2:l=(o+l)/2;return[n,l,e,o]};function h(r,t){return r/Math.pow(2,t)&1}var g=function(r){var t=c(r),e=(t[0]+t[2])/2,n=(t[1]+t[3])/2;return{latitude:e,longitude:n,error:{latitude:t[2]-e,longitude:t[3]-n}}},p=function(r,t){var e=v(r,t),n=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return{latitude:n,longitude:o,error:{latitude:e[2]-n,longitude:e[3]-o}}},b=function(r,t){var e=g(r),n=e.latitude+t[0]*e.error.latitude*2,o=e.longitude+t[1]*e.error.longitude*2;return o=m(o),n=_(n),f(n,o,r.length)},y=function(r,t,e){var n=p(r,e=e||52),o=n.latitude+t[0]*n.error.latitude*2,u=n.longitude+t[1]*n.error.longitude*2;return u=m(u),o=_(o),s(o,u,e)};function m(r){return r>d?i+r%d:r<i?d+r%d:r}function _(r){return r>a?a:r<u?u:r}var I={ENCODE_AUTO:o,encode:f,encode_uint64:s,encode_int:s,decode:g,decode_int:p,decode_uint64:p,decode_bbox:c,decode_bbox_uint64:v,decode_bbox_int:v,neighbor:b,neighbor_int:y,neighbors:function(r){var t,e,n=r.length,o=g(r),u=o.latitude,a=o.longitude,i=2*o.error.latitude,d=2*o.error.longitude;function l(r,o){return t=u+r*i,e=m(e=a+o*d),t=_(t),f(t,e,n)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},neighbors_int:function(r,t){var e,n,o=p(r,t=t||52),u=o.latitude,a=o.longitude,i=2*o.error.latitude,d=2*o.error.longitude;function l(r,o){return e=u+r*i,n=m(n=a+o*d),e=_(e),s(e,n,t)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},bboxes:function(r,t,e,n,o){for(var u=f(r,t,o=o||9),a=f(e,n,o),i=g(u),d=2*i.error.latitude,l=2*i.error.longitude,s=c(u),v=c(a),h=Math.round((v[0]-s[0])/d),p=Math.round((v[1]-s[1])/l),y=[],m=0;m<=h;m++)for(var _=0;_<=p;_++)y.push(b(u,[m,_]));return y},bboxes_int:function(r,t,e,n,o){for(var u=s(r,t,o=o||52),a=s(e,n,o),i=p(u,o),d=2*i.error.latitude,l=2*i.error.longitude,f=v(u,o),c=v(a,o),h=Math.round((c[0]-f[0])/d),g=Math.round((c[1]-f[1])/l),b=[],m=0;m<=h;m++)for(var _=0;_<=g;_++)b.push(y(u,[m,_],o));return b}};r.exports=I}}]);
//# sourceMappingURL=3305.cce05ad679c303a0e5ba.js.map