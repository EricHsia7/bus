"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[852],{7123(e,a,t){t.d(a,{R:()=>y});var r=t(467),n=t(7183),i=t(8024),o=t(6483),s=t(6802),u=t(7810),d=t(2063),f=t(8011),p=t(4293),l=t(1932),v=t(424),h=t(2303),c=t(6788),m=t(3459),g=t(1531);function y(e,a,t,r,n){return _.apply(this,arguments)}function _(){return(_=(0,r.A)(function*(e,a,t,r,y){(0,c.Mf)(y,"getRoute_0",0,!1),(0,c.Mf)(y,"getRoute_1",0,!1),(0,c.Mf)(y,"getStop_0",0,!1),(0,c.Mf)(y,"getStop_1",0,!1),(0,c.Mf)(y,"getLocation_0",0,!1),(0,c.Mf)(y,"getLocation_1",0,!1),(0,c.Mf)(y,"getSegmentBuffers_0",0,!1),(0,c.Mf)(y,"getSegmentBuffers_1",0,!1),(0,c.Mf)(y,"getEstimateTime_0",0,!1),(0,c.Mf)(y,"getEstimateTime_1",0,!1),(0,c.Mf)(y,"getBusEvent_0",0,!1),(0,c.Mf)(y,"getBusEvent_1",0,!1),(0,c.Mf)(y,"getBusData_0",0,!1),(0,c.Mf)(y,"getBusData_1",0,!1);var _=yield(0,p.a)(y,!0),S=yield(0,v.T)(y),B=yield(0,f.g)(y,0),D=yield(0,f.g)(y,1),k=yield(0,f.g)(y,2),I=yield(0,l.L)(y),b=yield(0,d.K)(y),Q=yield(0,u.J)(y),T=yield(0,s.d)(y),$=yield(0,o.Io)(t,r),w=(0,h.w_)(Q,T,_,e,a),L=!1,M={};(0,i.mQ)(I,`r_${e}`)&&(L=!0,M=I[`r_${e}`]);var R=(0,m.Js)("time_formatting_mode"),E=[],U=[];for(var C of b){var P={},H=C.RouteID;if([e,10*e].includes(H)||a.includes(H)){P.status=(0,h.$Q)(null==C?void 0:C.EstimateTime,R);var x=`s_${C.StopID}`,A={};if(!(0,i.mQ)(S,x))continue;A=S[x],P.id=C.StopID,P.sequence=A.seqNo,P.goBack=A.goBack;var O=`l_${A.stopLocationId}`,G={};if(!(0,i.mQ)(B,O))continue;G=B[O],P.name=G.n;var W=G.r.length;P.overlappingRoutes=[];for(var q=0;q<W;q++){var N=G.r[q];if(N!==e){var F=`r_${N}`;if((0,i.mQ)(_,F)){var z=_[F],Z={name:z.n,RouteEndPoints:{RouteDeparture:z.dep,RouteDestination:z.des,text:`${z.dep} ↔ ${z.des}`,html:`<span>${z.dep}</span><span>↔</span><span>${z.des}</span>`},RouteID:z.id,PathAttributeId:z.pid};P.overlappingRoutes.push(Z)}}}P.position={longitude:G.lo,latitude:G.la},U.push({latitude:G.la,longitude:G.lo,id:C.StopID});var V=G.g,J=[];for(var j of((0,i.mQ)(k,V)&&(J=k[V]),P.nearbyLocations=[],J)){var K=`ml_${j.hash}`;if((0,i.mQ)(D,K)){var Y=D[K],X={name:Y.n,distance:0|(0,n.aV)(Y.la[0],Y.lo[0],G.la,G.lo),hash:Y.hash};P.nearbyLocations.push(X)}}for(var ee of(P.nearbyLocations.sort(function(e,a){return e.distance-a.distance}),P.buses=[],G.s)){var ae=`s_${ee}`;if((0,i.mQ)(w,ae))for(var te=w[ae].length-1;te>=0;te--)P.buses.push((0,h.s$)(w[ae][te]))}P.buses.sort(function(e,a){return e.index-a.index});var re=[];(0,i.mQ)($,x)&&(re=$[x]),P.busArrivalTimes=re;var ne=!1,ie=!1,oe=!1,se=!1;if(L){var ue=`g_${P.goBack}`,de=[];for(var fe of((0,i.mQ)(M,ue)?de=M[ue]:"1"===P.goBack&&(se=!0,de=M.g_0),de))fe.OriginStopID!==C.StopID&&fe.DestinationStopID!==C.StopID||(ne=!0),se?(fe.OriginStopID===C.StopID&&(oe=!0),fe.DestinationStopID===C.StopID&&(ie=!0)):(fe.OriginStopID===C.StopID&&(ie=!0),fe.DestinationStopID===C.StopID&&(oe=!0))}P.segmentBuffer={isSegmentBuffer:ne,isStartingPoint:ie,isEndingPoint:oe},E.push(P)}}E.sort(function(e,a){return e.sequence-a.sequence});for(var pe=(0,g.uQ)(U,450),le=!1,ve=!1,he={},ce=0,me={},ge=E.length,ye=0;ye<ge;ye++){var _e=E[ye],Se=E[ye+1]||_e,Be=0;if(_e.buses.length>0&&_e.buses[0].onThisRoute){var De=[_e.buses[0].position.longitude,_e.buses[0].position.latitude],ke=De[0],Ie=De[1],be=[_e.position.longitude,_e.position.latitude],Qe=be[0],Te=be[1],$e=[Se.position.longitude,Se.position.latitude],we=$e[0],Le=$e[1];if((ke-Qe)*(we-ke)+(Ie-Te)*(Le-Ie)>=0){var Me=Math.hypot(ke-Qe,Ie-Te),Re=Math.hypot(ke-we,Ie-Le);Be=Math.max(0,Math.min(Me/(Me+Re),1))}}_e.progress=Be,_e.segmentBuffer.isStartingPoint&&(le=!0),_e.segmentBuffer.isEndingPoint&&le&&(ve=!0),le&&!ve&&(_e.segmentBuffer.isSegmentBuffer=!0),le&&ve&&(le=!1,ve=!1);var Ee=!1;null!==pe&&pe.id===_e.id&&(Ee=!0),_e.nearest=Ee;var Ue=`g_${_e.goBack}`||"g_0";(0,i.mQ)(he,Ue)||(he[Ue]=[],me[Ue]=0,ce+=1),he[Ue].push(_e),me[Ue]+=1}var Ce=_[`r_${e}`],Pe=Ce.n,He=Ce.dep,xe=Ce.des,Ae={groupNames:[`往${xe}`,`往${He}`],groupedItems:he,groupQuantity:ce,itemQuantity:me,RouteName:Pe,RouteEndPoints:[He,xe],dataUpdateTime:(0,c.Zt)(y),RouteID:e,PathAttributeId:a};return(0,c.LQ)(y),(0,c.gC)(y),Ae})).apply(this,arguments)}},8134(e,a,t){t.d(a,{F6:()=>c,GU:()=>k,Rk:()=>v,dD:()=>S,k9:()=>p});var r=t(467),n=t(2129),i=t(8024),o=t(4781),s=t(9734),u=t(8011),d=t(4293),f=t(6788);function p(e){return l.apply(this,arguments)}function l(){return(l=(0,r.A)(function*(e){var a=(0,i.zx)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.n).indexOf(e)>-1&&r.push(o)}return(0,f.LQ)(a),(0,f.gC)(a),r})).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=(0,r.A)(function*(e){var a,t=(0,i.zx)(),r=yield(0,d.a)(t,!0),n=`r_${e}`;return!!(0,i.mQ)(r,n)&&(a=r[n],(0,f.LQ)(t),(0,f.gC)(t),a)})).apply(this,arguments)}function c(e){return m.apply(this,arguments)}function m(){return(m=(0,r.A)(function*(e){var a=(0,i.zx)(),t=yield(0,d.a)(a,!0),r=[];for(var n in t){var o=t[n];String(o.pid).indexOf(e)>-1&&r.push(o)}return(0,f.LQ)(a),(0,f.gC)(a),r})).apply(this,arguments)}var g={},y=[],_=!1;function S(){return B.apply(this,arguments)}function B(){return(B=(0,r.A)(function*(){if(!_){var e=(0,i.zx)(),a=yield(0,d.a)(e,!0),t=yield(0,u.g)(e,1),r=yield(0,s.j)(e,!0);(0,f.LQ)(e),(0,f.gC)(e);var n={},p=[],l=0;for(var v in a){var h=a[v],c={id:h.id,pid:h.pid,dep:h.dep,des:h.des,n:h.n,hash:"",lo:"",la:"",r:"",s:"",type:0};p.push(c);var m=(0,o.B5)(`${c.n.toLowerCase()}${c.dep.toLowerCase()}${c.des.toLowerCase()}`,!0);for(var S of m){var B=`u_${S}`;(0,i.mQ)(n,B)||(n[B]=[]),n[B].push(l)}l+=1}for(var D in t){var k=t[D],I={id:k.id,n:k.n,lo:k.lo,la:k.la,r:k.r,s:k.s,hash:k.hash,dep:"",des:"",pid:[],type:1};p.push(I);var b=(0,o.B5)(I.n.toLowerCase(),!0);for(var Q of b){var T=`u_${Q}`;(0,i.mQ)(n,T)||(n[T]=[]),n[T].push(l)}l+=1}for(var $ in r){var w=r[$],L={id:w.BusId,pid:[],dep:"",des:"",n:w.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};p.push(L);var M=(0,o.B5)(L.n.toLowerCase(),!0);for(var R of M){var E=`u_${R}`;(0,i.mQ)(n,E)||(n[E]=[]),n[E].push(l)}l+=1}g=n,y=p,_=!0}})).apply(this,arguments)}function D(e,a){var t=0,r=0;for(var n of a){t+=e.indexOf(n,r)-r,r+=1}return e===a&&(t=10*Math.abs(t)),t}function k(e,a,t){if(!_)return[];var r=e.toLowerCase(),s=(0,o.B5)(r,!0),u=(0,o.B5)(r,!1),d=[];for(var f of s){var p=`u_${f}`;(0,i.mQ)(g,p)&&d.push(g[p])}d.sort(function(e,a){return e.length-a.length});var l=d.length-1,v=[];if(0===l&&(v=d[0]),l>0)for(var h=0;h<l;h++){var c=d[h],m=d[h+1];v=0===h?(0,n._N)(c,m):(0,n._N)(v,m)}var S=[],B=0,k=new Set;if(-1===a||2===a){var I=y.filter(function(e){return e.n===r&&2===e.type});for(var b of I)if(S.push({item:b,score:1/0}),k.add(b.id),(B+=1)>=t)break}if(B<t)for(var Q of v){var T=y[Q];if((-1===a||a===T.type)&&!k.has(T.id)){var $=D(u,(0,o.B5)(T.n,!1));if(!(B<t))break;S.push({item:T,score:$}),B+=1}}return S.sort(function(e,a){return a.score-e.score}),S}},8621(e,a,t){t.d(a,{p:()=>p});var r=t(467),n=t(5579),i=t(313),o=t(4293),s=t(8201),u=t(8671),d=t(2303),f=t(6788);function p(e,a,t){return l.apply(this,arguments)}function l(){return(l=(0,r.A)(function*(e,a,t){var r=function(e,a){var t={};for(var r of e)if(r.Id===a){t=r;break}return t}(yield(0,o.a)(t,!1),e),p=yield(0,s.Y)(t),l=yield(0,u.s)(t),v=yield(0,i.s)(t),h=function(e){var a=(0,d.aU)(e.goFirstBusTime,0),t=(0,d.aU)(e.goLastBusTime,0),r=(0,d.aU)(e.backFirstBusTime,0),n=(0,d.aU)(e.backLastBusTime,0),i=(0,d.aU)(e.holidayGoFirstBusTime,0),o=(0,d.aU)(e.holidayGoLastBusTime,0),s=(0,d.aU)(e.holidayBackFirstBusTime,0),u=(0,d.aU)(e.holidayBackLastBusTime,0),f=(0,d.aU)(e.peakHeadway,1),p=(0,d.aU)(e.offPeakHeadway,1),l=(0,d.aU)(e.holidayPeakHeadway,1),v=(0,d.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:a,last:t,rushHourWindow:f,offRushHourWindow:p},holiday:{first:i,last:o,rushHourWindow:l,offRushHourWindow:v}},back:{weekday:{first:r,last:n,rushHourWindow:f,offRushHourWindow:p},holiday:{first:s,last:u,rushHourWindow:l,offRushHourWindow:v}},realSequence:e.realSequence}}(r),c=function(e,a,t,r,i){var o={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},s=(0,n.P$)();for(var u of r)if(a.indexOf(u.PathAttributeId)>-1&&"0"===u.DateType)for(var f=(0,n.mr)(u.DateValue),p=(0,n.S1)(s,f.day,0,0),l=(0,d.aU)(u.StartTime,0),v=(0,n.S1)(p,0,l.hours,l.minutes),h=(0,d.aU)(u.EndTime,0),c=(0,n.S1)(p,0,h.hours,h.minutes),m=Math.abs(60*h.hours+h.minutes-(60*l.hours+l.minutes)),g=parseInt(u.LongHeadway),y=parseInt(u.LowHeadway),_=(y+g)/2,S=m/_,B=0;B<S;B++){var D=!1,k=(0,n.S1)(p,0,l.hours,l.minutes+y*B);k.getTime()<v.getTime()&&(D=!0),k.getTime()>c.getTime()&&(D=!0),!1===D&&(o.calendarEventGroups[f.code].push({date:k,dateString:(0,n.$T)(k,"hh:mm"),duration:y,deviation:Math.abs(_-y)}),o.calendarEventQuantity[f.code]+=1)}for(var I of i)if(a.indexOf(I.PathAttributeId)>-1&&"0"===I.DateType){var b=(0,n.mr)(I.DateValue),Q=(0,n.S1)(s,b.day,0,0),T=(0,d.aU)(I.DepartureTime,0),$=(0,n.S1)(Q,0,T.hours,T.minutes);o.calendarEventGroups[b.code].push({date:$,dateString:(0,n.$T)($,"hh:mm"),duration:15,deviation:0}),o.calendarEventQuantity[b.code]+=1}for(var w in o.calendarEventGroups)o.calendarEventGroups[w].sort(function(e,a){return e.date.getTime()-a.date.getTime()});return o}(0,a,0,p,l),m=function(e,a){var t={};for(var r of e)r.id===a&&(t=r);return t}(v,r.providerId),g={timeTableRules:h,calendar:c,properties:[{key:"route_name",icon:"route",value:r.nameZh},{key:"pricing",icon:"attach_money",value:r.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,f.LQ)(t),(0,f.gC)(t),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=77b409e1ef7dcee38583.js.map