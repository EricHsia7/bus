"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[317,4821],{1932(r,t,e){e.d(t,{L:()=>v});var n=e(467),a=e(4311),o=e(3153),i=e(6788);function u(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return s(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw o}}}}function s(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}var l=!1,f={};function c(r){return p.apply(this,arguments)}function p(){return(p=(0,n.A)(function*(r){var t=new Worker(new URL(e.p+e.u(5332),e.b));return yield new Promise(function(e,n){t.onmessage=function(r){e(r.data),t.terminate()},t.onerror=function(r){n(r.message),t.terminate()},t.postMessage(r)})})).apply(this,arguments)}function y(r){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(r){var t=new Worker(new URL(e.p+e.u(8892),e.b));return yield new Promise(function(e,n){t.onmessage=function(r){e(r.data),t.terminate()},t.onerror=function(r){n(r.message),t.terminate()},t.postMessage(r)})})).apply(this,arguments)}function v(r){return h.apply(this,arguments)}function h(){return h=(0,n.A)(function*(r){function t(){return e.apply(this,arguments)}function e(){return e=(0,n.A)(function*(){var t,e="",n=u([[0,15],[1,15]].map(function(r){return{url:(0,o.y)(r[0],r[1]),e:r}}));try{for(n.s();!(t=n.n()).done;){var a=t.value;e+=(yield(0,i.Fd)(a.url,r,`getSegmentBuffers_${a.e[0]}`,"xml")),(0,i.ZL)(r,-1)}}catch(r){n.e(r)}finally{n.f()}return e}),e.apply(this,arguments)}var s="bus_segment_buffers_cache",p=yield(0,a.Ct)(0,`${s}_timestamp`);if(null===p){var d=yield t(),v=yield c(d),h=yield y(v);return yield(0,a.mL)(0,`${s}_timestamp`,(new Date).getTime()),yield(0,a.mL)(0,s,JSON.stringify(h)),l||(l=!0,f=h),h}if((new Date).getTime()-parseInt(p)>2592e6){var m=yield t(),g=yield c(m),b=yield y(g);return yield(0,a.mL)(0,`${s}_timestamp`,(new Date).getTime()),yield(0,a.mL)(0,s,JSON.stringify(b)),b}if(!l){var w=yield(0,a.Ct)(0,s);l=!0,f=JSON.parse(w)}return(0,i.Mf)(r,"getSegmentBuffers_0",0,!0),(0,i.Mf)(r,"getSegmentBuffers_1",0,!0),(0,i.ZL)(r,-1),f}),h.apply(this,arguments)}},6160(r,t,e){e.d(t,{i:()=>d});var n=e(467),a=e(6802),o=e(7810),i=e(9734),u=e(8011),s=e(424),l=e(2303),f=e(6788),c=e(8134);function p(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return y(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?y(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw o}}}}function y(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}function d(r,t){return v.apply(this,arguments)}function v(){return(v=(0,n.A)(function*(r,t){var e=`c_${r}`,n=yield(0,i.j)(t,!0),y=yield(0,a.d)(t),d=yield(0,o.J)(t),v=yield(0,s.T)(t),h=yield(0,u.g)(t,0),m={properties:[],LocationName:""},g={};if(!n.hasOwnProperty(e))return m;var b=(g=n[e]).CarNum;m.properties.push({key:"car_number",icon:"tag",value:b});var w=g.CarType,A=(0,l.Ov)(w);m.properties.push({key:"car_type",icon:"directions_bus",value:A});var S,I={},O=p(y);try{for(O.s();!(S=O.n()).done;){var $=S.value;if($.BusID===b){I=$;break}}}catch(r){O.e(r)}finally{O.f()}var _,P=parseInt(I.RouteID),j=I.BusStatus,k=(0,l.eu)(j),T=parseInt(I.GoBack),L={},C=p(d);try{for(C.s();!(_=C.n()).done;){var x=_.value;if(x.BusID===b){L=x;break}}}catch(r){C.e(r)}finally{C.f()}var B=L.CarOnStop,E=(0,l.zi)(B);m.properties.push({key:"status",icon:"vital_signs",value:`${E} | ${k}`});var M=L.StopID,D=yield(0,c.F6)(P),U={};if(!(D.length>0))return m;var N=(U=D[0]).id,F=U.pid,q=U.n,Z=U.dep,J=[U.des,Z,""][T||0];m.properties.push({key:"route",icon:"route",value:`${q} - 往${J}`}),m.RouteID=N,m.FullPathAttributeId=F;var R=`s_${M}`;if(!v.hasOwnProperty(R))return m;var z=h[`l_${v[R].stopLocationId}`].n;return m.properties.push({key:"location_name",icon:"location_on",value:z}),(0,f.LQ)(t),(0,f.gC)(t),m})).apply(this,arguments)}},6788(r,t,e){e.d(t,{Fd:()=>p,LQ:()=>g,Mf:()=>h,ZL:()=>A,Zt:()=>S,gC:()=>I});var n=e(2284),a=e(467),o=e(4750),i=e(5579),u=e(8925);function s(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return l(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw o}}}}function l(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}var f={},c=new Error("FetchError");function p(r,t,e,n){return y.apply(this,arguments)}function y(){return(y=(0,a.A)(function*(r,t,e,n){if(f.hasOwnProperty(r)){if(f[r].processing)return yield new Promise(function(n,a){f[r].requests.push([n,a,t,e])});if(null!==f[r].result&&(new Date).getTime()<=f[r].timestamp)return h(t,e,0,!0),f[r].result}else f[r]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var a=yield fetch(r);if(!a.ok)throw h(t,e,0,!0),new Error(`HTTP error! status: ${a.status}`);for(var i=parseInt(String(a.headers.get("content-length"))),l=a.body.getReader(),y=[],v=0;;){var m=yield l.read(),g=m.done,b=m.value;if(g)break;y.push(b);var w=(v+=b.length)/i;if(h(t,e,w,!1),f.hasOwnProperty(r)){var A,S=s(f[r].requests);try{for(S.s();!(A=S.n()).done;){var I=A.value;h(I[2],I[3],w,!1)}}catch(r){S.e(r)}finally{S.f()}}}for(var O=new Uint8Array(v),$=0,_=0,P=y;_<P.length;_++){var j=P[_];O.set(j,$),$+=j.length}var k,T=new Blob([O],{type:"application/gzip"}),L=yield T.arrayBuffer(),C=yield(0,o.h)(L);switch(n){case"json":k=/^<!doctype html>/.test(C)?yield p(r.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,e,n):JSON.parse(C);break;case"xml":k=C}var x=new Date;if(yield(0,u.N$)(i,x),k){if(f.hasOwnProperty(r)){for(var B=v/i,E=f[r].requests.shift();E;)E[0](k),h(E[2],E[3],B,!1),E=f[r].requests.shift();f[r].result=k,f[r].timestamp=x.getTime()+3e4,f[r].processing=!1}return d(),k}if(f.hasOwnProperty(r)){for(var M=f[r].requests.shift();M;)M[1](c),h(M[2],M[3],0,!0),M=f[r].requests.shift();f[r].failed=!0}throw d(),c})).apply(this,arguments)}function d(){var r=(new Date).getTime();for(var t in f)if(f.hasOwnProperty(t)){if(!f[t].processing&&r>f[t].timestamp){delete f[t];continue}if(f[t].failed){delete f[t];continue}}}var v={};function h(r,t,e,n){v.hasOwnProperty(r)||(v[r]={}),v[r].hasOwnProperty(t)?(n?v[r][t].expel=!0:(v[r][t].expel=!1,v[r][t].progress=e),b(r,"run")):(v[r][t]={expel:!1,progress:e,total:1},b(r,"start"))}function m(r){if(v.hasOwnProperty(r)&&"object"===(0,n.A)(v[r])){var t=0,e=0;for(var a in v[r])v[r][a].expel||(t+=v[r][a].total,e+=v[r][a].progress);var o=Math.min(Math.max(e/t,0),1);return o===1/0||isNaN(o)?1:o}return 1}function g(r){v.hasOwnProperty(r)&&(delete v[r],b(r,"end"))}function b(r,t){var e={target:r,stage:t,progress:m(r)},n=new CustomEvent(r,{detail:e});document.dispatchEvent(n)}var w={};function A(r,t){w.hasOwnProperty(r)||(w[r]=0);var e=0;"string"==typeof t&&(e=(0,i.Zn)(t)),e>w[r]&&(w[r]=e)}function S(r){return w.hasOwnProperty(r)?1*w[r]:0}function I(r){w.hasOwnProperty(r)&&delete w[r]}},6802(r,t,e){e.d(t,{d:()=>s});var n=e(467),a=e(3153),o=e(6788);function i(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return u(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw o}}}}function u(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}function s(r){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(r){var t,e=[],n=i([[0,0],[1,0]].map(function(r){return{url:(0,a.y)(r[0],r[1]),e:r}}));try{for(n.s();!(t=n.n()).done;){var u=t.value,s=yield(0,o.Fd)(u.url,r,`getBusData_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,o.ZL)(r,s.EssentialInfo.UpdateTime)}}catch(r){n.e(r)}finally{n.f()}return e})).apply(this,arguments)}},7810(r,t,e){e.d(t,{J:()=>s});var n=e(467),a=e(3153),o=e(6788);function i(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return u(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){s=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw o}}}}function u(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}function s(r){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(function*(r){var t,e=[],n=i([[0,1],[1,1]].map(function(r){return{url:(0,a.y)(r[0],r[1]),e:r}}));try{for(n.s();!(t=n.n()).done;){var u=t.value,s=yield(0,o.Fd)(u.url,r,`getBusEvent_${u.e[0]}`,"json");e=e.concat(s.BusInfo),(0,o.ZL)(r,s.EssentialInfo.UpdateTime)}}catch(r){n.e(r)}finally{n.f()}return e})).apply(this,arguments)}},9609(r,t,e){var n=e(4256),a=e(8024);self.onmessage=function(r){var t=function(r){var t={};for(var e in r){var o=(0,a.Fx)(String(r[e].n).trim().replaceAll(/[\(（）\)\:：\~～]*/gim,"")),i=`ml_${o}`;t.hasOwnProperty(i)?(t[i].lo.push(r[e].lo),t[i].la.push(r[e].la),t[i].g.indexOf(r[e].g)<0&&t[i].g.push(r[e].g),t[i].r.push(r[e].r),t[i].s.push(r[e].s),t[i].v.push(r[e].v),t[i].a.push((0,n.bj)(r[e].a)),t[i].id.push(r[e].id)):t[i]={n:r[e].n,lo:[r[e].lo],la:[r[e].la],g:[r[e].g],r:[r[e].r],s:[r[e].s],v:[r[e].v],a:[(0,n.bj)(r[e].a)],id:[r[e].id],hash:o}}return t}(r.data);self.postMessage(t)}}}]);
//# sourceMappingURL=57c247a2061037622fd7.js.map