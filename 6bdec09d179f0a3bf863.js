!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("bus",[],t):"object"==typeof exports?exports.bus=t():r.bus=t()}(self,()=>(()=>{var r={5241(r){for(var t="0123456789bcdefghjkmnpqrstuvwxyz",e={},n=0;n<32;n++)e[t.charAt(n)]=n;var o="auto",u=-90,a=90,i=-180,d=180,f=[0,5,7,8,11,12,13,15,16,17,18],l=function(r,e,n){if(n===o){if("number"==typeof r||"number"==typeof e)throw new Error("string notation required for auto precision.");var l=r.split(".")[1].length,s=e.split(".")[1].length,c=Math.max(l,s);n=f[c]}else void 0===n&&(n=9);for(var v,h=[],p=0,g=0,b=0,y=a,m=u,x=d,_=i;h.length<n;)if(g%2==0?e>(v=(x+_)/2)?(b=1+(b<<1),_=v):(b=0+(b<<1),x=v):r>(v=(y+m)/2)?(b=1+(b<<1),m=v):(b=0+(b<<1),y=v),g++,5===++p){var I=t[b];h.push(I),p=0,b=0}return h.join("")},s=function(r,t,e){e=e||52;for(var n,o=0,f=a,l=u,s=d,c=i,v=0;o<e;)v*=2,o%2==0?t>(n=(s+c)/2)?(v+=1,c=n):s=n:r>(n=(f+l)/2)?(v+=1,l=n):f=n,o++;return v},c=function(r){for(var t,n=!0,o=a,f=u,l=d,s=i,c=0,v=0,h=r.length;v<h;v++){var p=r[v].toLowerCase();c=e[p];for(var g=4;g>=0;g--){var b=c>>g&1;n?(t=(l+s)/2,1===b?s=t:l=t):(t=(o+f)/2,1===b?f=t:o=t),n=!n}}return[f,s,o,l]},v=function(r,t){for(var e=a,n=u,o=d,f=i,l=0,s=(t=t||52)/2,c=0;c<s;c++)l=h(r,2*(s-c)-1),0===h(r,2*(s-c)-2)?e=(e+n)/2:n=(e+n)/2,0===l?o=(o+f)/2:f=(o+f)/2;return[n,f,e,o]};function h(r,t){return r/Math.pow(2,t)&1}var p=function(r){var t=c(r),e=(t[0]+t[2])/2,n=(t[1]+t[3])/2;return{latitude:e,longitude:n,error:{latitude:t[2]-e,longitude:t[3]-n}}},g=function(r,t){var e=v(r,t),n=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return{latitude:n,longitude:o,error:{latitude:e[2]-n,longitude:e[3]-o}}},b=function(r,t){var e=p(r),n=e.latitude+t[0]*e.error.latitude*2,o=e.longitude+t[1]*e.error.longitude*2;return o=m(o),n=x(n),l(n,o,r.length)},y=function(r,t,e){var n=g(r,e=e||52),o=n.latitude+t[0]*n.error.latitude*2,u=n.longitude+t[1]*n.error.longitude*2;return u=m(u),o=x(o),s(o,u,e)};function m(r){return r>d?i+r%d:r<i?d+r%d:r}function x(r){return r>a?a:r<u?u:r}var _={ENCODE_AUTO:o,encode:l,encode_uint64:s,encode_int:s,decode:p,decode_int:g,decode_uint64:g,decode_bbox:c,decode_bbox_uint64:v,decode_bbox_int:v,neighbor:b,neighbor_int:y,neighbors:function(r){var t,e,n=r.length,o=p(r),u=o.latitude,a=o.longitude,i=2*o.error.latitude,d=2*o.error.longitude;function f(r,o){return t=u+r*i,e=m(e=a+o*d),t=x(t),l(t,e,n)}return[f(1,0),f(1,1),f(0,1),f(-1,1),f(-1,0),f(-1,-1),f(0,-1),f(1,-1)]},neighbors_int:function(r,t){var e,n,o=g(r,t=t||52),u=o.latitude,a=o.longitude,i=2*o.error.latitude,d=2*o.error.longitude;function f(r,o){return e=u+r*i,n=m(n=a+o*d),e=x(e),s(e,n,t)}return[f(1,0),f(1,1),f(0,1),f(-1,1),f(-1,0),f(-1,-1),f(0,-1),f(1,-1)]},bboxes:function(r,t,e,n,o){for(var u=l(r,t,o=o||9),a=l(e,n,o),i=p(u),d=2*i.error.latitude,f=2*i.error.longitude,s=c(u),v=c(a),h=Math.round((v[0]-s[0])/d),g=Math.round((v[1]-s[1])/f),y=[],m=0;m<=h;m++)for(var x=0;x<=g;x++)y.push(b(u,[m,x]));return y},bboxes_int:function(r,t,e,n,o){for(var u=s(r,t,o=o||52),a=s(e,n,o),i=g(u,o),d=2*i.error.latitude,f=2*i.error.longitude,l=v(u,o),c=v(a,o),h=Math.round((c[0]-l[0])/d),p=Math.round((c[1]-l[1])/f),b=[],m=0;m<=h;m++)for(var x=0;x<=p;x++)b.push(y(u,[m,x],o));return b}};r.exports=_}},t={};function e(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return r[n](u,u.exports,e),u.exports}var n={};return(()=>{"use strict";var r=e(5241).encode;function t(t,e,n){return r(t,e,n)}function n(r){var t=Math.hypot(r),e=r.length,n=new Float32Array(e);if(t>0){for(var o=1/t,u=e;u>0;u--)n[u]=r[u]*o;return Array.from(n)}return r}function o(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return u(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,o=function(){};return{s:o,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,d=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){d=!0,a=r},f:function(){try{i||null==e.return||e.return()}finally{if(d)throw a}}}}function u(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}self.onmessage=function(r){var e=function(r){var e,u={},a=o(r);try{for(a.s();!(e=a.n()).done;){var i=e.value,d=`r_${i.routeId}`;u.hasOwnProperty(d)||(u[d]=[]),u[d].push(i)}}catch(r){a.e(r)}finally{a.f()}for(var f in u)u[f].sort(function(r,t){return r.seqNo-t.seqNo});var l,s={},c=o(r);try{for(c.s();!(l=c.n()).done;){for(var v=l.value,h=`r_${v.routeId}`,p=parseFloat(v.longitude),g=parseFloat(v.latitude),b=[0,0],y=u[h],m=y.length,x=null,_=0;_<m;_++)if(y[_].Id===v.Id){var I=0;_<m-1&&(I=_+1),x=y[I]}if(x)b=n([parseFloat(x.longitude)-p,parseFloat(x.latitude)-g]);var w=`l_${v.stopLocationId}`;if(s.hasOwnProperty(w))s[w].r.indexOf(v.routeId)<0&&s[w].r.push(v.routeId),s[w].s.indexOf(v.Id)<0&&(s[w].s.push(v.Id),s[w].v.push(b)),s[w].a.push(v.address);else{var A={};A.n=v.nameZh,A.lo=p,A.la=g,A.g=t(g,p,6),A.r=[v.routeId],A.s=[v.Id],A.v=[b],A.a=[v.address],A.id=v.stopLocationId,s[w]=A}}}catch(r){c.e(r)}finally{c.f()}return s}(r.data);self.postMessage(e)}})(),n=n.default})());
//# sourceMappingURL=6bdec09d179f0a3bf863.js.map