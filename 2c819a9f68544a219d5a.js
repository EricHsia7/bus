"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[5680],{365(e,t,r){r.d(t,{G:()=>d});var n=r(467),a=r(77),i=r(4778),o=r(2571),u=r(1172);function d(e){return s.apply(this,arguments)}function s(){return(s=(0,n.A)(function*(e){if(""===a.M3||""===a.se||void 0===e)return!1;var t=(0,i.F)("cancel",[e]),r=(0,o.b)("cancel",[e]),n=yield(0,u.R)("cancel",t,r);return!1!==n&&(200===n.code&&"cancel"===n.method&&(yield(0,a.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>a});var n=r(467);function a(e,t,r){return i.apply(this,arguments)}function i(){return(i=(0,n.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"omit"},a=yield fetch(t,n);if(!a.ok){yield a.text();return!1}try{var i=yield a.text(),o=JSON.parse(i);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}})).apply(this,arguments)}},2571(e,t,r){r.d(t,{b:()=>o});var n=r(8024),a=r(77);function i(e,t,r){var a=(new Date).getTime(),i=(a-a%5e3)/5e3;return(0,n.Zf)((0,n.Zf)(`${e}\n${t}\n${i}\n${(0,n.Zf)(`${e}\n${t}\n${(0,n.Zf)(JSON.stringify(r))}`)}`))}function o(e,t){switch(e){case"cancel":return""!==a.M3&&""!==a.se&&1===t.length&&{client_id:a.M3,token:i(a.M3,a.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,n.Zf)(`${(0,n.Zf)(t[0])}${r.getTime()}`)};case"schedule":return""!==a.M3&&""!==a.se&&9===t.length&&{client_id:a.M3,token:i(a.M3,a.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==a.M3&&""!==a.se&&0===t.length&&{client_id:a.M3,token:i(a.M3,a.se,{})};case"reschedule":return""!==a.M3&&""!==a.se&&3===t.length&&{client_id:a.M3,token:i(a.M3,a.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}},3447(e,t,r){r.d(t,{Z:()=>c});var n=r(2284),a=r(467),i=r(77),o=r(4778),u=r(2571),d=r(1172);function s(){return(s=(0,a.A)(function*(){if(""===i.M3||""===i.se)return!1;var e=(0,o.F)("rotate"),t=(0,u.b)("rotate",[]),r=yield(0,d.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&((0,i.uQ)(r.secret),yield(0,i.ms)(),!0))})).apply(this,arguments)}function c(e,t,r,n,a,i,o,u,d){return l.apply(this,arguments)}function l(){return l=(0,a.A)(function*(e,t,r,a,c,l,f,y,h){if(""===i.M3||""===i.se||void 0===e||void 0===t||void 0===r||void 0===a||void 0===c||void 0===l||"number"!=typeof f||void 0===h)return!1;var p=new Date;switch((0,n.A)(h)){case"string":case"number":p=new Date(h);break;default:if(!(h instanceof Date))return!1;p=h}var m=(0,o.F)("schedule"),v=(0,u.b)("schedule",[e,t,r,a,c,l,f,y,p.toISOString()]),g=yield(0,d.R)("schedule",m,v);return!1!==g&&(200===g.code&&"schedule"===g.method&&(Math.random()>.8&&(yield function(){return s.apply(this,arguments)}()),yield(0,i.G7)(g.schedule_id,e,t,r,a,c,l,f,y,p.getTime()),g.schedule_id))}),l.apply(this,arguments)}},4311(e,t,r){r.d(t,{Ct:()=>s,Su:()=>y,VC:()=>g,iQ:()=>l,le:()=>p,mL:()=>u,tH:()=>m});var n=r(467),a=r(3790),i={cacheStore:!1,settingsStore:!1,dataUsageStatsStore:!1,updateRateDataStore:!1,updateRateDataWriteAheadLogStore:!1,busArrivalTimeDataWriteAheadLogStore:!1,busArrivalTimeDataStore:!1,personalScheduleStore:!1,recentViewsStore:!1,notificationStore:!1,notificationScheduleStore:!1,folderListStore:!1,folderContentIndexStore:!1,folderContentStore:!1},o=["cacheStore","settingsStore","dataUsageStatsStore","updateRateDataStore","updateRateDataWriteAheadLogStore","busArrivalTimeDataWriteAheadLogStore","busArrivalTimeDataStore","personalScheduleStore","recentViewsStore","notificationStore","notificationScheduleStore","folderListStore","folderContentIndexStore","folderContentStore"];function u(e,t,r){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(e,t,r){try{var n=o[e];return!1===i[n]&&(i[n]=yield a.createInstance({name:n})),yield i[n].setItem(t,r)}catch(e){return null}})).apply(this,arguments)}function s(e,t){return c.apply(this,arguments)}function c(){return(c=(0,n.A)(function*(e,t){try{var r=o[e];return!1===i[r]&&(i[r]=yield a.createInstance({name:r})),yield i[r].getItem(t)}catch(e){return null}})).apply(this,arguments)}function l(e,t){return f.apply(this,arguments)}function f(){return(f=(0,n.A)(function*(e,t){try{var r=o[e];return!1===i[r]&&(i[r]=yield a.createInstance({name:r})),yield i[r].removeItem(t)}catch(e){return null}})).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(e){try{var t=o[e];return!1===i[t]&&(i[t]=yield a.createInstance({name:t})),yield i[t].keys()}catch(e){return[]}})).apply(this,arguments)}function p(){return o.length}function m(){return v.apply(this,arguments)}function v(){return(v=(0,n.A)(function*(){if(navigator.storage&&navigator.storage.persist)return yield navigator.storage.persisted();return!1})).apply(this,arguments)}function g(){return _.apply(this,arguments)}function _(){return(_=(0,n.A)(function*(){if(navigator.storage&&navigator.storage.persist)return(yield navigator.storage.persist())?"granted":"denied";return"unsupported"})).apply(this,arguments)}},4778(e,t,r){r.d(t,{F:()=>a});var n=r(77);function a(e){if(""===n.ph)return!1;var t=new URL(n.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},5427(e,t,r){r.d(t,{Qx:()=>g});var n=r(467),a=r(9566),i=r(5352),o=r(5314),u=r(3459),d=r(4311);function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e){return f.apply(this,arguments)}function f(){return(f=(0,n.A)(function*(e){var t,r=s(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n,o=!1,u=!1,c=`f_${i.id}`;if((yield(0,d.Ct)(11,c))?o=yield(0,a.g$)(i.id,i.name,i.icon):u=yield(0,a.vV)(i.name,i.icon),o){var l,f=s(n.content);try{for(f.s();!(l=f.n()).done;){var y=l.value;yield(0,a.z$)(n.id,y)}}catch(e){f.e(e)}finally{f.f()}}if(u){var h,p=s(n.content);try{for(p.s();!(h=p.n()).done;){var m=h.value;yield(0,a.z$)(u,m)}}catch(e){p.e(e)}finally{p.f()}}}}catch(e){r.e(e)}finally{r.f()}})).apply(this,arguments)}function y(e){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(e){var t,r=s(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=(0,u.PL)(n.key);a&&"select"===a.type&&(yield(0,u.aN)(n.key,n.option))}}catch(e){r.e(e)}finally{r.f()}return!0})).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=(0,n.A)(function*(e){var t,r=s(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;(yield(0,i.qZ)(n.id))?yield(0,i.nL)(n):yield(0,i.Qh)(n.name,n.period.start.hours,n.period.start.minutes,n.period.end.hours,n.period.end.minutes,n.days)}}catch(e){r.e(e)}finally{r.f()}return!0})).apply(this,arguments)}function v(){return(v=(0,n.A)(function*(e){var t,r=s(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;switch(n.type){case"route":(yield(0,o.DF)("route",n.id))||(yield(0,o.XK)(n.type,n.id));break;case"location":(yield(0,o.DF)("location",n.hash))||(yield(0,o.XK)(n.type,n.hash));break;case"bus":(yield(0,o.DF)("bus",n.id))||(yield(0,o.XK)(n.type,n.id))}}}catch(e){r.e(e)}finally{r.f()}return!0})).apply(this,arguments)}function g(e){return _.apply(this,arguments)}function _(){return _=(0,n.A)(function*(e){var t=JSON.parse(e);switch(t.version){case 1:return yield l(t.folders),!0;case 2:return yield l(t.folders),yield y(t.settings),!0;case 3:return yield l(t.folders),yield y(t.settings),yield p(t.personal_schedules),!0;case 4:return yield l(t.folders),yield y(t.settings),yield p(t.personal_schedules),yield function(e){return v.apply(this,arguments)}(t.recent_views),!0;default:return!1}}),_.apply(this,arguments)}},5976(e,t,r){r.d(t,{R:()=>d});var n=r(467),a=r(9566),i=r(5352),o=r(5314),u=r(3459);function d(){return s.apply(this,arguments)}function s(){return(s=(0,n.A)(function*(){var e=yield(0,a.Xi)(),t=(0,u.Gn)(),r=yield(0,i.ty)(),n=yield(0,o.Qj)(),d={};return d.time=(new Date).toISOString(),d.version=4,d.folders=e,d.settings=t,d.personal_schedules=r,d.recent_views=n,JSON.stringify(d)})).apply(this,arguments)}},6983(e,t,r){r.d(t,{v:()=>d});var n=r(467),a=r(1351),i=r(3041),o=r(8011),u=r(6788);function d(e,t){return s.apply(this,arguments)}function s(){return(s=(0,n.A)(function*(e,t){var r=yield(0,o.g)(t,1);(0,u.LQ)(t),(0,u.gC)(t);var n=`ml_${e}`;if(!r.hasOwnProperty(n))return{actions:[],actionsQuantity:0,hash:e};r[n];var d=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,i.B)("location",[e])}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,a.k9)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,a.qp)(e)}}];return{actions:d,actionsQuantity:d.length,hash:e}})).apply(this,arguments)}},8621(e,t,r){r.d(t,{p:()=>y});var n=r(467),a=r(5579),i=r(313),o=r(4293),u=r(8201),d=r(8671),s=r(2303),c=r(6788);function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t,r){return h.apply(this,arguments)}function h(){return(h=(0,n.A)(function*(e,t,r){var n=function(e,t){var r,n={},a=l(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.Id===t){n=i;break}}}catch(e){a.e(e)}finally{a.f()}return n}(yield(0,o.a)(r,!1),e),f=yield(0,u.Y)(r),y=yield(0,d.s)(r),h=yield(0,i.s)(r),p=function(e){var t=(0,s.aU)(e.goFirstBusTime,0),r=(0,s.aU)(e.goLastBusTime,0),n=(0,s.aU)(e.backFirstBusTime,0),a=(0,s.aU)(e.backLastBusTime,0),i=(0,s.aU)(e.holidayGoFirstBusTime,0),o=(0,s.aU)(e.holidayGoLastBusTime,0),u=(0,s.aU)(e.holidayBackFirstBusTime,0),d=(0,s.aU)(e.holidayBackLastBusTime,0),c=(0,s.aU)(e.peakHeadway,1),l=(0,s.aU)(e.offPeakHeadway,1),f=(0,s.aU)(e.holidayPeakHeadway,1),y=(0,s.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:r,rushHourWindow:c,offRushHourWindow:l},holiday:{first:i,last:o,rushHourWindow:f,offRushHourWindow:y}},back:{weekday:{first:n,last:a,rushHourWindow:c,offRushHourWindow:l},holiday:{first:u,last:d,rushHourWindow:f,offRushHourWindow:y}},realSequence:e.realSequence}}(n),m=function(e,t,r,n,i){var o,u={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},d=(0,a.P$)(),c=l(n);try{for(c.s();!(o=c.n()).done;){var f=o.value;if(t.indexOf(f.PathAttributeId)>-1&&"0"===f.DateType)for(var y=(0,a.mr)(f.DateValue),h=(0,a.S1)(d,y.day,0,0),p=(0,s.aU)(f.StartTime,0),m=(0,a.S1)(h,0,p.hours,p.minutes),v=(0,s.aU)(f.EndTime,0),g=(0,a.S1)(h,0,v.hours,v.minutes),_=Math.abs(60*v.hours+v.minutes-(60*p.hours+p.minutes)),S=parseInt(f.LongHeadway),b=parseInt(f.LowHeadway),w=(b+S)/2,A=_/w,k=0;k<A;k++){var T=!1,D=(0,a.S1)(h,0,p.hours,p.minutes+b*k);D.getTime()<m.getTime()&&(T=!0),D.getTime()>g.getTime()&&(T=!0),!1===T&&(u.calendarEventGroups[y.code].push({date:D,dateString:(0,a.$T)(D,"hh:mm"),duration:b,deviation:Math.abs(w-b)}),u.calendarEventQuantity[y.code]+=1)}}}catch(e){c.e(e)}finally{c.f()}var I,M=l(i);try{for(M.s();!(I=M.n()).done;){var U=I.value;if(t.indexOf(U.PathAttributeId)>-1&&"0"===U.DateType){var $=(0,a.mr)(U.DateValue),L=(0,a.S1)(d,$.day,0,0),O=(0,s.aU)(U.DepartureTime,0),H=(0,a.S1)(L,0,O.hours,O.minutes);u.calendarEventGroups[$.code].push({date:H,dateString:(0,a.$T)(H,"hh:mm"),duration:15,deviation:0}),u.calendarEventQuantity[$.code]+=1}}}catch(e){M.e(e)}finally{M.f()}for(var R in u.calendarEventGroups)u.calendarEventGroups[R].sort(function(e,t){return e.date.getTime()-t.date.getTime()});return u}(0,t,0,f,y),v=function(e,t){var r,n={},a=l(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.id===t&&(n=i)}}catch(e){a.e(e)}finally{a.f()}return n}(h,n.providerId),g={timeTableRules:p,calendar:m,properties:[{key:"route_name",icon:"route",value:n.nameZh},{key:"pricing",icon:"attach_money",value:n.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:v.nameZn},{key:"provider_phone",icon:"call",value:v.phoneInfo},{key:"provider_email",icon:"alternate_email",value:v.email}]};return(0,c.LQ)(r),(0,c.gC)(r),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=2c819a9f68544a219d5a.js.map