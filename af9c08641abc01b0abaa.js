!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("bus",[],e):"object"==typeof exports?exports.bus=e():r.bus=e()}(self,()=>(()=>{var r,e,t={5241(r){for(var e="0123456789bcdefghjkmnpqrstuvwxyz",t={},n=0;n<32;n++)t[e.charAt(n)]=n;var o="auto",u=-90,i=90,a=-180,f=180,l=[0,5,7,8,11,12,13,15,16,17,18],d=function(r,t,n){if(n===o){if("number"==typeof r||"number"==typeof t)throw new Error("E3");var d=r.split(".")[1].length,s=t.split(".")[1].length,c=Math.max(d,s);n=l[c]}else void 0===n&&(n=9);for(var v,p=[],h=0,g=0,b=0,y=i,m=u,x=f,w=a;p.length<n;)if(g%2==0?t>(v=(x+w)/2)?(b=1+(b<<1),w=v):(b=0+(b<<1),x=v):r>(v=(y+m)/2)?(b=1+(b<<1),m=v):(b=0+(b<<1),y=v),g++,5===++h){var O=e[b];p.push(O),h=0,b=0}return p.join("")},s=function(r,e,t){t=t||52;for(var n,o=0,l=i,d=u,s=f,c=a,v=0;o<t;)v*=2,o%2==0?e>(n=(s+c)/2)?(v+=1,c=n):s=n:r>(n=(l+d)/2)?(v+=1,d=n):l=n,o++;return v},c=function(r){for(var e,n=!0,o=i,l=u,d=f,s=a,c=0,v=0,p=r.length;v<p;v++){var h=r[v].toLowerCase();c=t[h];for(var g=4;g>=0;g--){var b=c>>g&1;n?(e=(d+s)/2,1===b?s=e:d=e):(e=(o+l)/2,1===b?l=e:o=e),n=!n}}return[l,s,o,d]},v=function(r,e){for(var t=i,n=u,o=f,l=a,d=0,s=(e=e||52)/2,c=0;c<s;c++)d=p(r,2*(s-c)-1),0===p(r,2*(s-c)-2)?t=(t+n)/2:n=(t+n)/2,0===d?o=(o+l)/2:l=(o+l)/2;return[n,l,t,o]};function p(r,e){return r/Math.pow(2,e)&1}var h=function(r){var e=c(r),t=(e[0]+e[2])/2,n=(e[1]+e[3])/2;return{latitude:t,longitude:n,error:{latitude:e[2]-t,longitude:e[3]-n}}},g=function(r,e){var t=v(r,e),n=(t[0]+t[2])/2,o=(t[1]+t[3])/2;return{latitude:n,longitude:o,error:{latitude:t[2]-n,longitude:t[3]-o}}},b=function(r,e){var t=h(r),n=t.latitude+e[0]*t.error.latitude*2,o=t.longitude+e[1]*t.error.longitude*2;return o=m(o),n=x(n),d(n,o,r.length)},y=function(r,e,t){var n=g(r,t=t||52),o=n.latitude+e[0]*n.error.latitude*2,u=n.longitude+e[1]*n.error.longitude*2;return u=m(u),o=x(o),s(o,u,t)};function m(r){return r>f?a+r%f:r<a?f+r%f:r}function x(r){return r>i?i:r<u?u:r}var w={ENCODE_AUTO:o,encode:d,encode_uint64:s,encode_int:s,decode:h,decode_int:g,decode_uint64:g,decode_bbox:c,decode_bbox_uint64:v,decode_bbox_int:v,neighbor:b,neighbor_int:y,neighbors:function(r){var e,t,n=r.length,o=h(r),u=o.latitude,i=o.longitude,a=2*o.error.latitude,f=2*o.error.longitude;function l(r,o){return e=u+r*a,t=m(t=i+o*f),e=x(e),d(e,t,n)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},neighbors_int:function(r,e){var t,n,o=g(r,e=e||52),u=o.latitude,i=o.longitude,a=2*o.error.latitude,f=2*o.error.longitude;function l(r,o){return t=u+r*a,n=m(n=i+o*f),t=x(t),s(t,n,e)}return[l(1,0),l(1,1),l(0,1),l(-1,1),l(-1,0),l(-1,-1),l(0,-1),l(1,-1)]},bboxes:function(r,e,t,n,o){for(var u=d(r,e,o=o||9),i=d(t,n,o),a=h(u),f=2*a.error.latitude,l=2*a.error.longitude,s=c(u),v=c(i),p=Math.round((v[0]-s[0])/f),g=Math.round((v[1]-s[1])/l),y=[],m=0;m<=p;m++)for(var x=0;x<=g;x++)y.push(b(u,[m,x]));return y},bboxes_int:function(r,e,t,n,o){for(var u=s(r,e,o=o||52),i=s(t,n,o),a=g(u,o),f=2*a.error.latitude,l=2*a.error.longitude,d=v(u,o),c=v(i,o),p=Math.round((c[0]-d[0])/f),h=Math.round((c[1]-d[1])/l),b=[],m=0;m<=p;m++)for(var x=0;x<=h;x++)b.push(y(u,[m,x],o));return b}};r.exports=w},7367(r,e,t){"use strict";var n=t(5241).encode;function o(r,e,t){return n(r,e,t)}var u=t(2284);t(3503),t(4462).sha512;function i(r,e){return null!=r&&"object"===(0,u.A)(r)&&!Array.isArray(r)&&Object.prototype.hasOwnProperty.call(r,e)}function a(r){var e=Math.hypot(r),t=r.length,n=new Float32Array(t);if(e>0){for(var o=1/e,u=t;u>0;u--)n[u]=r[u]*o;return Array.from(n)}return r}function f(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function(r,e){if(r){if("string"==typeof r)return l(r,e);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(r,e):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,o=function(){};return{s:o,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:o}}throw new TypeError("E0")}var u,i=!0,a=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return i=r.done,r},e:function(r){a=!0,u=r},f:function(){try{i||null==t.return||t.return()}finally{if(a)throw u}}}}function l(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}self.onmessage=function(r){var e=function(r){var e,t={},n=f(r);try{for(n.s();!(e=n.n()).done;){var u=e.value,l=`r_${u.routeId}`;i(t,l)||(t[l]=[]),t[l].push(u)}}catch(r){n.e(r)}finally{n.f()}for(var d in t)t[d].sort(function(r,e){return r.seqNo-e.seqNo});var s,c={},v=f(r);try{for(v.s();!(s=v.n()).done;){for(var p=s.value,h=`r_${p.routeId}`,g=parseFloat(p.longitude),b=parseFloat(p.latitude),y=[0,0],m=t[h],x=m.length,w=null,O=0;O<x;O++)if(m[O].Id===p.Id){var _=0;O<x-1&&(_=O+1),w=m[_]}if(w)y=a([parseFloat(w.longitude)-g,parseFloat(w.latitude)-b]);var j=`l_${p.stopLocationId}`;if(i(c,j))c[j].r.indexOf(p.routeId)<0&&c[j].r.push(p.routeId),c[j].s.indexOf(p.Id)<0&&(c[j].s.push(p.Id),c[j].v.push(y)),c[j].a.push(p.address);else{var A={};A.n=p.nameZh,A.lo=g,A.la=b,A.g=o(b,g,6),A.r=[p.routeId],A.s=[p.Id],A.v=[y],A.a=[p.address],A.id=p.stopLocationId,c[j]=A}}}catch(r){v.e(r)}finally{v.f()}return c}(r.data);self.postMessage(e)}}},n={};function o(r){var e=n[r];if(void 0!==e)return e.exports;var u=n[r]={exports:{}};return t[r](u,u.exports,o),u.exports}o.m=t,o.x=()=>{var r=o.O(void 0,[35],()=>o(7367));return r=o.O(r)},o.amdO={},r=[],o.O=(e,t,n,u)=>{if(!t){var i=1/0;for(d=0;d<r.length;d++){for(var[t,n,u]=r[d],a=!0,f=0;f<t.length;f++)(!1&u||i>=u)&&Object.keys(o.O).every(r=>o.O[r](t[f]))?t.splice(f--,1):(a=!1,u<i&&(i=u));if(a){r.splice(d--,1);var l=n();void 0!==l&&(e=l)}}return e}u=u||0;for(var d=r.length;d>0&&r[d-1][2]>u;d--)r[d]=r[d-1];r[d]=[t,n,u]},o.d=(r,e)=>{for(var t in e)o.o(e,t)&&!o.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},o.f={},o.e=r=>Promise.all(Object.keys(o.f).reduce((e,t)=>(o.f[t](r,e),e),[])),o.u=r=>"5b413071ef852ffa271a.js",o.miniCssF=r=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(r){if("object"==typeof window)return window}}(),o.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),o.p="./",(()=>{var r={367:1};o.f.i=(e,t)=>{r[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkbus=self.webpackChunkbus||[],t=e.push.bind(e);e.push=e=>{var[n,u,i]=e;for(var a in u)o.o(u,a)&&(o.m[a]=u[a]);for(i&&i(o);n.length;)r[n.pop()]=1;t(e)}})(),e=o.x,o.x=()=>o.e(35).then(e);var u=o.x();return u=u.default})());
//# sourceMappingURL=af9c08641abc01b0abaa.js.map