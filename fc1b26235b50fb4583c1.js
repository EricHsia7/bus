"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(e,t,i){i.d(t,{eS:()=>he,s_:()=>V,so:()=>pe});var a=i(467),n=i(5767),r=i(9566),d=i(2757),s=i(3422),o=i(5314),l=i(3459),u=i(8179),c=i(7968),p=i(8024),h=i(5579),v=i(4537),m=i(904),f=i(9119),g=i(3041),b=i(752),y=i(1351);function A(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return C(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("E0")}var r,d=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return d=e.done,e},e:function(e){s=!0,r=e},f:function(){try{d||null==i.return||i.return()}finally{if(s)throw r}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=Array(t);i<t;i++)a[i]=e[i];return a}var I=(0,u.bv)(".dg"),L=(0,u.aI)(I,".mg"),E=(0,u.aI)(L,".qg"),x=(0,u.aI)(E,"span"),w=(0,u.aI)(L,".pg"),k=(0,u.aI)(I,".ah"),T=(0,u.aI)(L,".sg"),_=(0,u.aI)(T,".tg"),$=(0,u.aI)(L,".wg"),j=(0,u.aI)($,".xg"),S=(0,u.aI)(L,".yg .zg"),M={},Z=!1,N=!1,P=0,D=0,Q=0,R={},Y=0,q=!1,F=15e3,H=5e3,z=15e3,B=!0,O=0,J=0,U="",W=!1,K=!1,X=!1,G="";function V(){k.addEventListener("touchstart",function(){P=Math.round(k.scrollLeft/Y)},{passive:!0}),k.addEventListener("scroll",function(e){q=!0;var t=e.target.scrollLeft/Y;D=t>P?P+1:P-1;var i=t-P,a=Math.abs(i);a>1&&(i>0?(P=Math.floor(t),D=P+1):(P=Math.ceil(t),D=P-1),a=Math.abs(t-P));var n=R[`g_${P}`]||{width:0,offset:0},r=R[`g_${D}`]||{width:0,offset:0},d=n.width+(r.width-n.width)*a,s=-1*(n.offset+(r.offset-n.offset)*a)+.5*Y-.5*d;ee(Q,s,d-20,t)},{passive:!0}),k.addEventListener("scrollend",function(e){var t=e.target.scrollLeft/Y;P=Math.round(t),q=!1},{passive:!0})}function ee(e,t,i,a){k.style.setProperty("--cg",e.toString()),j.style.setProperty("--gg",i.toString()),_.style.setProperty("--hg",`${t.toString()}px`),_.style.setProperty("--jg",a.toString())}function te(e){var t=e;if(W){var i=t.detail.progress-1;S.style.setProperty("--kg",i.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,te)}function ie(){var e=document.createElement("div");e.classList.add("lh"),e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0");var t=document.createElement("div");t.classList.add("mh");var i=document.createElement("div");i.classList.add("nh");var a=document.createElement("div");a.classList.add("ph"),a.setAttribute("code","-1"),a.setAttribute("displayed","false");var n=document.createElement("div");n.classList.add("qh"),n.setAttribute("code","-1"),n.setAttribute("displayed","true"),i.appendChild(a),i.appendChild(n);var r=document.createElement("div");r.classList.add("_h");var d=document.createElement("div");d.classList.add("ai");var s=document.createElement("div");s.classList.add("bi");var o=document.createElement("div");o.classList.add("ei");var l=document.createElement("div");l.classList.add("tf"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var c=document.createElement("div");c.classList.add("uf"),c.setAttribute("code","0"),c.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(c);var p=document.createElement("div");p.classList.add("di"),p.appendChild((0,v.YC)("keyboard_arrow_down")),p.onclick=function(){!function(e){var t=(0,u.aI)(e,".fi"),i=e.parentElement,a=(0,u.ji)(e,"lh"),n=a.length,r=i.getBoundingClientRect(),d=e.getBoundingClientRect().top-r.top,s="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=s?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--jh",`${d}px`);for(var c=0;c<n;c++){var p=a[c];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<n;t++){var i=a[t];i.setAttribute("push-direction","0"),i.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<n;e++){a[e].setAttribute("push-state","2")}},{once:!0})}s?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(e)};var h=document.createElement("div");h.classList.add("ci"),s.appendChild(o),s.appendChild(p),s.appendChild(h),t.appendChild(i),t.appendChild(r),t.appendChild(d),t.appendChild(s);var m=document.createElement("div");m.classList.add("fi"),m.setAttribute("displayed","false");var f=document.createElement("div");f.classList.add("gi");var g=document.createElement("div");g.classList.add("hi"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var b=document.createElement("div");b.classList.add("ki"),b.appendChild((0,v.YC)("directions_bus")),g.appendChild(b),g.appendChild(document.createTextNode("公車")),g.onclick=function(){ve(e,0)};var y=document.createElement("div");y.classList.add("hi"),y.setAttribute("highlighted","false"),y.setAttribute("type","tab"),y.setAttribute("code","1");var A=document.createElement("div");A.classList.add("ki"),A.appendChild((0,v.YC)("departure_board")),y.appendChild(A),y.appendChild(document.createTextNode("抵達時間")),y.onclick=function(){ve(e,1)};var C=document.createElement("div");C.classList.add("hi"),C.setAttribute("highlighted","false"),C.setAttribute("type","save-to-folder");var I=document.createElement("div");I.classList.add("ki"),I.appendChild((0,v.YC)("folder")),C.appendChild(I),C.appendChild(document.createTextNode("儲存"));var L=document.createElement("div");L.classList.add("hi"),L.setAttribute("highlighted","false"),L.setAttribute("type","schedule-notification"),L.setAttribute("enabled","true");var E=document.createElement("div");E.classList.add("ki"),E.appendChild((0,v.YC)("notifications")),L.appendChild(E),L.appendChild(document.createTextNode("通知")),f.appendChild(g),f.appendChild(y),f.appendChild(C),f.appendChild(L);var x=document.createElement("div");x.classList.add("li"),x.setAttribute("displayed","true");var w=document.createElement("div");return w.classList.add("mi"),w.setAttribute("displayed","false"),m.appendChild(f),m.appendChild(x),m.appendChild(w),e.appendChild(t),e.appendChild(m),e}function ae(){var e=document.createElement("div");e.classList.add("bh");var t=document.createElement("div");t.classList.add("ch");var i=document.createElement("div");i.classList.add("dh"),t.appendChild(i);var a=document.createElement("div");return a.classList.add("kh"),e.appendChild(t),e.appendChild(a),e}function ne(){var e=document.createElement("div");e.classList.add("ug");var t=document.createElement("span");return e.appendChild(t),e}function re(){var e=document.createElement("div");e.classList.add("fh");var t=document.createElement("div");t.classList.add("gh"),t.appendChild((0,v.oC)());var i=document.createElement("div");return i.classList.add("hh"),e.appendChild(t),e.appendChild(i),e}function de(){var e=document.createElement("div");e.classList.add("ni"),e.setAttribute("on-this-route","false");var t=document.createElement("div");t.classList.add("pi");var i=document.createElement("div");i.classList.add("ri"),i.appendChild((0,v.YC)("directions_bus"));var a=document.createElement("div");a.classList.add("ti");var n=document.createElement("div");n.classList.add("wi");var r=document.createElement("div");r.classList.add("_i");var d=document.createElement("div");d.classList.add("aj");var s=document.createElement("div");return s.classList.add("bj"),t.appendChild(i),t.appendChild(a),e.appendChild(t),n.appendChild(r),n.appendChild(d),n.appendChild(s),e.appendChild(n),e}function se(){var e=document.createElement("div");e.classList.add("oi");var t=document.createElement("div");t.classList.add("qi");var i=document.createElement("div");i.classList.add("si"),i.appendChild((0,v.YC)("calendar_view_day"));var a=document.createElement("div");a.classList.add("ui");var n=document.createElement("div");n.classList.add("vi");var r=document.createElement("div");return r.classList.add("xi"),t.appendChild(i),t.appendChild(a),t.appendChild(n),e.appendChild(t),e.appendChild(r),e}function oe(e,t,i){var a,n;function d(e,a,n){function d(e,t,i){var a=e.getBoundingClientRect(),n=a.top,r=a.left,d=a.bottom,s=a.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(e,".mh"),p=(0,u.aI)(c,".ei"),h=(0,u.aI)(p,".tf"),v=(0,u.aI)(p,".uf");h.setAttribute("code",t.status.code.toString()),h.innerText=t.status.text,i&&d>0&&n<l&&s>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("wf"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("wf")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}function o(e,t,i){var a=e.getBoundingClientRect(),n=a.top,r=a.left,d=a.bottom,s=a.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(e,".mh"),p=(0,u.aI)(c,".nh"),h=(0,u.aI)(p,".ph"),v=(0,u.aI)(p,".qh");h.setAttribute("code",t.ranking.code.toString()),h.innerText=t.ranking.text,i&&d>0&&n<l&&s>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text,v.classList.remove("zh"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("zh")):(v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text)}function l(e,t){var i=(0,u.aI)(e,".mh");(0,u.aI)(i,"._h").innerText=t.route_direction}function c(e,t){var i=(0,u.aI)(e,".mh");(0,u.aI)(i,".ai").innerText=t.route_name}function v(e,t){var i=(0,u.aI)(e,".fi"),a=(0,u.aI)(i,".li"),n=(0,u.jg)(a,".ni"),r=n.length,d=t.buses.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0,c=Math.abs(s);l<c;l++){var h=de();o.appendChild(h)}a.append(o)}else for(var v=0,m=Math.abs(s);v<m;v++){n[r-1-v].remove()}for(var f=(0,u.jg)(a,".ni"),g=0;g<d;g++){var b=t.buses[g],y=f[g],A=(0,u.aI)(y,".pi"),C=(0,u.aI)(A,".ti"),I=(0,u.aI)(y,".wi"),L=(0,u.aI)(I,"._i"),E=(0,u.aI)(I,".aj"),x=(0,u.aI)(I,".bj");y.setAttribute("on-this-route",(0,p.xZ)(b.onThisRoute)),C.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,E.innerText=`狀態：${b.status.text}`,x.innerText=`類型：${b.type}`}a.setAttribute("empty",(0,p.xZ)(0===d))}function m(e,t){var i=(0,u.aI)(e,".fi"),a=(0,u.aI)(i,".mi"),n=(0,u.jg)(a,".oi"),r=n.length,d=t.busArrivalTimes.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0,c=Math.abs(s);l<c;l++){var v=se();o.appendChild(v)}a.append(o)}else for(var m=0,f=Math.abs(s);m<f;m++){n[r-1-m].remove()}for(var g=(0,u.jg)(a,".oi"),b=0;b<d;b++){var y=t.busArrivalTimes[b],A=g[b],C=(0,u.aI)(A,".qi"),I=(0,u.aI)(C,".ui"),L=(0,u.aI)(C,".vi"),E=(0,u.aI)(A,".xi");I.innerText=y.personalSchedule.name,L.innerText=`週${(0,h.kd)(y.day).name} ${(0,h.pn)(y.personalSchedule.period.start)} - ${(0,h.pn)(y.personalSchedule.period.end)}`,E.innerHTML=y.chart}a.setAttribute("empty",(0,p.xZ)(0===d))}function f(e,t){t&&e.setAttribute("stretched","false")}function y(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function A(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}function C(e,t){var i=(0,u.aI)(e,".fi"),a=(0,u.aI)(i,".gi"),n=(0,u.aI)(a,'.hi[type="save-to-folder"]');n.onclick=function(){(0,g.B)("stop",[t.stopId,t.routeId],n)},(0,r.LH)("stop",t.stopId).then(function(e){n.setAttribute("highlighted",(0,p.xZ)(e))})}function I(e,t){var i=(0,u.aI)(e,".fi"),a=(0,u.aI)(i,".gi"),n=(0,u.aI)(a,'.hi[type="schedule-notification"]');n.onclick=function(){(0,b.Ho)(n,t.stopId,t.routeId,t.status.time)};var r=(0,s.Zc)(t.stopId);n.setAttribute("highlighted",(0,p.xZ)(r))}null==n?(d(e,a,i),o(e,a,i),l(e,a),c(e,a),v(e,a),m(e,a),f(e,t),y(e,i),A(e,t),C(e,a),I(e,a)):(a.status.time!==n.status.time&&(d(e,a,i),I(e,a)),n.ranking.number===a.ranking.number&&n.ranking.code===a.ranking.code||o(e,a,i),n.stopId!==a.stopId&&(l(e,a),c(e,a),C(e,a)),(0,p.hw)(n.buses,a.buses)||v(e,a),(0,p.hw)(n.busArrivalTimes,a.busArrivalTimes)||m(e,a),i!==Z&&y(e,i),t!==N&&(f(e,t),A(e,t)))}function o(e,a,n){function r(e,t){var i=(0,u.aI)(e,".gh");(0,v.yD)(i,t.icon)}function d(e,t){(0,u.aI)(e,".hh").innerHTML=t.value}function s(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}null==n?(r(e,a),d(e,a),s(e,i),o(e,t)):((0,p.hw)(n.icon,a.icon)||r(e,a),(0,p.hw)(n.value,a.value)||d(e,a),i!==Z&&s(e,i),t!==N&&o(e,t))}var l=(0,m.gO)("window"),f=l.width,A=l.height,C=e.groupQuantity,I=e.itemQuantity,L=e.groupedItems,j=e.groups;Q=C,Y=f;for(var S=0,D=0;D<C;D++){var F=`g_${D}`,H=(0,c.q_)(j[F].name,500,"17px",'"Noto Sans TC", sans-serif')+20;R[F]={width:H,offset:S},S+=H}if(R[`g_${C}`]={width:0,offset:S},!q){var z=R[`g_${P}`],B=-1*z.offset+.5*Y-.5*z.width,O=z.width-20;ee(Q,B,O,P)}(null===(a=M)||void 0===a?void 0:a.hash)!==e.hash&&(w.onclick=function(){(0,y.ID)(e.hash)}),(null===(n=M)||void 0===n?void 0:n.LocationName)!==e.LocationName&&(x.innerText=e.LocationName),Z!==i&&(E.setAttribute("animation",(0,p.xZ)(i)),T.setAttribute("animation",(0,p.xZ)(i))),N!==t&&(E.setAttribute("skeleton-screen",(0,p.xZ)(t)),T.setAttribute("skeleton-screen",(0,p.xZ)(t)),$.setAttribute("skeleton-screen",(0,p.xZ)(t)));var J=(0,u.jg)(k,".bh"),U=J.length;if(C!==U){var W=U-C;if(W<0){for(var K=new DocumentFragment,X=new DocumentFragment,G=0;G>W;G--){var V=ae();K.appendChild(V);var te=ne();X.appendChild(te)}k.append(K),_.append(X)}else for(var oe=(0,u.jg)(_,".ug"),le=U-1,ue=U-W-1;le>ue;le--)J[le].remove(),oe[le].remove()}for(var ce=(0,u.jg)(k,".bh"),pe=0;pe<C;pe++){var he=`g_${pe}`,ve=ce[pe],me=(0,u.aI)(ve,".kh"),fe=(0,u.jg)(me,".lh"),ge=fe.length;if(I[he]!==ge){var be=ge-I[he];if(be<0){for(var ye=new DocumentFragment,Ae=0;Ae>be;Ae--){var Ce=ie();ye.appendChild(Ce)}me.append(ye)}else for(var Ie=ge-1,Le=ge-be-1;Ie>Le;Ie--)fe[Ie].remove()}var Ee=(0,u.aI)(ve,".ch"),xe=(0,u.aI)(Ee,".dh"),we=(0,u.jg)(xe,".fh"),ke=we.length,Te=j[he].properties.length;if(Te!==ke){var _e=ke-Te;if(_e<0){for(var $e=new DocumentFragment,je=0;je>_e;je--){var Se=re();$e.appendChild(Se)}xe.append($e)}else for(var Me=ke-1,Ze=ke-_e-1;Me>Ze;Me--)we[Me].remove()}}var Ne=(0,u.jg)(_,".ug"),Pe=(0,u.jg)(k,".bh");_.style.setProperty("--ig",`${S}px`);for(var De=0;De<C;De++){var Qe=`g_${De}`,Re=Ne[De];(0,u.aI)(Re,"span").innerText=j[Qe].name,Re.style.setProperty("--eg",`${R[Qe].offset}px`),Re.style.setProperty("--fg",`${R[Qe].width}px`),Re.style.setProperty("--vg",De.toString());for(var Ye=Pe[De],qe=(0,u.jg)(Ye,".ch .dh .fh"),Fe=(0,u.jg)(Ye,".kh .lh"),He=j[Qe].properties.length,ze=0;ze<He;ze++){var Be=j[Qe].properties[ze],Oe=qe[ze];if((0,p.mQ)(M,"groups"))if((0,p.mQ)(M.groups,Qe))if(M.groups[Qe].properties[ze])o(Oe,Be,M.groups[Qe].properties[ze]);else o(Oe,Be,null);else o(Oe,Be,null);else o(Oe,Be,null)}for(var Je=0;Je<I[Qe];Je++){var Ue=Fe[Je],We=L[Qe][Je];if((0,p.mQ)(M,"groupedItems"))if((0,p.mQ)(M.groupedItems,Qe))if(M.groupedItems[Qe][Je])d(Ue,We,M.groupedItems[Qe][Je]);else d(Ue,We,null);else d(Ue,We,null);else d(Ue,We,null)}}M=e,Z=i,N=t}function le(){return ue.apply(this,arguments)}function ue(){return(ue=(0,a.A)(function*(){var e=(0,l.Js)("playing_animation"),t=(0,l.Js)("refresh_interval"),i=(0,m.gO)("location-bus-arrival-time-chart");B=t.dynamic,F=t.baseInterval,W=!0,U=(0,p.zx)(),S.setAttribute("refreshing","true"),S.classList.remove("_g"),document.addEventListener(U,te);var a=yield(0,d.R)(G,i.width,i.height,U);oe(a,!1,e);var r=0;B&&(r=yield(0,n.wz)()),O=(new Date).getTime(),J=B?Math.max(O+H,a.dataUpdateTime+F/r):O+F,z=Math.max(H,J-O),W=!1,S.setAttribute("refreshing","false"),S.style.setProperty("--lg",`${z}ms`),S.classList.add("_g")})).apply(this,arguments)}function ce(){le().then(function(){K?setTimeout(function(){ce()},Math.max(H,J-(new Date).getTime())):X=!1}).catch(function(e){K?((0,f.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){ce()},1e4)):X=!1})}function pe(e){(0,m.WR)("Location"),(0,o.XK)("location",e),G=e,P=0,R={},I.setAttribute("displayed","true"),k.scrollLeft=0,k.focus(),function(e){for(var t=(0,l.Js)("playing_animation"),i=(0,m.gO)("window"),a=(i.width,i.height),n={g_0:Math.floor(a/50)+5,g_1:Math.floor(a/50)+5},r={},d=0;d<2;d++){var s=`g_${d}`;r[s]=[];for(var o=0;o<n[s];o++)r[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}oe({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:n,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,X?le():(X=!0,ce())),(0,m.Z_)()}function he(){I.setAttribute("displayed","false"),K=!1,(0,m.l$)()}function ve(e,t){var i,a=(0,u.aI)(e,".fi"),n=(0,u.aI)(a,".gi"),r=A((0,u.jg)(n,'.hi[highlighted="true"][type="tab"]'));try{for(r.s();!(i=r.n()).done;){i.value.setAttribute("highlighted","false")}}catch(e){r.e(e)}finally{r.f()}switch((0,u.aI)(n,`.hi[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,u.aI)(e,".li").setAttribute("displayed","true"),(0,u.aI)(e,".mi").setAttribute("displayed","false");break;case 1:(0,u.aI)(e,".li").setAttribute("displayed","false"),(0,u.aI)(e,".mi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=fc1b26235b50fb4583c1.js.map