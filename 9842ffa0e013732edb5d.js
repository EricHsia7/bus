"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[806],{904:(e,t,n)=>{n.d(t,{AE:()=>S,BM:()=>I,WR:()=>m,Z_:()=>b,gO:()=>_,kr:()=>g,l$:()=>w});var r=n(8024),a=n(3648),i=n(4927),o=n(6052),s=n(9333),c=n(8379),u=n(7908),d=n(5693),l=n(7891),f=n(5009),v=n(6104),p=100,h=(new Date).getTime(),y=["Home"];function m(e){var t=y.length;y[t-1]!==e&&y.push(e)}function g(e){if(y.indexOf(e)>-1){var t=y.length;y[t-1]===e&&y.pop()}}function b(){var e=y.length;if(e>1)switch(y[e-2]){case"Home":case"FolderIconSelector":case"Location":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":default:break;case"FolderCreator":(0,o.z1)();break;case"FolderEditor":(0,s.I6)();break;case"FolderManager":(0,c.m)();break;case"Search":(0,f.Bb)();break;case"Settings":(0,v.os)();break;case"PersonalScheduleManager":(0,l.Z)();break;case"PersonalScheduleEditor":(0,d.Xy)();break;case"Bus":(0,i.F)();break;case"RegisterNotification":(0,u.hy)()}}function w(){var e=y.length;if(e>1){var t=y[e-2];switch(y.pop(),t){case"Home":case"FolderIconSelector":case"Location":case"Route":case"RouteDetails":case"SaveToFolder":case"SettingsOptions":case"DataUsage":case"PersonalScheduleCreator":case"ScheduleNotification":case"NotificationScheduleManager":default:break;case"FolderCreator":(0,o.pd)();break;case"FolderEditor":(0,s.uy)();break;case"FolderManager":(0,c.g)();break;case"Search":(0,f.rf)();break;case"Settings":(0,v.Ow)();break;case"PersonalScheduleManager":(0,l.z)();break;case"PersonalScheduleEditor":(0,d.bF)();break;case"Bus":(0,i.$)();break;case"RegisterNotification":(0,u.XG)()}}}function I(){var e=0;(0,r.t9)()&&(e=-1*(window.outerHeight-window.innerHeight)/2),(0,a.bv)(".f svg.g").style.setProperty("--h",`${e}px`)}function S(e){function t(){var t=(0,a.bv)(".f");t.classList.add("i"),t.addEventListener("animationend",(function(){t.setAttribute("displayed","false"),t.classList.remove("i"),"function"==typeof e&&e()}),{once:!0})}var n=(new Date).getTime();n-h<p?setTimeout(t,Math.max(1,n-h)):t()}function _(e){var t=0,n=0,r=window.innerWidth,a=window.innerHeight;switch(e){case"window":t=r,n=a;break;case"head":t=r,n=55;break;case"head-one-button":t=r-55,n=55;break;case"head-two-button":t=r-110,n=55;break;case"route-details-canvas":t=r-20-20,n=1440;break;case"route-bus-arrival-time-chart":t=r-45-15-20,n=75;break;case"location-bus-arrival-time-chart":t=r-30-20,n=75;break;default:t=0,n=0}return{width:t,height:n}}},3030:(e,t,n)=>{n.d(t,{az:()=>fe,dM:()=>ve,eS:()=>le,s_:()=>K,so:()=>de,uj:()=>ee});var r=n(2757),a=n(4537),i=n(6788),o=n(3459),s=n(8024),c=n(7968),u=n(3648),d=n(5767),l=n(904),f=n(9119),v=n(5314),p=n(5579),h=n(9566),y=n(4636);function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var w=(0,u.bv)(".j"),I=(0,u.aI)(w,".k"),S=(0,u.aI)(I,".l"),_=(0,u.aI)(w,".m"),A=(0,u.aI)(I,".n"),$=(0,u.aI)(A,".o"),k=(0,u.aI)(I,".p"),T=(0,u.aI)(k,".q"),L=(0,u.aI)(I,".r .s"),M={},E=!0,x=!1,P=0,R=0,D=0,F={},O=0,B=!1,H=1e4,j=15e3,C=5e3,Z=15e3,U=!0,N=!1,z=0,q=0,W=!1,G="",Q=-1,Y=-1,J=!1,X="",V=20;function K(){_.addEventListener("touchstart",(function(){P=Math.round(_.scrollLeft/O)}),{passive:!0}),_.addEventListener("scroll",(function(e){B=!0;var t=e.target.scrollLeft/O;R=t>P?P+1:P-1;var n=F[`g_${P}`]||{width:0,offset:0},r=F[`g_${R}`]||{width:0,offset:0},a=n.width+(r.width-n.width)*Math.abs(t-P),i=-1*(n.offset+(r.offset-n.offset)*Math.abs(t-P))+.5*O-.5*a;te(D,i,a-V,t),t===R&&(P=Math.round(_.scrollLeft/O),B=!1)}),{passive:!0})}function ee(){var e=(0,l.gO)("window"),t=e.width,n=e.height;w.style.setProperty("--t",`${t}px`),w.style.setProperty("--u",`${n}px`)}function te(e,t,n,r){_.style.setProperty("--v",e.toString()),T.style.setProperty("--w",(n/10).toString()),$.style.setProperty("--x",`${t.toFixed(5)}px`),$.style.setProperty("--y",r.toFixed(5))}function ne(){var e=(new Date).getTime();W?(Y=-1+(0,i._M)(G),Q=.7*(Y-Q)):(Y=-1*Math.min(1,Math.max(0,Math.abs(e-z)/Z)),Q=Y),L.style.setProperty("--z",Q.toString()),window.requestAnimationFrame((function(){N&&ne()}))}function re(){var e=(0,s.zx)("i"),t=document.createElement("div");return t.classList.add("_"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0"),t.innerHTML=`<div class="aa"><div class="ba"><div class="ca" code="-1"></div><div class="da" code="-1"></div></div><div class="ea"></div><div class="fa"></div><div class="ga"><div class="ha"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="ka" onclick="bus.location.stretchLocationItem('${e}')">${(0,a.Z)("keyboard_arrow_down")}</div><div class="la"></div></div></div><div class="ma" displayed="false"><div class="na"><div class="oa" highlighted="true" type="tab" onclick="bus.location.switchLocationBodyTab('${e}', 0)" code="0"><div class="pa">${(0,a.Z)("directions_bus")}</div>公車</div><div class="oa" highlighted="false" type="tab" onclick="bus.location.switchLocationBodyTab('${e}', 1)" code="1"><div class="pa">${(0,a.Z)("departure_board")}</div>抵達時間</div><div class="oa" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-location', ['${e}', null, null])"><div class="pa">${(0,a.Z)("folder")}</div>儲存至資料夾</div><div class="oa" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-location', ['${e}', null, null, null])" enabled="true"><div class="pa">${(0,a.Z)("notifications")}</div>設定到站通知</div></div><div class="qa" displayed="true"></div><div class="ra" displayed="false"></div></div>`,{element:t,id:e}}function ae(){var e=document.createElement("div");return e.classList.add("wa"),{element:e,id:""}}function ie(){var e=document.createElement("div");return e.classList.add("xa"),e.innerHTML='<div class="ya"></div><div class="za"></div>',{element:e,id:""}}function oe(e,t,n){function r(e,r,i){function o(e,t,n){var r=e.getBoundingClientRect(),a=r.top,i=r.left,o=r.bottom,s=r.right,c=window.innerWidth,d=window.innerHeight,l=(0,u.aI)(e,".ha"),f=(0,u.aI)(l,".ia"),v=(0,u.aI)(l,".ja");f.setAttribute("code",t.status.code.toString()),f.innerText=t.status.text,n&&o>0&&a<d&&s>0&&i<c?(v.addEventListener("animationend",(function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("_a")}),{once:!0}),v.classList.add("_a")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}function c(e,t,n){var r=e.getBoundingClientRect(),a=r.top,i=r.left,o=r.bottom,s=r.right,c=window.innerWidth,d=window.innerHeight,l=(0,u.aI)(e,".ba"),f=(0,u.aI)(l,".ca"),v=(0,u.aI)(l,".da");f.setAttribute("code",t.ranking.code.toString()),f.innerText=t.ranking.text,n&&o>0&&a<d&&s>0&&i<c?(v.addEventListener("animationend",(function(){v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text,v.classList.remove("ab")}),{once:!0}),v.classList.add("ab")):(v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text)}function d(e,t){(0,u.aI)(e,".ea").innerText=t.route_direction}function l(e,t){(0,u.aI)(e,".fa").innerText=t.route_name}function f(e,t){(0,u.aI)(e,".qa").innerHTML=0===t.buses.length?'<div class="bb">目前沒有公車可顯示</div>':t.buses.map((function(e){return`<div class="cb" on-this-route="${e.onThisRoute}"><div class="db"><div class="eb">${(0,a.Z)("directions_bus")}</div><div class="fb">${e.carNumber}</div></div><div class="gb"><div class="hb">路線：${e.RouteName}</div><div class="ib">狀態：${e.status.text}</div><div class="jb">類型：${e.type}</div></div></div>`})).join("")}function v(e,t){(0,u.aI)(e,".ra").innerHTML=0===t.busArrivalTimes.length?'<div class="kb">目前沒有抵達時間可顯示</div>':t.busArrivalTimes.map((function(e){return`<div class="lb"><div class="mb"><div class="nb">${(0,a.Z)("calendar_view_day")}</div><div class="ob">${e.personalSchedule.name}</div><div class="pb">週${(0,p.kd)(e.day).name} ${(0,p.pn)(e.personalSchedule.period.start)} - ${(0,p.pn)(e.personalSchedule.period.end)}</div></div><div class="qb">${e.chart}</div></div>`})).join("")}function m(e,t){t&&e.setAttribute("stretched","false")}function g(e,t){e.setAttribute("animation",(0,s.xZ)(t))}function b(e,t){e.setAttribute("skeleton-screen",(0,s.xZ)(t))}function w(e,t){var n=(0,u.aI)(e,".ma"),r=(0,u.aI)(n,".na"),a=(0,u.aI)(r,'.oa[type="save-to-folder"]');a.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-location', ['${e.id}', ${t.stopId}, ${t.routeId}])`),(0,h.LH)("stop",t.stopId).then((function(e){a.setAttribute("highlighted",(0,s.xZ)(e))}))}function I(e,t){var n=(0,u.aI)(e,".ma"),r=(0,u.aI)(n,".na"),a=(0,u.aI)(r,'.oa[type="schedule-notification"]');a.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-location', ['${e.id}', ${t.stopId}, ${t.routeId}, ${t.status.time}])`);var i=(0,y.Zc)(t.stopId);a.setAttribute("highlighted",(0,s.xZ)(i))}null===i?(o(e,r,n),c(e,r,n),d(e,r),l(e,r),f(e,r),v(e,r),m(e,t),g(e,n),b(e,t),w(e,r),I(e,r)):(r.status.time!==i.status.time&&(o(e,r,n),I(e,r)),i.ranking.number===r.ranking.number&&i.ranking.code===r.ranking.code||c(e,r,n),i.stopId!==r.stopId&&(d(e,r),l(e,r),w(e,r)),(0,s.hw)(i.buses,r.buses)||f(e,r),(0,s.hw)(i.busArrivalTimes,r.busArrivalTimes)||v(e,r),n!==E&&g(e,n),t!==x&&(m(e,t),b(e,t)))}function i(e,r,i){function o(e,t){(0,u.aI)(e,".ya").innerHTML=(0,a.Z)(t.icon)}function c(e,t){(0,u.aI)(e,".za").innerHTML=t.value}function d(e,t){e.setAttribute("animation",(0,s.xZ)(t))}function l(e,t){e.setAttribute("skeleton-screen",(0,s.xZ)(t))}null===i?(o(e,r),c(e,r),d(e,n),l(e,t)):((0,s.hw)(i.icon,r.icon)||o(e,r),(0,s.hw)(i.value,r.value)||c(e,r),n!==E&&d(e,n),t!==x&&l(e,t))}var o=(0,l.gO)("window"),d=o.width,f=o.height,v=e.groupQuantity,m=e.itemQuantity,g=e.groupedItems,b=e.groups;D=v,O=d;for(var w=0,I=0;I<v;I++){var T=(0,c.q_)(b[`g_${I}`].name,500,"17px",'"Noto Sans TC", sans-serif')+V;F[`g_${I}`]={width:T,offset:w},w+=T}var L=-1*F[`g_${P}`].offset+.5*O-.5*F[`g_${P}`].width;B||te(D,L,F[`g_${P}`].width-V,P),S.innerHTML=`<span>${e.LocationName}</span>`,S.setAttribute("animation",(0,s.xZ)(n)),S.setAttribute("skeleton-screen",(0,s.xZ)(t)),A.setAttribute("animation",(0,s.xZ)(n)),A.setAttribute("skeleton-screen",(0,s.xZ)(t)),k.setAttribute("skeleton-screen",(0,s.xZ)(t));var R,H=(0,u.jg)(_,".sa").length;if(v!==H){var j=H-v;if(j<0)for(var C=0;C<Math.abs(j);C++){var Z=(R=void 0,(R=document.createElement("div")).classList.add("sa"),R.innerHTML='<div class="ta"><div class="ua"></div></div><div class="va"></div>',{element:R,id:""});_.appendChild(Z.element);var U=ae();$.appendChild(U.element)}else for(var N=(0,u.jg)(_,".sa"),z=(0,u.jg)($,".wa"),q=0;q<Math.abs(j);q++){var W=H-1-q;N[W].remove(),z[W].remove()}}for(var G=(0,u.jg)(_,".sa"),Q=0;Q<v;Q++){var Y=`g_${Q}`,J=G[Q],X=(0,u.jg)(J,".va ._").length;if(m[Y]!==X){var K=X-m[Y];if(K<0)for(var ee=(0,u.aI)(J,".va"),ne=0;ne<Math.abs(K);ne++){var oe=re();ee.appendChild(oe.element)}else for(var se=(0,u.jg)(J,".va ._"),ce=0;ce<Math.abs(K);ce++){se[X-1-ce].remove()}}var ue=(0,u.jg)((0,u.jg)(_,".sa")[Q],".ta .ua .xa").length,de=b[Y].properties.length;if(de!==ue){var le=ue-de;if(le<0)for(var fe=(0,u.aI)(J,".ta"),ve=(0,u.aI)(fe,".ua"),pe=0;pe<Math.abs(le);pe++){var he=ie();ve.appendChild(he.element)}else for(var ye=(0,u.aI)(J,".ta"),me=(0,u.aI)(ye,".ua"),ge=(0,u.jg)(me,".xa"),be=0;be<Math.abs(le);be++){ge[ue-1-be].remove()}}}for(var we=0;we<v;we++){var Ie=`g_${we}`,Se=(0,u.jg)($,".wa")[we];Se.innerHTML=`<span>${b[Ie].name}</span>`,Se.style.setProperty("--rb",`${F[Ie].width}px`),Se.style.setProperty("--sb",we.toString());for(var _e=(0,u.jg)(_,".sa")[we],Ae=b[Ie].properties.length,$e=0;$e<Ae;$e++){var ke=b[Ie].properties[$e],Te=(0,u.jg)(_e,".ta .ua .xa")[$e];if(M.hasOwnProperty("groups"))if(M.groups.hasOwnProperty(Ie))if(M.groups[Ie].properties[$e])i(Te,ke,M.groups[Ie].properties[$e]);else i(Te,ke,null);else i(Te,ke,null);else i(Te,ke,null)}for(var Le=0;Le<m[Ie];Le++){var Me=(0,u.jg)(_e,".va ._")[Le],Ee=g[Ie][Le];if(M.hasOwnProperty("groupedItems"))if(M.groupedItems.hasOwnProperty(Ie))if(M.groupedItems[Ie][Le])r(Me,Ee,M.groupedItems[Ie][Le]);else r(Me,Ee,null);else r(Me,Ee,null);else r(Me,Ee,null)}}M=e,E=n,x=t}function se(){return ce.apply(this,arguments)}function ce(){var e;return e=function*(){var e=(0,o.Js)("playing_animation"),t=(0,o.Js)("refresh_interval"),n=(0,l.gO)("location-bus-arrival-time-chart");U=t.dynamic,j=t.baseInterval,W=!0,G=(0,s.zx)("r"),L.setAttribute("refreshing","true");var a=yield(0,r.R)(X,n.width,n.height,G);oe(a,!1,e);var i=0;U&&(i=yield(0,d.wz)()),z=(new Date).getTime(),q=U?Math.max(z+C,a.dataUpdateTime+j/i):z+j,Z=Math.max(C,q-z),W=!1,L.setAttribute("refreshing","false")},ce=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){b(i,r,a,o,s,"next",e)}function s(e){b(i,r,a,o,s,"throw",e)}o(void 0)}))},ce.apply(this,arguments)}function ue(){se().then((function(){N?setTimeout((function(){ue()}),Math.max(C,q-(new Date).getTime())):J=!1})).catch((function(e){console.error(e),N?((0,f.a)(`地點網路連線中斷，將在${H/1e3}秒後重試。`,"error"),setTimeout((function(){ue()}),H)):J=!1}))}function de(e){(0,l.WR)("Location"),(0,v.XK)("location",e),X=e,P=0,w.setAttribute("displayed","true"),_.scrollLeft=0,function(){for(var e=(0,o.Js)("playing_animation"),t=(0,l.gO)("window"),n=(t.width,t.height),r={g_0:Math.floor(n/50)+5,g_1:Math.floor(n/50)+5},a={},i=0;i<2;i++){var s=`g_${i}`;a[s]=[];for(var c=0;c<r[s];c++)a[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}oe({groupedItems:a,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:r,LocationName:"載入中",dataUpdateTime:0},!0,e)}(),N||(N=!0,J?se():(J=!0,ue()),Q=-1,Y=-1,ne()),(0,l.Z_)()}function le(){w.setAttribute("displayed","false"),N=!1,Q=-1,Y=-1,(0,l.l$)()}function fe(e){var t=(0,u.aI)(_,`.sa .va ._#${e}`),n=(0,u.aI)(t,".ma"),r=t.parentElement,a=(0,u.ji)(t,"_"),i=a.length,o=r.getBoundingClientRect(),s=t.getBoundingClientRect().top-o.top,c="true"===t.getAttribute("stretched"),d="true"===t.getAttribute("animation");if(d){var l=c?"2":"1";t.setAttribute("stretching","true"),t.style.setProperty("--ub",`${s}px`);for(var f=0;f<i;f++){var v=a[f];v.setAttribute("push-direction",l),v.setAttribute("push-state","1")}t.addEventListener("transitionend",(function(){for(var e=0;e<i;e++){var n=a[e];n.setAttribute("push-direction","0"),n.setAttribute("push-state","0")}t.setAttribute("stretching","false")}),{once:!0}),t.addEventListener("transitionstart",(function(){for(var e=0;e<i;e++){a[e].setAttribute("push-state","2")}}),{once:!0})}c?(d?n.addEventListener("transitionend",(function(){n.setAttribute("displayed","false")}),{once:!0}):n.setAttribute("displayed","false"),t.setAttribute("stretched","false")):(n.setAttribute("displayed","true"),t.setAttribute("stretched","true"))}function ve(e,t){var n,r=(0,u.aI)(_,`.sa .va ._#${e}`),a=(0,u.aI)(r,".ma"),i=(0,u.aI)(a,".na"),o=m((0,u.jg)(i,'.oa[highlighted="true"][type="tab"]'));try{for(o.s();!(n=o.n()).done;){n.value.setAttribute("highlighted","false")}}catch(e){o.e(e)}finally{o.f()}switch((0,u.aI)(i,`.oa[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,u.aI)(r,".qa").setAttribute("displayed","true"),(0,u.aI)(r,".ra").setAttribute("displayed","false");break;case 1:(0,u.aI)(r,".qa").setAttribute("displayed","false"),(0,u.aI)(r,".ra").setAttribute("displayed","true")}}},4927:(e,t,n)=>{n.d(t,{F:()=>w,$:()=>b});var r=n(6160),a=n(5314),i=n(3459),o=n(8024),s=n(3648),c=n(904),u=n(4537),d=[],l=!1,f=!0;function v(e,t,n,r){function a(e,t,a){function i(e,t){(0,s.aI)(e,".wb").innerHTML=(0,u.Z)(t.icon)}function c(e,t){(0,s.aI)(e,".xb").innerText=t.value}function d(e,t){e.setAttribute("animation",t)}function v(e,t){e.setAttribute("skeleton-screen",t)}null===a?(i(e,t),c(e,t),v(e,n),d(e,r)):((0,o.hw)(a,t)||i(e,t),(0,o.hw)(a,t)||c(e,t),n!==l&&v(e,n),r!==f&&d(e,r))}var i,c=t.length,v=(0,s.jg)(e,".yb .vb").length;if(c!==v){var p=v-c;if(p<0)for(var h=0;h<Math.abs(p);h++){var y=(i=void 0,(i=document.createElement("div")).classList.add("vb"),i.innerHTML='<div class="wb"></div><div class="xb"></div>',{element:i,id:""});(0,s.aI)(e,".yb").appendChild(y.element)}else for(var m=0;m<Math.abs(p);m++){var g=v-1-m;(0,s.jg)(e,".yb .vb")[g].remove()}}for(var b=(0,s.jg)(e,".yb .vb"),w=0;w<c;w++){var I=b[w],S=t[w];0===d.length?a(I,S,null):a(I,S,d[w])}d=t,f=r,l=n}function p(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var h=(0,s.bv)(".zb"),y=((0,s.aI)(h,"._b"),(0,s.aI)(h,".ac")),m=(0,s.aI)(y,".bc"),g=(0,s.aI)(m,'.cc[group="properties"]');(0,s.aI)(m,'.cc[group="location"]');function b(e){(0,c.WR)("Bus"),(0,a.XK)("bus",e),h.setAttribute("displayed","true"),function(e){I.apply(this,arguments)}(e),(0,c.Z_)()}function w(){h.setAttribute("displayed","false"),(0,c.l$)()}function I(){var e;return e=function*(e){!function(e){for(var t=(0,i.Js)("playing_animation"),n=[],r=0;r<5;r++)n.push({key:r,icon:"none",value:""});v(e,n,!0,t)}(g);var t=(0,i.Js)("playing_animation"),n=(0,o.zx)("r"),a=yield(0,r.i)(e,n);v(g,a.properties,!1,t)},I=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){p(i,r,a,o,s,"next",e)}function s(e){p(i,r,a,o,s,"throw",e)}o(void 0)}))},I.apply(this,arguments)}},6052:(e,t,n)=>{n.d(t,{c6:()=>f,pd:()=>v,z1:()=>p});var r=n(9566),a=n(3648),i=n(904),o=n(9119),s=(0,a.bv)(".dc"),c=(0,a.aI)(s,".ec"),u=(0,a.aI)(c,".fc"),d=(0,a.aI)(u,'.gc[group="folder-name"] .hc input'),l=(0,a.aI)(u,'.gc[group="folder-icon"] .hc .ic input');function f(){var e=d.value,t=l.value;(0,r.vV)(e,t).then((function(e){e?(p(),(0,o.a)("已建立資料夾","folder")):(0,o.a)("無法建立資料夾","error")}))}function v(){(0,i.WR)("FolderCreator"),s.setAttribute("displayed","true"),(0,i.Z_)()}function p(){s.setAttribute("displayed","false"),(0,i.l$)()}},7084:(e,t,n)=>{n.d(t,{default:()=>ye});var r=n(5009),a=n(5767),i=n(8925),o=n(1531),s=n(4690),c=n(4474),u=n(8332),d=n(3030),l=n(9469),f=n(9566),v=n(6082),p=n(3251),h=n(6104),y=n(6166),m=n(3459),g=n(904),b=n(3648),w=n(3041),I=n(8379),S=n(9333),_=n(9930),A=n(972),$=n(8024),k=n(4781),T=n(4537),L=n(9119);function M(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return E(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var P="",R=(0,b.bv)(".jc"),D=(0,b.bv)(".dc"),F=(0,b.bv)(".kc");function O(e){var t=(0,$.zx)("i"),n=document.createElement("div");return n.id=t,n.classList.add("lc"),n.setAttribute("onclick",`bus.folder.selectFolderIcon('${e}', '${P}')`),n.innerHTML=(0,T.Z)(e),{element:n,id:t}}function B(){var e;return e=function*(){var e=(0,b.aI)(F,".mc .nc");e.innerHTML="";var t,n=(0,$.zx)("r"),r=M(yield(0,_.z)(n));try{for(r.s();!(t=r.n()).done;){var a=O(t.value);e.appendChild(a.element)}}catch(e){r.e(e)}finally{r.f()}},B=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){x(i,r,a,o,s,"next",e)}function s(e){x(i,r,a,o,s,"throw",e)}o(void 0)}))},B.apply(this,arguments)}function H(e){var t=(0,b.aI)(F,".mc .oc"),n=(0,b.aI)(F,".mc .nc");if(t.innerHTML="",!(0,k.iO)(e)){var r,a=(0,A.U)(e,100),i=M(a);try{for(i.s();!(r=i.n()).done;){var o=O(r.value.item);t.appendChild(o.element)}}catch(e){i.e(e)}finally{i.f()}t.setAttribute("displayed",a.length>0?"true":"false"),n.setAttribute("displayed",a.length>0?"false":"true")}}function j(){(0,g.kr)("FolderIconSelector"),F.setAttribute("displayed","false")}var C=n(6052),Z=n(540),U=n(7183),N=n(5579);function z(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var q=(0,b.bv)(".wc"),W=(0,b.aI)(q,".xc"),G=(0,b.aI)(W,".yc"),Q=(0,b.aI)(W,".zc"),Y=(0,b.aI)(Q,'._c[name="total-data-usage"] .ad'),J=(0,b.aI)(Q,'._c[name="start-time"] .ad'),X=(0,b.aI)(Q,'._c[name="end-time"] .ad');function V(){var e;return e=function*(){var e=(0,g.gO)("window"),t=e.width,n=Math.min(5/18*t,.33*e.height),r=yield(0,i.LN)(t,n,20);Y.innerText=(0,U.tH)(r.stats.sum),J.innerText=(0,N.$T)(r.period.start,"YYYY-MM-DD"),X.innerText=(0,N.$T)(r.period.end,"YYYY-MM-DD"),G.innerHTML=r.chart},V=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){z(i,r,a,o,s,"next",e)}function s(e){z(i,r,a,o,s,"throw",e)}o(void 0)}))},V.apply(this,arguments)}var K=n(2994),ee=n(7891),te=n(8380),ne=n(5693),re=n(6483),ae=n(4927),ie=n(5314),oe=n(6091),se=n(7908),ce=n(4636),ue=n(752),de=n(2174),le=n(9009),fe=n(7599),ve=n(1238),pe=!1,he=!1;window.bus={initialize:function(){!1===pe&&(pe=!0,(0,g.BM)(),(0,m.Yq)().then((function(){var e=(0,b.bv)(".bd .cd .dd");(0,oe.Q)(e);var t=(0,b.bv)(".bd .cd .ed");(0,Z.F)(t),(0,p.A)().then((function(e){"ok"===e&&(0,fe.P)().then((function(){(0,s.S5)(),(0,d.s_)(),(0,s.aB)(),(0,d.uj)(),(0,r.ld)(),window.addEventListener("resize",(function(){(0,s.aB)(),(0,d.uj)(),(0,r.ld)()})),screen&&screen.orientation&&screen.orientation.addEventListener("change",(function(){(0,s.aB)(),(0,d.uj)(),(0,r.ld)()})),(0,oe.u)(),(0,f.Rh)().then((function(){(0,Z.a)()}));var e=window.matchMedia("(prefers-color-scheme: dark)"),t=(0,b.bv)(".fd .gd .hd #search_input");e.addEventListener("change",(function(){(0,r.gn)(t.selectionStart,t.selectionEnd)})),t.addEventListener("paste",(function(){(0,r.RC)(),(0,r.gn)(t.selectionStart,t.selectionEnd)})),t.addEventListener("cut",(function(){(0,r.RC)(),(0,r.gn)(t.selectionStart,t.selectionEnd)})),t.addEventListener("selectionchange",(function(){(0,r.RC)(),(0,r.gn)(t.selectionStart,t.selectionEnd)})),document.addEventListener("selectionchange",(function(){(0,r.RC)(),(0,r.gn)(t.selectionStart,t.selectionEnd)})),t.addEventListener("keyup",(function(){(0,r.RC)(),(0,r.gn)(t.selectionStart,t.selectionEnd)}));var n=(0,b.bv)(".kc .id .jd #search_material_symbols_input");n.addEventListener("paste",(function(){H(n.value)})),n.addEventListener("cut",(function(){H(n.value)})),n.addEventListener("selectionchange",(function(){H(n.value)})),document.addEventListener("selectionchange",(function(){H(n.value)})),n.addEventListener("keyup",(function(){H(n.value)})),(0,l._)(),(0,g.AE)((function(){(0,ce.Db)(),(0,ce.cS)().then((function(){(0,ce.z9)()})),document.addEventListener("click",(function(){(0,o.to)(),(0,ve.q)()}),{once:!0})}))})),"fetchError"!==e&&"unknownError"!==e||((0,g.AE)(),alert(e))})).catch((function(e){(0,g.AE)(),alert(e)}))})))},secondlyInitialize:function(){he||(he=!0,(0,v.X)(),(0,a.fV)(),(0,i.Ir)(),(0,re.$t)(),(0,ie.FU)(),(0,a.fV)().then((function(){(0,a.MN)().then((function(){(0,a.cy)()}))})))},route:{stretchRouteItem:s.aU,openRoute:s.SR,closeRoute:s.U7,switchRoute:s.Ch,switchRouteBodyTab:s.py,openRouteDetails:c.GS,closeRouteDetails:c.GZ,shareRoutePermalink:u.w,switchCalendarDay:le.f4},location:{openLocation:d.so,closeLocation:d.eS,stretchLocationItem:d.az,switchLocationBodyTab:d.dM},folder:{openSaveToFolder:w.BI,closeSaveToFolder:w.nS,openFolderManager:I.g,closeFolderManager:I.m,openFolderEditor:S.uy,closeFolderEditor:S.I6,openFolderIconSelector:function(e){var t;switch((0,g.WR)("FolderIconSelector"),e){case"editor":P="editor",t=(0,b.aI)(R,'.pc .qc .rc[group="folder-icon"] .sc .tc .uc');break;case"creator":P="creator",t=(0,b.aI)(D,'.ec .fc .gc[group="folder-icon"] .hc .ic .vc')}"false"===t.getAttribute("disabled")&&(v.m?(F.setAttribute("displayed","true"),function(){B.apply(this,arguments)}(P),(0,A.L)()):(0,L.a)("資料還在下載中","download_for_offline"))},closeFolderIconSelector:j,openFolderCreator:C.pd,closeFolderCreator:C.z1,createFormulatedFolder:C.c6,saveEditedFolder:S.Bo,selectFolderIcon:function(e){var t;switch(P){case"editor":t=(0,b.aI)(R,'.pc .qc .rc[group="folder-icon"] .sc .tc input');break;case"creator":t=(0,b.aI)(D,'.ec .fc .gc[group="folder-icon"] .hc .ic input')}t.value=e,j()},saveStopItemOnRoute:w.JL,saveStopItemOnLocation:w.Lb,saveRouteOnDetailsPage:w.Dh,saveRouteOnRoute:w.jD,removeItemOnFolderEditor:S.cG,moveItemOnFolderEditor:S.Lq},search:{openSearch:r.rf,closeSearch:r.Bb,typeTextIntoInput:r._O,deleteCharFromInout:r.d$,emptyInput:r.Wb,openSystemKeyboard:r.vp,switchSearchTypeFilter:r.H2},storage:{openStorage:K.G,closeStorage:K.Q},dataUsage:{openDataUsage:function(){(0,g.WR)("DataUsage"),q.setAttribute("displayed","true"),function(){V.apply(this,arguments)}(),(0,g.Z_)()},closeDataUsage:function(){q.setAttribute("displayed","false"),(0,g.l$)()}},personalSchedule:{openPersonalScheduleManager:ee.z,closePersonalScheduleManager:ee.Z,openPersonalScheduleCreator:te.I1,closePersonalScheduleCreator:te.GJ,createFormulatedPersonalSchedule:te.Ps,switchPersonalScheduleCreatorDay:te.om,openPersonalScheduleEditor:ne.bF,closePersonalScheduleEditor:ne.Xy,switchPersonalScheduleEditorDay:ne.Dn,saveEditedPersonalSchedule:ne.gv},settings:{openSettings:h.Ow,closeSettings:h.os,openSettingsOptions:y.yH,closeSettingsOptions:y.wx,settingsOptionsHandler:y.Yi,downloadExportFile:h.vv,openFileToImportData:h.rY,viewCommitOfCurrentVersion:h.hP,showPromptToAskForPersistentStorage:h.jk},bus:{openBus:ae.$,closeBus:ae.F},notification:{openNotificationScheduleManager:de.Sv,closeNotificationScheduleManager:de.m_,openRegisterNotification:se.XG,closeRegisterNotification:se.hy,saveFormulatedRegisterNotification:se.NW,openScheduleNotification:ue.Ho,closeScheduleNotification:ue.b$,scheduleNotificationForStopItemOnRoute:ue.H9,scheduleNotificationForStopItemOnLocation:ue.b6,cancelNotificationOnNotificationScheduleManager:de.Gv}};const ye=window.bus},7123:(e,t,n)=>{n.d(t,{R:()=>g});var r=n(6483),a=n(6802),i=n(7810),o=n(2063),s=n(8011),c=n(4293),u=n(1932),d=n(424),l=n(2303),f=n(6788),v=n(3459),p=n(1531);function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function g(e,t,n,r,a){return b.apply(this,arguments)}function b(){var e;return e=function*(e,t,n,y,m){(0,f.Mf)(m,"getRoute_0",0,!1),(0,f.Mf)(m,"getRoute_1",0,!1),(0,f.Mf)(m,"getStop_0",0,!1),(0,f.Mf)(m,"getStop_1",0,!1),(0,f.Mf)(m,"getLocation_0",0,!1),(0,f.Mf)(m,"getLocation_1",0,!1),(0,f.Mf)(m,"getSegmentBuffers_0",0,!1),(0,f.Mf)(m,"getSegmentBuffers_1",0,!1),(0,f.Mf)(m,"getEstimateTime_0",0,!1),(0,f.Mf)(m,"getEstimateTime_1",0,!1),(0,f.Mf)(m,"getBusEvent_0",0,!1),(0,f.Mf)(m,"getBusEvent_1",0,!1),(0,f.Mf)(m,"getBusData_0",0,!1),(0,f.Mf)(m,"getBusData_1",0,!1);var g=yield(0,c.a)(m,!0),b=yield(0,d.T)(m),w=yield(0,s.g)(m,!1),I=yield(0,u.L)(m),S=yield(0,o.K)(m),_=yield(0,i.J)(m),A=yield(0,a.d)(m),$=yield(0,r.Io)(n,y),k=(0,l.w_)(_,A,g,e,t),T=!1,L={};I.hasOwnProperty(`r_${e}`)&&(T=!0,L=I[`r_${e}`]);var M,E=(0,v.Js)("time_formatting_mode"),x=[],P=[],R=h(S);try{for(R.s();!(M=R.n()).done;){var D=M.value,F={},O=D.RouteID;if([e,10*e].includes(O)||t.includes(O)){F.status=(0,l.$Q)(null==D?void 0:D.EstimateTime,E);var B=`s_${D.StopID}`,H={};if(!b.hasOwnProperty(B))continue;H=b[B],F.id=D.StopID,F.sequence=H.seqNo,F.goBack=H.goBack;var j=`l_${H.stopLocationId}`,C={};if(!w.hasOwnProperty(j))continue;C=w[j],F.name=C.n,F.overlappingRoutes=C.r.filter((function(t){return t!==e})).map((function(e){var t=`r_${e}`;if(g.hasOwnProperty(t)){var n=g[t];return{name:n.n,RouteEndPoints:{RouteDeparture:n.dep,RouteDestination:n.des,text:`${n.dep} ↔ ${n.des}`,html:`<span>${n.dep}</span><span>↔</span><span>${n.des}</span>`},RouteID:n.id,PathAttributeId:n.pid}}return null})).filter((function(e){return!(null===e)})),F.position={longitude:C.lo,latitude:C.la},P.push({latitude:C.la,longitude:C.lo,id:D.StopID});var Z,U=[],N=h(C.s);try{for(N.s();!(Z=N.n()).done;){var z=`s_${Z.value}`;k.hasOwnProperty(z)&&U.push(k[z].map((function(e){return(0,l.s$)(e)})))}}catch(e){N.e(e)}finally{N.f()}F.buses=U.flat().sort((function(e,t){return e.index-t.index}));var q=[];$.hasOwnProperty(B)&&(q=$[B]),F.busArrivalTimes=q;var W=!1,G=!1,Q=!1,Y=!1;if(T){var J=`g_${F.goBack}`,X=[];L.hasOwnProperty(J)?X=L[J]:"1"===F.goBack&&(Y=!0,X=L.g_0);var V,K=h(X);try{for(K.s();!(V=K.n()).done;){var ee=V.value;ee.OriginStopID!==D.StopID&&ee.DestinationStopID!==D.StopID||(W=!0),Y?(ee.OriginStopID===D.StopID&&(Q=!0),ee.DestinationStopID===D.StopID&&(G=!0)):(ee.OriginStopID===D.StopID&&(G=!0),ee.DestinationStopID===D.StopID&&(Q=!0))}}catch(e){K.e(e)}finally{K.f()}}F.segmentBuffer={isSegmentBuffer:W,isStartingPoint:G,isEndingPoint:Q},x.push(F)}}}catch(e){R.e(e)}finally{R.f()}x.sort((function(e,t){return e.sequence-t.sequence}));for(var te=(0,p.uQ)(P,450),ne=!1,re=!1,ae={},ie=0,oe={},se=x.length,ce=0;ce<se;ce++){var ue=x[ce],de=x[ce+1]||ue,le=0;if(ue.buses.length>0&&ue.buses[0].onThisRoute){var fe=[ue.buses[0].position.longitude,ue.buses[0].position.latitude],ve=fe[0],pe=fe[1],he=[ue.position.longitude,ue.position.latitude],ye=he[0],me=he[1],ge=[de.position.longitude,de.position.latitude],be=ge[0],we=ge[1];if((ve-ye)*(be-ve)+(pe-me)*(we-pe)>=0){var Ie=Math.hypot(ve-ye,pe-me),Se=Math.hypot(ve-be,pe-we);le=Math.max(0,Math.min(Ie/(Ie+Se),1))}}ue.progress=le,ue.segmentBuffer.isStartingPoint&&(ne=!0),ue.segmentBuffer.isEndingPoint&&ne&&(re=!0),ne&&!re&&(ue.segmentBuffer.isSegmentBuffer=!0),ne&&re&&(ne=!1,re=!1);var _e=!1;null!==te&&te.id===ue.id&&(_e=!0),ue.nearest=_e;var Ae=`g_${ue.goBack}`||"g_0";ae.hasOwnProperty(Ae)||(ae[Ae]=[],oe[Ae]=0,ie+=1),ae[Ae].push(ue),oe[Ae]+=1}var $e=g[`r_${e}`],ke={groupedItems:ae,groupQuantity:ie,itemQuantity:oe,RouteName:$e.n,RouteEndPoints:{RouteDeparture:$e.dep,RouteDestination:$e.des},dataUpdateTime:(0,f.Zt)(m),RouteID:e,PathAttributeId:t};return(0,f.LQ)(m),(0,f.gC)(m),ke},b=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){m(i,r,a,o,s,"next",e)}function s(e){m(i,r,a,o,s,"throw",e)}o(void 0)}))},b.apply(this,arguments)}},8379:(e,t,n)=>{n.d(t,{g:()=>v,m:()=>p});var r=n(9566),a=n(8024),i=n(3648),o=n(4537),s=n(904);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function l(e){var t=(0,a.zx)("i"),n=document.createElement("div");return n.classList.add("kd"),n.id=t,n.setAttribute("onclick",`bus.folder.openFolderEditor('${e.id}')`),n.innerHTML=`<div class="ld">${(0,o.Z)(e.icon)}</div><div class="md">${e.name}</div><div class="nd">${e.contentLength}</div><div class="od">${(0,o.Z)("arrow_forward_ios")}</div>`,{element:n,id:t}}function f(){var e;return e=function*(){var e=(0,i.bv)(".pd"),t=(0,i.aI)(e,".qd .rd");t.innerHTML="";var n,a=c(yield(0,r.Xi)());try{for(a.s();!(n=a.n()).done;){var o=l(n.value);t.appendChild(o.element)}}catch(e){a.e(e)}finally{a.f()}},f=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){d(i,r,a,o,s,"next",e)}function s(e){d(i,r,a,o,s,"throw",e)}o(void 0)}))},f.apply(this,arguments)}function v(){(0,s.WR)("FolderManager"),(0,i.bv)(".pd").setAttribute("displayed","true"),function(){f.apply(this,arguments)}()}function p(){(0,s.kr)("FolderManager"),(0,i.bv)(".pd").setAttribute("displayed","false")}},8621:(e,t,n)=>{n.d(t,{p:()=>v});var r=n(2303),a=n(313),i=n(4293),o=n(8201),s=n(8671),c=n(5579),u=n(6788);function d(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n){return p.apply(this,arguments)}function p(){var e;return e=function*(e,t,n){var d=function(e,t){var n,r={},a=l(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.Id===t){r=i;break}}}catch(e){a.e(e)}finally{a.f()}return r}(yield(0,i.a)(n,!1),e),f=yield(0,o.Y)(n),v=yield(0,s.s)(n),p=yield(0,a.s)(n),h=function(e){var t=(0,r.aU)(e.goFirstBusTime,0),n=(0,r.aU)(e.goLastBusTime,0),a=(0,r.aU)(e.backFirstBusTime,0),i=(0,r.aU)(e.backLastBusTime,0),o=(0,r.aU)(e.holidayGoFirstBusTime,0),s=(0,r.aU)(e.holidayGoLastBusTime,0),c=(0,r.aU)(e.holidayBackFirstBusTime,0),u=(0,r.aU)(e.holidayBackLastBusTime,0),d=(0,r.aU)(e.peakHeadway,1),l=(0,r.aU)(e.offPeakHeadway,1),f=(0,r.aU)(e.holidayPeakHeadway,1),v=(0,r.aU)(e.holidayOffPeakHeadway,1);return{go:{weekday:{first:t,last:n,rushHourWindow:d,offRushHourWindow:l},holiday:{first:o,last:s,rushHourWindow:f,offRushHourWindow:v}},back:{weekday:{first:a,last:i,rushHourWindow:d,offRushHourWindow:l},holiday:{first:c,last:u,rushHourWindow:f,offRushHourWindow:v}},realSequence:e.realSequence}}(d),y=function(e,t,n,a,i){var o,s={calendarDays:{d_0:{name:"日",day:0,code:"d_0"},d_1:{name:"一",day:1,code:"d_1"},d_2:{name:"二",day:2,code:"d_2"},d_3:{name:"三",day:3,code:"d_3"},d_4:{name:"四",day:4,code:"d_4"},d_5:{name:"五",day:5,code:"d_5"},d_6:{name:"六",day:6,code:"d_6"}},calendarDayQuantity:7,calendarEventGroups:{d_0:[],d_1:[],d_2:[],d_3:[],d_4:[],d_5:[],d_6:[]},calendarEventQuantity:{d_0:0,d_1:0,d_2:0,d_3:0,d_4:0,d_5:0,d_6:0}},u=(0,c.P$)(),d=l(a);try{for(d.s();!(o=d.n()).done;){var f=o.value;if(t.indexOf(f.PathAttributeId)>-1&&"0"===f.DateType)for(var v=(0,c.mr)(f.DateValue),p=(0,c.S1)(u,v.day,0,0),h=(0,r.aU)(f.StartTime,0),y=(0,c.S1)(p,0,h.hours,h.minutes),m=(0,r.aU)(f.EndTime,0),g=(0,c.S1)(p,0,m.hours,m.minutes),b=Math.abs(60*m.hours+m.minutes-(60*h.hours+h.minutes)),w=parseInt(f.LongHeadway),I=parseInt(f.LowHeadway),S=(I+w)/2,_=b/S,A=0;A<_;A++){var $=!1,k=(0,c.S1)(p,0,h.hours,h.minutes+I*A);k.getTime()<y.getTime()&&($=!0),k.getTime()>g.getTime()&&($=!0),!1===$&&(s.calendarEventGroups[v.code].push({date:k,dateString:(0,c.$T)(k,"hh:mm"),duration:I,deviation:Math.abs(S-I)}),s.calendarEventQuantity[v.code]+=1)}}}catch(e){d.e(e)}finally{d.f()}var T,L=l(i);try{for(L.s();!(T=L.n()).done;){var M=T.value;if(t.indexOf(M.PathAttributeId)>-1&&"0"===M.DateType){var E=(0,c.mr)(M.DateValue),x=(0,c.S1)(u,E.day,0,0),P=(0,r.aU)(M.DepartureTime,0),R=(0,c.S1)(x,0,P.hours,P.minutes);s.calendarEventGroups[E.code].push({date:R,dateString:(0,c.$T)(R,"hh:mm"),duration:15,deviation:0}),s.calendarEventQuantity[E.code]+=1}}}catch(e){L.e(e)}finally{L.f()}for(var D in s.calendarEventGroups)s.calendarEventGroups[D].sort((function(e,t){return e.date.getTime()-t.date.getTime()}));return s}(0,t,0,f,v),m=function(e,t){var n,r={},a=l(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.id===t&&(r=i)}}catch(e){a.e(e)}finally{a.f()}return r}(p,d.providerId),g={timeTableRules:h,calendar:y,properties:[{key:"route_name",icon:"route",value:d.nameZh},{key:"pricing",icon:"attach_money",value:d.ticketPriceDescriptionZh},{key:"provider_name",icon:"corporate_fare",value:m.nameZn},{key:"provider_phone",icon:"call",value:m.phoneInfo},{key:"provider_email",icon:"alternate_email",value:m.email}]};return(0,u.LQ)(n),(0,u.gC)(n),g},p=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){d(i,r,a,o,s,"next",e)}function s(e){d(i,r,a,o,s,"throw",e)}o(void 0)}))},p.apply(this,arguments)}},9333:(e,t,n)=>{n.d(t,{Bo:()=>T,I6:()=>A,Lq:()=>k,cG:()=>$,uy:()=>_});var r=n(9566),a=n(8024),i=n(3648),o=n(904),s=n(4537),c=n(9119);function u(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f=(0,i.bv)(".jc"),v=(0,i.aI)(f,".sd"),p=(0,i.aI)(v,".td"),h=(0,i.aI)(f,".pc"),y=(0,i.aI)(h,".qc"),m=(0,i.aI)(y,'.rc[group="folder-name"] .sc input'),g=(0,i.aI)(y,'.rc[group="folder-icon"] .sc .tc input'),b=(0,i.aI)(y,'.rc[group="folder-icon"] .sc .tc .uc'),w=(0,i.aI)(y,'.rc[group="folder-content"] .sc');function I(e,t){var n=(0,a.zx)("i"),r=document.createElement("div");r.id=n,r.classList.add("ud"),r.setAttribute("type",t.type);var i="",o="",c="";switch(t.type){case"stop":c="location_on",i=`${t.route?t.route.name:""} - 往${t.route?[t.route.endPoints.destination,t.route.endPoints.departure,""][t.direction?t.direction:0]:""}`,o=t.name;break;case"route":c="route",i=`${t.endPoints.departure} ↔ ${t.endPoints.destination}`,o=t.name;break;case"bus":i="",o=t.name;break;case"empty":c="lightbulb",i="提示",o="沒有內容";break;default:c="",i="null",o="null"}return r.innerHTML=`<div class="vd">${(0,s.Z)(c)}</div><div class="wd">${i}</div><div class="xd">${o}</div><div class="yd"><div class="zd" onclick="bus.folder.moveItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id}, 'up')">${(0,s.Z)("keyboard_arrow_down")}</div><div class="_d" onclick="bus.folder.moveItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id}, 'down')">${(0,s.Z)("keyboard_arrow_down")}</div><div class="ae" onclick="bus.folder.removeItemOnFolderEditor('${n}', '${e.id}', '${t.type}', ${t.id})">${(0,s.Z)("delete")}</div><div class="be"></div><div class="be"></div></div>`,{element:r,id:n}}function S(){var e;return e=function*(e){!function(e,t){m.value=e.name,g.value=e.icon,e.default?(m.setAttribute("readonly","readonly"),g.setAttribute("readonly","readonly"),b.setAttribute("disabled","true")):(m.removeAttribute("readonly"),g.removeAttribute("readonly"),b.setAttribute("disabled","false")),p.setAttribute("onclick",`bus.folder.saveEditedFolder('${e.id}')`),w.innerHTML="";var n,r=d(t);try{for(r.s();!(n=r.n()).done;){var a=I(e,n.value);w.appendChild(a.element)}}catch(e){r.e(e)}finally{r.f()}}(yield(0,r.L2)(e),yield(0,r.eD)(e))},S=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){u(i,r,a,o,s,"next",e)}function s(e){u(i,r,a,o,s,"throw",e)}o(void 0)}))},S.apply(this,arguments)}function _(e){(0,o.WR)("FolderEditor"),f.setAttribute("displayed","true"),function(e){S.apply(this,arguments)}(e),(0,o.Z_)()}function A(){f.setAttribute("displayed","false"),(0,o.l$)()}function $(e,t,n,a){var o=(0,i.aI)(f,`.pc .qc .rc[group="folder-content"] .sc .ud#${e}`);(0,r.NC)(t,n,a).then((function(e){if(e)switch(o.remove(),n){case"stop":(0,c.a)("已移除站牌","delete");break;case"route":(0,c.a)("已移除路線","delete")}else(0,c.a)("無法移除","error")}))}function k(e,t,n,a,o){var s=(0,i.aI)(f,`.pc .qc .rc[group="folder-content"] .sc .ud#${e}`);(0,r.bq)(t,n,a,o).then((function(e){if(e)switch(o){case"up":var t=s.previousElementSibling;t&&s.parentNode.insertBefore(s,t),(0,c.a)("已往上移","arrow_circle_up");break;case"down":var n=s.nextElementSibling;n&&s.parentNode.insertBefore(n,s),(0,c.a)("已往下移","arrow_circle_down")}else(0,c.a)("無法移動","error")}))}function T(e){var t=m.value,n=g.value;(0,r.g$)(e,t,n),A()}}}]);
//# sourceMappingURL=9842ffa0e013732edb5d.js.map