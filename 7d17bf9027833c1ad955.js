"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[796,6675],{7123(t,n,e){e.d(n,{R:()=>w});var r=e(7183),o=e(6483),a=e(6802),i=e(7810),u=e(2063),s=e(8011),f=e(4293),l=e(1932),p=e(424),c=e(2303),d=e(6788),v=e(3459),h=e(1531);function y(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return g(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?g(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function g(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function m(t,n,e,r,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void e(t)}u.done?n(s):Promise.resolve(s).then(r,o)}function w(t,n,e,r,o){return S.apply(this,arguments)}function S(){var t;return t=function*(t,n,e,g,m){(0,d.Mf)(m,"getRoute_0",0,!1),(0,d.Mf)(m,"getRoute_1",0,!1),(0,d.Mf)(m,"getStop_0",0,!1),(0,d.Mf)(m,"getStop_1",0,!1),(0,d.Mf)(m,"getLocation_0",0,!1),(0,d.Mf)(m,"getLocation_1",0,!1),(0,d.Mf)(m,"getSegmentBuffers_0",0,!1),(0,d.Mf)(m,"getSegmentBuffers_1",0,!1),(0,d.Mf)(m,"getEstimateTime_0",0,!1),(0,d.Mf)(m,"getEstimateTime_1",0,!1),(0,d.Mf)(m,"getBusEvent_0",0,!1),(0,d.Mf)(m,"getBusEvent_1",0,!1),(0,d.Mf)(m,"getBusData_0",0,!1),(0,d.Mf)(m,"getBusData_1",0,!1);var w=yield(0,f.a)(m,!0),S=yield(0,p.T)(m),_=yield(0,s.g)(m,0),b=yield(0,s.g)(m,1),I=yield(0,s.g)(m,2),D=yield(0,l.L)(m),P=yield(0,u.K)(m),$=yield(0,i.J)(m),B=yield(0,a.d)(m),O=yield(0,o.Io)(e,g),M=(0,c.w_)($,B,w,t,n),C=!1,L={};D.hasOwnProperty(`r_${t}`)&&(C=!0,L=D[`r_${t}`]);var R,x=(0,v.Js)("time_formatting_mode"),A=[],k=[],E=y(P);try{for(E.s();!(R=E.n()).done;){var Q=R.value,T={},j=Q.RouteID;if([t,10*t].includes(j)||n.includes(j)){T.status=(0,c.$Q)(null==Q?void 0:Q.EstimateTime,x);var N=`s_${Q.StopID}`,q={};if(!S.hasOwnProperty(N))continue;q=S[N],T.id=Q.StopID,T.sequence=q.seqNo,T.goBack=q.goBack;var z=`l_${q.stopLocationId}`,U={};if(!_.hasOwnProperty(z))continue;U=_[z],T.name=U.n,T.overlappingRoutes=U.r.filter(function(n){return n!==t}).map(function(t){var n=`r_${t}`;if(w.hasOwnProperty(n)){var e=w[n];return{name:e.n,RouteEndPoints:{RouteDeparture:e.dep,RouteDestination:e.des,text:`${e.dep} ↔ ${e.des}`,html:`<span>${e.dep}</span><span>↔</span><span>${e.des}</span>`},RouteID:e.id,PathAttributeId:e.pid}}return null}).filter(function(t){return null!==t}),T.position={longitude:U.lo,latitude:U.la},k.push({latitude:U.la,longitude:U.lo,id:Q.StopID});var J=U.g,F=[];I.hasOwnProperty(J)&&(F=I[J]);var G,K=[],V=y(F);try{for(V.s();!(G=V.n()).done;){var Z=`ml_${G.value.hash}`;if(b.hasOwnProperty(Z)){var H=b[Z],W={name:H.n,distance:0|(0,r.aV)(H.la[0],H.lo[0],U.la,U.lo),hash:H.hash};K.push(W)}}}catch(t){V.e(t)}finally{V.f()}K.sort(function(t,n){return t.distance-n.distance}),T.nearbyLocations=K;var X,Y=[],tt=y(U.s);try{for(tt.s();!(X=tt.n()).done;){var nt=`s_${X.value}`;M.hasOwnProperty(nt)&&Y.push(M[nt].map(function(t){return(0,c.s$)(t)}))}}catch(t){tt.e(t)}finally{tt.f()}T.buses=Y.flat().sort(function(t,n){return t.index-n.index});var et=[];O.hasOwnProperty(N)&&(et=O[N]),T.busArrivalTimes=et;var rt=!1,ot=!1,at=!1,it=!1;if(C){var ut=`g_${T.goBack}`,st=[];L.hasOwnProperty(ut)?st=L[ut]:"1"===T.goBack&&(it=!0,st=L.g_0);var ft,lt=y(st);try{for(lt.s();!(ft=lt.n()).done;){var pt=ft.value;pt.OriginStopID!==Q.StopID&&pt.DestinationStopID!==Q.StopID||(rt=!0),it?(pt.OriginStopID===Q.StopID&&(at=!0),pt.DestinationStopID===Q.StopID&&(ot=!0)):(pt.OriginStopID===Q.StopID&&(ot=!0),pt.DestinationStopID===Q.StopID&&(at=!0))}}catch(t){lt.e(t)}finally{lt.f()}}T.segmentBuffer={isSegmentBuffer:rt,isStartingPoint:ot,isEndingPoint:at},A.push(T)}}}catch(t){E.e(t)}finally{E.f()}A.sort(function(t,n){return t.sequence-n.sequence});for(var ct=(0,h.uQ)(k,450),dt=!1,vt=!1,ht={},yt=0,gt={},mt=A.length,wt=0;wt<mt;wt++){var St=A[wt],_t=A[wt+1]||St,bt=0;if(St.buses.length>0&&St.buses[0].onThisRoute){var It=[St.buses[0].position.longitude,St.buses[0].position.latitude],Dt=It[0],Pt=It[1],$t=[St.position.longitude,St.position.latitude],Bt=$t[0],Ot=$t[1],Mt=[_t.position.longitude,_t.position.latitude],Ct=Mt[0],Lt=Mt[1];if((Dt-Bt)*(Ct-Dt)+(Pt-Ot)*(Lt-Pt)>=0){var Rt=Math.hypot(Dt-Bt,Pt-Ot),xt=Math.hypot(Dt-Ct,Pt-Lt);bt=Math.max(0,Math.min(Rt/(Rt+xt),1))}}St.progress=bt,St.segmentBuffer.isStartingPoint&&(dt=!0),St.segmentBuffer.isEndingPoint&&dt&&(vt=!0),dt&&!vt&&(St.segmentBuffer.isSegmentBuffer=!0),dt&&vt&&(dt=!1,vt=!1);var At=!1;null!==ct&&ct.id===St.id&&(At=!0),St.nearest=At;var kt=`g_${St.goBack}`||"g_0";ht.hasOwnProperty(kt)||(ht[kt]=[],gt[kt]=0,yt+=1),ht[kt].push(St),gt[kt]+=1}var Et=w[`r_${t}`],Qt={groupedItems:ht,groupQuantity:yt,itemQuantity:gt,RouteName:Et.n,RouteEndPoints:{RouteDeparture:Et.dep,RouteDestination:Et.des},dataUpdateTime:(0,d.Zt)(m),RouteID:t,PathAttributeId:n};return(0,d.LQ)(m),(0,d.gC)(m),Qt},S=function(){var n=this,e=arguments;return new Promise(function(r,o){var a=t.apply(n,e);function i(t){m(a,r,o,i,u,"next",t)}function u(t){m(a,r,o,i,u,"throw",t)}i(void 0)})},S.apply(this,arguments)}},8134(t,n,e){e.d(n,{F6:()=>m,GU:()=>$,Rk:()=>y,dD:()=>I,k9:()=>v});var r=e(2129),o=e(8024),a=e(4781),i=e(9734),u=e(8011),s=e(4293),f=e(6788);function l(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return p(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?p(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw a}}}}function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function c(t,n,e,r,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void e(t)}u.done?n(s):Promise.resolve(s).then(r,o)}function d(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var a=t.apply(n,e);function i(t){c(a,r,o,i,u,"next",t)}function u(t){c(a,r,o,i,u,"throw",t)}i(void 0)})}}function v(t){return h.apply(this,arguments)}function h(){return(h=d(function*(t){var n=(0,o.zx)(),e=yield(0,s.a)(n,!0),r=[];for(var a in e){var i=e[a];String(i.n).indexOf(t)>-1&&r.push(i)}return(0,f.LQ)(n),(0,f.gC)(n),r})).apply(this,arguments)}function y(t){return g.apply(this,arguments)}function g(){return(g=d(function*(t){var n,e=(0,o.zx)(),r=yield(0,s.a)(e,!0),a=`r_${t}`;return!!r.hasOwnProperty(a)&&(n=r[a],(0,f.LQ)(e),(0,f.gC)(e),n)})).apply(this,arguments)}function m(t){return w.apply(this,arguments)}function w(){return(w=d(function*(t){var n=(0,o.zx)(),e=yield(0,s.a)(n,!0),r=[];for(var a in e){var i=e[a];String(i.pid).indexOf(t)>-1&&r.push(i)}return(0,f.LQ)(n),(0,f.gC)(n),r})).apply(this,arguments)}var S={},_=[],b=!1;function I(){return D.apply(this,arguments)}function D(){return(D=d(function*(){if(!b){var t=(0,o.zx)(),n=yield(0,s.a)(t,!0),e=yield(0,u.g)(t,1),r=yield(0,i.j)(t,!0);(0,f.LQ)(t),(0,f.gC)(t);var p={},c=[],d=0;for(var v in n){var h=n[v],y={id:h.id,pid:h.pid,dep:h.dep,des:h.des,n:h.n,hash:"",lo:"",la:"",r:"",s:"",type:0};c.push(y);var g,m=l((0,a.B5)(`${y.n.toLowerCase()}${y.dep.toLowerCase()}${y.des.toLowerCase()}`,!0));try{for(m.s();!(g=m.n()).done;){var w=`u_${g.value}`;p.hasOwnProperty(w)||(p[w]=[]),p[w].push(d)}}catch(t){m.e(t)}finally{m.f()}d+=1}for(var I in e){var D=e[I],P={id:D.id,n:D.n,lo:D.lo,la:D.la,r:D.r,s:D.s,hash:D.hash,dep:"",des:"",pid:[],type:1};c.push(P);var $,B=l((0,a.B5)(P.n.toLowerCase(),!0));try{for(B.s();!($=B.n()).done;){var O=`u_${$.value}`;p.hasOwnProperty(O)||(p[O]=[]),p[O].push(d)}}catch(t){B.e(t)}finally{B.f()}d+=1}for(var M in r){var C=r[M],L={id:C.BusId,pid:[],dep:"",des:"",n:C.CarNum,hash:"",lo:"",la:"",r:"",s:"",type:2};c.push(L);var R,x=l((0,a.B5)(L.n.toLowerCase(),!0));try{for(x.s();!(R=x.n()).done;){var A=`u_${R.value}`;p.hasOwnProperty(A)||(p[A]=[]),p[A].push(d)}}catch(t){x.e(t)}finally{x.f()}d+=1}S=p,_=c,b=!0}})).apply(this,arguments)}function P(t,n){var e,r=0,o=0,a=l(n);try{for(a.s();!(e=a.n()).done;){var i=e.value;r+=t.indexOf(i,o)-o,o+=1}}catch(t){a.e(t)}finally{a.f()}return t===n&&(r=10*Math.abs(r)),r}function $(t,n,e){if(!b)return[];var o,i=t.toLowerCase(),u=(0,a.B5)(i,!0),s=(0,a.B5)(i,!1),f=[],p=l(u);try{for(p.s();!(o=p.n()).done;){var c=`u_${o.value}`;S.hasOwnProperty(c)&&f.push(S[c])}}catch(t){p.e(t)}finally{p.f()}f.sort(function(t,n){return t.length-n.length});var d=f.length-1,v=[];if(0===d&&(v=f[0]),d>0)for(var h=0;h<d;h++){var y=f[h],g=f[h+1];v=0===h?(0,r._N)(y,g):(0,r._N)(v,g)}var m=[],w=0,I=new Set;if(-1===n||2===n){var D,$=_.filter(function(t){return t.n===i&&2===t.type}),B=l($);try{for(B.s();!(D=B.n()).done;){var O=D.value;if(m.push({item:O,score:1/0}),I.add(O.id),(w+=1)>=e)break}}catch(t){B.e(t)}finally{B.f()}}if(w<e){var M,C=l(v);try{for(C.s();!(M=C.n()).done;){var L=M.value,R=_[L];if((-1===n||n===R.type)&&!I.has(R.id)){var x=P(s,(0,a.B5)(R.n,!1));if(!(w<e))break;m.push({item:R,score:x}),w+=1}}}catch(t){C.e(t)}finally{C.f()}}return m.sort(function(t,n){return n.score-t.score}),m}}}]);
//# sourceMappingURL=7d17bf9027833c1ad955.js.map