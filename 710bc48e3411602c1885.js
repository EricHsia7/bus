"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(e,t,a){a.d(t,{eS:()=>he,s_:()=>V,so:()=>pe});var i=a(467),n=a(5767),r=a(9566),d=a(2757),s=a(3422),o=a(5314),l=a(3459),c=a(8179),u=a(7968),p=a(8024),h=a(5579),v=a(4537),m=a(904),f=a(9119),g=a(3041),b=a(752),y=a(1351);function A(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return I(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("E0")}var r,d=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return d=e.done,e},e:function(e){s=!0,r=e},f:function(){try{d||null==a.return||a.return()}finally{if(s)throw r}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var C=(0,c.bv)(".zd"),L=(0,c.aI)(C,".gh"),x=(0,c.aI)(L,".kh"),E=(0,c.aI)(x,"span"),w=(0,c.aI)(L,".jh"),j=(0,c.aI)(C,"._d"),k=(0,c.aI)(L,".lh"),T=(0,c.aI)(k,".mh"),_=(0,c.aI)(L,".ph"),M=(0,c.aI)(_,".qh"),$=(0,c.aI)(L,".sh .th"),S={},Z=!1,N=!1,z=0,P=0,D=0,Q={},R=0,Y=!1,H=15e3,B=5e3,q=15e3,F=!0,O=0,J=0,U="",W=!1,K=!1,X=!1,G="";function V(){j.addEventListener("touchstart",function(){z=Math.round(j.scrollLeft/R)},{passive:!0}),j.addEventListener("scroll",function(e){Y=!0;var t=e.target.scrollLeft/R;P=t>z?z+1:z-1;var a=t-z,i=Math.abs(a);i>1&&(a>0?(z=Math.floor(t),P=z+1):(z=Math.ceil(t),P=z-1),i=Math.abs(t-z));var n=Q[`g_${z}`]||{width:0,offset:0},r=Q[`g_${P}`]||{width:0,offset:0},d=n.width+(r.width-n.width)*i,s=-1*(n.offset+(r.offset-n.offset)*i)+.5*R-.5*d;ee(D,s,d-20,t),t===P&&(z=Math.round(j.scrollLeft/R),Y=!1)},{passive:!0})}function ee(e,t,a,i){j.style.setProperty("--_g",e.toString()),M.style.setProperty("--bh",a.toString()),T.style.setProperty("--ch",`${t.toString()}px`),T.style.setProperty("--dh",i.toString())}function te(e){var t=e;if(W){var a=t.detail.progress-1;$.style.setProperty("--eh",a.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,te)}function ae(){var e=(0,p.zx)(),t=document.createElement("div");t.classList.add("ce"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var a=document.createElement("div");a.classList.add("bi");var i=document.createElement("div");i.classList.add("ci");var n=document.createElement("div");n.classList.add("ei"),n.setAttribute("code","-1"),n.setAttribute("displayed","false");var r=document.createElement("div");r.classList.add("fi"),r.setAttribute("code","-1"),r.setAttribute("displayed","true"),i.appendChild(n),i.appendChild(r);var d=document.createElement("div");d.classList.add("pi");var s=document.createElement("div");s.classList.add("qi");var o=document.createElement("div");o.classList.add("ri");var l=document.createElement("div");l.classList.add("ui");var u=document.createElement("div");u.classList.add("_a"),u.setAttribute("code","0"),u.setAttribute("displayed","false");var h=document.createElement("div");h.classList.add("ab"),h.setAttribute("code","0"),h.setAttribute("displayed","true"),l.appendChild(u),l.appendChild(h);var m=document.createElement("div");m.classList.add("ti"),m.appendChild((0,v.YC)("keyboard_arrow_down")),m.onclick=function(){!function(e){var t=(0,c.aI)(e,".de"),a=e.parentElement,i=(0,c.ji)(e,"ce"),n=i.length,r=a.getBoundingClientRect(),d=e.getBoundingClientRect().top-r.top,s="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=s?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--ai",`${d}px`);for(var u=0;u<n;u++){var p=i[u];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<n;t++){var a=i[t];a.setAttribute("push-direction","0"),a.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<n;e++){i[e].setAttribute("push-state","2")}},{once:!0})}s?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(t)};var f=document.createElement("div");f.classList.add("si"),o.appendChild(l),o.appendChild(m),o.appendChild(f),a.appendChild(i),a.appendChild(d),a.appendChild(s),a.appendChild(o);var g=document.createElement("div");g.classList.add("de"),g.setAttribute("displayed","false");var b=document.createElement("div");b.classList.add("ee");var y=document.createElement("div");y.classList.add("fe"),y.setAttribute("highlighted","true"),y.setAttribute("type","tab"),y.setAttribute("code","0");var A=document.createElement("div");A.classList.add("vi"),A.appendChild((0,v.YC)("directions_bus")),y.appendChild(A),y.appendChild(document.createTextNode("公車")),y.onclick=function(){ve(e,0)};var I=document.createElement("div");I.classList.add("fe"),I.setAttribute("highlighted","false"),I.setAttribute("type","tab"),I.setAttribute("code","1");var C=document.createElement("div");C.classList.add("vi"),C.appendChild((0,v.YC)("departure_board")),I.appendChild(C),I.appendChild(document.createTextNode("抵達時間")),I.onclick=function(){ve(e,1)};var L=document.createElement("div");L.classList.add("fe"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var x=document.createElement("div");x.classList.add("vi"),x.appendChild((0,v.YC)("folder")),L.appendChild(x),L.appendChild(document.createTextNode("儲存"));var E=document.createElement("div");E.classList.add("fe"),E.setAttribute("highlighted","false"),E.setAttribute("type","schedule-notification"),E.setAttribute("enabled","true");var w=document.createElement("div");w.classList.add("vi"),w.appendChild((0,v.YC)("notifications")),E.appendChild(w),E.appendChild(document.createTextNode("通知")),b.appendChild(y),b.appendChild(I),b.appendChild(L),b.appendChild(E);var j=document.createElement("div");j.classList.add("wi"),j.setAttribute("displayed","true");var k=document.createElement("div");return k.classList.add("xi"),k.setAttribute("displayed","false"),g.appendChild(b),g.appendChild(j),g.appendChild(k),t.appendChild(a),t.appendChild(g),{element:t,id:e}}function ie(){var e=document.createElement("div");e.classList.add("ae");var t=document.createElement("div");t.classList.add("vh");var a=document.createElement("div");a.classList.add("wh"),t.appendChild(a);var i=document.createElement("div");return i.classList.add("be"),e.appendChild(t),e.appendChild(i),{element:e,id:""}}function ne(){var e=document.createElement("div");e.classList.add("nh");var t=document.createElement("span");return e.appendChild(t),{element:e,id:""}}function re(){var e=document.createElement("div");e.classList.add("xh");var t=document.createElement("div");t.classList.add("yh"),t.appendChild((0,v.oC)());var a=document.createElement("div");return a.classList.add("zh"),e.appendChild(t),e.appendChild(a),{element:e,id:""}}function de(){var e=document.createElement("div");e.classList.add("yi"),e.setAttribute("on-this-route","false");var t=document.createElement("div");t.classList.add("_i");var a=document.createElement("div");a.classList.add("bj"),a.appendChild((0,v.YC)("directions_bus"));var i=document.createElement("div");i.classList.add("dj");var n=document.createElement("div");n.classList.add("gj");var r=document.createElement("div");r.classList.add("ij");var d=document.createElement("div");d.classList.add("jj");var s=document.createElement("div");return s.classList.add("kj"),t.appendChild(a),t.appendChild(i),e.appendChild(t),n.appendChild(r),n.appendChild(d),n.appendChild(s),e.appendChild(n),{element:e,id:""}}function se(){var e=document.createElement("div");e.classList.add("zi");var t=document.createElement("div");t.classList.add("aj");var a=document.createElement("div");a.classList.add("cj"),a.appendChild((0,v.YC)("calendar_view_day"));var i=document.createElement("div");i.classList.add("ej");var n=document.createElement("div");n.classList.add("fj");var r=document.createElement("div");return r.classList.add("hj"),t.appendChild(a),t.appendChild(i),t.appendChild(n),e.appendChild(t),e.appendChild(r),{element:e,id:""}}function oe(e,t,a){var i,n;function d(e,i,n){function d(e,t,a){var i=e.getBoundingClientRect(),n=i.top,r=i.left,d=i.bottom,s=i.right,o=window.innerWidth,l=window.innerHeight,u=(0,c.aI)(e,".bi"),p=(0,c.aI)(u,".ui"),h=(0,c.aI)(p,"._a"),v=(0,c.aI)(p,".ab");h.setAttribute("code",t.status.code.toString()),h.innerText=t.status.text,a&&d>0&&n<l&&s>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("kb"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("kb")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}function o(e,t,a){var i=e.getBoundingClientRect(),n=i.top,r=i.left,d=i.bottom,s=i.right,o=window.innerWidth,l=window.innerHeight,u=(0,c.aI)(e,".bi"),p=(0,c.aI)(u,".ci"),h=(0,c.aI)(p,".ei"),v=(0,c.aI)(p,".fi");h.setAttribute("code",t.ranking.code.toString()),h.innerText=t.ranking.text,a&&d>0&&n<l&&s>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text,v.classList.remove("oi"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("oi")):(v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text)}function l(e,t){var a=(0,c.aI)(e,".bi");(0,c.aI)(a,".pi").innerText=t.route_direction}function u(e,t){var a=(0,c.aI)(e,".bi");(0,c.aI)(a,".qi").innerText=t.route_name}function v(e,t){var a=(0,c.aI)(e,".de"),i=(0,c.aI)(a,".wi"),n=(0,c.jg)(i,".yi"),r=n.length,d=t.buses.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0,u=Math.abs(s);l<u;l++){var h=de();o.appendChild(h.element)}i.append(o)}else for(var v=0,m=Math.abs(s);v<m;v++){n[r-1-v].remove()}for(var f=(0,c.jg)(i,".yi"),g=0;g<d;g++){var b=t.buses[g],y=f[g],A=(0,c.aI)(y,"._i"),I=(0,c.aI)(A,".dj"),C=(0,c.aI)(y,".gj"),L=(0,c.aI)(C,".ij"),x=(0,c.aI)(C,".jj"),E=(0,c.aI)(C,".kj");y.setAttribute("on-this-route",(0,p.xZ)(b.onThisRoute)),I.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,x.innerText=`狀態：${b.status.text}`,E.innerText=`類型：${b.type}`}i.setAttribute("empty",(0,p.xZ)(0===d))}function m(e,t){var a=(0,c.aI)(e,".de"),i=(0,c.aI)(a,".xi"),n=(0,c.jg)(i,".zi"),r=n.length,d=t.busArrivalTimes.length,s=r-d;if(s<0){for(var o=new DocumentFragment,l=0,u=Math.abs(s);l<u;l++){var v=se();o.appendChild(v.element)}i.append(o)}else for(var m=0,f=Math.abs(s);m<f;m++){n[r-1-m].remove()}for(var g=(0,c.jg)(i,".zi"),b=0;b<d;b++){var y=t.busArrivalTimes[b],A=g[b],I=(0,c.aI)(A,".aj"),C=(0,c.aI)(I,".ej"),L=(0,c.aI)(I,".fj"),x=(0,c.aI)(A,".hj");C.innerText=y.personalSchedule.name,L.innerText=`週${(0,h.kd)(y.day).name} ${(0,h.pn)(y.personalSchedule.period.start)} - ${(0,h.pn)(y.personalSchedule.period.end)}`,x.innerHTML=y.chart}i.setAttribute("empty",(0,p.xZ)(0===d))}function f(e,t){t&&e.setAttribute("stretched","false")}function y(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function A(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}function I(e,t){var a=(0,c.aI)(e,".de"),i=(0,c.aI)(a,".ee"),n=(0,c.aI)(i,'.fe[type="save-to-folder"]');n.onclick=function(){(0,g.B)("stop-on-location",[e.id,t.stopId,t.routeId])},(0,r.LH)("stop",t.stopId).then(function(e){n.setAttribute("highlighted",(0,p.xZ)(e))})}function C(e,t){var a=(0,c.aI)(e,".de"),i=(0,c.aI)(a,".ee"),n=(0,c.aI)(i,'.fe[type="schedule-notification"]');n.onclick=function(){(0,b.Ho)(n,t.stopId,t.routeId,t.status.time)};var r=(0,s.Zc)(t.stopId);n.setAttribute("highlighted",(0,p.xZ)(r))}null==n?(d(e,i,a),o(e,i,a),l(e,i),u(e,i),v(e,i),m(e,i),f(e,t),y(e,a),A(e,t),I(e,i),C(e,i)):(i.status.time!==n.status.time&&(d(e,i,a),C(e,i)),n.ranking.number===i.ranking.number&&n.ranking.code===i.ranking.code||o(e,i,a),n.stopId!==i.stopId&&(l(e,i),u(e,i),I(e,i)),(0,p.hw)(n.buses,i.buses)||v(e,i),(0,p.hw)(n.busArrivalTimes,i.busArrivalTimes)||m(e,i),a!==Z&&y(e,a),t!==N&&(f(e,t),A(e,t)))}function o(e,i,n){function r(e,t){var a=(0,c.aI)(e,".yh");(0,v.yD)(a,t.icon)}function d(e,t){(0,c.aI)(e,".zh").innerHTML=t.value}function s(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}null==n?(r(e,i),d(e,i),s(e,a),o(e,t)):((0,p.hw)(n.icon,i.icon)||r(e,i),(0,p.hw)(n.value,i.value)||d(e,i),a!==Z&&s(e,a),t!==N&&o(e,t))}var l=(0,m.gO)("window"),f=l.width,A=l.height,I=e.groupQuantity,C=e.itemQuantity,L=e.groupedItems,M=e.groups;D=I,R=f;for(var $=0,P=0;P<I;P++){var H=`g_${P}`,B=(0,u.q_)(M[H].name,500,"17px",'"Noto Sans TC", sans-serif')+20;Q[H]={width:B,offset:$},$+=B}if(Q[`g_${I}`]={width:0,offset:$},!Y){var q=Q[`g_${z}`],F=-1*q.offset+.5*R-.5*q.width,O=q.width-20;ee(D,F,O,z)}(null===(i=S)||void 0===i?void 0:i.hash)!==e.hash&&(w.onclick=function(){(0,y.ID)(e.hash)}),(null===(n=S)||void 0===n?void 0:n.LocationName)!==e.LocationName&&(E.innerText=e.LocationName),Z!==a&&(x.setAttribute("animation",(0,p.xZ)(a)),k.setAttribute("animation",(0,p.xZ)(a))),N!==t&&(x.setAttribute("skeleton-screen",(0,p.xZ)(t)),k.setAttribute("skeleton-screen",(0,p.xZ)(t)),_.setAttribute("skeleton-screen",(0,p.xZ)(t)));var J=(0,c.jg)(j,".ae").length;if(I!==J){var U=J-I;if(U<0){for(var W=new DocumentFragment,K=new DocumentFragment,X=0,G=Math.abs(U);X<G;X++){var V=ie();W.appendChild(V.element);var te=ne();K.appendChild(te.element)}j.append(W),T.append(K)}else for(var oe=(0,c.jg)(j,".ae"),le=(0,c.jg)(T,".nh"),ce=0,ue=Math.abs(U);ce<ue;ce++){var pe=J-1-ce;oe[pe].remove(),le[pe].remove()}}for(var he=(0,c.jg)(j,".ae"),ve=0;ve<I;ve++){var me=`g_${ve}`,fe=he[ve],ge=(0,c.jg)(fe,".be .ce").length;if(C[me]!==ge){var be=ge-C[me];if(be<0)for(var ye=(0,c.aI)(fe,".be"),Ae=0,Ie=Math.abs(be);Ae<Ie;Ae++){var Ce=ae();ye.appendChild(Ce.element)}else for(var Le=(0,c.jg)(fe,".be .ce"),xe=0,Ee=Math.abs(be);xe<Ee;xe++){Le[ge-1-xe].remove()}}var we=(0,c.jg)((0,c.jg)(j,".ae")[ve],".vh .wh .xh").length,je=M[me].properties.length;if(je!==we){var ke=we-je;if(ke<0)for(var Te=(0,c.aI)(fe,".vh"),_e=(0,c.aI)(Te,".wh"),Me=0,$e=Math.abs(ke);Me<$e;Me++){var Se=re();_e.appendChild(Se.element)}else for(var Ze=(0,c.aI)(fe,".vh"),Ne=(0,c.aI)(Ze,".wh"),ze=(0,c.jg)(Ne,".xh"),Pe=0,De=Math.abs(ke);Pe<De;Pe++){ze[we-1-Pe].remove()}}}for(var Qe=(0,c.jg)(T,".nh"),Re=(0,c.jg)(j,".ae"),Ye=0;Ye<I;Ye++){var He=`g_${Ye}`,Be=Qe[Ye];(0,c.aI)(Be,"span").innerText=M[He].name,Be.style.setProperty("--ah",`${Q[He].width}px`),Be.style.setProperty("--oh",Ye.toString());for(var qe=Re[Ye],Fe=(0,c.jg)(qe,".vh .wh .xh"),Oe=(0,c.jg)(qe,".be .ce"),Je=M[He].properties.length,Ue=0;Ue<Je;Ue++){var We=M[He].properties[Ue],Ke=Fe[Ue];if((0,p.mQ)(S,"groups"))if((0,p.mQ)(S.groups,He))if(S.groups[He].properties[Ue])o(Ke,We,S.groups[He].properties[Ue]);else o(Ke,We,null);else o(Ke,We,null);else o(Ke,We,null)}for(var Xe=0;Xe<C[He];Xe++){var Ge=Oe[Xe],Ve=L[He][Xe];if((0,p.mQ)(S,"groupedItems"))if((0,p.mQ)(S.groupedItems,He))if(S.groupedItems[He][Xe])d(Ge,Ve,S.groupedItems[He][Xe]);else d(Ge,Ve,null);else d(Ge,Ve,null);else d(Ge,Ve,null)}}S=e,Z=a,N=t}function le(){return ce.apply(this,arguments)}function ce(){return(ce=(0,i.A)(function*(){var e=(0,l.Js)("playing_animation"),t=(0,l.Js)("refresh_interval"),a=(0,m.gO)("location-bus-arrival-time-chart");F=t.dynamic,H=t.baseInterval,W=!0,U=(0,p.zx)(),$.setAttribute("refreshing","true"),$.classList.remove("uh"),document.addEventListener(U,te);var i=yield(0,d.R)(G,a.width,a.height,U);oe(i,!1,e);var r=0;F&&(r=yield(0,n.wz)()),O=(new Date).getTime(),J=F?Math.max(O+B,i.dataUpdateTime+H/r):O+H,q=Math.max(B,J-O),W=!1,$.setAttribute("refreshing","false"),$.style.setProperty("--fh",`${q}ms`),$.classList.add("uh")})).apply(this,arguments)}function ue(){le().then(function(){K?setTimeout(function(){ue()},Math.max(B,J-(new Date).getTime())):X=!1}).catch(function(e){K?((0,f.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){ue()},1e4)):X=!1})}function pe(e){(0,m.WR)("Location"),(0,o.XK)("location",e),G=e,z=0,Q={},C.setAttribute("displayed","true"),j.scrollLeft=0,j.focus(),function(e){for(var t=(0,l.Js)("playing_animation"),a=(0,m.gO)("window"),i=(a.width,a.height),n={g_0:Math.floor(i/50)+5,g_1:Math.floor(i/50)+5},r={},d=0;d<2;d++){var s=`g_${d}`;r[s]=[];for(var o=0;o<n[s];o++)r[s].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}oe({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:n,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,X?le():(X=!0,ue())),(0,m.Z_)()}function he(){C.setAttribute("displayed","false"),K=!1,(0,m.l$)()}function ve(e,t){var a,i=(0,c.aI)(j,`.ae .be .ce#${e}`),n=(0,c.aI)(i,".de"),r=(0,c.aI)(n,".ee"),d=A((0,c.jg)(r,'.fe[highlighted="true"][type="tab"]'));try{for(d.s();!(a=d.n()).done;){a.value.setAttribute("highlighted","false")}}catch(e){d.e(e)}finally{d.f()}switch((0,c.aI)(r,`.fe[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,c.aI)(i,".wi").setAttribute("displayed","true"),(0,c.aI)(i,".xi").setAttribute("displayed","false");break;case 1:(0,c.aI)(i,".wi").setAttribute("displayed","false"),(0,c.aI)(i,".xi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=710bc48e3411602c1885.js.map