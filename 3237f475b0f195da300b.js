"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[6160,8153],{2303(e,t,r){r.d(t,{$Q:()=>i,AS:()=>f,Ov:()=>l,aU:()=>u,eu:()=>p,s$:()=>v,w_:()=>s,zi:()=>c});var n=r(5579);function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){if("string"==typeof e){var r=parseInt(e);if(-3===r)return{code:6,text:"末班駛離",time:r};if(-4===r)return{code:5,text:"今日停駛",time:r};if(-2===r)return{code:4,text:"交通管制",time:r};if(-1===r)return{code:3,text:"未發車",time:r};if(0<=r&&r<=10)return{code:2,text:"進站中",time:r};if(10<r&&r<=180)return{code:1,text:(0,n.fU)(r,t),time:r};if(180<r&&r<=250)return{code:.5,text:(0,n.fU)(r,t),time:r};if(250<r)return{code:0,text:(0,n.fU)(r,t),time:r}}return{code:7,text:"發生錯誤",time:-5}}function u(e,t){var r=e.length;if(0===t){var n=0,a=0;return 4===r&&(n=parseInt(e.substring(0,2)),a=parseInt(e.substring(2,4))),2===r&&(a=parseInt(e)),{type:"moment",hours:n,minutes:a}}if(1===t){var o=0,i=0;if(4===r){var u=parseInt(e.substring(0,2)),s=parseInt(e.substring(2,4));o=Math.min(u,s),i=Math.max(u,s)}if(2===r){var f=parseInt(e);o=f,i=f}return{type:"range",min:o,max:i}}}function s(e,t,r,n,o){var i,u={},s={},f=a(t);try{for(f.s();!(i=f.n()).done;){var l=i.value;s[l.BusID]=l}}catch(e){f.e(e)}finally{f.f()}var c,p=a(e);try{for(p.s();!(c=p.n()).done;){var v=c.value,y={};y.CarType=v.CarType,y.BusStatus=v.BusStatus,y.BusID=v.BusID,y.CarOnStop=v.CarOnStop;var d=parseInt(v.RouteID),h=String(v.BusID),m=!1,b=0;d===n||o.indexOf(d)>-1||d===10*n?(m=!0,b=h.charCodeAt(0)*Math.pow(10,-5)):(m=!1,b=h.charCodeAt(0)),y.onThisRoute=m,y.index=b;var g={};if(s.hasOwnProperty(h)){g=s[h],y.position={latitude:parseFloat(g.Latitude),longitude:parseFloat(g.Longitude)};var w={},I=!1;for(var S in r){var O=r[S];if(O.pid.indexOf(d)>-1){w=O,I=!0;break}}y.RouteName=I?w.n:"未知路線",y.RouteID=I?w.id:null;var k=`s_${v.StopID}`;u.hasOwnProperty(k)||(u[k]=[]),u[k].push(y)}}}catch(e){p.e(e)}finally{p.f()}return u}function f(e,t,r,n){var o,i={},u={},s=a(t);try{for(s.s();!(o=s.n()).done;){var f=o.value;u[f.BusID]=f}}catch(e){s.e(e)}finally{s.f()}var l,c=a(e);try{for(c.s();!(l=c.n()).done;){var p=l.value,v={},y=parseInt(p.StopID),d=parseInt(p.RouteID),h=String(p.BusID);if(!(n.indexOf(y)<0)){v.index=h.charCodeAt(0),v.onThisRoute=!0,v.CarType=p.CarType,v.BusStatus=p.BusStatus,v.BusID=p.BusID,v.CarOnStop=p.CarOnStop;var m={};if(u.hasOwnProperty(h)){m=u[h],v.position={latitude:parseFloat(m.Latitude),longitude:parseFloat(m.Longitude)};var b={},g=!1;for(var w in r){var I=r[w];if(I.pid.indexOf(d)>-1){b=I,g=!0;break}}v.RouteName=g?b.n:"未知路線",v.RouteID=g?b.id:null;var S=`s_${y}`;i.hasOwnProperty(S)||(i[S]=[]),i[S].push(v)}}}}catch(e){c.e(e)}finally{c.f()}return i}function l(e){var t="";switch(e){case"0":t="一般";break;case"1":t="低底盤";break;case"2":t="大復康巴士";break;case"3":t="狗狗友善專車";break;default:t="未知類型"}return t}function c(e){var t="";switch(e){case"0":t="離站";break;case"1":t="進站";break;default:t="未知狀態"}return t}function p(e){var t="";switch(e){case"0":t="正常";break;case"1":t="車禍";break;case"2":t="故障";break;case"3":t="塞車";break;case"4":t="緊急求援";break;case"5":t="加油";break;case"99":t="非營運狀態";break;default:t="未知狀態"}return t}function v(e){var t={},r=l(e.CarType);t.type=r;var n=c(e.CarOnStop),a=p(e.BusStatus);return t.carNumber=e.BusID,t.status={onStop:n,situation:a,text:`${n} | ${a}`},t.RouteName=e.RouteName,t.onThisRoute=e.onThisRoute,t.index=e.index,t.position=e.position,t}},6160(e,t,r){r.d(t,{i:()=>y});var n=r(467),a=r(6802),o=r(7810),i=r(9734),u=r(8011),s=r(424),f=r(2303),l=r(6788),c=r(8134);function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return v(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function y(e,t){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(function*(e,t){var r=`c_${e}`,n=yield(0,i.j)(t,!0),v=yield(0,a.d)(t),y=yield(0,o.J)(t),d=yield(0,s.T)(t),h=yield(0,u.g)(t,0),m={properties:[],LocationName:""},b={};if(!n.hasOwnProperty(r))return m;var g=(b=n[r]).CarNum;m.properties.push({key:"car_number",icon:"tag",value:g});var w=b.CarType,I=(0,f.Ov)(w);m.properties.push({key:"car_type",icon:"directions_bus",value:I});var S,O={},k=p(v);try{for(k.s();!(S=k.n()).done;){var x=S.value;if(x.BusID===g){O=x;break}}}catch(e){k.e(e)}finally{k.f()}var A,C=parseInt(O.RouteID),D=O.BusStatus,P=(0,f.eu)(D),B=parseInt(O.GoBack),T={},$=p(y);try{for($.s();!(A=$.n()).done;){var R=A.value;if(R.BusID===g){T=R;break}}}catch(e){$.e(e)}finally{$.f()}var _=T.CarOnStop,N=(0,f.zi)(_);m.properties.push({key:"status",icon:"vital_signs",value:`${N} | ${P}`});var j=T.StopID,L=yield(0,c.F6)(C),M={};if(!(L.length>0))return m;var E=(M=L[0]).id,F=M.pid,U=M.n,q=M.dep,z=[M.des,q,""][B||0];m.properties.push({key:"route",icon:"route",value:`${U} - 往${z}`}),m.RouteID=E,m.FullPathAttributeId=F;var Q=`s_${j}`;if(!d.hasOwnProperty(Q))return m;var Z=h[`l_${d[Q].stopLocationId}`].n;return m.properties.push({key:"location_name",icon:"location_on",value:Z}),(0,l.LQ)(t),(0,l.gC)(t),m})).apply(this,arguments)}},6788(e,t,r){r.d(t,{Fd:()=>p,LQ:()=>b,Mf:()=>h,ZL:()=>I,Zt:()=>S,gC:()=>O});var n=r(2284),a=r(467),o=r(4750),i=r(5579),u=r(8925);function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var l={},c=new Error("FetchError");function p(e,t,r,n){return v.apply(this,arguments)}function v(){return(v=(0,a.A)(function*(e,t,r,n){if(l.hasOwnProperty(e)){if(l[e].processing)return yield new Promise(function(n,a){l[e].requests.push([n,a,t,r])});if(null!==l[e].result&&(new Date).getTime()<=l[e].timestamp)return h(t,r,0,!0),l[e].result}else l[e]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var a=yield fetch(e);if(!a.ok)throw h(t,r,0,!0),new Error(`HTTP error! status: ${a.status}`);for(var i=parseInt(String(a.headers.get("content-length"))),f=a.body.getReader(),v=[],d=0;;){var m=yield f.read(),b=m.done,g=m.value;if(b)break;v.push(g);var w=(d+=g.length)/i;if(h(t,r,w,!1),l.hasOwnProperty(e)){var I,S=s(l[e].requests);try{for(S.s();!(I=S.n()).done;){var O=I.value;h(O[2],O[3],w,!1)}}catch(e){S.e(e)}finally{S.f()}}}for(var k=new Uint8Array(d),x=0,A=0,C=v;A<C.length;A++){var D=C[A];k.set(D,x),x+=D.length}var P,B=new Blob([k],{type:"application/gzip"}),T=yield B.arrayBuffer(),$=yield(0,o.h)(T);switch(n){case"json":P=/^<!doctype html>/.test($)?yield p(e.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,r,n):JSON.parse($);break;case"xml":P=$}var R=new Date;if(yield(0,u.N$)(i,R),P){if(l.hasOwnProperty(e)){for(var _=d/i,N=l[e].requests.shift();N;)N[0](P),h(N[2],N[3],_,!1),N=l[e].requests.shift();l[e].result=P,l[e].timestamp=R.getTime()+3e4,l[e].processing=!1}return y(),P}if(l.hasOwnProperty(e)){for(var j=l[e].requests.shift();j;)j[1](c),h(j[2],j[3],0,!0),j=l[e].requests.shift();l[e].failed=!0}throw y(),c})).apply(this,arguments)}function y(){var e=(new Date).getTime();for(var t in l)if(l.hasOwnProperty(t)){if(!l[t].processing&&e>l[t].timestamp){delete l[t];continue}if(l[t].failed){delete l[t];continue}}}var d={};function h(e,t,r,n){d.hasOwnProperty(e)||(d[e]={}),d[e].hasOwnProperty(t)?(n?d[e][t].expel=!0:(d[e][t].expel=!1,d[e][t].progress=r),g(e,"run")):(d[e][t]={expel:!1,progress:r,total:1},g(e,"start"))}function m(e){if(d.hasOwnProperty(e)&&"object"===(0,n.A)(d[e])){var t=0,r=0;for(var a in d[e])d[e][a].expel||(t+=d[e][a].total,r+=d[e][a].progress);var o=Math.min(Math.max(r/t,0),1);return o===1/0||isNaN(o)?1:o}return 1}function b(e){d.hasOwnProperty(e)&&(delete d[e],g(e,"end"))}function g(e,t){var r={target:e,stage:t,progress:m(e)},n=new CustomEvent(e,{detail:r});document.dispatchEvent(n)}var w={};function I(e,t){w.hasOwnProperty(e)||(w[e]=0);var r=0;"string"==typeof t&&(r=(0,i.Zn)(t)),r>w[e]&&(w[e]=r)}function S(e){return w.hasOwnProperty(e)?1*w[e]:0}function O(e){w.hasOwnProperty(e)&&delete w[e]}}}]);
//# sourceMappingURL=3237f475b0f195da300b.js.map