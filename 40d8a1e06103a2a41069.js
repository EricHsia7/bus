"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(e,t,i){i.d(t,{eS:()=>pe,s_:()=>V,so:()=>ce});var a=i(467),n=i(5767),r=i(9566),s=i(2757),d=i(3422),o=i(5314),l=i(3459),u=i(8179),c=i(7968),p=i(8024),h=i(5579),v=i(4537),f=i(904),m=i(9119),g=i(3041),b=i(752),y=i(1351);function A(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return I(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?I(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("E0")}var r,s=!0,d=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){d=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(d)throw r}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=Array(t);i<t;i++)a[i]=e[i];return a}var C=(0,u.bv)(".ce"),L=(0,u.aI)(C,".kh"),j=(0,u.aI)(L,".oh"),E=(0,u.aI)(j,"span"),x=(0,u.aI)(L,".nh"),w=(0,u.aI)(C,".de"),k=(0,u.aI)(L,".ph"),_=(0,u.aI)(k,".qh"),T=(0,u.aI)(L,".th"),$=(0,u.aI)(T,".uh"),M=(0,u.aI)(L,".wh .xh"),S={},Z=!1,z=!1,N=0,P=0,Q=0,R={},D=0,H=!1,Y=15e3,B=5e3,O=15e3,F=!0,J=0,U=0,W="",q=!1,K=!1,X=!1,G="";function V(){w.addEventListener("touchstart",function(){N=Math.round(w.scrollLeft/D)},{passive:!0}),w.addEventListener("scroll",function(e){H=!0;var t=e.target.scrollLeft/D;P=t>N?N+1:N-1;var i=t-N,a=Math.abs(i);a>1&&(i>0?(N=Math.floor(t),P=N+1):(N=Math.ceil(t),P=N-1),a=Math.abs(t-N));var n=R[`g_${N}`]||{width:0,offset:0},r=R[`g_${P}`]||{width:0,offset:0},s=n.width+(r.width-n.width)*a,d=-1*(n.offset+(r.offset-n.offset)*a)+.5*D-.5*s;ee(Q,d,s-20,t),t===P&&(N=Math.round(w.scrollLeft/D),H=!1)},{passive:!0})}function ee(e,t,i,a){w.style.setProperty("--dh",e.toString()),$.style.setProperty("--fh",i.toString()),_.style.setProperty("--gh",`${t.toString()}px`),_.style.setProperty("--hh",a.toString())}function te(e){var t=e;if(q){var i=t.detail.progress-1;M.style.setProperty("--ih",i.toString())}"end"===t.detail.stage&&document.removeEventListener(t.detail.target,te)}function ie(){var e=(0,p.zx)(),t=document.createElement("div");t.classList.add("ge"),t.id=e,t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var i=document.createElement("div");i.classList.add("fi");var a=document.createElement("div");a.classList.add("gi");var n=document.createElement("div");n.classList.add("ii"),n.setAttribute("code","-1"),n.setAttribute("displayed","false");var r=document.createElement("div");r.classList.add("ji"),r.setAttribute("code","-1"),r.setAttribute("displayed","true"),a.appendChild(n),a.appendChild(r);var s=document.createElement("div");s.classList.add("ti");var d=document.createElement("div");d.classList.add("ui");var o=document.createElement("div");o.classList.add("vi");var l=document.createElement("div");l.classList.add("yi");var c=document.createElement("div");c.classList.add("_a"),c.setAttribute("code","0"),c.setAttribute("displayed","false");var h=document.createElement("div");h.classList.add("ab"),h.setAttribute("code","0"),h.setAttribute("displayed","true"),l.appendChild(c),l.appendChild(h);var f=document.createElement("div");f.classList.add("xi"),f.appendChild((0,v.YC)("keyboard_arrow_down")),f.onclick=function(){!function(e){var t=(0,u.aI)(e,".he"),i=e.parentElement,a=(0,u.ji)(e,"ge"),n=a.length,r=i.getBoundingClientRect(),s=e.getBoundingClientRect().top-r.top,d="true"===e.getAttribute("stretched"),o="true"===e.getAttribute("animation");if(o){var l=d?"2":"1";e.setAttribute("stretching","true"),e.style.setProperty("--ei",`${s}px`);for(var c=0;c<n;c++){var p=a[c];p.setAttribute("push-direction",l),p.setAttribute("push-state","1")}e.addEventListener("transitionend",function(){for(var t=0;t<n;t++){var i=a[t];i.setAttribute("push-direction","0"),i.setAttribute("push-state","0")}e.setAttribute("stretching","false")},{once:!0}),e.addEventListener("transitionstart",function(){for(var e=0;e<n;e++){a[e].setAttribute("push-state","2")}},{once:!0})}d?(o?t.addEventListener("transitionend",function(){t.setAttribute("displayed","false")},{once:!0}):t.setAttribute("displayed","false"),e.setAttribute("stretched","false")):(t.setAttribute("displayed","true"),e.setAttribute("stretched","true"))}(t)};var m=document.createElement("div");m.classList.add("wi"),o.appendChild(l),o.appendChild(f),o.appendChild(m),i.appendChild(a),i.appendChild(s),i.appendChild(d),i.appendChild(o);var g=document.createElement("div");g.classList.add("he"),g.setAttribute("displayed","false");var b=document.createElement("div");b.classList.add("ie");var y=document.createElement("div");y.classList.add("je"),y.setAttribute("highlighted","true"),y.setAttribute("type","tab"),y.setAttribute("code","0");var A=document.createElement("div");A.classList.add("zi"),A.appendChild((0,v.YC)("directions_bus")),y.appendChild(A),y.appendChild(document.createTextNode("公車")),y.onclick=function(){he(e,0)};var I=document.createElement("div");I.classList.add("je"),I.setAttribute("highlighted","false"),I.setAttribute("type","tab"),I.setAttribute("code","1");var C=document.createElement("div");C.classList.add("zi"),C.appendChild((0,v.YC)("departure_board")),I.appendChild(C),I.appendChild(document.createTextNode("抵達時間")),I.onclick=function(){he(e,1)};var L=document.createElement("div");L.classList.add("je"),L.setAttribute("highlighted","false"),L.setAttribute("type","save-to-folder");var j=document.createElement("div");j.classList.add("zi"),j.appendChild((0,v.YC)("folder")),L.appendChild(j),L.appendChild(document.createTextNode("儲存"));var E=document.createElement("div");E.classList.add("je"),E.setAttribute("highlighted","false"),E.setAttribute("type","schedule-notification"),E.setAttribute("enabled","true");var x=document.createElement("div");x.classList.add("zi"),x.appendChild((0,v.YC)("notifications")),E.appendChild(x),E.appendChild(document.createTextNode("通知")),b.appendChild(y),b.appendChild(I),b.appendChild(L),b.appendChild(E);var w=document.createElement("div");w.classList.add("_i"),w.setAttribute("displayed","true");var k=document.createElement("div");return k.classList.add("aj"),k.setAttribute("displayed","false"),g.appendChild(b),g.appendChild(w),g.appendChild(k),t.appendChild(i),t.appendChild(g),{element:t,id:e}}function ae(){var e=document.createElement("div");e.classList.add("ee");var t=document.createElement("div");t.classList.add("zh");var i=document.createElement("div");i.classList.add("_h"),t.appendChild(i);var a=document.createElement("div");return a.classList.add("fe"),e.appendChild(t),e.appendChild(a),{element:e,id:""}}function ne(){var e=document.createElement("div");e.classList.add("rh");var t=document.createElement("span");return e.appendChild(t),{element:e,id:""}}function re(){var e=document.createElement("div");e.classList.add("ai");var t=document.createElement("div");t.classList.add("bi"),t.appendChild((0,v.oC)());var i=document.createElement("div");return i.classList.add("ci"),e.appendChild(t),e.appendChild(i),{element:e,id:""}}function se(){var e=document.createElement("div");e.classList.add("bj"),e.setAttribute("on-this-route","false");var t=document.createElement("div");t.classList.add("dj");var i=document.createElement("div");i.classList.add("fj"),i.appendChild((0,v.YC)("directions_bus"));var a=document.createElement("div");a.classList.add("hj");var n=document.createElement("div");n.classList.add("kj");var r=document.createElement("div");r.classList.add("mj");var s=document.createElement("div");s.classList.add("nj");var d=document.createElement("div");return d.classList.add("oj"),t.appendChild(i),t.appendChild(a),e.appendChild(t),n.appendChild(r),n.appendChild(s),n.appendChild(d),e.appendChild(n),{element:e,id:""}}function de(e,t,i){var a,n;function s(e,a,n){function s(e,t,i){var a=e.getBoundingClientRect(),n=a.top,r=a.left,s=a.bottom,d=a.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(e,".fi"),p=(0,u.aI)(c,".yi"),h=(0,u.aI)(p,"._a"),v=(0,u.aI)(p,".ab");h.setAttribute("code",t.status.code.toString()),h.innerText=t.status.text,i&&s>0&&n<l&&d>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text,v.classList.remove("kb"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("kb")):(v.setAttribute("code",t.status.code.toString()),v.innerText=t.status.text)}function o(e,t,i){var a=e.getBoundingClientRect(),n=a.top,r=a.left,s=a.bottom,d=a.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(e,".fi"),p=(0,u.aI)(c,".gi"),h=(0,u.aI)(p,".ii"),v=(0,u.aI)(p,".ji");h.setAttribute("code",t.ranking.code.toString()),h.innerText=t.ranking.text,i&&s>0&&n<l&&d>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text,v.classList.remove("si"),h.setAttribute("displayed","false")},{once:!0}),h.setAttribute("displayed","true"),v.classList.add("si")):(v.setAttribute("code",t.ranking.code.toString()),v.innerText=t.ranking.text)}function l(e,t){var i=(0,u.aI)(e,".fi");(0,u.aI)(i,".ti").innerText=t.route_direction}function c(e,t){var i=(0,u.aI)(e,".fi");(0,u.aI)(i,".ui").innerText=t.route_name}function f(e,t){var i=(0,u.aI)(e,".he"),a=(0,u.aI)(i,"._i"),n=(0,u.jg)(a,".bj"),r=n.length,s=t.buses.length,d=r-s;if(d<0){for(var o=new DocumentFragment,l=0,c=Math.abs(d);l<c;l++){var h=se();o.appendChild(h.element)}a.append(o)}else for(var v=0,f=Math.abs(d);v<f;v++){n[r-1-v].remove()}for(var m=(0,u.jg)(a,".bj"),g=0;g<s;g++){var b=t.buses[g],y=m[g],A=(0,u.aI)(y,".dj"),I=(0,u.aI)(A,".hj"),C=(0,u.aI)(y,".kj"),L=(0,u.aI)(C,".mj"),j=(0,u.aI)(C,".nj"),E=(0,u.aI)(C,".oj");y.setAttribute("on-this-route",(0,p.xZ)(b.onThisRoute)),I.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,j.innerText=`狀態：${b.status.text}`,E.innerText=`類型：${b.type}`}a.setAttribute("empty",(0,p.xZ)(0===s))}function m(e,t){var i=(0,u.aI)(e,".he");(0,u.aI)(i,".aj").innerHTML=0===t.busArrivalTimes.length?'<div class="sj">目前沒有抵達時間可顯示</div>':t.busArrivalTimes.map(function(e){return`<div class="cj"><div class="ej"><div class="gj">${(0,v.Zf)("calendar_view_day")}</div><div class="ij">${e.personalSchedule.name}</div><div class="jj">週${(0,h.kd)(e.day).name} ${(0,h.pn)(e.personalSchedule.period.start)} - ${(0,h.pn)(e.personalSchedule.period.end)}</div></div><div class="lj">${e.chart}</div></div>`}).join("")}function y(e,t){t&&e.setAttribute("stretched","false")}function A(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function I(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}function C(e,t){var i=(0,u.aI)(e,".he"),a=(0,u.aI)(i,".ie"),n=(0,u.aI)(a,'.je[type="save-to-folder"]');n.onclick=function(){(0,g.B)("stop-on-location",[e.id,t.stopId,t.routeId])},(0,r.LH)("stop",t.stopId).then(function(e){n.setAttribute("highlighted",(0,p.xZ)(e))})}function L(e,t){var i=(0,u.aI)(e,".he"),a=(0,u.aI)(i,".ie"),n=(0,u.aI)(a,'.je[type="schedule-notification"]');n.onclick=function(){(0,b.Ho)(n,t.stopId,t.routeId,t.status.time)};var r=(0,d.Zc)(t.stopId);n.setAttribute("highlighted",(0,p.xZ)(r))}null==n?(s(e,a,i),o(e,a,i),l(e,a),c(e,a),f(e,a),m(e,a),y(e,t),A(e,i),I(e,t),C(e,a),L(e,a)):(a.status.time!==n.status.time&&(s(e,a,i),L(e,a)),n.ranking.number===a.ranking.number&&n.ranking.code===a.ranking.code||o(e,a,i),n.stopId!==a.stopId&&(l(e,a),c(e,a),C(e,a)),(0,p.hw)(n.buses,a.buses)||f(e,a),(0,p.hw)(n.busArrivalTimes,a.busArrivalTimes)||m(e,a),i!==Z&&A(e,i),t!==z&&(y(e,t),I(e,t)))}function o(e,a,n){function r(e,t){var i=(0,u.aI)(e,".bi");(0,v.yD)(i,t.icon)}function s(e,t){(0,u.aI)(e,".ci").innerHTML=t.value}function d(e,t){e.setAttribute("animation",(0,p.xZ)(t))}function o(e,t){e.setAttribute("skeleton-screen",(0,p.xZ)(t))}null==n?(r(e,a),s(e,a),d(e,i),o(e,t)):((0,p.hw)(n.icon,a.icon)||r(e,a),(0,p.hw)(n.value,a.value)||s(e,a),i!==Z&&d(e,i),t!==z&&o(e,t))}var l=(0,f.gO)("window"),m=l.width,A=l.height,I=e.groupQuantity,C=e.itemQuantity,L=e.groupedItems,$=e.groups;Q=I,D=m;for(var M=0,P=0;P<I;P++){var Y=`g_${P}`,B=(0,c.q_)($[Y].name,500,"17px",'"Noto Sans TC", sans-serif')+20;R[Y]={width:B,offset:M},M+=B}if(R[`g_${I}`]={width:0,offset:M},!H){var O=R[`g_${N}`],F=-1*O.offset+.5*D-.5*O.width,J=O.width-20;ee(Q,F,J,N)}(null===(a=S)||void 0===a?void 0:a.hash)!==e.hash&&(x.onclick=function(){(0,y.ID)(e.hash)}),(null===(n=S)||void 0===n?void 0:n.LocationName)!==e.LocationName&&(E.innerText=e.LocationName),Z!==i&&(j.setAttribute("animation",(0,p.xZ)(i)),k.setAttribute("animation",(0,p.xZ)(i))),z!==t&&(j.setAttribute("skeleton-screen",(0,p.xZ)(t)),k.setAttribute("skeleton-screen",(0,p.xZ)(t)),T.setAttribute("skeleton-screen",(0,p.xZ)(t)));var U=(0,u.jg)(w,".ee").length;if(I!==U){var W=U-I;if(W<0){for(var q=new DocumentFragment,K=new DocumentFragment,X=0,G=Math.abs(W);X<G;X++){var V=ae();q.appendChild(V.element);var te=ne();K.appendChild(te.element)}w.append(q),_.append(K)}else for(var de=(0,u.jg)(w,".ee"),oe=(0,u.jg)(_,".rh"),le=0,ue=Math.abs(W);le<ue;le++){var ce=U-1-le;de[ce].remove(),oe[ce].remove()}}for(var pe=(0,u.jg)(w,".ee"),he=0;he<I;he++){var ve=`g_${he}`,fe=pe[he],me=(0,u.jg)(fe,".fe .ge").length;if(C[ve]!==me){var ge=me-C[ve];if(ge<0)for(var be=(0,u.aI)(fe,".fe"),ye=0,Ae=Math.abs(ge);ye<Ae;ye++){var Ie=ie();be.appendChild(Ie.element)}else for(var Ce=(0,u.jg)(fe,".fe .ge"),Le=0,je=Math.abs(ge);Le<je;Le++){Ce[me-1-Le].remove()}}var Ee=(0,u.jg)((0,u.jg)(w,".ee")[he],".zh ._h .ai").length,xe=$[ve].properties.length;if(xe!==Ee){var we=Ee-xe;if(we<0)for(var ke=(0,u.aI)(fe,".zh"),_e=(0,u.aI)(ke,"._h"),Te=0,$e=Math.abs(we);Te<$e;Te++){var Me=re();_e.appendChild(Me.element)}else for(var Se=(0,u.aI)(fe,".zh"),Ze=(0,u.aI)(Se,"._h"),ze=(0,u.jg)(Ze,".ai"),Ne=0,Pe=Math.abs(we);Ne<Pe;Ne++){ze[Ee-1-Ne].remove()}}}for(var Qe=(0,u.jg)(_,".rh"),Re=(0,u.jg)(w,".ee"),De=0;De<I;De++){var He=`g_${De}`,Ye=Qe[De];(0,u.aI)(Ye,"span").innerText=$[He].name,Ye.style.setProperty("--eh",`${R[He].width}px`),Ye.style.setProperty("--sh",De.toString());for(var Be=Re[De],Oe=(0,u.jg)(Be,".zh ._h .ai"),Fe=(0,u.jg)(Be,".fe .ge"),Je=$[He].properties.length,Ue=0;Ue<Je;Ue++){var We=$[He].properties[Ue],qe=Oe[Ue];if((0,p.mQ)(S,"groups"))if((0,p.mQ)(S.groups,He))if(S.groups[He].properties[Ue])o(qe,We,S.groups[He].properties[Ue]);else o(qe,We,null);else o(qe,We,null);else o(qe,We,null)}for(var Ke=0;Ke<C[He];Ke++){var Xe=Fe[Ke],Ge=L[He][Ke];if((0,p.mQ)(S,"groupedItems"))if((0,p.mQ)(S.groupedItems,He))if(S.groupedItems[He][Ke])s(Xe,Ge,S.groupedItems[He][Ke]);else s(Xe,Ge,null);else s(Xe,Ge,null);else s(Xe,Ge,null)}}S=e,Z=i,z=t}function oe(){return le.apply(this,arguments)}function le(){return(le=(0,a.A)(function*(){var e=(0,l.Js)("playing_animation"),t=(0,l.Js)("refresh_interval"),i=(0,f.gO)("location-bus-arrival-time-chart");F=t.dynamic,Y=t.baseInterval,q=!0,W=(0,p.zx)(),M.setAttribute("refreshing","true"),M.classList.remove("yh"),document.addEventListener(W,te);var a=yield(0,s.R)(G,i.width,i.height,W);de(a,!1,e);var r=0;F&&(r=yield(0,n.wz)()),J=(new Date).getTime(),U=F?Math.max(J+B,a.dataUpdateTime+Y/r):J+Y,O=Math.max(B,U-J),q=!1,M.setAttribute("refreshing","false"),M.style.setProperty("--jh",`${O}ms`),M.classList.add("yh")})).apply(this,arguments)}function ue(){oe().then(function(){K?setTimeout(function(){ue()},Math.max(B,U-(new Date).getTime())):X=!1}).catch(function(e){K?((0,m.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){ue()},1e4)):X=!1})}function ce(e){(0,f.WR)("Location"),(0,o.XK)("location",e),G=e,N=0,R={},C.setAttribute("displayed","true"),w.scrollLeft=0,w.focus(),function(e){for(var t=(0,l.Js)("playing_animation"),i=(0,f.gO)("window"),a=(i.width,i.height),n={g_0:Math.floor(a/50)+5,g_1:Math.floor(a/50)+5},r={},s=0;s<2;s++){var d=`g_${s}`;r[d]=[];for(var o=0;o<n[d];o++)r[d].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}de({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:n,LocationName:"載入中",hash:e,dataUpdateTime:0},!0,t)}(e),K||(K=!0,X?oe():(X=!0,ue())),(0,f.Z_)()}function pe(){C.setAttribute("displayed","false"),K=!1,(0,f.l$)()}function he(e,t){var i,a=(0,u.aI)(w,`.ee .fe .ge#${e}`),n=(0,u.aI)(a,".he"),r=(0,u.aI)(n,".ie"),s=A((0,u.jg)(r,'.je[highlighted="true"][type="tab"]'));try{for(s.s();!(i=s.n()).done;){i.value.setAttribute("highlighted","false")}}catch(e){s.e(e)}finally{s.f()}switch((0,u.aI)(r,`.je[code="${t}"]`).setAttribute("highlighted","true"),t){case 0:(0,u.aI)(a,"._i").setAttribute("displayed","true"),(0,u.aI)(a,".aj").setAttribute("displayed","false");break;case 1:(0,u.aI)(a,"._i").setAttribute("displayed","false"),(0,u.aI)(a,".aj").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=40d8a1e06103a2a41069.js.map