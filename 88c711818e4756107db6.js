"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[470],{8201(e,t,r){r.d(t,{a:()=>f});var a=r(467),i=r(4311),n=r(3153),s=r(6788),u=!1,o={};function f(e){return p.apply(this,arguments)}function p(){return p=(0,a.a)(function*(e){function t(){return r.apply(this,arguments)}function r(){return r=(0,a.a)(function*(){var t=[];for(var r of[[0,12],[1,12]]){for(var a=(0,n.a)(r[0],r[1]),i=yield(0,s.c)(a,e,`getSemiTimeTable_${r[0]}`,"json"),u=0,o=i.BusInfo.length;u<o;u++)t.push(i.BusInfo[u]);(0,s.g)(e,i.EssentialInfo.UpdateTime,-480)}return t}),r.apply(this,arguments)}var f="bus_semi_timetable_cache",p=yield(0,i.d)(0,`${f}_timestamp`);if(null===p){var l=yield t();return yield(0,i.g)(0,`${f}_timestamp`,(new Date).getTime()),yield(0,i.g)(0,f,JSON.stringify(l)),u||(u=!0,o=l),l}if((new Date).getTime()-parseInt(p)>12096e5){var c=yield t();return yield(0,i.g)(0,`${f}_timestamp`,(new Date).getTime()),yield(0,i.g)(0,f,JSON.stringify(c)),c}if(!u){var d=yield(0,i.d)(0,f);u=!0,o=JSON.parse(d)}return(0,s.f)(e,"getSemiTimeTable_0",0,!0),(0,s.f)(e,"getSemiTimeTable_1",0,!0),(0,s.g)(e,-1),o}),p.apply(this,arguments)}},424(e,t,r){r.d(t,{a:()=>l});var a=r(467),i=r(4311),n=r(3153),s=r(6788),u=!1,o={};function f(e){return p.apply(this,arguments)}function p(){return(p=(0,a.a)(function*(e){var t=new Worker(new URL(r.p+r.u(132),r.b));return yield new Promise(function(r,a){t.onmessage=function(e){r(e.data),t.terminate()},t.onerror=function(e){a(e.message),t.terminate()},t.postMessage(e)})})).apply(this,arguments)}function l(e){return c.apply(this,arguments)}function c(){return c=(0,a.a)(function*(e){function t(){return r.apply(this,arguments)}function r(){return r=(0,a.a)(function*(){var t=[];for(var r of[[0,11],[1,11]]){for(var a=(0,n.a)(r[0],r[1]),i=yield(0,s.c)(a,e,`getStop_${r[0]}`,"json"),u=0,o=i.BusInfo.length;u<o;u+=64)Array.prototype.push.apply(t,i.BusInfo.slice(u,u+64));(0,s.g)(e,i.EssentialInfo.UpdateTime,-480)}return t}),r.apply(this,arguments)}var p="bus_stop_cache",l=yield(0,i.d)(0,`${p}_timestamp`);if(null===l){var c=yield t(),d=yield f(c);return yield(0,i.g)(0,`${p}_timestamp`,(new Date).getTime()),yield(0,i.g)(0,p,JSON.stringify(d)),u||(u=!0,o=d),d}if((new Date).getTime()-parseInt(l)>3888e6){var v=yield t(),y=yield f(v);return yield(0,i.g)(0,`${p}_timestamp`,(new Date).getTime()),yield(0,i.g)(0,p,JSON.stringify(y)),y}if(!u){var m=yield(0,i.d)(0,p);u=!0,o=JSON.parse(m)}return(0,s.f)(e,"getStop_0",0,!0),(0,s.f)(e,"getStop_1",0,!0),(0,s.g)(e,-1),o}),c.apply(this,arguments)}},2303(e,t,r){r.d(t,{a:()=>o,b:()=>u,c:()=>c,d:()=>l,e:()=>p,f:()=>f,g:()=>n,h:()=>s});var a=r(8024),i=r(5579);function n(e,t){if("string"==typeof e){var r=parseInt(e);if(-3===r)return{code:6,text:"末班駛離",time:r};if(-4===r)return{code:5,text:"今日停駛",time:r};if(-2===r)return{code:4,text:"交通管制",time:r};if(-1===r)return{code:3,text:"未發車",time:r};if(0<=r&&r<=10)return{code:2,text:"進站中",time:r};if(10<r&&r<=180)return{code:1,text:(0,i.d)(r,t),time:r};if(180<r&&r<=250)return{code:.5,text:(0,i.d)(r,t),time:r};if(250<r)return{code:0,text:(0,i.d)(r,t),time:r}}return{code:7,text:"發生錯誤",time:-5}}function s(e,t){var r=e.length;if(0===t){var a=0,i=0;return 4===r&&(a=parseInt(e.substring(0,2)),i=parseInt(e.substring(2,4))),2===r&&(i=parseInt(e)),{type:"moment",hours:a,minutes:i}}if(1===t){var n=0,s=0;if(4===r){var u=parseInt(e.substring(0,2)),o=parseInt(e.substring(2,4));n=Math.min(u,o),s=Math.max(u,o)}if(2===r){var f=parseInt(e);n=f,s=f}return{type:"range",min:n,max:s}}}function u(e,t,r,i,n){var s={},u={};for(var o of t){u[o.BusID]=o}for(var f of e){var p={};p.CarType=f.CarType,p.BusStatus=f.BusStatus,p.BusID=f.BusID,p.CarOnStop=f.CarOnStop;var l=parseInt(f.RouteID),c=String(f.BusID),d=!1,v=0;l===i||n.indexOf(l)>-1||l===10*i?(d=!0,v=c.charCodeAt(0)*Math.pow(10,-5)):(d=!1,v=c.charCodeAt(0)),p.onThisRoute=d,p.index=v;var y={};if((0,a.f)(u,c)){y=u[c],p.position={latitude:parseFloat(y.Latitude),longitude:parseFloat(y.Longitude)};var m={},g=!1;for(var h in r){var b=r[h];if(b.pid.indexOf(l)>-1){m=b,g=!0;break}}p.RouteName=g?m.n:"未知路線",p.RouteID=g?m.id:null;var I=`s_${f.StopID}`;(0,a.f)(s,I)||(s[I]=[]),s[I].push(p)}}return s}function o(e,t,r,i){var n={},s={};for(var u of t){s[u.BusID]=u}for(var o of e){var f={},p=parseInt(o.StopID),l=parseInt(o.RouteID),c=String(o.BusID);if(!(i.indexOf(p)<0)){f.index=c.charCodeAt(0),f.onThisRoute=!0,f.CarType=o.CarType,f.BusStatus=o.BusStatus,f.BusID=o.BusID,f.CarOnStop=o.CarOnStop;var d={};if((0,a.f)(s,c)){d=s[c],f.position={latitude:parseFloat(d.Latitude),longitude:parseFloat(d.Longitude)};var v={},y=!1;for(var m in r){var g=r[m];if(g.pid.indexOf(l)>-1){v=g,y=!0;break}}f.RouteName=y?v.n:"未知路線",f.RouteID=y?v.id:null;var h=`s_${p}`;(0,a.f)(n,h)||(n[h]=[]),n[h].push(f)}}}return n}function f(e){var t="";switch(e){case"0":t="一般";break;case"1":t="低底盤";break;case"2":t="大復康巴士";break;case"3":t="狗狗友善專車";break;default:t="未知類型"}return t}function p(e){var t="";switch(e){case"0":t="離站";break;case"1":t="進站";break;default:t="未知狀態"}return t}function l(e){var t="";switch(e){case"0":t="正常";break;case"1":t="車禍";break;case"2":t="故障";break;case"3":t="塞車";break;case"4":t="緊急求援";break;case"5":t="加油";break;case"99":t="非營運狀態";break;default:t="未知狀態"}return t}function c(e){var t={},r=f(e.CarType);t.type=r;var a=p(e.CarOnStop),i=l(e.BusStatus);return t.carNumber=e.BusID,t.status={onStop:a,situation:i,text:`${a} | ${i}`},t.RouteName=e.RouteName,t.onThisRoute=e.onThisRoute,t.index=e.index,t.position=e.position,t}},6788(e,t,r){r.d(t,{a:()=>g,b:()=>k,c:()=>l,d:()=>m,e:()=>S,f:()=>y,g:()=>I});var a=r(2284),i=r(467),n=r(8024),s=r(4750),u=r(5579),o=r(8925),f={},p=new Error("E21");function l(e,t,r,a){return c.apply(this,arguments)}function c(){return(c=(0,i.a)(function*(e,t,r,a){if((0,n.f)(f,e)){if(f[e].processing)return yield new Promise(function(a,i){f[e].requests.push([a,i,t,r])});if(null!==f[e].result&&(new Date).getTime()<=f[e].timestamp)return y(t,r,0,!0),f[e].result}else f[e]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var i=yield fetch(e);if(!i.ok)throw y(t,r,0,!0),new Error("E22");for(var u=parseInt(String(i.headers.get("content-length"))),c=i.body.getReader(),v=[],m=0;;){var g=yield c.read(),h=g.done,b=g.value;if(h)break;v.push(b);var I=(m+=b.length)/u;if(y(t,r,I,!1),(0,n.f)(f,e))for(var S of f[e].requests)y(S[2],S[3],I,!1)}var k=new Uint8Array(m),w=0;for(var D of v)k.set(D,w),w+=D.length;var _,T=new Blob([k],{type:"application/gzip"}),x=yield T.arrayBuffer(),B=yield(0,s.a)(x);switch(a){case"json":_=/^<!doctype html>/.test(B)?yield l(e.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,r,a):JSON.parse(B);break;case"xml":_=B}var C=new Date;if(yield(0,o.d)(u,C),_){if((0,n.f)(f,e)){for(var $=m/u,O=f[e].requests.shift();O;)O[0](_),y(O[2],O[3],$,!1),O=f[e].requests.shift();f[e].result=_,f[e].timestamp=C.getTime()+3e4,f[e].processing=!1}return d(),_}if((0,n.f)(f,e)){for(var N=f[e].requests.shift();N;)N[1](p),y(N[2],N[3],0,!0),N=f[e].requests.shift();f[e].failed=!0}throw d(),p})).apply(this,arguments)}function d(){var e=(new Date).getTime();for(var t in f)if((0,n.f)(f,t)){if(!f[t].processing&&e>f[t].timestamp){delete f[t];continue}if(f[t].failed){delete f[t];continue}}}var v={};function y(e,t,r,a){(0,n.f)(v,e)||(v[e]={}),(0,n.f)(v[e],t)?(a?v[e][t].expel=!0:(v[e][t].expel=!1,v[e][t].progress=r),h(e,"run")):(v[e][t]={expel:!1,progress:r,total:1},h(e,"start"))}function m(e){if((0,n.f)(v,e)&&"object"===(0,a.a)(v[e])){var t=0,r=0;for(var i in v[e])v[e][i].expel||(t+=v[e][i].total,r+=v[e][i].progress);var s=Math.min(Math.max(r/t,0),1);return s===1/0||isNaN(s)?1:s}return 1}function g(e){(0,n.f)(v,e)&&(delete v[e],h(e,"end"))}function h(e,t){var r={target:e,stage:t,progress:m(e)},a=new CustomEvent(e,{detail:r});document.dispatchEvent(a)}var b={};function I(e,t,r){(0,n.f)(b,e)||(b[e]=0);var a=0;"string"==typeof t&&(a=(0,u.h)(t,r)),a>b[e]&&(b[e]=a)}function S(e){return(0,n.f)(b,e)?1*b[e]:0}function k(e){(0,n.f)(b,e)&&delete b[e]}},6160(e,t,r){r.d(t,{a:()=>d});var a=r(467),i=r(8024),n=r(6802),s=r(7810),u=r(9734),o=r(8011),f=r(424),p=r(2303),l=r(6788),c=r(8134);function d(e,t){return v.apply(this,arguments)}function v(){return(v=(0,a.a)(function*(e,t){var r=`c_${e}`,a=yield(0,u.a)(t,!0),d=yield(0,n.a)(t),v=yield(0,s.a)(t),y=yield(0,f.a)(t),m=yield(0,o.a)(t,0),g={properties:[],LocationName:""},h={};if(!(0,i.f)(a,r))return g;var b=(h=a[r]).CarNum;g.properties.push({key:"car_number",icon:"tag",value:b});var I=h.CarType,S=(0,p.f)(I);g.properties.push({key:"car_type",icon:"directions_bus",value:S});var k={};for(var w of d){if(w.BusID===b){k=w;break}}var D=parseInt(k.RouteID),_=k.BusStatus,T=(0,p.d)(_),x=parseInt(k.GoBack),B={};for(var C of v){if(C.BusID===b){B=C;break}}var $=B.CarOnStop,O=(0,p.e)($);g.properties.push({key:"status",icon:"vital_signs",value:`${O} | ${T}`});var N=B.StopID,R=yield(0,c.d)(D),E={};if(!(R.length>0))return g;var q=(E=R[0]).id,J=E.pid,L=E.n,A=E.dep,M=[E.des,A,""][x||0];g.properties.push({key:"route",icon:"route",value:`${L} - 往${M}`}),g.RouteID=q,g.FullPathAttributeId=J;var F=`s_${N}`;if(!(0,i.f)(y,F))return g;var j=m[`l_${y[F].stopLocationId}`].n;return g.properties.push({key:"location_name",icon:"location_on",value:j}),(0,l.a)(t),(0,l.b)(t),g})).apply(this,arguments)}}}]);
//# sourceMappingURL=88c711818e4756107db6.js.map