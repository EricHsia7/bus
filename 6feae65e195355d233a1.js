"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,i)=>{i.d(e,{Ch:()=>vt,S5:()=>tt,SR:()=>lt,U7:()=>ct,aU:()=>ft,py:()=>pt});var s=i(7123),n=i(4537),a=i(6788),r=i(3459),o=i(8024),d=i(7968),u=i(3648),l=i(5767),c=i(9566),v=i(904),f=i(9119),p=i(5579),h=i(5314),m=i(4636);function g(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return b(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw a}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=Array(e);i<e;i++)s[i]=t[i];return s}function y(t,e,i,s,n,a,r){try{var o=t[a](r),d=o.value}catch(t){return void i(t)}o.done?e(d):Promise.resolve(d).then(s,n)}var A=(0,u.bv)(".ek"),I=(0,u.aI)(A,".xl"),$=(0,u.aI)(I,"._l"),k=(0,u.aI)(I,".zl"),w=(0,u.aI)(I,".gm .hm"),x=(0,u.aI)(I,".am"),L=(0,u.aI)(x,".bm"),R=(0,u.aI)(I,".em"),T=(0,u.aI)(R,".fm"),j=(0,u.aI)(A,".fk"),P={},S=!0,_=!1,E=0,Z=0,M=0,C={},D=0,B=!1,H=1e4,F=15e3,z=5e3,q=15e3,N=!0,O=!1,U=0,Q=0,J=!1,W="",K=-1,X=!1,G=0,V=[],Y=20;function tt(){j.addEventListener("touchstart",(function(){E=Math.round(j.scrollLeft/D)}),{passive:!0}),j.addEventListener("scroll",(function(t){B=!0;var e=t.target.scrollLeft/D;Z=e>E?E+1:E-1;var i=C[`g_${E}`]||{width:0,offset:0},s=C[`g_${Z}`]||{width:0,offset:0},n=i.width+(s.width-i.width)*Math.abs(e-E),a=-1*(i.offset+(s.offset-i.offset)*Math.abs(e-E))+.5*D-.5*n;et(M,a,n-Y,e),e===Z&&(E=Math.round(j.scrollLeft/D),B=!1)}),{passive:!0})}function et(t,e,i,s){j.style.setProperty("--dk",t.toString()),T.style.setProperty("--tl",i.toString()),L.style.setProperty("--cm",`${e.toFixed(5)}px`),L.style.setProperty("--rl",s.toFixed(5))}function it(t){var e=t;J&&(K=-1+(0,a._M)(W),w.style.setProperty("--vl",K.toString())),"end"===e.detail.stage&&document.removeEventListener(e.detail.target,it)}function st(){var t=(0,o.zx)("i"),e=document.createElement("div");return e.classList.add("nm"),e.id=t,e.setAttribute("stretched","false"),e.setAttribute("stretching","false"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0"),e.innerHTML='<div class="sm"></div><div class="vm"><div class="ga" code="0"></div><div class="ha" code="0"></div></div>',{element:e,id:t}}function nt(t){var e=(0,o.zx)("i"),i=document.createElement("div");return i.classList.add("ym"),i.id=e,i.setAttribute("stretched","false"),i.setAttribute("stretching","false"),i.setAttribute("push-direction","0"),i.setAttribute("push-state","0"),i.innerHTML=`<div class="zm"><div class="_m"></div><div class="an"><div class="bn"><div class="ga" code="0"></div><div class="ha" code="0"></div></div><div class="cn" onclick="bus.route.stretchRouteItem('${e}', '${t}')">${(0,n.Z)("keyboard_arrow_down")}</div><div class="dn"></div></div></div><div class="en" displayed="false"><div class="fn"><div class="gn" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 0)" code="0"><div class="hn">${(0,n.Z)("directions_bus")}</div>公車</div><div class="gn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 1)" code="1"><div class="hn">${(0,n.Z)("departure_board")}</div>抵達時間</div><div class="gn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 2)" code="2"><div class="hn">${(0,n.Z)("route")}</div>路線</div><div class="gn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab('${e}', 3)" code="3"><div class="hn">${(0,n.Z)("location_on")}</div>地點</div><div class="gn" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder('stop-on-route', ['${e}', null, null])"><div class="hn">${(0,n.Z)("folder")}</div>儲存至資料夾</div><div class="gn" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification('stop-on-route', ['${e}', null, null, null])" enabled="true"><div class="hn">${(0,n.Z)("notifications")}</div>設定到站通知</div></div><div class="in" displayed="true"></div><div class="jn" displayed="false"></div><div class="kn" displayed="false"></div><div class="ln" displayed="false"></div></div>`,{element:i,id:e}}function at(){var t=document.createElement("div");t.classList.add("gk");var e=document.createElement("div");e.classList.add("hk");var i=document.createElement("div");i.classList.add("ik");var s=document.createElement("div");s.classList.add("mm");var n=document.createElement("div");n.classList.add("jk");var a=document.createElement("div");return a.classList.add("mn"),n.appendChild(a),i.appendChild(s),e.appendChild(i),e.appendChild(n),t.appendChild(e),{element:t,id:""}}function rt(t,e,i){function s(e,i,s,a,r,d){function l(t,e,i,s,n){var a=(0,u.aI)(e,".vm"),r=(0,u.aI)(a,".ha"),o=(0,u.aI)(a,".ga"),d=(0,u.aI)(t,".bn"),l=(0,u.aI)(d,".ha"),c=(0,u.aI)(d,".ga");if(o.setAttribute("code",i.status.code.toString()),c.setAttribute("code",i.status.code.toString()),c.innerText=i.status.text,!s&&n){var v=t.getBoundingClientRect(),f=v.top,p=v.left,h=v.bottom,m=v.right,g=window.innerWidth,b=window.innerHeight;if(h>0&&f<b&&m>0&&p<g)return r.addEventListener("animationend",(function(){r.setAttribute("code",i.status.code.toString()),r.classList.remove("ya")}),{once:!0}),l.addEventListener("animationend",(function(){l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text,l.classList.remove("ya")}),{once:!0}),r.classList.add("ya"),void l.classList.add("ya")}r.setAttribute("code",i.status.code.toString()),l.setAttribute("code",i.status.code.toString()),l.innerText=i.status.text}function v(t,e,i){t.setAttribute("segment-buffer",(0,o.xZ)(i.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,o.xZ)(i.segmentBuffer.isSegmentBuffer))}function f(t,e){(0,u.aI)(t,"._m").innerText=e.name}function h(t,e){(0,u.aI)(t,".in").innerHTML=0===e.buses.length?'<div class="nn">目前沒有公車可顯示</div>':e.buses.map((function(t){return`<div class="on" on-this-route="${t.onThisRoute}"><div class="pn"><div class="qn">${(0,n.Z)("directions_bus")}</div><div class="rn">${t.carNumber}</div></div><div class="sn"><div class="tn">路線：${t.RouteName}</div><div class="un">狀態：${t.status.text}</div><div class="vn">類型：${t.type}</div></div></div>`})).join("")}function g(t,e){(0,u.aI)(t,".jn").innerHTML=0===e.overlappingRoutes.length?'<div class="wn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return`<div class="xn"><div class="yn"><div class="zn">${(0,n.Z)("route")}</div><div class="_n">${t.name}</div></div><div class="ao">${t.RouteEndPoints.html}</div><div class="bo"><div class="co" onclick="bus.route.switchRoute(${t.RouteID}, [${t.PathAttributeId.join(",")}])">查看路線</div><div class="co" onclick="bus.folder.openSaveToFolder('route-on-route', [${t.RouteID}])">收藏路線</div></div></div>`})).join("")}function b(t,e){(0,u.aI)(t,".kn").innerHTML=0===e.busArrivalTimes.length?'<div class="do">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return`<div class="eo"><div class="fo"><div class="go">${(0,n.Z)("calendar_view_day")}</div><div class="ho">${t.personalSchedule.name}</div><div class="io">週${(0,p.kd)(t.day).name} ${(0,p.pn)(t.personalSchedule.period.start)} - ${(0,p.pn)(t.personalSchedule.period.end)}</div></div><div class="jo">${t.chart}</div></div>`})).join("")}function y(t,e){(0,u.aI)(t,".ln").innerHTML=0===e.nearbyLocations.length?'<div class="ko">目前沒有地點可顯示</div>':e.nearbyLocations.map((function(t){return`<div class="lo"><div class="mo"><div class="no">${(0,n.Z)("location_on")}</div><div class="oo">${t.name}</div></div><div class="po">${t.distance}公尺</div><div class="qo"><div class="ro" onclick="bus.location.openLocation('${t.hash}')">查看地點</div><div class="ro">收藏地點</div></div></div>`})).join("")}function A(t,e,i){t.setAttribute("nearest",(0,o.xZ)(i.nearest)),e.setAttribute("nearest",(0,o.xZ)(i.nearest))}function I(t,e,i,s,n){var a=(null==i?void 0:i.progress)||0,r=(null==e?void 0:e.progress)||0,o=(0,u.aI)(t,".sm");if(!s&&n&&0!==a&&0===r&&Math.abs(r-a)>0)return o.style.setProperty("--qm","100%"),o.style.setProperty("--rm","100%"),void o.addEventListener("transitionend",(function(){o.style.setProperty("--qm","0%"),o.style.setProperty("--rm","0%")}),{once:!0});o.style.setProperty("--qm","0%"),o.style.setProperty("--rm",100*r+"%")}function $(t,e,i){i&&((0,u.aI)(t,".en").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function k(t,e,i){t.setAttribute("animation",(0,o.xZ)(i)),e.setAttribute("animation",(0,o.xZ)(i))}function w(t,e,i){t.setAttribute("skeleton-screen",(0,o.xZ)(i)),e.setAttribute("skeleton-screen",(0,o.xZ)(i))}function x(e,i){var s=(0,u.aI)(e,'.en .fn .gn[type="save-to-folder"]');s.setAttribute("onclick",`bus.folder.openSaveToFolder('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}])`),(0,c.LH)("stop",i.id).then((function(t){s.setAttribute("highlighted",(0,o.xZ)(t))}))}function L(e,i){var s=(0,u.aI)(e,'.en .fn .gn[type="schedule-notification"]');s.setAttribute("onclick",`bus.notification.openScheduleNotification('stop-on-route', ['${e.id}', ${i.id}, ${t.RouteID}, ${i.status.time}])`);var n=(0,m.Zc)(i.id);s.setAttribute("highlighted",(0,o.xZ)(n))}null===a?(l(e,i,s,r,d),f(e,s),h(e,s),g(e,s),b(e,s),y(e,s),v(e,i,s),A(e,i,s),I(i,s,a,r,d),$(e,i,r),k(e,i,d),w(e,i,r),x(e,s),L(e,s)):(s.status.time!==a.status.time&&(l(e,i,s,r,d),L(e,s)),(0,o.hw)(a.buses,s.buses)||h(e,s),(0,o.hw)(a.busArrivalTimes,s.busArrivalTimes)||b(e,s),(0,o.hw)(a.segmentBuffer,s.segmentBuffer)||v(e,i,s),a.nearest!==s.nearest&&A(e,i,s),a.progress!==s.progress&&I(i,s,a,r,d),a.id!==s.id&&(f(e,s),g(e,s),y(e,s),x(e,s),L(e,s)),d!==S&&k(e,i,d),r!==_&&($(e,i,r),w(e,i,r)))}var a=(0,v.gO)("window"),r=a.width,l=a.height,f=t.groupQuantity,h=t.itemQuantity,g=t.groupedItems;M=f,D=r;for(var b=0,y=0;y<f;y++){var A=(0,d.q_)([t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`往${t}`}))[y],500,"17px",'"Noto Sans TC", sans-serif')+Y;C[`g_${y}`]={width:A,offset:b},b+=A}var I=-1*C[`g_${E}`].offset+.5*D-.5*C[`g_${E}`].width;B||et(M,I,C[`g_${E}`].width-Y,E),$.innerHTML=`<span>${t.RouteName}</span>`,$.setAttribute("animation",(0,o.xZ)(i)),$.setAttribute("skeleton-screen",(0,o.xZ)(e)),x.setAttribute("animation",(0,o.xZ)(i)),x.setAttribute("skeleton-screen",(0,o.xZ)(e)),R.setAttribute("animation",(0,o.xZ)(i)),R.setAttribute("skeleton-screen",(0,o.xZ)(e)),k.setAttribute("onclick",`bus.route.openRouteDetails(${t.RouteID}, [${t.PathAttributeId.join(",")}])`);var w,T,Z=(0,u.jg)(j,".gk").length;if(f!==Z){var H=Z-f;if(H<0){for(var F=new DocumentFragment,z=new DocumentFragment,q=0;q<Math.abs(H);q++){var N=at();F.appendChild(N.element);var O=(w=void 0,T=void 0,w=(0,o.zx)("t"),(T=document.createElement("div")).classList.add("dm"),T.id=w,{element:T,id:w});z.appendChild(O.element)}j.append(F),L.append(z)}else for(var U=(0,u.jg)(j,".gk"),Q=(0,u.jg)(L,".dm"),J=0;J<Math.abs(H);J++){var W=Z-1-J;U[W].remove(),Q[W].remove()}}for(var K=(0,u.jg)(j,".gk"),X=0;X<f;X++){var G=`g_${X}`,V=K[X],tt=(0,u.aI)(V,".jk"),it=(0,u.aI)(V,".ik"),rt=(0,u.jg)(tt,".ym").length;if(h[G]!==rt){var ot=rt-h[G];if(ot<0){for(var dt=new DocumentFragment,ut=new DocumentFragment,lt=0;lt<Math.abs(ot);lt++){var ct=st(),vt=nt(ct.id);dt.appendChild(vt.element),ut.appendChild(ct.element)}tt.append(dt),it.append(ut)}else for(var ft=(0,u.jg)(tt,".ym"),pt=(0,u.jg)(it,".nm"),ht=0;ht<Math.abs(ot);ht++){var mt=rt-1-ht;ft[mt].remove(),pt[mt].remove()}}}for(var gt=(0,u.jg)(L,".dm"),bt=0;bt<f;bt++){var yt=`g_${bt}`,At=gt[bt];At.innerHTML=[t.RouteEndPoints.RouteDestination,t.RouteEndPoints.RouteDeparture,""].map((function(t){return`<span>往${t}</span>`}))[bt],At.style.setProperty("--ul",`${C[yt].width}px`),At.style.setProperty("--sl",bt.toString());for(var It=K[bt],$t=(0,u.aI)(It,".jk"),kt=(0,u.aI)(It,".ik"),wt=(0,u.jg)($t,".ym"),xt=(0,u.jg)(kt,".nm"),Lt=0;Lt<h[yt];Lt++){var Rt=wt[Lt],Tt=xt[Lt],jt=g[yt][Lt];if(P.hasOwnProperty("groupedItems"))if(P.groupedItems.hasOwnProperty(yt))if(P.groupedItems[yt][Lt])s(Rt,Tt,jt,P.groupedItems[yt][Lt],e,i);else s(Rt,Tt,jt,null,e,i);else s(Rt,Tt,jt,null,e,i);else s(Rt,Tt,jt,null,e,i)}}P=t,S=i,_=e}function ot(){return dt.apply(this,arguments)}function dt(){var t;return t=function*(){var t=(0,r.Js)("playing_animation"),e=(0,r.Js)("refresh_interval"),i=(0,v.gO)("route-bus-arrival-time-chart");N=e.dynamic,F=e.baseInterval,J=!0,W=(0,o.zx)("r"),w.setAttribute("refreshing","true"),document.addEventListener(W,it);var n=yield(0,s.R)(G,V,i.width,i.height,W);rt(n,!1,t);var a=0;N&&(a=yield(0,l.wz)()),U=(new Date).getTime(),Q=N?Math.max(U+z,n.dataUpdateTime+F/a):U+F,q=Math.max(z,Q-U),J=!1,w.setAttribute("refreshing","false"),w.classList.remove("im"),w.style.setProperty("--wl",`${q}ms`),w.classList.add("im")},dt=function(){var e=this,i=arguments;return new Promise((function(s,n){var a=t.apply(e,i);function r(t){y(a,s,n,r,o,"next",t)}function o(t){y(a,s,n,r,o,"throw",t)}r(void 0)}))},dt.apply(this,arguments)}function ut(){ot().then((function(){O?setTimeout((function(){ut()}),Math.max(z,Q-(new Date).getTime())):X=!1})).catch((function(t){console.error(t),O?((0,f.a)(`路線網路連線中斷，將在${H/1e3}秒後重試。`,"error"),setTimeout((function(){ut()}),H)):X=!1}))}function lt(t,e){(0,v.WR)("Route"),(0,h.XK)("route",t),G=t,V=e,E=0,A.setAttribute("displayed","true"),j.scrollLeft=0,function(){for(var t=(0,r.Js)("playing_animation"),e=(0,v.gO)("window"),i=(e.width,e.height),s=Math.floor(i/50)+5,n={},a=0;a<2;a++){var o=`g_${a}`;n[o]=[];for(var d=0;d<s;d++)n[o].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],nearbyLocations:[],sequence:d,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}rt({groupedItems:n,groupQuantity:2,itemQuantity:{g_0:s,g_1:s},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,t)}(),O||(O=!0,X?ot():(X=!0,ut()),K=-1),(0,v.Z_)()}function ct(){A.setAttribute("displayed","false"),O=!1,K=-1,(0,v.l$)()}function vt(t,e){O=!1,K=-1,lt(t,e)}function ft(t,e){var i=(0,u.aI)(j,`.gk .hk .jk .ym#${t}`),s=(0,u.aI)(i,".en"),n=(0,u.aI)(j,`.gk .hk .ik .nm#${e}`),a=i.parentElement,r=n.parentElement,o=(0,u.ji)(n,"nm"),d=(0,u.ji)(i,"ym"),l=d.length,c=a.getBoundingClientRect(),v=i.getBoundingClientRect(),f=r.getBoundingClientRect(),p=n.getBoundingClientRect().top-f.top,h=v.top-c.top,m="true"===i.getAttribute("stretched"),g="true"===i.getAttribute("animation");if(g){var b=m?"2":"1";n.setAttribute("stretching","true"),n.style.setProperty("--km",`${p}px`),i.setAttribute("stretching","true"),i.style.setProperty("--to",`${h}px`);for(var y=0;y<l;y++){var A=d[y],I=o[y];I.style.setProperty("--lm",(-1*y-1).toString()),I.setAttribute("push-direction",b),I.setAttribute("push-state","1"),A.setAttribute("push-direction",b),A.setAttribute("push-state","1")}i.addEventListener("transitionend",(function(){for(var t=0;t<l;t++){var e=d[t],s=o[t];s.setAttribute("push-direction","0"),s.setAttribute("push-state","0"),e.setAttribute("push-direction","0"),e.setAttribute("push-state","0")}n.setAttribute("stretching","false"),i.setAttribute("stretching","false")}),{once:!0}),i.addEventListener("transitionstart",(function(){for(var t=0;t<l;t++){var e=d[t];o[t].setAttribute("push-state","2"),e.setAttribute("push-state","2")}}),{once:!0})}m?(g?s.addEventListener("transitionend",(function(){s.setAttribute("displayed","false")}),{once:!0}):s.setAttribute("displayed","false"),i.setAttribute("stretched","false"),n.setAttribute("stretched","false")):(s.setAttribute("displayed","true"),i.setAttribute("stretched","true"),n.setAttribute("stretched","true"))}function pt(t,e){var i,s=(0,u.aI)(j,`.ym#${t}`),n=(0,u.aI)(s,".fn"),a=g((0,u.jg)(n,'.gn[highlighted="true"][type="tab"]'));try{for(a.s();!(i=a.n()).done;){i.value.setAttribute("highlighted","false")}}catch(t){a.e(t)}finally{a.f()}switch((0,u.aI)(n,`.gn[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,u.aI)(s,".in").setAttribute("displayed","true"),(0,u.aI)(s,".kn").setAttribute("displayed","false"),(0,u.aI)(s,".jn").setAttribute("displayed","false"),(0,u.aI)(s,".ln").setAttribute("displayed","false");break;case 1:(0,u.aI)(s,".in").setAttribute("displayed","false"),(0,u.aI)(s,".kn").setAttribute("displayed","true"),(0,u.aI)(s,".jn").setAttribute("displayed","false"),(0,u.aI)(s,".ln").setAttribute("displayed","false");break;case 2:(0,u.aI)(s,".in").setAttribute("displayed","false"),(0,u.aI)(s,".kn").setAttribute("displayed","false"),(0,u.aI)(s,".jn").setAttribute("displayed","true"),(0,u.aI)(s,".ln").setAttribute("displayed","false");break;case 3:(0,u.aI)(s,".in").setAttribute("displayed","false"),(0,u.aI)(s,".kn").setAttribute("displayed","false"),(0,u.aI)(s,".jn").setAttribute("displayed","false"),(0,u.aI)(s,".ln").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=6feae65e195355d233a1.js.map