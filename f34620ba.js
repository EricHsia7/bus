"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[126],{2303(e,t,r){r.d(t,{$Q:()=>i,AS:()=>c,Ov:()=>l,aU:()=>s,eu:()=>d,s$:()=>p,w_:()=>u,zi:()=>f});var n=r(5579);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){if("string"==typeof e){var r=parseInt(e);if(-3===r)return{code:6,text:"末班駛離",time:r};if(-4===r)return{code:5,text:"今日停駛",time:r};if(-2===r)return{code:4,text:"交通管制",time:r};if(-1===r)return{code:3,text:"未發車",time:r};if(0<=r&&r<=10)return{code:2,text:"進站中",time:r};if(10<r&&r<=180)return{code:1,text:(0,n.fU)(r,t),time:r};if(180<r&&r<=250)return{code:.5,text:(0,n.fU)(r,t),time:r};if(250<r)return{code:0,text:(0,n.fU)(r,t),time:r}}return{code:7,text:"發生錯誤",time:-5}}function s(e,t){var r=e.length;if(0===t){var n=0,o=0;return 4===r&&(n=parseInt(e.substring(0,2)),o=parseInt(e.substring(2,4))),2===r&&(o=parseInt(e)),{type:"moment",hours:n,minutes:o}}if(1===t){var a=0,i=0;if(4===r){var s=parseInt(e.substring(0,2)),u=parseInt(e.substring(2,4));a=Math.min(s,u),i=Math.max(s,u)}if(2===r){var c=parseInt(e);a=c,i=c}return{type:"range",min:a,max:i}}}function u(e,t,r,n,a){var i,s={},u={},c=o(t);try{for(c.s();!(i=c.n()).done;){var l=i.value;u[l.BusID]=l}}catch(e){c.e(e)}finally{c.f()}var f,d=o(e);try{for(d.s();!(f=d.n()).done;){var p=f.value,h={};h.CarType=p.CarType,h.BusStatus=p.BusStatus,h.BusID=p.BusID,h.CarOnStop=p.CarOnStop;var v=parseInt(p.RouteID),y=String(p.BusID),g=!1,m=0;v===n||a.indexOf(v)>-1||v===10*n?(g=!0,m=y.charCodeAt(0)*Math.pow(10,-5)):(g=!1,m=y.charCodeAt(0)),h.onThisRoute=g,h.index=m;var b={};if(u.hasOwnProperty(y)){b=u[y],h.position={latitude:parseFloat(b.Latitude),longitude:parseFloat(b.Longitude)};var S={},w=!1;for(var I in r){var k=r[I];if(k.pid.indexOf(v)>-1){S=k,w=!0;break}}h.RouteName=w?S.n:"未知路線",h.RouteID=w?S.id:null;var O=`s_${p.StopID}`;s.hasOwnProperty(O)||(s[O]=[]),s[O].push(h)}}}catch(e){d.e(e)}finally{d.f()}return s}function c(e,t,r,n){var a,i={},s={},u=o(t);try{for(u.s();!(a=u.n()).done;){var c=a.value;s[c.BusID]=c}}catch(e){u.e(e)}finally{u.f()}var l,f=o(e);try{for(f.s();!(l=f.n()).done;){var d=l.value,p={},h=parseInt(d.StopID),v=parseInt(d.RouteID),y=String(d.BusID);if(!(n.indexOf(h)<0)){p.index=y.charCodeAt(0),p.onThisRoute=!0,p.CarType=d.CarType,p.BusStatus=d.BusStatus,p.BusID=d.BusID,p.CarOnStop=d.CarOnStop;var g={};if(s.hasOwnProperty(y)){g=s[y],p.position={latitude:parseFloat(g.Latitude),longitude:parseFloat(g.Longitude)};var m={},b=!1;for(var S in r){var w=r[S];if(w.pid.indexOf(v)>-1){m=w,b=!0;break}}p.RouteName=b?m.n:"未知路線",p.RouteID=b?m.id:null;var I=`s_${h}`;i.hasOwnProperty(I)||(i[I]=[]),i[I].push(p)}}}}catch(e){f.e(e)}finally{f.f()}return i}function l(e){var t="";switch(e){case"0":t="一般";break;case"1":t="低底盤";break;case"2":t="大復康巴士";break;case"3":t="狗狗友善專車";break;default:t="未知類型"}return t}function f(e){var t="";switch(e){case"0":t="離站";break;case"1":t="進站";break;default:t="未知狀態"}return t}function d(e){var t="";switch(e){case"0":t="正常";break;case"1":t="車禍";break;case"2":t="故障";break;case"3":t="塞車";break;case"4":t="緊急求援";break;case"5":t="加油";break;case"99":t="非營運狀態";break;default:t="未知狀態"}return t}function p(e){var t={},r=l(e.CarType);t.type=r;var n=f(e.CarOnStop),o=d(e.BusStatus);return t.carNumber=e.BusID,t.status={onStop:n,situation:o,text:`${n} | ${o}`},t.RouteName=e.RouteName,t.onThisRoute=e.onThisRoute,t.index=e.index,t.position=e.position,t}},4356(e,t,r){r.d(t,{default:()=>z});var n=r(6483),o=r(8925),a=r(5767),i=r(9566),s=r(3422),u=r(5314),c=r(3459),l=r(3251),f=r(1238),d=r(1531),p=r(4884),h=r(9499),v=r(6052),y=r(9333),g=r(6189),m=r(8379),b=r(540),S=r(6082),w=r(6091),I=r(904),k=r(1351),O=r(3030),E=r(2174),C=r(8380),P=r(5693),A=r(7891),x=r(8279),D=r(7908),F=r(5286),R=r(4690),L=r(3041),B=r(752),N=r(5009),T=r(6104),$=r(6166),_=r(2994),M=r(9469),U=r(8179),j=!1,q=!1;window.bus={initialize:function(){!1===j&&(j=!0,(0,I.BM)(),(0,c.Yq)().then(function(){(0,w.Q)(),(0,b.F)(),(0,l.A)().then(function(e){if("ok"===e){(0,R.S5)(),(0,O.s_)(),(0,N.ld)(),window.addEventListener("resize",function(){(0,N.ld)()}),screen&&screen.orientation&&screen.orientation.addEventListener("change",function(){(0,N.ld)()}),(0,w.u)(),(0,i.Rh)().then(function(){(0,b.a)()});var t=window.matchMedia("(prefers-color-scheme: dark)"),r=(0,U.bv)(".er .fr .gr #search_input");t.addEventListener("change",function(){(0,N.gn)(r.selectionStart,r.selectionEnd)}),r.addEventListener("paste",function(){(0,N.RC)(),(0,N.gn)(r.selectionStart,r.selectionEnd)}),r.addEventListener("cut",function(){(0,N.RC)(),(0,N.gn)(r.selectionStart,r.selectionEnd)}),r.addEventListener("selectionchange",function(){(0,N.RC)(),(0,N.gn)(r.selectionStart,r.selectionEnd)}),document.addEventListener("selectionchange",function(){(0,N.RC)(),(0,N.gn)(r.selectionStart,r.selectionEnd)}),r.addEventListener("keyup",function(){(0,N.RC)(),(0,N.gn)(r.selectionStart,r.selectionEnd)});var n=(0,U.bv)(".ff .hf .if #search_material_symbols_input");n.addEventListener("paste",function(){(0,g.Pk)(n.value)}),n.addEventListener("cut",function(){(0,g.Pk)(n.value)}),n.addEventListener("selectionchange",function(){(0,g.Pk)(n.value)}),document.addEventListener("selectionchange",function(){(0,g.Pk)(n.value)}),n.addEventListener("keyup",function(){(0,g.Pk)(n.value)}),(0,M._)(),(0,I.AE)(function(){(0,s.Db)(),(0,s.cS)().then(function(){(0,s.z9)()}),document.addEventListener("click",function(){(0,d.to)(),(0,f.q)()},{once:!0})})}"fetchError"!==e&&"unknownError"!==e||((0,I.f1)(),(0,I.AE)())}).catch(function(){(0,I.f1)(),(0,I.AE)()})}))},secondlyInitialize:function(){q||(q=!0,(0,S.X)(),(0,a.fV)(),(0,o.Ir)(),(0,n.$t)(),(0,u.FU)(),(0,a.fV)().then(function(){(0,a.MN)().then(function(){(0,a.cy)()})}))},route:{closeRoute:R.U7,switchRoute:R.Ch,closeRouteDetails:F.GZ},location:{openLocation:O.so,closeLocation:O.eS,closeLocationDetails:k.co},folder:{openSaveToFolder:L.B,closeSaveToFolder:L.n,closeFolderManager:m.m,closeFolderEditor:y.I6,openFolderIconSelector:g.r7,closeFolderIconSelector:g.jW,openFolderCreator:v.pd,closeFolderCreator:v.z1,createFormulatedFolder:v.c6,saveEditedFolder:y.Bo},search:{openSearch:N.rf,closeSearch:N.Bb,switchSearchTypeFilter:N.H2},storage:{closeStorage:_.Q},dataUsage:{closeDataUsage:h.i},personalSchedule:{closePersonalScheduleManager:A.Z,openPersonalScheduleCreator:C.I1,closePersonalScheduleCreator:C.GJ,createFormulatedPersonalSchedule:C.Ps,switchPersonalScheduleCreatorDay:C.om,openPersonalScheduleEditor:P.bF,closePersonalScheduleEditor:P.Xy,switchPersonalScheduleEditorDay:P.Dn,saveEditedPersonalSchedule:P.gv},settings:{openSettings:T.Ow,closeSettings:T.os,openSettingsOptions:$.yH,closeSettingsOptions:$.wx,settingsOptionsHandler:$.Yi,downloadExportFile:T.vv,openFileToImportData:T.rY,viewCommitOfCurrentVersion:T.hP,showPromptToAskForPersistentStorage:T.jk},bus:{openBus:p.$l,closeBus:p.FN},notification:{openNotificationScheduleManager:E.Sv,closeNotificationScheduleManager:E.m_,openRegisterNotification:D.XG,closeRegisterNotification:D.hy,saveFormulatedRegisterNotification:D.NW,openScheduleNotification:B.Ho,closeScheduleNotification:B.b$,scheduleNotificationForStopItemOnRoute:B.H9,scheduleNotificationForStopItemOnLocation:B.b6,cancelNotificationOnNotificationScheduleManager:E.Gv},qrcode:{openQRCode:x.X8,closeQRCode:x.Vc}};const z=window.bus},6160(e,t,r){r.d(t,{i:()=>h});var n=r(467),o=r(6802),a=r(7810),i=r(9734),s=r(8011),u=r(424),c=r(2303),l=r(6788),f=r(8134);function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){return v.apply(this,arguments)}function v(){return(v=(0,n.A)(function*(e,t){var r=`c_${e}`,n=yield(0,i.j)(t,!0),p=yield(0,o.d)(t),h=yield(0,a.J)(t),v=yield(0,u.T)(t),y=yield(0,s.g)(t,0),g={properties:[],LocationName:""},m={};if(!n.hasOwnProperty(r))return g;var b=(m=n[r]).CarNum;g.properties.push({key:"car_number",icon:"tag",value:b});var S=m.CarType,w=(0,c.Ov)(S);g.properties.push({key:"car_type",icon:"directions_bus",value:w});var I,k={},O=d(p);try{for(O.s();!(I=O.n()).done;){var E=I.value;if(E.BusID===b){k=E;break}}}catch(e){O.e(e)}finally{O.f()}var C,P=parseInt(k.RouteID),A=k.BusStatus,x=(0,c.eu)(A),D=parseInt(k.GoBack),F={},R=d(h);try{for(R.s();!(C=R.n()).done;){var L=C.value;if(L.BusID===b){F=L;break}}}catch(e){R.e(e)}finally{R.f()}var B=F.CarOnStop,N=(0,c.zi)(B);g.properties.push({key:"status",icon:"vital_signs",value:`${N} | ${x}`});var T=F.StopID,$=yield(0,f.F6)(P),_={};if(!($.length>0))return g;var M=(_=$[0]).id,U=_.pid,j=_.n,q=_.dep,z=[_.des,q,""][D||0];g.properties.push({key:"route",icon:"route",value:`${j} - 往${z}`}),g.RouteID=M,g.FullPathAttributeId=U;var Q=`s_${T}`;if(!v.hasOwnProperty(Q))return g;var H=y[`l_${v[Q].stopLocationId}`].n;return g.properties.push({key:"location_name",icon:"location_on",value:H}),(0,l.LQ)(t),(0,l.gC)(t),g})).apply(this,arguments)}},6788(e,t,r){r.d(t,{Fd:()=>d,LQ:()=>m,Mf:()=>y,ZL:()=>w,Zt:()=>I,_M:()=>g,gC:()=>k});var n=r(2284),o=r(467),a=r(4750),i=r(5579),s=r(8925);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var l={},f=new Error("FetchError");function d(e,t,r,n){return p.apply(this,arguments)}function p(){return(p=(0,o.A)(function*(e,t,r,n){if(l.hasOwnProperty(e)){if(l[e].processing)return yield new Promise(function(n,o){l[e].requests.push([n,o,t,r])});if(null!==l[e].result&&(new Date).getTime()<=l[e].timestamp)return y(t,r,0,!0),l[e].result}else l[e]={processing:!0,requests:[],failed:!1,timestamp:-1,result:null};var o=yield fetch(e);if(!o.ok)throw y(t,r,0,!0),new Error(`HTTP error! status: ${o.status}`);for(var i=parseInt(String(o.headers.get("content-length"))),c=o.body.getReader(),p=[],v=0;;){var g=yield c.read(),m=g.done,b=g.value;if(m)break;p.push(b);var S=(v+=b.length)/i;if(y(t,r,S,!1),l.hasOwnProperty(e)){var w,I=u(l[e].requests);try{for(I.s();!(w=I.n()).done;){var k=w.value;y(k[2],k[3],S,!1)}}catch(e){I.e(e)}finally{I.f()}}}for(var O=new Uint8Array(v),E=0,C=0,P=p;C<P.length;C++){var A=P[C];O.set(A,E),E+=A.length}var x,D=new Blob([O],{type:"application/gzip"}),F=yield D.arrayBuffer(),R=yield(0,a.h)(F);switch(n){case"json":x=/^<!doctype html>/.test(R)?yield d(e.replace("https://tcgbusfs.blob.core.windows.net/","https://erichsia7.github.io/bus-alternative-static-apis/"),t,r,n):JSON.parse(R);break;case"xml":x=R}var L=new Date;if(yield(0,s.N$)(i,L),x){if(l.hasOwnProperty(e)){for(var B=v/i,N=l[e].requests.shift();N;)N[0](x),y(N[2],N[3],B,!1),N=l[e].requests.shift();l[e].result=x,l[e].timestamp=L.getTime()+3e4,l[e].processing=!1}return h(),x}if(l.hasOwnProperty(e)){for(var T=l[e].requests.shift();T;)T[1](f),y(T[2],T[3],0,!0),T=l[e].requests.shift();l[e].failed=!0}throw h(),f})).apply(this,arguments)}function h(){var e=(new Date).getTime();for(var t in l)if(l.hasOwnProperty(t)){if(!l[t].processing&&e>l[t].timestamp){delete l[t];continue}if(l[t].failed){delete l[t];continue}}}var v={};function y(e,t,r,n){v.hasOwnProperty(e)||(v[e]={}),v[e].hasOwnProperty(t)?(n?v[e][t].expel=!0:(v[e][t].expel=!1,v[e][t].progress=r),b(e,"run")):(v[e][t]={expel:!1,progress:r,total:1},b(e,"start"))}function g(e){if(v.hasOwnProperty(e)&&"object"===(0,n.A)(v[e])){var t=0,r=0;for(var o in v[e])v[e][o].expel||(t+=v[e][o].total,r+=v[e][o].progress);var a=Math.min(Math.max(r/t,0),1);return a===1/0||isNaN(a)?1:a}return 1}function m(e){v.hasOwnProperty(e)&&(delete v[e],b(e,"end"))}function b(e,t){var r={target:e,stage:t,progress:g(e)},n=new CustomEvent(e,{detail:r});document.dispatchEvent(n)}var S={};function w(e,t){S.hasOwnProperty(e)||(S[e]=0);var r=0;"string"==typeof t&&(r=(0,i.Zn)(t)),r>S[e]&&(S[e]=r)}function I(e){return S.hasOwnProperty(e)?1*S[e]:0}function k(e){S.hasOwnProperty(e)&&delete S[e]}}}]);
//# sourceMappingURL=f34620ba.js.map