"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[694],{365(e,t,r){r.d(t,{G:()=>c});var n=r(467),i=r(77),a=r(4778),o=r(7528),s=r(1172);function c(e){return u.apply(this,arguments)}function u(){return(u=(0,n.A)(function*(e){if(""===i.M3||""===i.se||void 0===e)return!1;var t=(0,a.F)("cancel",[e]),r=(0,o.b)("cancel",[e]),n=yield(0,s.R)("cancel",t,r);return!1!==n&&(200===n.code&&"cancel"===n.method&&(yield(0,i.VJ)(e),!0))})).apply(this,arguments)}},1172(e,t,r){r.d(t,{R:()=>i});var n=r(467);function i(e,t,r){return a.apply(this,arguments)}function a(){return(a=(0,n.A)(function*(e,t,r){try{if(!1===t||!1===r)return!1;var n={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)},i=yield fetch(t,n);if(!i.ok){yield i.text();return!1}try{var a=yield i.text(),o=JSON.parse(a);switch(e){case"cancel":case"register":case"schedule":case"rotate":case"reschedule":return o;default:return!1}}catch(e){throw new Error("Invalid JSON response from server")}}catch(e){return!1}})).apply(this,arguments)}},2757(e,t,r){r.d(t,{R:()=>k});var n=r(467),i=r(4256),a=r(574),o=r(2945),s=r(5428),c=r(6483),u=r(6802),d=r(7810),l=r(2063),f=r(8011),h=r(4293),p=r(424),m=r(2303),y=r(6788),v=r(3459),_=r(1238);function g(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t){var r={},n=[];for(var i in e){var a=e[i],o=a.StopID,s=parseInt(a.EstimateTime);s>=0&&t.indexOf(o)>-1&&n.push([o,s])}var c=n.length;n.sort(function(e,t){return e[1]-t[1]});for(var u=1,d=0,l=n;d<l.length;d++){var f=u/c,h=(f-f%.25)/.25;r[`s_${l[d][0]}`]={number:u,text:u.toString(),code:h},u+=1}return r}function k(e,t,r,n){return w.apply(this,arguments)}function w(){return(w=(0,n.A)(function*(e,t,r,n){(0,y.Mf)(n,"getLocation_0",0,!1),(0,y.Mf)(n,"getLocation_1",0,!1),(0,y.Mf)(n,"getRoute_0",0,!1),(0,y.Mf)(n,"getRoute_1",0,!1),(0,y.Mf)(n,"getStop_0",0,!1),(0,y.Mf)(n,"getStop_1",0,!1),(0,y.Mf)(n,"getEstimateTime_0",0,!1),(0,y.Mf)(n,"getEstimateTime_1",0,!1),(0,y.Mf)(n,"getBusEvent_0",0,!1),(0,y.Mf)(n,"getBusEvent_1",0,!1);for(var b=yield(0,l.K)(n),k=yield(0,f.g)(n,1),w=yield(0,h.a)(n,!0),S=yield(0,p.T)(n),$=yield(0,d.J)(n),A=yield(0,u.d)(n),I=yield(0,c.Io)(t,r),O=(0,v.Js)("time_formatting_mode"),x=(0,v.Js)("location_labels"),D=(0,v.Js)("display_user_orientation"),T={},P={},Q={},R=(0,_.Y)(),E=k[`ml_${e}`],F=E.n,J=E.id,L=E.v,C=[],q=[],B=J.length,H=0;H<B;H++)C=C.concat(E.s[H]),q=q.concat(E.r[H]);var N,j=function(e,t){var r,n={},i=g(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.indexOf(a.StopID)>-1&&(n[`s_${a.StopID}`]=a)}}catch(e){i.e(e)}finally{i.f()}return n}(b,C),U=(0,m.AS)($,A,w,C),G=[],K=g(L);try{for(K.s();!(N=K.n()).done;){var V,Z=N.value,Y=0,z=0,W=g(Z);try{for(W.s();!(V=W.n()).done;){var X=V.value;Y+=X[0],z+=X[1]}}catch(e){W.e(e)}finally{W.f()}var ee=(0,s.hF)([Y,z]),te=(0,a.DK)(ee);G.push(te)}}catch(e){K.e(e)}finally{K.f()}var re=[];switch(x){case"address":re=(0,i._q)(E.a);break;case"letters":re=(0,o.V)(B);break;case"directions":re=(0,o.M)(G)}for(var ne=0;ne<B;ne++){var ie=`g_${ne}`;T[ie]=[],P[ie]=0,Q[ie]={name:re[ne],properties:[{key:"address",icon:"personal_places",value:(0,i.pD)(E.a[ne])},{key:"exact_position",icon:"location_on",value:`${E.la[ne].toFixed(5)}, ${E.lo[ne].toFixed(5)}`},{key:"cardinal_direction",icon:G[ne].icon,value:`${G[ne].name}${D&&-1!==R.cardinalDirection.id&&R.cardinalDirection.id===G[ne].id?"（目前指向）":""}`}]};for(var ae=E.s[ne],oe=ae.length,se=M(j,ae),ce=0;ce<oe;ce++){var ue={},de=E.s[ne][ce],le=`s_${de}`,fe={};if(S.hasOwnProperty(le)){fe=S[le],ue.stopId=de;var he={number:0,text:"--",code:-1};se.hasOwnProperty(le)&&(he=se[le]),ue.ranking=he;var pe=E.r[ne][ce],me=`r_${pe}`,ye={};if(w.hasOwnProperty(me)){ye=w[me],ue.route_name=ye.n,ue.route_direction=`往${[ye.des,ye.dep,""][parseInt(fe.goBack)]}`,ue.routeId=pe;var ve={};if(j.hasOwnProperty(le)){ve=j[le];var _e=(0,m.$Q)(ve.EstimateTime,O);ue.status=_e;var ge=[];U.hasOwnProperty(le)&&(ge=U[le].map(function(e){return(0,m.s$)(e)})),ue.buses=ge;var be=[];I.hasOwnProperty(le)&&(be=I[le]),ue.busArrivalTimes=be,T[ie].push(ue),P[ie]+=1}}}}}for(var Me in T)T[Me].sort(function(e,t){return e.routeId-t.routeId});var ke={groupedItems:T,groups:Q,groupQuantity:B,itemQuantity:P,LocationName:F,hash:e,dataUpdateTime:(0,y.Zt)(n)};return(0,y.LQ)(n),(0,y.gC)(n),ke})).apply(this,arguments)}},3937(e,t,r){r.d(t,{e:()=>c});var n=r(467),i=r(77),a=r(4778),o=r(7528),s=r(1172);function c(e){return u.apply(this,arguments)}function u(){return(u=(0,n.A)(function*(e){if(!e)return!1;var t=(0,a.F)("register"),r=(0,o.b)("register",[e]),n=yield(0,s.R)("register",t,r);return!1!==n&&(200===n.code&&"register"===n.method&&((0,i.gc)(n.client_id),(0,i.uQ)(n.secret),yield(0,i.ms)(),!0))})).apply(this,arguments)}},4778(e,t,r){r.d(t,{F:()=>i});var n=r(77);function i(e){if(""===n.ph)return!1;var t=new URL(n.ph);return["cancel","register","schedule","rotate","reschedule"].indexOf(e)>-1&&(t.searchParams.set("method",e),t.toString())}},6983(e,t,r){r.d(t,{v:()=>c});var n=r(467),i=r(1351),a=r(3041),o=r(8011),s=r(6788);function c(e,t){return u.apply(this,arguments)}function u(){return(u=(0,n.A)(function*(e,t){var r=yield(0,o.g)(t,1);(0,s.LQ)(t),(0,s.gC)(t);var n=`ml_${e}`;if(!r.hasOwnProperty(n))return{actions:[],actionsQuantity:0,hash:e};r[n];var c=[{icon:"folder",name:"儲存",key:"save-to-folder",action:function(){(0,a.B)("location",[e])}},{icon:"ios_share",name:"分享",key:"permalink",action:function(){(0,i.k9)(e)}},{icon:"qr_code_2",name:"二維條碼",key:"permalink-qr-code",action:function(){(0,i.qp)(e)}}];return{actions:c,actionsQuantity:c.length,hash:e}})).apply(this,arguments)}},7053(e,t,r){r.d(t,{Z:()=>d});var n=r(2284),i=r(467),a=r(77),o=r(4778),s=r(7528),c=r(1172);function u(){return(u=(0,i.A)(function*(){if(""===a.M3||""===a.se)return!1;var e=(0,o.F)("rotate"),t=(0,s.b)("rotate",[]),r=yield(0,c.R)("rotate",e,t);return!1!==r&&(200===r.code&&"rotate"===r.method&&((0,a.uQ)(r.secret),yield(0,a.ms)(),!0))})).apply(this,arguments)}function d(e,t,r,n,i,a,o,s,c){return l.apply(this,arguments)}function l(){return l=(0,i.A)(function*(e,t,r,i,d,l,f,h,p){if(""===a.M3||""===a.se||void 0===e||void 0===t||void 0===r||void 0===i||void 0===d||void 0===l||"number"!=typeof f||void 0===p)return!1;var m=new Date;switch((0,n.A)(p)){case"string":case"number":m=new Date(p);break;default:if(!(p instanceof Date))return!1;m=p}var y=(0,o.F)("schedule"),v=(0,s.b)("schedule",[e,t,r,i,d,l,f,h,m.toISOString()]),_=yield(0,c.R)("schedule",y,v);return!1!==_&&(200===_.code&&"schedule"===_.method&&(Math.random()>.8&&(yield function(){return u.apply(this,arguments)}()),yield(0,a.G7)(_.schedule_id,e,t,r,i,d,l,f,h,m.getTime()),_.schedule_id))}),l.apply(this,arguments)}},7528(e,t,r){r.d(t,{b:()=>o});var n=r(8024),i=r(425),a=r(77);function o(e,t){switch(e){case"cancel":return""!==a.M3&&""!==a.se&&1===t.length&&{client_id:a.M3,token:(0,i.H)(a.M3,a.se,{schedule_id:t[0]}),schedule_id:t[0]};case"register":if(1!==t.length)return!1;var r=new Date;return r.setMilliseconds(0),r.setSeconds(0),{hash:(0,n.sc)(`${t[0]}${r.getTime()}`)};case"schedule":return""!==a.M3&&""!==a.se&&9===t.length&&{client_id:a.M3,token:(0,i.H)(a.M3,a.se,{stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]}),stop_id:t[0],location_name:t[1],route_id:t[2],route_name:t[3],direction:t[4],estimate_time:t[5],time_formatting_mode:t[6],time_offset:t[7],scheduled_time:t[8]};case"rotate":return""!==a.M3&&""!==a.se&&0===t.length&&{client_id:a.M3,token:(0,i.H)(a.M3,a.se,{})};case"reschedule":return""!==a.M3&&""!==a.se&&3===t.length&&{client_id:a.M3,token:(0,i.H)(a.M3,a.se,{schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]}),schedule_id:t[0],estimate_time:t[1],scheduled_time:t[2]};default:return!1}}}}]);
//# sourceMappingURL=f7ae9ab5aaad1d8361ee.js.map