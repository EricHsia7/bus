"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[466],{4690:(t,e,n)=>{n.d(e,{Ch:()=>mt,S5:()=>et,SR:()=>vt,U7:()=>ft,aB:()=>nt,py:()=>ht,q0:()=>pt});var i=n(7123),a=n(4537),s=n(6788),o=n(3459),r=n(8024),c=n(7968),d=n(3648),u=n(5767),l=n(9566),v=n(904),f=n(9119),m=n(5579),p=n(5314),h=n(4636);function g(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw s}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function y(t,e,n,i,a,s,o){try{var r=t[s](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,a)}var k=(0,d.bv)(".kk"),A=(0,d.aI)(k,".am"),I=(0,d.aI)(A,".dm"),w=(0,d.aI)(A,".cm"),x=(0,d.aI)(A,".km .lm"),R=(0,d.aI)(A,".em"),j=(0,d.aI)(R,".fm"),T=(0,d.aI)(A,".im"),_=(0,d.aI)(T,".jm"),P=(0,d.aI)(k,".lk"),L={},S=!0,Z=!1,M=0,E=0,D=0,B={},C=0,z=!1,F=1e4,H=15e3,q=5e3,N=15e3,O=!0,Q=!1,U=0,J=0,W=!1,$="",K=-1,X=-1,G=!1,V=0,Y=[],tt=20;function et(){P.addEventListener("touchstart",(function(){M=Math.round(P.scrollLeft/C)}),{passive:!0}),P.addEventListener("scroll",(function(t){z=!0;var e=t.target.scrollLeft/C;E=e>M?M+1:M-1;var n=B["g_".concat(M)]||{width:0,offset:0},i=B["g_".concat(E)]||{width:0,offset:0},a=n.width+(i.width-n.width)*Math.abs(e-M),s=-1*(n.offset+(i.offset-n.offset)*Math.abs(e-M))+.5*C-.5*a;it(D,s,a-tt,e),e===E&&(M=Math.round(P.scrollLeft/C),z=!1)}),{passive:!0})}function nt(){var t=(0,v.gO)("window"),e=t.width,n=t.height;k.style.setProperty("--hk","".concat(e,"px")),k.style.setProperty("--ik","".concat(n,"px"))}function it(t,e,n,i){P.style.setProperty("--jk",t.toString()),_.style.setProperty("--zl",(n/10).toString()),j.style.setProperty("--gm","".concat(e.toFixed(5),"px")),j.style.setProperty("--xl",i.toFixed(5))}function at(){var t=(new Date).getTime();W?(X=-1+(0,s._M)($),K+=.1*(X-K)):(X=-1*Math.min(1,Math.max(0,Math.abs(t-U)/N)),K=X),x.style.setProperty("--z",K.toString()),window.requestAnimationFrame((function(){Q&&at()}))}function st(){var t=(0,r.zx)("i"),e=document.createElement("div");return e.classList.add("mm"),e.id=t,e.setAttribute("stretched","false"),e.innerHTML='<div class="rm"></div><div class="um"><div class="ia" code="0"></div><div class="ja" code="0"></div></div>',{element:e,id:t}}function ot(t){var e=(0,r.zx)("i"),n=document.createElement("div");return n.classList.add("xm"),n.id=e,n.setAttribute("stretched","false"),n.innerHTML='<div class="ym"><div class="zm"></div><div class="_m"><div class="an"><div class="ia" code="0"></div><div class="ja" code="0"></div></div><div class="bn" onclick="bus.route.stretchRouteItemBody(\''.concat(e,"', '").concat(t,"')\">").concat((0,a.Z)("keyboard_arrow_down"),'</div><div class="cn"></div></div></div><div class="dn" displayed="false"><div class="en"><div class="fn" highlighted="true" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 0)" code="0"><div class="gn">').concat((0,a.Z)("directions_bus"),'</div>公車</div><div class="fn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 1)" code="1"><div class="gn">').concat((0,a.Z)("departure_board"),'</div>抵達時間</div><div class="fn" highlighted="false" type="tab" onclick="bus.route.switchRouteBodyTab(\'').concat(e,'\', 2)" code="2"><div class="gn">').concat((0,a.Z)("route"),'</div>路線</div><div class="fn" highlighted="false" type="save-to-folder" onclick="bus.folder.openSaveToFolder(\'stop-on-route\', [\'').concat(e,'\', null, null])"><div class="gn">').concat((0,a.Z)("folder"),'</div>儲存至資料夾</div><div class="fn" highlighted="false" type="schedule-notification" onclick="bus.notification.openScheduleNotification(\'stop-on-route\', [\'').concat(e,'\', null, null, null])" enabled="true"><div class="gn">').concat((0,a.Z)("notifications"),'</div>設定到站通知</div></div><div class="hn" displayed="true"></div><div class="in" displayed="false"></div><div class="jn" displayed="false"></div></div>'),{element:n,id:e}}function rt(){var t=document.createElement("div");t.classList.add("mk");var e=document.createElement("div");e.classList.add("nk");var n=document.createElement("div");n.classList.add("ok");var i=document.createElement("div");return i.classList.add("pk"),e.appendChild(n),e.appendChild(i),t.appendChild(e),{element:t,id:""}}function ct(t,e,n,i){function s(t,s,o,c){function u(t,e,n,i){var a=t.getBoundingClientRect(),s=a.top,o=a.left,r=a.bottom,c=a.right,u=window.innerWidth,l=window.innerHeight,v=(0,d.aI)(e,".um"),f=(0,d.aI)(v,".ja"),m=(0,d.aI)(v,".ia"),p=(0,d.aI)(t,".an"),h=(0,d.aI)(p,".ja"),g=(0,d.aI)(p,".ia");m.setAttribute("code",n.status.code.toString()),g.setAttribute("code",n.status.code.toString()),g.innerText=n.status.text,i&&r>0&&s<l&&c>0&&o<u?(f.addEventListener("animationend",(function(){f.setAttribute("code",n.status.code.toString()),f.classList.remove("_a")}),{once:!0}),h.addEventListener("animationend",(function(){h.setAttribute("code",n.status.code.toString()),h.innerText=n.status.text,h.classList.remove("_a")}),{once:!0}),f.classList.add("_a"),h.classList.add("_a")):(f.setAttribute("code",n.status.code.toString()),h.setAttribute("code",n.status.code.toString()),h.innerText=n.status.text)}function v(t,e,n){t.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer)),e.setAttribute("segment-buffer",(0,r.xZ)(n.segmentBuffer.isSegmentBuffer))}function f(t,e){(0,d.aI)(t,".zm").innerText=e.name}function p(t,e){(0,d.aI)(t,".hn").innerHTML=0===e.buses.length?'<div class="kn">目前沒有公車可顯示</div>':e.buses.map((function(t){return'<div class="ln" on-this-route="'.concat(t.onThisRoute,'"><div class="mn"><div class="nn">').concat((0,a.Z)("directions_bus"),'</div><div class="on">').concat(t.carNumber,'</div></div><div class="pn"><div class="qn">路線：').concat(t.RouteName,'</div><div class="rn">狀態：').concat(t.status.text,'</div><div class="sn">類型：').concat(t.type,"</div></div></div>")})).join("")}function g(t,e){(0,d.aI)(t,".in").innerHTML=0===e.overlappingRoutes.length?'<div class="tn">目前沒有路線可顯示</div>':e.overlappingRoutes.map((function(t){return'<div class="un"><div class="vn"><div class="wn">'.concat((0,a.Z)("route"),'</div><div class="xn">').concat(t.name,'</div></div><div class="yn">').concat(t.RouteEndPoints.html,'</div><div class="zn"><div class="_n" onclick="bus.route.switchRoute(').concat(t.RouteID,", [").concat(t.PathAttributeId.join(","),'])">查看路線</div><div class="_n" onclick="bus.folder.openSaveToFolder(\'route-on-route\', [').concat(t.RouteID,'])">收藏路線</div></div></div>')})).join("")}function b(t,e){(0,d.aI)(t,".jn").innerHTML=0===e.busArrivalTimes.length?'<div class="ao">目前沒有抵達時間可顯示</div>':e.busArrivalTimes.map((function(t){return'<div class="bo"><div class="co"><div class="do">'.concat((0,a.Z)("calendar_view_day"),'</div><div class="eo">').concat(t.personalSchedule.name,'</div><div class="fo">週').concat((0,m.kd)(t.day).name," ").concat((0,m.pn)(t.personalSchedule.period.start)," - ").concat((0,m.pn)(t.personalSchedule.period.end),'</div></div><div class="go">').concat(t.chart,"</div></div>")})).join("")}function y(t,e,n){t.setAttribute("nearest",(0,r.xZ)(n.nearest)),e.setAttribute("nearest",(0,r.xZ)(n.nearest))}function k(t,e,n,i){var a=(null==n?void 0:n.progress)||0,s=(null==e?void 0:e.progress)||0,o=(0,d.aI)(t,".rm");i&&0!==a&&0===s&&Math.abs(s-a)>0?(o.style.setProperty("--pm","".concat(100,"%")),o.style.setProperty("--qm","".concat(100,"%")),o.addEventListener("transitionend",(function(){o.style.setProperty("--pm","".concat(0,"%")),o.style.setProperty("--qm","".concat(0,"%"))}),{once:!0})):(o.style.setProperty("--pm","".concat(0,"%")),o.style.setProperty("--qm","".concat(100*s,"%")))}function A(t,e,n){n&&((0,d.aI)(t,".dn").setAttribute("displayed","false"),t.setAttribute("stretched","false"),e.setAttribute("stretched","false"))}function I(t,e,n){t.setAttribute("animation",(0,r.xZ)(n)),e.setAttribute("animation",(0,r.xZ)(n))}function w(t,e,n){t.setAttribute("skeleton-screen",(0,r.xZ)(n)),e.setAttribute("skeleton-screen",(0,r.xZ)(n))}function x(t,n){var i=(0,d.aI)(t,'.dn .en .fn[type="save-to-folder"]');i.setAttribute("onclick","bus.folder.openSaveToFolder('stop-on-route', ['".concat(t.id,"', ").concat(n.id,", ").concat(e.RouteID,"])")),(0,l.LH)("stop",n.id).then((function(t){i.setAttribute("highlighted",(0,r.xZ)(t))}))}function R(t,n){var i=(0,d.aI)(t,'.dn .en .fn[type="schedule-notification"]');i.setAttribute("onclick","bus.notification.openScheduleNotification('stop-on-route', ['".concat(t.id,"', ").concat(n.id,", ").concat(e.RouteID,", ").concat(n.status.time,"])"));var a=(0,h.Zc)(n.id);i.setAttribute("highlighted",(0,r.xZ)(a))}null===c?(u(t,s,o,i),f(t,o),p(t,o),g(t,o),b(t,o),v(t,s,o),y(t,s,o),k(s,o,c,i),A(t,s,n),I(t,s,i),w(t,s,n),x(t,o),R(t,o)):(o.status.time!==c.status.time&&(u(t,s,o,i),R(t,o)),(0,r.hw)(c.buses,o.buses)||p(t,o),(0,r.hw)(c.busArrivalTimes,o.busArrivalTimes)||b(t,o),(0,r.hw)(c.segmentBuffer,o.segmentBuffer)||v(t,s,o),c.nearest!==o.nearest&&y(t,s,o),c.progress!==o.progress&&k(s,o,c,i),c.id!==o.id&&(f(t,o),g(t,o),x(t,o),R(t,o)),i!==S&&I(t,s,i),n!==Z&&(A(t,s,n),w(t,s,n)))}var o=(0,v.gO)("window"),u=o.width,f=o.height,p=e.groupQuantity,g=e.itemQuantity,b=e.groupedItems;D=p,C=u;for(var y=0,k=0;k<p;k++){var A=(0,c.q_)([e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,""].map((function(t){return"往".concat(t)}))[k],500,"17px",'"Noto Sans TC", sans-serif')+tt;B["g_".concat(k)]={width:A,offset:y},y+=A}var x=-1*B["g_".concat(M)].offset+.5*C-.5*B["g_".concat(M)].width;z||it(D,x,B["g_".concat(M)].width-tt,M),I.innerHTML="<span>".concat(e.RouteName,"</span>"),I.setAttribute("animation",(0,r.xZ)(i)),I.setAttribute("skeleton-screen",(0,r.xZ)(n)),R.setAttribute("animation",(0,r.xZ)(i)),R.setAttribute("skeleton-screen",(0,r.xZ)(n)),T.setAttribute("animation",(0,r.xZ)(i)),T.setAttribute("skeleton-screen",(0,r.xZ)(n)),w.setAttribute("onclick","bus.route.openRouteDetails(".concat(e.RouteID,", [").concat(e.PathAttributeId.join(","),"])"));var _,E,F=(0,d.jg)(t,".lk .mk").length;if(p!==F){var H=F-p;if(H<0){for(var q=new DocumentFragment,N=new DocumentFragment,O=0;O<Math.abs(H);O++){var Q=rt();q.appendChild(Q.element);var U=(_=void 0,E=void 0,_=(0,r.zx)("t"),(E=document.createElement("div")).classList.add("hm"),E.id=_,{element:E,id:_});N.appendChild(U.element)}P.append(q),j.append(N)}else for(var J=(0,d.jg)(t,".lk .mk"),W=(0,d.jg)(t,".am .em .fm .hm"),$=0;$<Math.abs(H);$++){var K=F-1-$;J[K].remove(),W[K].remove()}}for(var X=0;X<p;X++){var G="g_".concat(X),V=(0,d.jg)((0,d.aI)((0,d.jg)(t,".lk .mk")[X],".pk"),".xm").length;if(g[G]!==V){var Y=V-g[G];if(Y<0){for(var et=(0,d.aI)((0,d.jg)(t,".lk .mk")[X],".pk"),nt=(0,d.aI)((0,d.jg)(t,".lk .mk")[X],".ok"),at=new DocumentFragment,ct=new DocumentFragment,dt=0;dt<Math.abs(Y);dt++){var ut=st(),lt=ot(ut.id);at.appendChild(lt.element),ct.appendChild(ut.element)}et.append(at),nt.append(ct)}else for(var vt=(0,d.jg)((0,d.aI)((0,d.jg)(t,".lk .mk")[X],".pk"),".xm"),ft=(0,d.jg)((0,d.aI)((0,d.jg)(t,".lk .mk")[X],".ok"),".mm"),mt=0;mt<Math.abs(Y);mt++){var pt=V-1-mt;vt[pt].remove(),ft[pt].remove()}}}for(var ht=0;ht<p;ht++){var gt="g_".concat(ht),bt=(0,d.jg)(t,".am .em .fm .hm")[ht];bt.innerHTML=[e.RouteEndPoints.RouteDestination,e.RouteEndPoints.RouteDeparture,""].map((function(t){return"<span>往".concat(t,"</span>")}))[ht],bt.style.setProperty("--_l","".concat(B[gt].width,"px")),bt.style.setProperty("--yl","".concat(ht));for(var yt=(0,d.jg)((0,d.aI)((0,d.jg)(t,".lk .mk")[ht],".pk"),".xm"),kt=(0,d.jg)((0,d.aI)((0,d.jg)(t,".lk .mk")[ht],".ok"),".mm"),At=0;At<g[gt];At++){var It=yt[At],wt=kt[At],xt=b[gt][At];if(L.hasOwnProperty("groupedItems"))if(L.groupedItems.hasOwnProperty(gt))if(L.groupedItems[gt][At])s(It,wt,xt,L.groupedItems[gt][At]);else s(It,wt,xt,null);else s(It,wt,xt,null);else s(It,wt,xt,null)}}L=e,S=i,Z=n}function dt(){return ut.apply(this,arguments)}function ut(){var t;return t=function*(){var t=(0,o.Js)("playing_animation"),e=(0,o.Js)("refresh_interval"),n=(0,v.gO)("route-bus-arrival-time-chart");O=e.dynamic,H=e.baseInterval,W=!0,$=(0,r.zx)("r"),x.setAttribute("refreshing","true");var a=yield(0,i.R)(V,Y,n.width,n.height,$);ct(k,a,!1,t);var s=0;O&&(s=yield(0,u.wz)()),U=(new Date).getTime(),J=O?Math.max(U+q,a.dataUpdateTime+H/s):U+H,N=Math.max(q,J-U),W=!1,x.setAttribute("refreshing","false")},ut=function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function o(t){y(s,i,a,o,r,"next",t)}function r(t){y(s,i,a,o,r,"throw",t)}o(void 0)}))},ut.apply(this,arguments)}function lt(){dt().then((function(){Q?setTimeout((function(){lt()}),Math.max(q,J-(new Date).getTime())):G=!1})).catch((function(t){console.error(t),Q?((0,f.a)("（路線）發生網路錯誤，將在".concat(F/1e3,"秒後重試。"),"error"),setTimeout((function(){lt()}),F)):G=!1}))}function vt(t,e){(0,v.WR)("Route"),(0,p.XK)("route",t),V=t,Y=e,M=0,k.setAttribute("displayed","true"),(0,d.aI)(k,".lk").scrollLeft=0,function(t){for(var e=(0,o.Js)("playing_animation"),n=(0,v.gO)("window"),i=(n.width,n.height),a=Math.floor(i/50)+5,s={},r=0;r<2;r++){var c="g_".concat(r);s[c]=[];for(var d=0;d<a;d++)s[c].push({name:"",goBack:"0",status:{code:8,text:"",time:-6},buses:[],overlappingRoutes:[],busArrivalTimes:[],sequence:d,position:{longitude:0,latitude:0},nearest:!1,progress:0,segmentBuffer:{isSegmentBuffer:!1,isStartingPoint:!1,isEndingPoint:!1},id:0})}ct(t,{groupedItems:s,groupQuantity:2,itemQuantity:{g_0:a,g_1:a},RouteName:"載入中",RouteEndPoints:{RouteDeparture:"載入中",RouteDestination:"載入中"},RouteID:0,PathAttributeId:[],dataUpdateTime:0},!0,e)}(k),Q||(Q=!0,G?dt():(G=!0,lt()),K=-1,X=-1,at()),(0,v.Z_)()}function ft(){k.setAttribute("displayed","false"),Q=!1,K=-1,X=-1,(0,v.l$)()}function mt(t,e){Q=!1,K=-1,X=-1,vt(t,e)}function pt(t,e){var n=(0,d.bv)(".kk .lk .mk .nk .pk .xm#".concat(t)),i=(0,d.aI)(n,".dn"),a=(0,d.bv)(".kk .lk .mk .nk .ok .mm#".concat(e));"true"===n.getAttribute("stretched")?("true"===n.getAttribute("animation")?i.addEventListener("transitionend",(function(){i.setAttribute("displayed","false")}),{once:!0}):i.setAttribute("displayed","false"),n.setAttribute("stretched","false"),a.setAttribute("stretched","false")):(i.setAttribute("displayed","true"),n.setAttribute("stretched","true"),a.setAttribute("stretched","true"))}function ht(t,e){var n,i=(0,d.aI)(P,".xm#".concat(t)),a=(0,d.aI)(i,".en"),s=g((0,d.jg)(a,'.fn[highlighted="true"][type="tab"]'));try{for(s.s();!(n=s.n()).done;){n.value.setAttribute("highlighted","false")}}catch(t){s.e(t)}finally{s.f()}switch((0,d.aI)(a,'.fn[code="'.concat(e,'"]')).setAttribute("highlighted","true"),e){case 0:(0,d.aI)(i,".hn").setAttribute("displayed","true"),(0,d.aI)(i,".in").setAttribute("displayed","false"),(0,d.aI)(i,".jn").setAttribute("displayed","false");break;case 1:(0,d.aI)(i,".hn").setAttribute("displayed","false"),(0,d.aI)(i,".in").setAttribute("displayed","false"),(0,d.aI)(i,".jn").setAttribute("displayed","true");break;case 2:(0,d.aI)(i,".hn").setAttribute("displayed","false"),(0,d.aI)(i,".in").setAttribute("displayed","true"),(0,d.aI)(i,".jn").setAttribute("displayed","false")}}}}]);
//# sourceMappingURL=b41e93ba36df7aad65b3.js.map