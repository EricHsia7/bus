"use strict";(self.webpackChunkbus=self.webpackChunkbus||[]).push([[532],{3030(t,e,a){a.d(e,{eS:()=>pt,s_:()=>V,so:()=>ht});var i=a(467),n=a(5767),r=a(9566),s=a(2757),d=a(3422),o=a(5314),l=a(3459),u=a(8179),c=a(7968),h=a(8024),p=a(5579),v=a(4537),m=a(904),f=a(9119),g=a(3041),b=a(752),y=a(1351);function A(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return I(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("E0")}var r,s=!0,d=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){d=!0,r=t},f:function(){try{s||null==a.return||a.return()}finally{if(d)throw r}}}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);a<e;a++)i[a]=t[a];return i}var C=(0,u.bv)(".tg"),L=(0,u.aI)(C,"._g"),x=(0,u.aI)(L,".dh"),E=(0,u.aI)(x,"span"),w=(0,u.aI)(L,".ch"),j=(0,u.aI)(C,".oh"),k=(0,u.aI)(L,".eh"),T=(0,u.aI)(k,".fh"),_=(0,u.aI)(L,".ih"),M=(0,u.aI)(_,".jh"),S=(0,u.aI)(L,".lh .mh"),$={},Z=!1,z=!1,N=0,P=0,D=0,Q={},R=0,q=!1,Y=15e3,H=5e3,B=15e3,F=!0,O=0,J=0,U="",W=!1,K=!1,X=!1,G="";function V(){j.addEventListener("touchstart",function(){N=Math.round(j.scrollLeft/R)},{passive:!0}),j.addEventListener("scroll",function(t){q=!0;var e=t.target.scrollLeft/R;P=e>N?N+1:N-1;var a=e-N,i=Math.abs(a);i>1&&(a>0?(N=Math.floor(e),P=N+1):(N=Math.ceil(e),P=N-1),i=Math.abs(e-N));var n=Q[`g_${N}`]||{width:0,offset:0},r=Q[`g_${P}`]||{width:0,offset:0},s=n.width+(r.width-n.width)*i,d=-1*(n.offset+(r.offset-n.offset)*i)+.5*R-.5*s;tt(D,d,s-20,e),e===P&&(N=Math.round(j.scrollLeft/R),q=!1)},{passive:!0})}function tt(t,e,a,i){j.style.setProperty("--sg",t.toString()),M.style.setProperty("--vg",a.toString()),T.style.setProperty("--wg",`${e.toString()}px`),T.style.setProperty("--xg",i.toString())}function et(t){var e=t;if(W){var a=e.detail.progress-1;S.style.setProperty("--yg",a.toString())}"end"===e.detail.stage&&document.removeEventListener(e.detail.target,et)}function at(){var t=document.createElement("div");t.classList.add("yh"),t.setAttribute("stretched","false"),t.setAttribute("stretching","false"),t.setAttribute("push-direction","0"),t.setAttribute("push-state","0");var e=document.createElement("div");e.classList.add("zh");var a=document.createElement("div");a.classList.add("_h");var i=document.createElement("div");i.classList.add("bi"),i.setAttribute("code","-1"),i.setAttribute("displayed","false");var n=document.createElement("div");n.classList.add("ci"),n.setAttribute("code","-1"),n.setAttribute("displayed","true"),a.appendChild(i),a.appendChild(n);var r=document.createElement("div");r.classList.add("mi");var s=document.createElement("div");s.classList.add("ni");var d=document.createElement("div");d.classList.add("oi");var o=document.createElement("div");o.classList.add("ri");var l=document.createElement("div");l.classList.add("_a"),l.setAttribute("code","0"),l.setAttribute("displayed","false");var c=document.createElement("div");c.classList.add("ab"),c.setAttribute("code","0"),c.setAttribute("displayed","true"),o.appendChild(l),o.appendChild(c);var h=document.createElement("div");h.classList.add("qi"),h.appendChild((0,v.YC)("keyboard_arrow_down")),h.onclick=function(){!function(t){var e=(0,u.aI)(t,".si"),a=t.parentElement,i=(0,u.ji)(t,"yh"),n=i.length,r=a.getBoundingClientRect(),s=t.getBoundingClientRect().top-r.top,d="true"===t.getAttribute("stretched"),o="true"===t.getAttribute("animation");if(o){var l=d?"2":"1";t.setAttribute("stretching","true"),t.style.setProperty("--wh",`${s}px`);for(var c=0;c<n;c++){var h=i[c];h.setAttribute("push-direction",l),h.setAttribute("push-state","1")}t.addEventListener("transitionend",function(){for(var e=0;e<n;e++){var a=i[e];a.setAttribute("push-direction","0"),a.setAttribute("push-state","0")}t.setAttribute("stretching","false")},{once:!0}),t.addEventListener("transitionstart",function(){for(var t=0;t<n;t++){i[t].setAttribute("push-state","2")}},{once:!0})}d?(o?e.addEventListener("transitionend",function(){e.setAttribute("displayed","false")},{once:!0}):e.setAttribute("displayed","false"),t.setAttribute("stretched","false")):(e.setAttribute("displayed","true"),t.setAttribute("stretched","true"))}(t)};var p=document.createElement("div");p.classList.add("pi"),d.appendChild(o),d.appendChild(h),d.appendChild(p),e.appendChild(a),e.appendChild(r),e.appendChild(s),e.appendChild(d);var m=document.createElement("div");m.classList.add("si"),m.setAttribute("displayed","false");var f=document.createElement("div");f.classList.add("ti");var g=document.createElement("div");g.classList.add("ui"),g.setAttribute("highlighted","true"),g.setAttribute("type","tab"),g.setAttribute("code","0");var b=document.createElement("div");b.classList.add("vi"),b.appendChild((0,v.YC)("directions_bus")),g.appendChild(b),g.appendChild(document.createTextNode("公車")),g.onclick=function(){vt(t,0)};var y=document.createElement("div");y.classList.add("ui"),y.setAttribute("highlighted","false"),y.setAttribute("type","tab"),y.setAttribute("code","1");var A=document.createElement("div");A.classList.add("vi"),A.appendChild((0,v.YC)("departure_board")),y.appendChild(A),y.appendChild(document.createTextNode("抵達時間")),y.onclick=function(){vt(t,1)};var I=document.createElement("div");I.classList.add("ui"),I.setAttribute("highlighted","false"),I.setAttribute("type","save-to-folder");var C=document.createElement("div");C.classList.add("vi"),C.appendChild((0,v.YC)("folder")),I.appendChild(C),I.appendChild(document.createTextNode("儲存"));var L=document.createElement("div");L.classList.add("ui"),L.setAttribute("highlighted","false"),L.setAttribute("type","schedule-notification"),L.setAttribute("enabled","true");var x=document.createElement("div");x.classList.add("vi"),x.appendChild((0,v.YC)("notifications")),L.appendChild(x),L.appendChild(document.createTextNode("通知")),f.appendChild(g),f.appendChild(y),f.appendChild(I),f.appendChild(L);var E=document.createElement("div");E.classList.add("wi"),E.setAttribute("displayed","true");var w=document.createElement("div");return w.classList.add("xi"),w.setAttribute("displayed","false"),m.appendChild(f),m.appendChild(E),m.appendChild(w),t.appendChild(e),t.appendChild(m),t}function it(){var t=document.createElement("div");t.classList.add("ph");var e=document.createElement("div");e.classList.add("qh");var a=document.createElement("div");a.classList.add("rh"),e.appendChild(a);var i=document.createElement("div");return i.classList.add("xh"),t.appendChild(e),t.appendChild(i),t}function nt(){var t=document.createElement("div");t.classList.add("gh");var e=document.createElement("span");return t.appendChild(e),t}function rt(){var t=document.createElement("div");t.classList.add("sh");var e=document.createElement("div");e.classList.add("th"),e.appendChild((0,v.oC)());var a=document.createElement("div");return a.classList.add("uh"),t.appendChild(e),t.appendChild(a),t}function st(){var t=document.createElement("div");t.classList.add("yi"),t.setAttribute("on-this-route","false");var e=document.createElement("div");e.classList.add("_i");var a=document.createElement("div");a.classList.add("bj"),a.appendChild((0,v.YC)("directions_bus"));var i=document.createElement("div");i.classList.add("dj");var n=document.createElement("div");n.classList.add("gj");var r=document.createElement("div");r.classList.add("ij");var s=document.createElement("div");s.classList.add("jj");var d=document.createElement("div");return d.classList.add("kj"),e.appendChild(a),e.appendChild(i),t.appendChild(e),n.appendChild(r),n.appendChild(s),n.appendChild(d),t.appendChild(n),t}function dt(){var t=document.createElement("div");t.classList.add("zi");var e=document.createElement("div");e.classList.add("aj");var a=document.createElement("div");a.classList.add("cj"),a.appendChild((0,v.YC)("calendar_view_day"));var i=document.createElement("div");i.classList.add("ej");var n=document.createElement("div");n.classList.add("fj");var r=document.createElement("div");return r.classList.add("hj"),e.appendChild(a),e.appendChild(i),e.appendChild(n),t.appendChild(e),t.appendChild(r),t}function ot(t,e,a){var i,n;function s(t,i,n){function s(t,e,a){var i=t.getBoundingClientRect(),n=i.top,r=i.left,s=i.bottom,d=i.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(t,".zh"),h=(0,u.aI)(c,".ri"),p=(0,u.aI)(h,"._a"),v=(0,u.aI)(h,".ab");p.setAttribute("code",e.status.code.toString()),p.innerText=e.status.text,a&&s>0&&n<l&&d>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",e.status.code.toString()),v.innerText=e.status.text,v.classList.remove("kb"),p.setAttribute("displayed","false")},{once:!0}),p.setAttribute("displayed","true"),v.classList.add("kb")):(v.setAttribute("code",e.status.code.toString()),v.innerText=e.status.text)}function o(t,e,a){var i=t.getBoundingClientRect(),n=i.top,r=i.left,s=i.bottom,d=i.right,o=window.innerWidth,l=window.innerHeight,c=(0,u.aI)(t,".zh"),h=(0,u.aI)(c,"._h"),p=(0,u.aI)(h,".bi"),v=(0,u.aI)(h,".ci");p.setAttribute("code",e.ranking.code.toString()),p.innerText=e.ranking.text,a&&s>0&&n<l&&d>0&&r<o?(v.addEventListener("animationend",function(){v.setAttribute("code",e.ranking.code.toString()),v.innerText=e.ranking.text,v.classList.remove("li"),p.setAttribute("displayed","false")},{once:!0}),p.setAttribute("displayed","true"),v.classList.add("li")):(v.setAttribute("code",e.ranking.code.toString()),v.innerText=e.ranking.text)}function l(t,e){var a=(0,u.aI)(t,".zh");(0,u.aI)(a,".mi").innerText=e.route_direction}function c(t,e){var a=(0,u.aI)(t,".zh");(0,u.aI)(a,".ni").innerText=e.route_name}function v(t,e){var a=(0,u.aI)(t,".si"),i=(0,u.aI)(a,".wi"),n=(0,u.jg)(i,".yi"),r=n.length,s=e.buses.length,d=r-s;if(d<0){for(var o=new DocumentFragment,l=0,c=Math.abs(d);l<c;l++){var p=st();o.appendChild(p)}i.append(o)}else for(var v=0,m=Math.abs(d);v<m;v++){n[r-1-v].remove()}for(var f=(0,u.jg)(i,".yi"),g=0;g<s;g++){var b=e.buses[g],y=f[g],A=(0,u.aI)(y,"._i"),I=(0,u.aI)(A,".dj"),C=(0,u.aI)(y,".gj"),L=(0,u.aI)(C,".ij"),x=(0,u.aI)(C,".jj"),E=(0,u.aI)(C,".kj");y.setAttribute("on-this-route",(0,h.xZ)(b.onThisRoute)),I.innerText=b.carNumber,L.innerText=`路線：${b.RouteName}`,x.innerText=`狀態：${b.status.text}`,E.innerText=`類型：${b.type}`}i.setAttribute("empty",(0,h.xZ)(0===s))}function m(t,e){var a=(0,u.aI)(t,".si"),i=(0,u.aI)(a,".xi"),n=(0,u.jg)(i,".zi"),r=n.length,s=e.busArrivalTimes.length,d=r-s;if(d<0){for(var o=new DocumentFragment,l=0,c=Math.abs(d);l<c;l++){var v=dt();o.appendChild(v)}i.append(o)}else for(var m=0,f=Math.abs(d);m<f;m++){n[r-1-m].remove()}for(var g=(0,u.jg)(i,".zi"),b=0;b<s;b++){var y=e.busArrivalTimes[b],A=g[b],I=(0,u.aI)(A,".aj"),C=(0,u.aI)(I,".ej"),L=(0,u.aI)(I,".fj"),x=(0,u.aI)(A,".hj");C.innerText=y.personalSchedule.name,L.innerText=`週${(0,p.kd)(y.day).name} ${(0,p.pn)(y.personalSchedule.period.start)} - ${(0,p.pn)(y.personalSchedule.period.end)}`,x.innerHTML=y.chart}i.setAttribute("empty",(0,h.xZ)(0===s))}function f(t,e){e&&t.setAttribute("stretched","false")}function y(t,e){t.setAttribute("animation",(0,h.xZ)(e))}function A(t,e){t.setAttribute("skeleton-screen",(0,h.xZ)(e))}function I(t,e){var a=(0,u.aI)(t,".si"),i=(0,u.aI)(a,".ti"),n=(0,u.aI)(i,'.ui[type="save-to-folder"]');n.onclick=function(){(0,g.B)("stop",[e.stopId,e.routeId],n)},(0,r.LH)("stop",e.stopId).then(function(t){n.setAttribute("highlighted",(0,h.xZ)(t))})}function C(t,e){var a=(0,u.aI)(t,".si"),i=(0,u.aI)(a,".ti"),n=(0,u.aI)(i,'.ui[type="schedule-notification"]');n.onclick=function(){(0,b.Ho)(n,e.stopId,e.routeId,e.status.time)};var r=(0,d.Zc)(e.stopId);n.setAttribute("highlighted",(0,h.xZ)(r))}null==n?(s(t,i,a),o(t,i,a),l(t,i),c(t,i),v(t,i),m(t,i),f(t,e),y(t,a),A(t,e),I(t,i),C(t,i)):(i.status.time!==n.status.time&&(s(t,i,a),C(t,i)),n.ranking.number===i.ranking.number&&n.ranking.code===i.ranking.code||o(t,i,a),n.stopId!==i.stopId&&(l(t,i),c(t,i),I(t,i)),(0,h.hw)(n.buses,i.buses)||v(t,i),(0,h.hw)(n.busArrivalTimes,i.busArrivalTimes)||m(t,i),a!==Z&&y(t,a),e!==z&&(f(t,e),A(t,e)))}function o(t,i,n){function r(t,e){var a=(0,u.aI)(t,".th");(0,v.yD)(a,e.icon)}function s(t,e){(0,u.aI)(t,".uh").innerHTML=e.value}function d(t,e){t.setAttribute("animation",(0,h.xZ)(e))}function o(t,e){t.setAttribute("skeleton-screen",(0,h.xZ)(e))}null==n?(r(t,i),s(t,i),d(t,a),o(t,e)):((0,h.hw)(n.icon,i.icon)||r(t,i),(0,h.hw)(n.value,i.value)||s(t,i),a!==Z&&d(t,a),e!==z&&o(t,e))}var l=(0,m.gO)("window"),f=l.width,A=l.height,I=t.groupQuantity,C=t.itemQuantity,L=t.groupedItems,M=t.groups;D=I,R=f;for(var S=0,P=0;P<I;P++){var Y=`g_${P}`,H=(0,c.q_)(M[Y].name,500,"17px",'"Noto Sans TC", sans-serif')+20;Q[Y]={width:H,offset:S},S+=H}if(Q[`g_${I}`]={width:0,offset:S},!q){var B=Q[`g_${N}`],F=-1*B.offset+.5*R-.5*B.width,O=B.width-20;tt(D,F,O,N)}(null===(i=$)||void 0===i?void 0:i.hash)!==t.hash&&(w.onclick=function(){(0,y.ID)(t.hash)}),(null===(n=$)||void 0===n?void 0:n.LocationName)!==t.LocationName&&(E.innerText=t.LocationName),Z!==a&&(x.setAttribute("animation",(0,h.xZ)(a)),k.setAttribute("animation",(0,h.xZ)(a))),z!==e&&(x.setAttribute("skeleton-screen",(0,h.xZ)(e)),k.setAttribute("skeleton-screen",(0,h.xZ)(e)),_.setAttribute("skeleton-screen",(0,h.xZ)(e)));var J=(0,u.jg)(j,".ph").length;if(I!==J){var U=J-I;if(U<0){for(var W=new DocumentFragment,K=new DocumentFragment,X=0,G=Math.abs(U);X<G;X++){var V=it();W.appendChild(V);var et=nt();K.appendChild(et)}j.append(W),T.append(K)}else for(var ot=(0,u.jg)(j,".ph"),lt=(0,u.jg)(T,".gh"),ut=0,ct=Math.abs(U);ut<ct;ut++){var ht=J-1-ut;ot[ht].remove(),lt[ht].remove()}}for(var pt=(0,u.jg)(j,".ph"),vt=0;vt<I;vt++){var mt=`g_${vt}`,ft=pt[vt],gt=(0,u.jg)(ft,".xh .yh").length;if(C[mt]!==gt){var bt=gt-C[mt];if(bt<0)for(var yt=(0,u.aI)(ft,".xh"),At=0,It=Math.abs(bt);At<It;At++){var Ct=at();yt.appendChild(Ct)}else for(var Lt=(0,u.jg)(ft,".xh .yh"),xt=0,Et=Math.abs(bt);xt<Et;xt++){Lt[gt-1-xt].remove()}}var wt=(0,u.jg)((0,u.jg)(j,".ph")[vt],".qh .rh .sh").length,jt=M[mt].properties.length;if(jt!==wt){var kt=wt-jt;if(kt<0)for(var Tt=(0,u.aI)(ft,".qh"),_t=(0,u.aI)(Tt,".rh"),Mt=0,St=Math.abs(kt);Mt<St;Mt++){var $t=rt();_t.appendChild($t)}else for(var Zt=(0,u.aI)(ft,".qh"),zt=(0,u.aI)(Zt,".rh"),Nt=(0,u.jg)(zt,".sh"),Pt=0,Dt=Math.abs(kt);Pt<Dt;Pt++){Nt[wt-1-Pt].remove()}}}for(var Qt=(0,u.jg)(T,".gh"),Rt=(0,u.jg)(j,".ph"),qt=0;qt<I;qt++){var Yt=`g_${qt}`,Ht=Qt[qt];(0,u.aI)(Ht,"span").innerText=M[Yt].name,Ht.style.setProperty("--ug",`${Q[Yt].width}px`),Ht.style.setProperty("--hh",qt.toString());for(var Bt=Rt[qt],Ft=(0,u.jg)(Bt,".qh .rh .sh"),Ot=(0,u.jg)(Bt,".xh .yh"),Jt=M[Yt].properties.length,Ut=0;Ut<Jt;Ut++){var Wt=M[Yt].properties[Ut],Kt=Ft[Ut];if((0,h.mQ)($,"groups"))if((0,h.mQ)($.groups,Yt))if($.groups[Yt].properties[Ut])o(Kt,Wt,$.groups[Yt].properties[Ut]);else o(Kt,Wt,null);else o(Kt,Wt,null);else o(Kt,Wt,null)}for(var Xt=0;Xt<C[Yt];Xt++){var Gt=Ot[Xt],Vt=L[Yt][Xt];if((0,h.mQ)($,"groupedItems"))if((0,h.mQ)($.groupedItems,Yt))if($.groupedItems[Yt][Xt])s(Gt,Vt,$.groupedItems[Yt][Xt]);else s(Gt,Vt,null);else s(Gt,Vt,null);else s(Gt,Vt,null)}}$=t,Z=a,z=e}function lt(){return ut.apply(this,arguments)}function ut(){return(ut=(0,i.A)(function*(){var t=(0,l.Js)("playing_animation"),e=(0,l.Js)("refresh_interval"),a=(0,m.gO)("location-bus-arrival-time-chart");F=e.dynamic,Y=e.baseInterval,W=!0,U=(0,h.zx)(),S.setAttribute("refreshing","true"),S.classList.remove("nh"),document.addEventListener(U,et);var i=yield(0,s.R)(G,a.width,a.height,U);ot(i,!1,t);var r=0;F&&(r=yield(0,n.wz)()),O=(new Date).getTime(),J=F?Math.max(O+H,i.dataUpdateTime+Y/r):O+Y,B=Math.max(H,J-O),W=!1,S.setAttribute("refreshing","false"),S.style.setProperty("--zg",`${B}ms`),S.classList.add("nh")})).apply(this,arguments)}function ct(){lt().then(function(){K?setTimeout(function(){ct()},Math.max(H,J-(new Date).getTime())):X=!1}).catch(function(t){K?((0,f.a)("error","地點網路連線中斷，將在10秒後重試。"),setTimeout(function(){ct()},1e4)):X=!1})}function ht(t){(0,m.WR)("Location"),(0,o.XK)("location",t),G=t,N=0,Q={},C.setAttribute("displayed","true"),j.scrollLeft=0,j.focus(),function(t){for(var e=(0,l.Js)("playing_animation"),a=(0,m.gO)("window"),i=(a.width,a.height),n={g_0:Math.floor(i/50)+5,g_1:Math.floor(i/50)+5},r={},s=0;s<2;s++){var d=`g_${s}`;r[d]=[];for(var o=0;o<n[d];o++)r[d].push({route_name:"",route_direction:"",routeId:0,stopId:0,status:{code:8,text:"",time:-6},ranking:{number:0,text:"--",code:-1},buses:[],busArrivalTimes:[]})}ot({groupedItems:r,groupQuantity:2,groups:{g_0:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]},g_1:{name:"載入中",properties:[{key:"0",icon:"",value:""},{key:"1",icon:"",value:""},{key:"2",icon:"",value:""}]}},itemQuantity:n,LocationName:"載入中",hash:t,dataUpdateTime:0},!0,e)}(t),K||(K=!0,X?lt():(X=!0,ct())),(0,m.Z_)()}function pt(){C.setAttribute("displayed","false"),K=!1,(0,m.l$)()}function vt(t,e){var a,i=(0,u.aI)(t,".si"),n=(0,u.aI)(i,".ti"),r=A((0,u.jg)(n,'.ui[highlighted="true"][type="tab"]'));try{for(r.s();!(a=r.n()).done;){a.value.setAttribute("highlighted","false")}}catch(t){r.e(t)}finally{r.f()}switch((0,u.aI)(n,`.ui[code="${e}"]`).setAttribute("highlighted","true"),e){case 0:(0,u.aI)(t,".wi").setAttribute("displayed","true"),(0,u.aI)(t,".xi").setAttribute("displayed","false");break;case 1:(0,u.aI)(t,".wi").setAttribute("displayed","false"),(0,u.aI)(t,".xi").setAttribute("displayed","true")}}}}]);
//# sourceMappingURL=9ad4dfc84b0ae7e7cff7.js.map